
# 企画書：ブラウザ完結型 動画エンコードWebアプリケーション

## 1. プロジェクト概要

* **プロジェクト名** ：クライアントサイド分散処理による「ブラウザ完結型 動画エンコードWebアプリ」構築
* **提案者** ：島村 光輝（スーパーITエンジニア科）
* **日付** ：2025年12月9日

## 2. 背景と目的

### 背景（現状の課題）

一般的な動画変換サービスはサーバー側で演算を行うため、運営者には**莫大なCPU/GPUコスト**がかかり、ユーザーには「プライベートな動画をアップロードする」という**セキュリティ上の不安**があります。

### 目的（ソリューション）

最新のWeb標準技術（WebCodecs API）を活用し、**「サーバー負荷ゼロ（計算コストの分散）」と「プライバシー保護（ローカル処理）」**を両立する動画エンコードシステムを構築します。

また、開発課題要件（PHP/MySQL/MVC）を満たすため、エンコード設定と処理速度（ベンチマーク）を共有する「ナレッジベース機能」を実装します。

## 3. ターゲットとニーズ

* **動画編集初心者** ：「ソフトのインストールは面倒」「ギガ（通信量）を使わずに動画を軽くしたい」
* **開発者・ギーク層** ：「ブラウザの限界性能を試したい」「最適なエンコード設定（AV1等）を知りたい」

## 4. システム機能要件

### Tier 1：コア機能（MVP）

1. **ストリーム書き込み機能（最重要技術）**
   * **課題** ：ブラウザのメモリ上で動画全体を保持すると、数分間の動画でクラッシュする。
   * **解決策** ：`FileSystem Access API` を採用。エンコードされた断片（Chunk）を順次ローカルファイルに書き出し、メモリ枯渇を防ぐ。これにより1080p長尺動画の生成を可能にする。
2. **WebCodecsエンコード処理**
   * ハードウェアアクセラレーションを利用した高速エンコード（H.264, VP9, 可能ならAV1）。
3. **ベンチマーク自動計測**
   * エンコードにかかった時間、平均FPS、圧縮率を自動で記録する。

### Tier 2：ナレッジ共有機能（PHP/MySQL活用）

1. **設定＆スコア投稿API**
   * ユーザーが使用した「設定（JSON）」と、その結果である「ベンチマークスコア」をサーバーへ送信。
2. **プリセット配布機能**
   * サーバー上のDBから推奨設定（HQ / Mobile / Ultra Low）を取得し、UIに反映。

## 5. 技術構成（アーキテクチャ）

### フロントエンド（SPA）

* **Framework** : Svelte（軽量・高速なUI構築）
* **Core API** :
* `WebCodecs API`: 動画のデコード・エンコード
* `FileSystem Access API`: ローカルファイルへの直接書き込み
* `MP4Box.js` / `WebM Muxer`: コンテナ格納（Muxing）処理
* **Validation** : ユーザー環境（ブラウザ）の機能対応状況を判定し、非対応なら警告を表示。

### バックエンド（REST API）

* **Language** : PHP（MVC構成）
* 役割：HTMLの生成は行わず、JSONデータの送受信（API）に特化させる。
* **Database** : MySQL
* 役割：エンコード設定のプリセット管理、およびユーザー投稿データの永続化。

### データベース設計（簡易ER図）

| **テーブル名** | **内容**     | **主なカラム**                                                                                   |
| -------------- | ------------ | ------------------------------------------------------------------------------------------------ |
| **presets**    | 公式設定     | `id`,`name`,`config_json`(設定値)                                                                |
| **posts**      | ユーザー投稿 | `id`,`user_name`,`comment`,`config_json`,`benchmark_result`(処理時間/FPS),`user_agent`(環境情報) |

## 6. UI/UXデザイン方針

* **OneUIライクなモダンデザイン**
  * カード型レイアウト、大きく押しやすいボタン配置。
  * プログレスバーと「残り時間予測」を可視化し、待機ストレスを軽減。
* **パフォーマンスの可視化**
  * 処理完了後に「あなたのPCは〇〇秒で処理しました（スコア：A）」といったリザルト画面を表示し、共有（投稿）を促す。

## 7. 開発スケジュール（5週間）

* **Week 1：設計フェーズ**
  * UIワイヤーフレーム作成（Figma等）
  * DBスキーマ定義、APIエンドポイント設計
  * **技術検証** ：FileSystem Access APIを使った「巨大ファイルの書き出し」テスト
* **Week 2-3：コア機能実装（高難易度）**
  * WebCodecsによるデコード・エンコードパイプラインの構築
  * Muxing（MP4化）とファイル保存の実装
* **Week 4：バックエンド実装**
  * PHPによるAPI実装（投稿・取得）
  * MySQLデータベース構築と接続
* **Week 5：統合・テスト**
  * フロントとバックの結合
  * ブラウザ互換性チェック（Chrome / Edge）
  * 最終調整

## 8. リスクと対策

* **リスク** ：WebCodecs APIの仕様が複雑で、特定環境で動作しない可能性がある。
* **対策** ：ターゲットを「Chrome/Edge（Chromium系）」に絞ることを明記。非対応ブラウザでは閲覧モードのみ提供する。
* **リスク** ：セキュリティ（XSS等）。
* **対策** ：PHP側での入力値検証に加え、フロントエンド表示時にもエスケープ処理を徹底する。

## 9. 結論

本プロジェクトは、学校課題である「PHP/MySQLの実装」を満たしつつ、Web技術の最先端（WebCodecs + FileSystem API）を検証する挑戦的な取り組みです。「サーバーコスト削減」という実用的なメリットも提示できるため、エンジニアとしての技術力をアピールする最適なポートフォリオとなります。
