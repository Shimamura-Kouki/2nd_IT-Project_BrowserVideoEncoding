
# 要件定義書 v3.0

**Version:** 3.0 Final
**Scope:** 展示会向けデモアプリケーション開発

## 1. システム構成図 (概念)

Tailscale環境(Dev) または HTTPSサーバー上で動作するPWA。バックエンド処理は持たず、Litterbox APIへのPOSTのみ外部通信を行う。

## 2. 機能要件

### (1) ユーザーインターフェース (UI)

| 画面モード                      | 要件詳細                                                                                         |
| ------------------------------- | ------------------------------------------------------------------------------------------------ |
| **Simple Mode (Default)** | D&Dエリア、AI解析ボタン、プリセット選択ボタン（スマホ用/添付用）のみを表示。技術用語は隠蔽する。 |
| **Geek Mode**             | トグルスイッチにより展開。左側にプレビュー、右側にダッシュボードとコンソールを表示。             |

### (2) AI制御 & Adaptive Strategy

AIモデルの性能に応じて、生成するコマンドの複雑性と制御方法を動的に切り替える。

* **Safety Mode (Nano等):** AIはJSON形式の設定値のみを出力（`{crf: 23, preset: 'fast'}`）。JS側のテンプレートエンジンがFFmpegコマンドを組み立てる。
* **Advanced Mode (Cloud/High-End):** AIが直接FFmpegの生コマンド（Raw String）を生成。フィルタチェーン等の複雑な処理を許容。
* **Self-Healing (自己修復機能):**
  * Advanced ModeでFFmpegエラーが発生した場合、エラーログをAIにフィードバック。
  * AIは修正したコマンドを再提示する。このプロセス（思考ログ）をコンソールに表示する。

### (3) Geek Dashboard (可視化)

* **圧縮率比較:** 元ファイルサイズ vs 予想/結果サイズのバーグラフ。
* **AI Monitor:** 使用モデル名、推論速度(tokens/sec)、メモリ使用量をリアルタイム表示。
* **Media Info:** ビットレート推移、コーデック詳細。

### (4) エクスポート & The Souvenir

* **QR Code出力:** 最終的に成功したFFmpegコマンドを表示。
* **Colab Notebook生成:**
  * 現在の処理（動画DL→FFmpeg実行）を再現するPythonコード(.ipynb)を動的に生成。
  * **Litterbox連携:** 生成したファイルを `https://litterbox.catbox.moe/` APIへアップロード（有効期限付き）。
  * 発行されたURLをQRコード化して画面に表示。

## 3. 非機能要件

* **Network:** 基本オフライン動作（Litterboxアップロード時のみ通信発生）。
* **Security:** GitHubアカウント連携は行わない（API Key管理リスクの排除）。
* **Performance:** メモリ管理機能を実装し、iOS等のメモリ制限環境でのクラッシュを抑制する。
