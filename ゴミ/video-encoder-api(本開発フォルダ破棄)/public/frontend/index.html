<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ブラウザ完結型 動画エンコーダー</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/mp4-muxer@5.1.1/build/mp4-muxer.min.js"></script>
</head>

<body>
    <div class="container">
        <header>
            <h1>🎬 ブラウザ完結型 動画エンコーダー</h1>
            <p class="subtitle">WebCodecs API を使用した高速動画エンコード</p>
        </header>

        <!-- メインコンテンツエリア -->
        <main>
            <!-- ステップ1: 動画ファイル選択 -->
            <section class="card">
                <h2>📁 ステップ1: 動画ファイルを選択</h2>
                <div class="file-input-wrapper">
                    <input type="file" id="videoFile" accept="video/*" class="file-input">
                    <label for="videoFile" class="file-label">
                        <span id="fileLabel">ファイルを選択</span>
                    </label>
                </div>
                <div id="videoPreview" class="video-preview hidden">
                    <video id="previewVideo" controls></video>
                    <div class="video-info">
                        <p><strong>ファイル名:</strong> <span id="fileName"></span></p>
                        <p><strong>サイズ:</strong> <span id="fileSize"></span></p>
                        <p><strong>時間:</strong> <span id="videoDuration"></span></p>
                    </div>
                </div>
            </section>

            <!-- ステップ2: エンコード設定 -->
            <section class="card">
                <h2>⚙️ ステップ2: エンコード設定</h2>

                <!-- プリセット選択 -->
                <div class="form-group">
                    <label for="presetSelect">プリセット選択:</label>
                    <select id="presetSelect" class="select-input">
                        <option value="">カスタム設定</option>
                    </select>
                </div>

                <!-- 詳細設定 -->
                <div class="settings-grid">
                    <div class="form-group">
                        <label for="codecSelect">コーデック:</label>
                        <select id="codecSelect" class="select-input">
                            <option value="vp09.00.10.08" selected>VP9</option>
                            <option value="vp8">VP8</option>
                            <option value="avc1.42E01E">H.264 (AVC)</option>
                            <option value="av01.0.04M.08">AV1</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="widthInput">幅 (px):</label>
                        <input type="number" id="widthInput" class="text-input" value="1280" min="128" max="3840">
                    </div>

                    <div class="form-group">
                        <label for="heightInput">高さ (px):</label>
                        <input type="number" id="heightInput" class="text-input" value="720" min="128" max="2160">
                    </div>

                    <div class="form-group">
                        <label for="bitrateInput">ビットレート (kbps):</label>
                        <input type="number" id="bitrateInput" class="text-input" value="2500" min="100" max="50000">
                    </div>

                    <div class="form-group">
                        <label for="fpsInput">フレームレート (fps):</label>
                        <input type="number" id="fpsInput" class="text-input" value="30" min="10" max="60">
                    </div>
                </div>
            </section>

            <!-- ステップ3: エンコード実行 -->
            <section class="card">
                <h2>🚀 ステップ3: エンコード実行</h2>
                <button id="startEncode" class="btn btn-primary" disabled>
                    <span id="encodeButtonText">エンコード開始</span>
                </button>

                <!-- プログレスバー -->
                <div id="progressContainer" class="progress-container hidden">
                    <div class="progress-bar">
                        <div id="progressBar" class="progress-fill"></div>
                    </div>
                    <p class="progress-text">
                        <span id="progressPercent">0%</span> -
                        <span id="progressStatus">準備中...</span>
                    </p>
                    <p class="progress-stats">
                        <span id="encodeTime">経過時間: 0.0秒</span> |
                        <span id="encodeFps">速度: 0 fps</span>
                    </p>
                </div>

                <!-- 結果表示 -->
                <div id="resultContainer" class="result-container hidden">
                    <h3>✅ エンコード完了！</h3>
                    <div class="result-stats">
                        <p><strong>エンコード時間:</strong> <span id="resultTime"></span>秒</p>
                        <p><strong>平均速度:</strong> <span id="resultFps"></span> fps</p>
                        <p><strong>出力サイズ:</strong> <span id="resultSize"></span></p>
                    </div>
                    <button id="downloadBtn" class="btn btn-success">
                        📥 エンコード済み動画をダウンロード
                    </button>
                </div>
            </section>

            <!-- ステップ4: ベンチマーク投稿 -->
            <section class="card">
                <h2>📊 ステップ4: ベンチマーク結果を共有（任意）</h2>
                <form id="benchmarkForm" class="benchmark-form">
                    <div class="form-group">
                        <label for="userName">ユーザー名:</label>
                        <input type="text" id="userName" class="text-input" maxlength="30" placeholder="匿名ユーザー"
                            required>
                    </div>
                    <div class="form-group">
                        <label for="userComment">コメント:</label>
                        <textarea id="userComment" class="textarea-input" maxlength="200" rows="3"
                            placeholder="環境や感想など（任意）"></textarea>
                    </div>
                    <button type="submit" class="btn btn-secondary" id="submitBenchmark" disabled>
                        投稿する
                    </button>
                </form>
            </section>

            <!-- ベンチマーク一覧 -->
            <section class="card">
                <h2>🏆 みんなのベンチマーク結果</h2>
                <div class="benchmark-controls">
                    <label for="limitSelect">表示件数:</label>
                    <select id="limitSelect" class="select-input-small">
                        <option value="10">10件</option>
                        <option value="20">20件</option>
                        <option value="50">50件</option>
                    </select>
                    <button id="refreshBtn" class="btn btn-small">🔄 更新</button>
                </div>
                <div id="benchmarkList" class="benchmark-list">
                    <p class="loading">読み込み中...</p>
                </div>
            </section>
        </main>

        <footer>
            <p>&copy; 2025 動画エンコーダープロジェクト | 学校プロジェクト用</p>
        </footer>
    </div>

    <!-- JavaScript読み込み -->
    <script type="module" src="js/api-client.js"></script>
    <script type="module" src="js/video-encoder.js"></script>
    <script type="module" src="js/app.js"></script>
</body>

</html>