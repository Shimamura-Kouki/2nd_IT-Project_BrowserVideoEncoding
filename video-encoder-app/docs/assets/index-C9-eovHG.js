(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))f(u);new MutationObserver(u=>{for(const c of u)if(c.type==="childList")for(const v of c.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&f(v)}).observe(document,{childList:!0,subtree:!0});function h(u){const c={};return u.integrity&&(c.integrity=u.integrity),u.referrerPolicy&&(c.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?c.credentials="include":u.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function f(u){if(u.ep)return;u.ep=!0;const c=h(u);fetch(u.href,c)}})();const Si=!1;var Ri=Array.isArray,wn=Array.prototype.indexOf,ui=Array.from,bn=Object.defineProperty,Fe=Object.getOwnPropertyDescriptor,Un=Object.getOwnPropertyDescriptors,En=Object.prototype,Bn=Array.prototype,xr=Object.getPrototypeOf,nr=Object.isExtensible;function Cn(n){return n()}function wi(n){for(var a=0;a<n.length;a++)n[a]()}function Sr(){var n,a,h=new Promise((f,u)=>{n=f,a=u});return{promise:h,resolve:n,reject:a}}const Q=2,ri=4,qe=8,wr=1<<24,Lt=16,Dt=32,fe=64,Oi=128,gt=512,tt=1024,nt=2048,Mt=4096,ct=8192,Yt=16384,Ni=32768,me=65536,sr=1<<17,br=1<<18,we=1<<19,Ur=1<<20,Vt=1<<25,se=32768,bi=1<<21,Gi=1<<22,qt=1<<23,Qt=Symbol("$state"),ye=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function An(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Tn(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function In(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function zn(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Fn(n){throw new Error("https://svelte.dev/e/effect_orphan")}function Pn(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function kn(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Ln(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Dn(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Mn(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Rn=1,On=2,Nn=16,Gn=1,Hn=2,$=Symbol();function Vn(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Yn(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Er(n){return n===this.v}function qn(n,a){return n!=n?a==a:n!==a||n!==null&&typeof n=="object"||typeof n=="function"}function Br(n){return!qn(n,this.v)}let We=!1,Wn=!1;function jn(){We=!0}let W=null;function xe(n){W=n}function Cr(n,a=!1,h){W={p:W,i:!1,c:null,e:null,s:n,x:null,l:We&&!a?{s:null,u:null,$:[]}:null}}function Ar(n){var a=W,h=a.e;if(h!==null){a.e=null;for(var f of h)Yr(f)}return a.i=!0,W=a.p,{}}function je(){return!We||W!==null&&W.l===null}let ge=[];function Kn(){var n=ge;ge=[],wi(n)}function pi(n){if(ge.length===0){var a=ge;queueMicrotask(()=>{a===ge&&Kn()})}ge.push(n)}function Tr(n){var a=N;if(a===null)return D.f|=qt,n;if(a.f&Ni)Se(n,a);else{if(!(a.f&Oi))throw n;a.b.error(n)}}function Se(n,a){for(;a!==null;){if(a.f&Oi)try{a.b.error(n);return}catch(h){n=h}a=a.parent}throw n}const Xn=-7169;function Z(n,a){n.f=n.f&Xn|a}function Hi(n){n.f&gt||n.deps===null?Z(n,tt):Z(n,Mt)}function Ir(n){if(n!==null)for(const a of n)!(a.f&Q)||!(a.f&se)||(a.f^=se,Ir(a.deps))}function zr(n,a,h){n.f&nt?a.add(n):n.f&Mt&&h.add(n),Ir(n.deps),Z(n,tt)}const $e=new Set;let V=null,Je=null,mt=null,Et=[],Vi=null,Ui=!1;class At{committed=!1;current=new Map;previous=new Map;#e=new Set;#a=new Set;#t=0;#n=0;#s=null;#r=new Set;#i=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#n>0}process(a){Et=[],Je=null,this.apply();var h=[],f=[];for(const u of a)this.#o(u,h,f);this.is_fork||this.#h(),this.is_deferred()?(this.#l(f),this.#l(h)):(Je=this,V=null,ar(f),ar(h),Je=null,this.#s?.resolve()),mt=null}#o(a,h,f){a.f^=tt;for(var u=a.first,c=null;u!==null;){var v=u.f,s=(v&(Dt|fe))!==0,x=s&&(v&tt)!==0,g=x||(v&ct)!==0||this.skipped_effects.has(u);if(!g&&u.fn!==null){s?u.f^=tt:c!==null&&v&(ri|qe|wr)?c.b.defer_effect(u):v&ri?h.push(u):Xe(u)&&(v&Lt&&this.#r.add(u),Ge(u));var E=u.first;if(E!==null){u=E;continue}}var B=u.parent;for(u=u.next;u===null&&B!==null;)B===c&&(c=null),u=B.next,B=B.parent}}#l(a){for(var h=0;h<a.length;h+=1)zr(a[h],this.#r,this.#i)}capture(a,h){h!==$&&!this.previous.has(a)&&this.previous.set(a,h),a.f&qt||(this.current.set(a,a.v),mt?.set(a,a.v))}activate(){V=this,this.apply()}deactivate(){V===this&&(V=null,mt=null)}flush(){if(this.activate(),Et.length>0){if(Zn(),V!==null&&V!==this)return}else this.#t===0&&this.process([]);this.deactivate()}discard(){for(const a of this.#a)a(this);this.#a.clear()}#h(){if(this.#n===0){for(const a of this.#e)a();this.#e.clear()}this.#t===0&&this.#f()}#f(){if($e.size>1){this.previous.clear();var a=mt,h=!0;for(const u of $e){if(u===this){h=!1;continue}const c=[];for(const[s,x]of this.current){if(u.current.has(s))if(h&&x!==u.current.get(s))u.current.set(s,x);else continue;c.push(s)}if(c.length===0)continue;const v=[...u.current.keys()].filter(s=>!this.current.has(s));if(v.length>0){var f=Et;Et=[];const s=new Set,x=new Map;for(const g of c)Fr(g,v,s,x);if(Et.length>0){V=u,u.apply();for(const g of Et)u.#o(g,[],[]);u.deactivate()}Et=f}}V=null,mt=a}this.committed=!0,$e.delete(this)}increment(a){this.#t+=1,a&&(this.#n+=1)}decrement(a){this.#t-=1,a&&(this.#n-=1),this.revive()}revive(){for(const a of this.#r)this.#i.delete(a),Z(a,nt),Pt(a);for(const a of this.#i)Z(a,Mt),Pt(a);this.flush()}oncommit(a){this.#e.add(a)}ondiscard(a){this.#a.add(a)}settled(){return(this.#s??=Sr()).promise}static ensure(){if(V===null){const a=V=new At;$e.add(V),At.enqueue(()=>{V===a&&a.flush()})}return V}static enqueue(a){pi(a)}apply(){}}function Zn(){var n=ie;Ui=!0;var a=null;try{var h=0;for(ai(!0);Et.length>0;){var f=At.ensure();if(h++>1e3){var u,c;$n()}f.process(Et),Wt.clear()}}finally{Ui=!1,ai(n),Vi=null}}function $n(){try{Pn()}catch(n){Se(n,Vi)}}let zt=null;function ar(n){var a=n.length;if(a!==0){for(var h=0;h<a;){var f=n[h++];if(!(f.f&(Yt|ct))&&Xe(f)&&(zt=new Set,Ge(f),f.deps===null&&f.first===null&&f.nodes===null&&(f.teardown===null&&f.ac===null?jr(f):f.fn=null),zt?.size>0)){Wt.clear();for(const u of zt){if(u.f&(Yt|ct))continue;const c=[u];let v=u.parent;for(;v!==null;)zt.has(v)&&(zt.delete(v),c.push(v)),v=v.parent;for(let s=c.length-1;s>=0;s--){const x=c[s];x.f&(Yt|ct)||Ge(x)}}zt.clear()}}zt=null}}function Fr(n,a,h,f){if(!h.has(n)&&(h.add(n),n.reactions!==null))for(const u of n.reactions){const c=u.f;c&Q?Fr(u,a,h,f):c&(Gi|Lt)&&!(c&nt)&&Pr(u,a,f)&&(Z(u,nt),Pt(u))}}function Pr(n,a,h){const f=h.get(n);if(f!==void 0)return f;if(n.deps!==null)for(const u of n.deps){if(a.includes(u))return!0;if(u.f&Q&&Pr(u,a,h))return h.set(u,!0),!0}return h.set(n,!1),!1}function Pt(n){for(var a=Vi=n;a.parent!==null;){a=a.parent;var h=a.f;if(Ui&&a===N&&h&Lt&&!(h&br))return;if(h&(fe|Dt)){if(!(h&tt))return;a.f^=tt}}Et.push(a)}function Jn(n){let a=0,h=ae(0),f;return()=>{Wi()&&(F(h),gs(()=>(a===0&&(f=_i(()=>n(()=>Pe(h)))),a+=1,()=>{pi(()=>{a-=1,a===0&&(f?.(),f=void 0,Pe(h))})})))}}var Qn=me|we|Oi;function ts(n,a,h){new es(n,a,h)}class es{parent;is_pending=!1;#e;#a=null;#t;#n;#s;#r=null;#i=null;#o=null;#l=null;#h=null;#f=0;#d=0;#p=!1;#c=new Set;#_=new Set;#u=null;#x=Jn(()=>(this.#u=ae(this.#f),()=>{this.#u=null}));constructor(a,h,f){this.#e=a,this.#t=h,this.#n=f,this.parent=N.b,this.is_pending=!!this.#t.pending,this.#s=Ki(()=>{N.b=this;{var u=this.#g();try{this.#r=yt(()=>f(u))}catch(c){this.error(c)}this.#d>0?this.#y():this.is_pending=!1}return()=>{this.#h?.remove()}},Qn)}#S(){try{this.#r=yt(()=>this.#n(this.#e))}catch(a){this.error(a)}}#w(){const a=this.#t.pending;a&&(this.#i=yt(()=>a(this.#e)),At.enqueue(()=>{var h=this.#g();this.#r=this.#v(()=>(At.ensure(),yt(()=>this.#n(h)))),this.#d>0?this.#y():(ee(this.#i,()=>{this.#i=null}),this.is_pending=!1)}))}#g(){var a=this.#e;return this.is_pending&&(this.#h=te(),this.#e.before(this.#h),a=this.#h),a}defer_effect(a){zr(a,this.#c,this.#_)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#t.pending}#v(a){var h=N,f=D,u=W;Tt(this.#s),ot(this.#s),xe(this.#s.ctx);try{return a()}catch(c){return Tr(c),null}finally{Tt(h),ot(f),xe(u)}}#y(){const a=this.#t.pending;this.#r!==null&&(this.#l=document.createDocumentFragment(),this.#l.append(this.#h),Zr(this.#r,this.#l)),this.#i===null&&(this.#i=yt(()=>a(this.#e)))}#m(a){if(!this.has_pending_snippet()){this.parent&&this.parent.#m(a);return}if(this.#d+=a,this.#d===0){this.is_pending=!1;for(const h of this.#c)Z(h,nt),Pt(h);for(const h of this.#_)Z(h,Mt),Pt(h);this.#c.clear(),this.#_.clear(),this.#i&&ee(this.#i,()=>{this.#i=null}),this.#l&&(this.#e.before(this.#l),this.#l=null)}}update_pending_count(a){this.#m(a),this.#f+=a,this.#u&&oe(this.#u,this.#f)}get_effect_pending(){return this.#x(),F(this.#u)}error(a){var h=this.#t.onerror;let f=this.#t.failed;if(this.#p||!h&&!f)throw a;this.#r&&(lt(this.#r),this.#r=null),this.#i&&(lt(this.#i),this.#i=null),this.#o&&(lt(this.#o),this.#o=null);var u=!1,c=!1;const v=()=>{if(u){Yn();return}u=!0,c&&Mn(),At.ensure(),this.#f=0,this.#o!==null&&ee(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#r=this.#v(()=>(this.#p=!1,yt(()=>this.#n(this.#e)))),this.#d>0?this.#y():this.is_pending=!1};var s=D;try{ot(null),c=!0,h?.(a,v),c=!1}catch(x){Se(x,this.#s&&this.#s.parent)}finally{ot(s)}f&&pi(()=>{this.#o=this.#v(()=>{At.ensure(),this.#p=!0;try{return yt(()=>{f(this.#e,()=>a,()=>v)})}catch(x){return Se(x,this.#s.parent),null}finally{this.#p=!1}})})}}function is(n,a,h,f){const u=je()?Yi:kr;if(h.length===0&&n.length===0){f(a.map(u));return}var c=V,v=N,s=rs();function x(){Promise.all(h.map(g=>ns(g))).then(g=>{s();try{f([...a.map(u),...g])}catch(E){v.f&Yt||Se(E,v)}c?.deactivate(),ni()}).catch(g=>{Se(g,v)})}n.length>0?Promise.all(n).then(()=>{s();try{return x()}finally{c?.deactivate(),ni()}}):x()}function rs(){var n=N,a=D,h=W,f=V;return function(c=!0){Tt(n),ot(a),xe(h),c&&f?.activate()}}function ni(){Tt(null),ot(null),xe(null)}function Yi(n){var a=Q|nt,h=D!==null&&D.f&Q?D:null;return N!==null&&(N.f|=we),{ctx:W,deps:null,effects:null,equals:Er,f:a,fn:n,reactions:null,rv:0,v:$,wv:0,parent:h??N,ac:null}}function ns(n,a,h){let f=N;f===null&&Tn();var u=f.b,c=void 0,v=ae($),s=!D,x=new Map;return ys(()=>{var g=Sr();c=g.promise;try{Promise.resolve(n()).then(g.resolve,g.reject).then(()=>{E===V&&E.committed&&E.deactivate(),ni()})}catch(T){g.reject(T),ni()}var E=V;if(s){var B=u.is_rendered();u.update_pending_count(1),E.increment(B),x.get(E)?.reject(ye),x.delete(E),x.set(E,g)}const C=(T,y=void 0)=>{if(E.activate(),y)y!==ye&&(v.f|=qt,oe(v,y));else{v.f&qt&&(v.f^=qt),oe(v,T);for(const[M,t]of x){if(x.delete(M),M===E)break;t.reject(ye)}}s&&(u.update_pending_count(-1),E.decrement(B))};g.promise.then(C,T=>C(null,T||"unknown"))}),ji(()=>{for(const g of x.values())g.reject(ye)}),new Promise(g=>{function E(B){function C(){B===c?g(v):E(c)}B.then(C,C)}E(c)})}function kr(n){const a=Yi(n);return a.equals=Br,a}function Lr(n){var a=n.effects;if(a!==null){n.effects=null;for(var h=0;h<a.length;h+=1)lt(a[h])}}function ss(n){for(var a=n.parent;a!==null;){if(!(a.f&Q))return a.f&Yt?null:a;a=a.parent}return null}function qi(n){var a,h=N;Tt(ss(n));try{n.f&=~se,Lr(n),a=tn(n)}finally{Tt(h)}return a}function Dr(n){var a=qi(n);if(!n.equals(a)&&(n.wv=Jr(),(!V?.is_fork||n.deps===null)&&(n.v=a,n.deps===null))){Z(n,tt);return}le||(mt!==null?(Wi()||V?.is_fork)&&mt.set(n,a):Hi(n))}let Ei=new Set;const Wt=new Map;let Mr=!1;function ae(n,a){var h={f:0,v:n,reactions:null,equals:Er,rv:0,wv:0};return h}function Rt(n,a){const h=ae(n);return bs(h),h}function Ut(n,a=!1,h=!0){const f=ae(n);return a||(f.equals=Br),We&&h&&W!==null&&W.l!==null&&(W.l.s??=[]).push(f),f}function X(n,a,h=!1){D!==null&&(!xt||D.f&sr)&&je()&&D.f&(Q|Lt|Gi|sr)&&!Ft?.includes(n)&&Dn();let f=h?Ee(a):a;return oe(n,f)}function oe(n,a){if(!n.equals(a)){var h=n.v;le?Wt.set(n,a):Wt.set(n,h),n.v=a;var f=At.ensure();if(f.capture(n,h),n.f&Q){const u=n;n.f&nt&&qi(u),Hi(u)}n.wv=Jr(),Rr(n,nt),je()&&N!==null&&N.f&tt&&!(N.f&(Dt|fe))&&(_t===null?Us([n]):_t.push(n)),!f.is_fork&&Ei.size>0&&!Mr&&as()}return a}function as(){Mr=!1;var n=ie;ai(!0);const a=Array.from(Ei);try{for(const h of a)h.f&tt&&Z(h,Mt),Xe(h)&&Ge(h)}finally{ai(n)}Ei.clear()}function Pe(n){X(n,n.v+1)}function Rr(n,a){var h=n.reactions;if(h!==null)for(var f=je(),u=h.length,c=0;c<u;c++){var v=h[c],s=v.f;if(!(!f&&v===N)){var x=(s&nt)===0;if(x&&Z(v,a),s&Q){var g=v;mt?.delete(g),s&se||(s&gt&&(v.f|=se),Rr(g,Mt))}else x&&(s&Lt&&zt!==null&&zt.add(v),Pt(v))}}}function Ee(n){if(typeof n!="object"||n===null||Qt in n)return n;const a=xr(n);if(a!==En&&a!==Bn)return n;var h=new Map,f=Ri(n),u=Rt(0),c=re,v=s=>{if(re===c)return s();var x=D,g=re;ot(null),dr(c);var E=s();return ot(x),dr(g),E};return f&&h.set("length",Rt(n.length)),new Proxy(n,{defineProperty(s,x,g){(!("value"in g)||g.configurable===!1||g.enumerable===!1||g.writable===!1)&&kn();var E=h.get(x);return E===void 0?E=v(()=>{var B=Rt(g.value);return h.set(x,B),B}):X(E,g.value,!0),!0},deleteProperty(s,x){var g=h.get(x);if(g===void 0){if(x in s){const E=v(()=>Rt($));h.set(x,E),Pe(u)}}else X(g,$),Pe(u);return!0},get(s,x,g){if(x===Qt)return n;var E=h.get(x),B=x in s;if(E===void 0&&(!B||Fe(s,x)?.writable)&&(E=v(()=>{var T=Ee(B?s[x]:$),y=Rt(T);return y}),h.set(x,E)),E!==void 0){var C=F(E);return C===$?void 0:C}return Reflect.get(s,x,g)},getOwnPropertyDescriptor(s,x){var g=Reflect.getOwnPropertyDescriptor(s,x);if(g&&"value"in g){var E=h.get(x);E&&(g.value=F(E))}else if(g===void 0){var B=h.get(x),C=B?.v;if(B!==void 0&&C!==$)return{enumerable:!0,configurable:!0,value:C,writable:!0}}return g},has(s,x){if(x===Qt)return!0;var g=h.get(x),E=g!==void 0&&g.v!==$||Reflect.has(s,x);if(g!==void 0||N!==null&&(!E||Fe(s,x)?.writable)){g===void 0&&(g=v(()=>{var C=E?Ee(s[x]):$,T=Rt(C);return T}),h.set(x,g));var B=F(g);if(B===$)return!1}return E},set(s,x,g,E){var B=h.get(x),C=x in s;if(f&&x==="length")for(var T=g;T<B.v;T+=1){var y=h.get(T+"");y!==void 0?X(y,$):T in s&&(y=v(()=>Rt($)),h.set(T+"",y))}if(B===void 0)(!C||Fe(s,x)?.writable)&&(B=v(()=>Rt(void 0)),X(B,Ee(g)),h.set(x,B));else{C=B.v!==$;var M=v(()=>Ee(g));X(B,M)}var t=Reflect.getOwnPropertyDescriptor(s,x);if(t?.set&&t.set.call(E,g),!C){if(f&&typeof x=="string"){var e=h.get("length"),r=Number(x);Number.isInteger(r)&&r>=e.v&&X(e,r+1)}Pe(u)}return!0},ownKeys(s){F(u);var x=Reflect.ownKeys(s).filter(B=>{var C=h.get(B);return C===void 0||C.v!==$});for(var[g,E]of h)E.v!==$&&!(g in s)&&x.push(g);return x},setPrototypeOf(){Ln()}})}function or(n){try{if(n!==null&&typeof n=="object"&&Qt in n)return n[Qt]}catch{}return n}function os(n,a){return Object.is(or(n),or(a))}var lr,Or,Nr,Gr;function ls(){if(lr===void 0){lr=window,Or=/Firefox/.test(navigator.userAgent);var n=Element.prototype,a=Node.prototype,h=Text.prototype;Nr=Fe(a,"firstChild").get,Gr=Fe(a,"nextSibling").get,nr(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),nr(h)&&(h.__t=void 0)}}function te(n=""){return document.createTextNode(n)}function si(n){return Nr.call(n)}function Ke(n){return Gr.call(n)}function rt(n,a){return si(n)}function hs(n,a=!1){{var h=si(n);return h instanceof Comment&&h.data===""?Ke(h):h}}function bt(n,a=1,h=!1){let f=n;for(;a--;)f=Ke(f);return f}function fs(n){n.textContent=""}function Hr(){return!1}let hr=!1;function ds(){hr||(hr=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const a of n.target.elements)a.__on_r?.()})},{capture:!0}))}function ci(n){var a=D,h=N;ot(null),Tt(null);try{return n()}finally{ot(a),Tt(h)}}function us(n,a,h,f=h){n.addEventListener(a,()=>ci(h));const u=n.__on_r;u?n.__on_r=()=>{u(),f(!0)}:n.__on_r=()=>f(!0),ds()}function Vr(n){N===null&&(D===null&&Fn(),zn()),le&&In()}function ps(n,a){var h=a.last;h===null?a.last=a.first=n:(h.next=n,n.prev=h,a.last=n)}function It(n,a,h){var f=N;f!==null&&f.f&ct&&(n|=ct);var u={ctx:W,deps:null,nodes:null,f:n|nt|gt,first:null,fn:a,last:null,next:null,parent:f,b:f&&f.b,prev:null,teardown:null,wv:0,ac:null};if(h)try{Ge(u),u.f|=Ni}catch(s){throw lt(u),s}else a!==null&&Pt(u);var c=u;if(h&&c.deps===null&&c.teardown===null&&c.nodes===null&&c.first===c.last&&!(c.f&we)&&(c=c.first,n&Lt&&n&me&&c!==null&&(c.f|=me)),c!==null&&(c.parent=f,f!==null&&ps(c,f),D!==null&&D.f&Q&&!(n&fe))){var v=D;(v.effects??=[]).push(c)}return u}function Wi(){return D!==null&&!xt}function ji(n){const a=It(qe,null,!1);return Z(a,tt),a.teardown=n,a}function Bi(n){Vr();var a=N.f,h=!D&&(a&Dt)!==0&&(a&Ni)===0;if(h){var f=W;(f.e??=[]).push(n)}else return Yr(n)}function Yr(n){return It(ri|Ur,n,!1)}function cs(n){return Vr(),It(qe|Ur,n,!0)}function _s(n){At.ensure();const a=It(fe|we,n,!0);return(h={})=>new Promise(f=>{h.outro?ee(a,()=>{lt(a),f(void 0)}):(lt(a),f(void 0))})}function vs(n){return It(ri,n,!1)}function ys(n){return It(Gi|we,n,!0)}function gs(n,a=0){return It(qe|a,n,!0)}function Xt(n,a=[],h=[],f=[]){is(f,a,h,u=>{It(qe,()=>n(...u.map(F)),!0)})}function Ki(n,a=0){var h=It(Lt|a,n,!0);return h}function yt(n){return It(Dt|we,n,!0)}function qr(n){var a=n.teardown;if(a!==null){const h=le,f=D;fr(!0),ot(null);try{a.call(null)}finally{fr(h),ot(f)}}}function Wr(n,a=!1){var h=n.first;for(n.first=n.last=null;h!==null;){const u=h.ac;u!==null&&ci(()=>{u.abort(ye)});var f=h.next;h.f&fe?h.parent=null:lt(h,a),h=f}}function ms(n){for(var a=n.first;a!==null;){var h=a.next;a.f&Dt||lt(a),a=h}}function lt(n,a=!0){var h=!1;(a||n.f&br)&&n.nodes!==null&&n.nodes.end!==null&&(xs(n.nodes.start,n.nodes.end),h=!0),Wr(n,a&&!h),oi(n,0),Z(n,Yt);var f=n.nodes&&n.nodes.t;if(f!==null)for(const c of f)c.stop();qr(n);var u=n.parent;u!==null&&u.first!==null&&jr(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes=n.ac=null}function xs(n,a){for(;n!==null;){var h=n===a?null:Ke(n);n.remove(),n=h}}function jr(n){var a=n.parent,h=n.prev,f=n.next;h!==null&&(h.next=f),f!==null&&(f.prev=h),a!==null&&(a.first===n&&(a.first=f),a.last===n&&(a.last=h))}function ee(n,a,h=!0){var f=[];Kr(n,f,!0);var u=()=>{h&&lt(n),a&&a()},c=f.length;if(c>0){var v=()=>--c||u();for(var s of f)s.out(v)}else u()}function Kr(n,a,h){if(!(n.f&ct)){n.f^=ct;var f=n.nodes&&n.nodes.t;if(f!==null)for(const s of f)(s.is_global||h)&&a.push(s);for(var u=n.first;u!==null;){var c=u.next,v=(u.f&me)!==0||(u.f&Dt)!==0&&(n.f&Lt)!==0;Kr(u,a,v?h:!1),u=c}}}function Xi(n){Xr(n,!0)}function Xr(n,a){if(n.f&ct){n.f^=ct,n.f&tt||(Z(n,nt),Pt(n));for(var h=n.first;h!==null;){var f=h.next,u=(h.f&me)!==0||(h.f&Dt)!==0;Xr(h,u?a:!1),h=f}var c=n.nodes&&n.nodes.t;if(c!==null)for(const v of c)(v.is_global||a)&&v.in()}}function Zr(n,a){if(n.nodes)for(var h=n.nodes.start,f=n.nodes.end;h!==null;){var u=h===f?null:Ke(h);a.append(h),h=u}}let _e=null;function Ss(n){var a=_e;try{if(_e=new Set,_i(n),a!==null)for(var h of _e)a.add(h);return _e}finally{_e=a}}function ws(n){for(var a of Ss(n))oe(a,a.v)}let ie=!1;function ai(n){ie=n}let le=!1;function fr(n){le=n}let D=null,xt=!1;function ot(n){D=n}let N=null;function Tt(n){N=n}let Ft=null;function bs(n){D!==null&&(Ft===null?Ft=[n]:Ft.push(n))}let at=null,dt=0,_t=null;function Us(n){_t=n}let $r=1,Jt=0,re=Jt;function dr(n){re=n}function Jr(){return++$r}function Xe(n){var a=n.f;if(a&nt)return!0;if(a&Q&&(n.f&=~se),a&Mt){for(var h=n.deps,f=h.length,u=0;u<f;u++){var c=h[u];if(Xe(c)&&Dr(c),c.wv>n.wv)return!0}a&gt&&mt===null&&Z(n,tt)}return!1}function Qr(n,a,h=!0){var f=n.reactions;if(f!==null&&!Ft?.includes(n))for(var u=0;u<f.length;u++){var c=f[u];c.f&Q?Qr(c,a,!1):a===c&&(h?Z(c,nt):c.f&tt&&Z(c,Mt),Pt(c))}}function tn(n){var a=at,h=dt,f=_t,u=D,c=Ft,v=W,s=xt,x=re,g=n.f;at=null,dt=0,_t=null,D=g&(Dt|fe)?null:n,Ft=null,xe(n.ctx),xt=!1,re=++Jt,n.ac!==null&&(ci(()=>{n.ac.abort(ye)}),n.ac=null);try{n.f|=bi;var E=n.fn,B=E(),C=n.deps;if(at!==null){var T;if(oi(n,dt),C!==null&&dt>0)for(C.length=dt+at.length,T=0;T<at.length;T++)C[dt+T]=at[T];else n.deps=C=at;if(Wi()&&n.f&gt)for(T=dt;T<C.length;T++)(C[T].reactions??=[]).push(n)}else C!==null&&dt<C.length&&(oi(n,dt),C.length=dt);if(je()&&_t!==null&&!xt&&C!==null&&!(n.f&(Q|Mt|nt)))for(T=0;T<_t.length;T++)Qr(_t[T],n);if(u!==null&&u!==n){if(Jt++,u.deps!==null)for(let y=0;y<h;y+=1)u.deps[y].rv=Jt;if(a!==null)for(const y of a)y.rv=Jt;_t!==null&&(f===null?f=_t:f.push(..._t))}return n.f&qt&&(n.f^=qt),B}catch(y){return Tr(y)}finally{n.f^=bi,at=a,dt=h,_t=f,D=u,Ft=c,xe(v),xt=s,re=x}}function Es(n,a){let h=a.reactions;if(h!==null){var f=wn.call(h,n);if(f!==-1){var u=h.length-1;u===0?h=a.reactions=null:(h[f]=h[u],h.pop())}}if(h===null&&a.f&Q&&(at===null||!at.includes(a))){var c=a;c.f&gt&&(c.f^=gt,c.f&=~se),Hi(c),Lr(c),oi(c,0)}}function oi(n,a){var h=n.deps;if(h!==null)for(var f=a;f<h.length;f++)Es(n,h[f])}function Ge(n){var a=n.f;if(!(a&Yt)){Z(n,tt);var h=N,f=ie;N=n,ie=!0;try{a&(Lt|wr)?ms(n):Wr(n),qr(n);var u=tn(n);n.teardown=typeof u=="function"?u:null,n.wv=$r;var c;Si&&Wn&&n.f&nt&&n.deps}finally{ie=f,N=h}}}function F(n){var a=n.f,h=(a&Q)!==0;if(_e?.add(n),D!==null&&!xt){var f=N!==null&&(N.f&Yt)!==0;if(!f&&!Ft?.includes(n)){var u=D.deps;if(D.f&bi)n.rv<Jt&&(n.rv=Jt,at===null&&u!==null&&u[dt]===n?dt++:at===null?at=[n]:at.push(n));else{(D.deps??=[]).push(n);var c=n.reactions;c===null?n.reactions=[D]:c.includes(D)||c.push(D)}}}if(le&&Wt.has(n))return Wt.get(n);if(h){var v=n;if(le){var s=v.v;return(!(v.f&tt)&&v.reactions!==null||rn(v))&&(s=qi(v)),Wt.set(v,s),s}var x=(v.f&gt)===0&&!xt&&D!==null&&(ie||(D.f&gt)!==0),g=v.deps===null;Xe(v)&&(x&&(v.f|=gt),Dr(v)),x&&!g&&en(v)}if(mt?.has(n))return mt.get(n);if(n.f&qt)throw n.v;return n.v}function en(n){if(n.deps!==null){n.f|=gt;for(const a of n.deps)(a.reactions??=[]).push(n),a.f&Q&&!(a.f&gt)&&en(a)}}function rn(n){if(n.v===$)return!0;if(n.deps===null)return!1;for(const a of n.deps)if(Wt.has(a)||a.f&Q&&rn(a))return!0;return!1}function _i(n){var a=xt;try{return xt=!0,n()}finally{xt=a}}function Bs(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(Qt in n)Ci(n);else if(!Array.isArray(n))for(let a in n){const h=n[a];typeof h=="object"&&h&&Qt in h&&Ci(h)}}}function Ci(n,a=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!a.has(n)){a.add(n),n instanceof Date&&n.getTime();for(let f in n)try{Ci(n[f],a)}catch{}const h=xr(n);if(h!==Object.prototype&&h!==Array.prototype&&h!==Map.prototype&&h!==Set.prototype&&h!==Date.prototype){const f=Un(h);for(let u in f){const c=f[u].get;if(c)try{c.call(n)}catch{}}}}}const Cs=["touchstart","touchmove"];function As(n){return Cs.includes(n)}const Ts=new Set,ur=new Set;function Is(n,a,h,f={}){function u(c){if(f.capture||Be.call(a,c),!c.cancelBubble)return ci(()=>h?.call(this,c))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?pi(()=>{a.addEventListener(n,u,f)}):a.addEventListener(n,u,f),u}function gi(n,a,h,f,u){var c={capture:f,passive:u},v=Is(n,a,h,c);(a===document.body||a===window||a===document||a instanceof HTMLMediaElement)&&ji(()=>{a.removeEventListener(n,v,c)})}let pr=null;function Be(n){var a=this,h=a.ownerDocument,f=n.type,u=n.composedPath?.()||[],c=u[0]||n.target;pr=n;var v=0,s=pr===n&&n.__root;if(s){var x=u.indexOf(s);if(x!==-1&&(a===document||a===window)){n.__root=a;return}var g=u.indexOf(a);if(g===-1)return;x<=g&&(v=x)}if(c=u[v]||n.target,c!==a){bn(n,"currentTarget",{configurable:!0,get(){return c||h}});var E=D,B=N;ot(null),Tt(null);try{for(var C,T=[];c!==null;){var y=c.assignedSlot||c.parentNode||c.host||null;try{var M=c["__"+f];M!=null&&(!c.disabled||n.target===c)&&M.call(c,n)}catch(t){C?T.push(t):C=t}if(n.cancelBubble||y===a||y===null)break;c=y}if(C){for(let t of T)queueMicrotask(()=>{throw t});throw C}}finally{n.__root=a,delete n.currentTarget,ot(E),Tt(B)}}}function zs(n){var a=document.createElement("template");return a.innerHTML=n.replaceAll("<!>","<!---->"),a.content}function cr(n,a){var h=N;h.nodes===null&&(h.nodes={start:n,end:a,a:null,t:null})}function jt(n,a){var h=(a&Gn)!==0,f=(a&Hn)!==0,u,c=!n.startsWith("<!>");return()=>{u===void 0&&(u=zs(c?n:"<!>"+n),h||(u=si(u)));var v=f||Or?document.importNode(u,!0):u.cloneNode(!0);if(h){var s=si(v),x=v.lastChild;cr(s,x)}else cr(v,v);return v}}function Ot(n,a){n!==null&&n.before(a)}function pe(n,a){var h=a==null?"":typeof a=="object"?a+"":a;h!==(n.__t??=n.nodeValue)&&(n.__t=h,n.nodeValue=h+"")}function Fs(n,a){return Ps(n,a)}const ce=new Map;function Ps(n,{target:a,anchor:h,props:f={},events:u,context:c,intro:v=!0}){ls();var s=new Set,x=B=>{for(var C=0;C<B.length;C++){var T=B[C];if(!s.has(T)){s.add(T);var y=As(T);a.addEventListener(T,Be,{passive:y});var M=ce.get(T);M===void 0?(document.addEventListener(T,Be,{passive:y}),ce.set(T,1)):ce.set(T,M+1)}}};x(ui(Ts)),ur.add(x);var g=void 0,E=_s(()=>{var B=h??a.appendChild(te());return ts(B,{pending:()=>{}},C=>{if(c){Cr({});var T=W;T.c=c}u&&(f.$$events=u),g=n(C,f)||{},c&&Ar()}),()=>{for(var C of s){a.removeEventListener(C,Be);var T=ce.get(C);--T===0?(document.removeEventListener(C,Be),ce.delete(C)):ce.set(C,T)}ur.delete(x),B!==h&&B.parentNode?.removeChild(B)}});return ks.set(g,E),g}let ks=new WeakMap;class Ls{anchor;#e=new Map;#a=new Map;#t=new Map;#n=new Set;#s=!0;constructor(a,h=!0){this.anchor=a,this.#s=h}#r=()=>{var a=V;if(this.#e.has(a)){var h=this.#e.get(a),f=this.#a.get(h);if(f)Xi(f),this.#n.delete(h);else{var u=this.#t.get(h);u&&(this.#a.set(h,u.effect),this.#t.delete(h),u.fragment.lastChild.remove(),this.anchor.before(u.fragment),f=u.effect)}for(const[c,v]of this.#e){if(this.#e.delete(c),c===a)break;const s=this.#t.get(v);s&&(lt(s.effect),this.#t.delete(v))}for(const[c,v]of this.#a){if(c===h||this.#n.has(c))continue;const s=()=>{if(Array.from(this.#e.values()).includes(c)){var g=document.createDocumentFragment();Zr(v,g),g.append(te()),this.#t.set(c,{effect:v,fragment:g})}else lt(v);this.#n.delete(c),this.#a.delete(c)};this.#s||!f?(this.#n.add(c),ee(v,s,!1)):s()}}};#i=a=>{this.#e.delete(a);const h=Array.from(this.#e.values());for(const[f,u]of this.#t)h.includes(f)||(lt(u.effect),this.#t.delete(f))};ensure(a,h){var f=V,u=Hr();if(h&&!this.#a.has(a)&&!this.#t.has(a))if(u){var c=document.createDocumentFragment(),v=te();c.append(v),this.#t.set(a,{effect:yt(()=>h(v)),fragment:c})}else this.#a.set(a,yt(()=>h(this.anchor)));if(this.#e.set(f,a),u){for(const[s,x]of this.#a)s===a?f.skipped_effects.delete(x):f.skipped_effects.add(x);for(const[s,x]of this.#t)s===a?f.skipped_effects.delete(x.effect):f.skipped_effects.add(x.effect);f.oncommit(this.#r),f.ondiscard(this.#i)}else this.#r()}}function Ue(n,a,h=!1){var f=new Ls(n),u=h?me:0;function c(v,s){f.ensure(v,s)}Ki(()=>{var v=!1;a((s,x=!0)=>{v=!0,c(x,s)}),v||c(!1,null)},u)}function Ds(n,a){return a}function Ms(n,a,h){for(var f=[],u=a.length,c,v=a.length,s=0;s<u;s++){let B=a[s];ee(B,()=>{if(c){if(c.pending.delete(B),c.done.add(B),c.pending.size===0){var C=n.outrogroups;Ai(ui(c.done)),C.delete(c),C.size===0&&(n.outrogroups=null)}}else v-=1},!1)}if(v===0){var x=f.length===0&&h!==null;if(x){var g=h,E=g.parentNode;fs(E),E.append(g),n.items.clear()}Ai(a,!x)}else c={pending:new Set(a),done:new Set},(n.outrogroups??=new Set).add(c)}function Ai(n,a=!0){for(var h=0;h<n.length;h++)lt(n[h],a)}var _r;function Rs(n,a,h,f,u,c=null){var v=n,s=new Map;{var x=n;v=x.appendChild(te())}var g=null,E=kr(()=>{var t=h();return Ri(t)?t:t==null?[]:ui(t)}),B,C=!0;function T(){M.fallback=g,Os(M,B,v,a,f),g!==null&&(B.length===0?g.f&Vt?(g.f^=Vt,Ce(g,null,v)):Xi(g):ee(g,()=>{g=null}))}var y=Ki(()=>{B=F(E);for(var t=B.length,e=new Set,r=V,o=Hr(),l=0;l<t;l+=1){var d=B[l],p=f(d,l),_=C?null:s.get(p);_?(_.v&&oe(_.v,d),_.i&&oe(_.i,l),o&&r.skipped_effects.delete(_.e)):(_=Ns(s,C?v:_r??=te(),d,p,l,u,a,h),C||(_.e.f|=Vt),s.set(p,_)),e.add(p)}if(t===0&&c&&!g&&(C?g=yt(()=>c(v)):(g=yt(()=>c(_r??=te())),g.f|=Vt)),!C)if(o){for(const[m,w]of s)e.has(m)||r.skipped_effects.add(w.e);r.oncommit(T),r.ondiscard(()=>{})}else T();F(E)}),M={effect:y,items:s,outrogroups:null,fallback:g};C=!1}function Os(n,a,h,f,u){var c=a.length,v=n.items,s=n.effect.first,x,g=null,E=[],B=[],C,T,y,M;for(M=0;M<c;M+=1){if(C=a[M],T=u(C,M),y=v.get(T).e,n.outrogroups!==null)for(const m of n.outrogroups)m.pending.delete(y),m.done.delete(y);if(y.f&Vt)if(y.f^=Vt,y===s)Ce(y,null,h);else{var t=g?g.next:s;y===n.effect.last&&(n.effect.last=y.prev),y.prev&&(y.prev.next=y.next),y.next&&(y.next.prev=y.prev),Nt(n,g,y),Nt(n,y,t),Ce(y,t,h),g=y,E=[],B=[],s=g.next;continue}if(y.f&ct&&Xi(y),y!==s){if(x!==void 0&&x.has(y)){if(E.length<B.length){var e=B[0],r;g=e.prev;var o=E[0],l=E[E.length-1];for(r=0;r<E.length;r+=1)Ce(E[r],e,h);for(r=0;r<B.length;r+=1)x.delete(B[r]);Nt(n,o.prev,l.next),Nt(n,g,o),Nt(n,l,e),s=e,g=l,M-=1,E=[],B=[]}else x.delete(y),Ce(y,s,h),Nt(n,y.prev,y.next),Nt(n,y,g===null?n.effect.first:g.next),Nt(n,g,y),g=y;continue}for(E=[],B=[];s!==null&&s!==y;)(x??=new Set).add(s),B.push(s),s=s.next;if(s===null)continue}y.f&Vt||E.push(y),g=y,s=y.next}if(n.outrogroups!==null){for(const m of n.outrogroups)m.pending.size===0&&(Ai(ui(m.done)),n.outrogroups?.delete(m));n.outrogroups.size===0&&(n.outrogroups=null)}if(s!==null||x!==void 0){var d=[];if(x!==void 0)for(y of x)y.f&ct||d.push(y);for(;s!==null;)!(s.f&ct)&&s!==n.fallback&&d.push(s),s=s.next;var p=d.length;if(p>0){var _=c===0?h:null;Ms(n,d,_)}}}function Ns(n,a,h,f,u,c,v,s){var x=v&Rn?v&Nn?ae(h):Ut(h,!1,!1):null,g=v&On?ae(u):null;return{v:x,i:g,e:yt(()=>(c(a,x??h,g??u,s),()=>{n.delete(f)}))}}function Ce(n,a,h){if(n.nodes)for(var f=n.nodes.start,u=n.nodes.end,c=a&&!(a.f&Vt)?a.nodes.start:h;f!==null;){var v=Ke(f);if(c.before(f),f===u)return;f=v}}function Nt(n,a,h){a===null?n.effect.first=h:a.next=h,h===null?n.effect.last=a:h.prev=a}function Gs(n,a){return n==null?null:String(n)}function Hs(n,a,h,f){var u=n.__style;if(u!==a){var c=Gs(a);c==null?n.removeAttribute("style"):n.style.cssText=c,n.__style=a}return f}function nn(n,a,h=!1){if(n.multiple){if(a==null)return;if(!Ri(a))return Vn();for(var f of n.options)f.selected=a.includes(ke(f));return}for(f of n.options){var u=ke(f);if(os(u,a)){f.selected=!0;return}}(!h||a!==void 0)&&(n.selectedIndex=-1)}function Vs(n){var a=new MutationObserver(()=>{nn(n,n.__value)});a.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ji(()=>{a.disconnect()})}function Ys(n,a,h=a){var f=new WeakSet,u=!0;us(n,"change",c=>{var v=c?"[selected]":":checked",s;if(n.multiple)s=[].map.call(n.querySelectorAll(v),ke);else{var x=n.querySelector(v)??n.querySelector("option:not([disabled])");s=x&&ke(x)}h(s),V!==null&&f.add(V)}),vs(()=>{var c=a();if(n===document.activeElement){var v=Je??V;if(f.has(v))return}if(nn(n,c,u),u&&c===void 0){var s=n.querySelector(":checked");s!==null&&(c=ke(s),h(c))}n.__value=c,u=!1}),Vs(n)}function ke(n){return"__value"in n?n.__value:n.value}function qs(n=!1){const a=W,h=a.l.u;if(!h)return;let f=()=>Bs(a.s);if(n){let u=0,c={};const v=Yi(()=>{let s=!1;const x=a.s;for(const g in x)x[g]!==c[g]&&(c[g]=x[g],s=!0);return s&&u++,u});f=()=>F(v)}h.b.length&&cs(()=>{vr(a,f),wi(h.b)}),Bi(()=>{const u=_i(()=>h.m.map(Cn));return()=>{for(const c of u)typeof c=="function"&&c()}}),h.a.length&&Bi(()=>{vr(a,f),wi(h.a)})}function vr(n,a){if(n.l.s)for(const h of n.l.s)F(h);a()}function Ws(n){W===null&&An(),We&&W.l!==null?js(W).m.push(n):Bi(()=>{const a=_i(n);if(typeof a=="function")return a})}function js(n){var a=n.l;return a.u??={a:[],b:[],m:[]}}const Ks="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Ks);jn();var Zi=(n,a,h)=>{if(!a.has(n))throw TypeError("Cannot "+h)},S=(n,a,h)=>(Zi(n,a,"read from private field"),h?h.call(n):a.get(n)),k=(n,a,h)=>{if(a.has(n))throw TypeError("Cannot add the same private member more than once");a instanceof WeakSet?a.add(n):a.set(n,h)},J=(n,a,h,f)=>(Zi(n,a,"write to private field"),a.set(n,h),h),Y=(n,a,h)=>(Zi(n,a,"access private method"),h),R=new Uint8Array(8),kt=new DataView(R.buffer),vt=n=>[(n%256+256)%256],G=n=>(kt.setUint16(0,n,!1),[R[0],R[1]]),Xs=n=>(kt.setInt16(0,n,!1),[R[0],R[1]]),sn=n=>(kt.setUint32(0,n,!1),[R[1],R[2],R[3]]),z=n=>(kt.setUint32(0,n,!1),[R[0],R[1],R[2],R[3]]),Zs=n=>(kt.setUint32(0,Math.floor(n/2**32),!1),kt.setUint32(4,n,!1),[R[0],R[1],R[2],R[3],R[4],R[5],R[6],R[7]]),$i=n=>(kt.setInt16(0,2**8*n,!1),[R[0],R[1]]),Ct=n=>(kt.setInt32(0,2**16*n,!1),[R[0],R[1],R[2],R[3]]),mi=n=>(kt.setInt32(0,2**30*n,!1),[R[0],R[1],R[2],R[3]]),Bt=(n,a=!1)=>{let h=Array(n.length).fill(null).map((f,u)=>n.charCodeAt(u));return a&&h.push(0),h},he=n=>n&&n[n.length-1],He=(n,a,h=!0)=>{let f=n*a;return h?Math.round(f):f},an=n=>{let a=n*(Math.PI/180),h=Math.cos(a),f=Math.sin(a);return[h,f,0,-f,h,0,0,0,1]},$s=an(0),on=n=>[Ct(n[0]),Ct(n[1]),mi(n[2]),Ct(n[3]),Ct(n[4]),mi(n[5]),Ct(n[6]),Ct(n[7]),mi(n[8])],Le=n=>!n||typeof n!="object"?n:Array.isArray(n)?n.map(Le):Object.fromEntries(Object.entries(n).map(([a,h])=>[a,Le(h)])),et=(n,a,h)=>({type:n,contents:a&&new Uint8Array(a.flat(10)),children:h}),it=(n,a,h,f,u)=>et(n,[vt(a),sn(h),f??[]],u),Js=n=>n?et("ftyp",[Bt("isom"),z(0),Bt("iso4"),Bt("hvc1")]):et("ftyp",[Bt("isom"),z(0),Bt("isom"),Bt("avc1"),Bt("mp41")]),yr=n=>({type:"mdat",largeSize:n}),Qs=n=>({type:"free",size:n}),xi=(n,a)=>et("moov",null,[ta(a,n),...n.map(h=>ea(h,a))]),ta=(n,a)=>{let h=He(Math.max(0,...a.filter(u=>u.samples.length>0).map(u=>he(u.samples).timestamp+he(u.samples).duration)),zi),f=Math.max(...a.map(u=>u.id))+1;return it("mvhd",0,0,[z(n),z(n),z(zi),z(h),Ct(1),$i(1),Array(10).fill(0),on($s),Array(24).fill(0),z(f)])},ea=(n,a)=>et("trak",null,[ia(n,a),ra(n,a)]),ia=(n,a)=>{let h=he(n.samples),f=He(h?h.timestamp+h.duration:0,zi);return it("tkhd",0,3,[z(a),z(a),z(n.id),z(0),z(f),Array(8).fill(0),G(0),G(0),$i(n.info.type==="audio"?1:0),G(0),on(an(n.info.type==="video"?n.info.rotation:0)),Ct(n.info.type==="video"?n.info.width:0),Ct(n.info.type==="video"?n.info.height:0)])},ra=(n,a)=>et("mdia",null,[na(n,a),sa(n.info.type==="video"?"vide":"soun"),aa(n)]),na=(n,a)=>{let h=he(n.samples),f=He(h?h.timestamp+h.duration:0,n.timescale);return it("mdhd",0,0,[z(a),z(a),z(n.timescale),z(f),G(21956),G(0)])},sa=n=>it("hdlr",0,0,[Bt("mhlr"),Bt(n),z(0),z(0),z(0),Bt("mp4-muxer-hdlr")]),aa=n=>et("minf",null,[n.info.type==="video"?oa():la(),ha(),ua(n)]),oa=()=>it("vmhd",0,1,[G(0),G(0),G(0),G(0)]),la=()=>it("smhd",0,0,[G(0),G(0)]),ha=()=>et("dinf",null,[fa()]),fa=()=>it("dref",0,0,[z(1)],[da()]),da=()=>it("url ",0,1),ua=n=>et("stbl",null,[pa(n),wa(n),ba(n),Ua(n),Ea(n),Ba(n)]),pa=n=>it("stsd",0,0,[z(1)],[n.info.type==="video"?ca(Ca[n.info.codec],n):ma(Ta[n.info.codec],n)]),ca=(n,a)=>et(n,[Array(6).fill(0),G(1),G(0),G(0),Array(12).fill(0),G(a.info.width),G(a.info.height),z(4718592),z(4718592),z(0),G(1),Array(32).fill(0),G(24),Xs(65535)],[Aa[a.info.codec](a)]),_a=n=>n.codecPrivate&&et("avcC",[...n.codecPrivate]),va=n=>n.codecPrivate&&et("hvcC",[...n.codecPrivate]),ya=n=>n.codecPrivate&&et("vpcC",[...n.codecPrivate]),ga=n=>n.codecPrivate&&et("av1C",[...n.codecPrivate]),ma=(n,a)=>et(n,[Array(6).fill(0),G(1),G(0),G(0),z(0),G(a.info.numberOfChannels),G(16),G(0),G(0),Ct(a.info.sampleRate)],[Ia[a.info.codec](a)]),xa=n=>it("esds",0,0,[z(58753152),vt(32+n.codecPrivate.byteLength),G(1),vt(0),z(75530368),vt(18+n.codecPrivate.byteLength),vt(64),vt(21),sn(0),z(130071),z(130071),z(92307584),vt(n.codecPrivate.byteLength),...n.codecPrivate,z(109084800),vt(1),vt(2)]),Sa=n=>et("dOps",[vt(0),vt(n.info.numberOfChannels),G(3840),z(n.info.sampleRate),$i(0),vt(0)]),wa=n=>it("stts",0,0,[z(n.timeToSampleTable.length),n.timeToSampleTable.map(a=>[z(a.sampleCount),z(a.sampleDelta)])]),ba=n=>{if(n.samples.every(h=>h.type==="key"))return null;let a=[...n.samples.entries()].filter(([,h])=>h.type==="key");return it("stss",0,0,[z(a.length),a.map(([h])=>z(h+1))])},Ua=n=>it("stsc",0,0,[z(n.compactlyCodedChunkTable.length),n.compactlyCodedChunkTable.map(a=>[z(a.firstChunk),z(a.samplesPerChunk),z(1)])]),Ea=n=>it("stsz",0,0,[z(0),z(n.samples.length),n.samples.map(a=>z(a.size))]),Ba=n=>n.finalizedChunks.length>0&&he(n.finalizedChunks).offset>=2**32?it("co64",0,0,[z(n.finalizedChunks.length),n.finalizedChunks.map(a=>Zs(a.offset))]):it("stco",0,0,[z(n.finalizedChunks.length),n.finalizedChunks.map(a=>z(a.offset))]),Ca={avc:"avc1",hevc:"hvc1",vp9:"vp09",av1:"av01"},Aa={avc:_a,hevc:va,vp9:ya,av1:ga},Ta={aac:"mp4a",opus:"Opus"},Ia={aac:xa,opus:Sa},za=class{constructor(){this.buffer=null}},ln=class{constructor(n,a,h){this.onData=n,this.onDone=a,this.options=h}},hn=class{constructor(n,a){this.stream=n,this.options=a}},Zt,ve,Ji=class{constructor(){this.pos=0,k(this,Zt,new Uint8Array(8)),k(this,ve,new DataView(S(this,Zt).buffer)),this.offsets=new WeakMap}seek(n){this.pos=n}writeU32(n){S(this,ve).setUint32(0,n,!1),this.write(S(this,Zt).subarray(0,4))}writeU64(n){S(this,ve).setUint32(0,Math.floor(n/2**32),!1),S(this,ve).setUint32(4,n,!1),this.write(S(this,Zt).subarray(0,8))}writeAscii(n){for(let a=0;a<n.length;a++)S(this,ve).setUint8(a%8,n.charCodeAt(a)),a%8===7&&this.write(S(this,Zt));n.length%8!==0&&this.write(S(this,Zt).subarray(0,n.length%8))}writeBox(n){if(this.offsets.set(n,this.pos),n.contents&&!n.children)this.writeBoxHeader(n,n.size??n.contents.byteLength+8),this.write(n.contents);else{let a=this.pos;if(this.writeBoxHeader(n,0),n.contents&&this.write(n.contents),n.children)for(let u of n.children)u&&this.writeBox(u);let h=this.pos,f=n.size??h-a;this.seek(a),this.writeBoxHeader(n,f),this.seek(h)}}writeBoxHeader(n,a){this.writeU32(n.largeSize?1:a),this.writeAscii(n.type),n.largeSize&&this.writeU64(a)}measureBoxHeader(n){return 8+(n.largeSize?8:0)}patchBox(n){let a=this.pos;this.seek(this.offsets.get(n)),this.writeBox(n),this.seek(a)}measureBox(n){if(n.contents&&!n.children)return this.measureBoxHeader(n)+n.contents.byteLength;{let a=this.measureBoxHeader(n);if(n.contents&&(a+=n.contents.byteLength),n.children)for(let h of n.children)h&&(a+=this.measureBox(h));return a}}};Zt=new WeakMap;ve=new WeakMap;var Qe,ne,Ve,Ae,ti,Ti,Fa=class extends Ji{constructor(n){super(),k(this,ti),k(this,Qe,void 0),k(this,ne,new ArrayBuffer(2**16)),k(this,Ve,new Uint8Array(S(this,ne))),k(this,Ae,0),J(this,Qe,n)}write(n){Y(this,ti,Ti).call(this,this.pos+n.byteLength),S(this,Ve).set(n,this.pos),this.pos+=n.byteLength,J(this,Ae,Math.max(S(this,Ae),this.pos))}finalize(){Y(this,ti,Ti).call(this,this.pos),S(this,Qe).buffer=S(this,ne).slice(0,Math.max(S(this,Ae),this.pos))}};Qe=new WeakMap;ne=new WeakMap;Ve=new WeakMap;Ae=new WeakMap;ti=new WeakSet;Ti=function(n){let a=S(this,ne).byteLength;for(;a<n;)a*=2;if(a===S(this,ne).byteLength)return;let h=new ArrayBuffer(a),f=new Uint8Array(h);f.set(S(this,Ve),0),J(this,ne,h),J(this,Ve,f)};var Te,$t,fn=class extends Ji{constructor(n){super(),k(this,Te,void 0),k(this,$t,[]),J(this,Te,n)}write(n){S(this,$t).push({data:n.slice(),start:this.pos}),this.pos+=n.byteLength}flush(){if(S(this,$t).length===0)return;let n=[],a=[...S(this,$t)].sort((h,f)=>h.start-f.start);n.push({start:a[0].start,size:a[0].data.byteLength});for(let h=1;h<a.length;h++){let f=n[n.length-1],u=a[h];u.start<=f.start+f.size?f.size=Math.max(f.size,u.start+u.data.byteLength-f.start):n.push({start:u.start,size:u.data.byteLength})}for(let h of n){h.data=new Uint8Array(h.size);for(let f of S(this,$t))h.start<=f.start&&f.start<h.start+h.size&&h.data.set(f.data,f.start-h.start);S(this,Te).onData(h.data,h.start)}S(this,$t).length=0}finalize(){S(this,Te).onDone?.()}};Te=new WeakMap;$t=new WeakMap;var Pa=2**24,ka=2,De,St,pt,li,Ii,Qi,dn,tr,un,Me,hi,pn=class extends Ji{constructor(n){if(super(),k(this,li),k(this,Qi),k(this,tr),k(this,Me),k(this,De,void 0),k(this,St,void 0),k(this,pt,[]),J(this,De,n),J(this,St,n.options?.chunkSize??Pa),!Number.isInteger(S(this,St))||S(this,St)<2**10)throw new Error("Invalid StreamTarget options: chunkSize must be an integer not smaller than 1024.")}write(n){Y(this,li,Ii).call(this,n,this.pos),Y(this,Me,hi).call(this),this.pos+=n.byteLength}finalize(){Y(this,Me,hi).call(this,!0),S(this,De).onDone?.()}};De=new WeakMap;St=new WeakMap;pt=new WeakMap;li=new WeakSet;Ii=function(n,a){let h=S(this,pt).findIndex(s=>s.start<=a&&a<s.start+S(this,St));h===-1&&(h=Y(this,tr,un).call(this,a));let f=S(this,pt)[h],u=a-f.start,c=n.subarray(0,Math.min(S(this,St)-u,n.byteLength));f.data.set(c,u);let v={start:u,end:u+c.byteLength};if(Y(this,Qi,dn).call(this,f,v),f.written[0].start===0&&f.written[0].end===S(this,St)&&(f.shouldFlush=!0),S(this,pt).length>ka){for(let s=0;s<S(this,pt).length-1;s++)S(this,pt)[s].shouldFlush=!0;Y(this,Me,hi).call(this)}c.byteLength<n.byteLength&&Y(this,li,Ii).call(this,n.subarray(c.byteLength),a+c.byteLength)};Qi=new WeakSet;dn=function(n,a){let h=0,f=n.written.length-1,u=-1;for(;h<=f;){let c=Math.floor(h+(f-h+1)/2);n.written[c].start<=a.start?(h=c+1,u=c):f=c-1}for(n.written.splice(u+1,0,a),(u===-1||n.written[u].end<a.start)&&u++;u<n.written.length-1&&n.written[u].end>=n.written[u+1].start;)n.written[u].end=Math.max(n.written[u].end,n.written[u+1].end),n.written.splice(u+1,1)};tr=new WeakSet;un=function(n){let h={start:Math.floor(n/S(this,St))*S(this,St),data:new Uint8Array(S(this,St)),written:[],shouldFlush:!1};return S(this,pt).push(h),S(this,pt).sort((f,u)=>f.start-u.start),S(this,pt).indexOf(h)};Me=new WeakSet;hi=function(n=!1){for(let a=0;a<S(this,pt).length;a++){let h=S(this,pt)[a];if(!(!h.shouldFlush&&!n)){for(let f of h.written)S(this,De).onData(h.data.subarray(f.start,f.end),h.start+f.start);S(this,pt).splice(a--,1)}}};var La=class extends pn{constructor(n){super(new ln((a,h)=>n.stream.write({type:"write",data:a,position:h}),void 0,{chunkSize:n.options?.chunkSize}))}},zi=1e3,Da=["avc","hevc","vp9","av1"],Ma=["aac","opus"],Ra=2082844800,Oa=.5,Na=["strict","offset"],L,O,fi,ut,Gt,Ht,Ie,Re,Oe,Fi,cn,Pi,_n,er,vn,ki,yn,ir,gn,ei,Li,rr,mn,Ne,di,Ye,vi,ii,Di,Ga=class{constructor(n){if(k(this,Fi),k(this,Pi),k(this,er),k(this,ki),k(this,ir),k(this,ei),k(this,rr),k(this,Ne),k(this,Ye),k(this,ii),k(this,L,void 0),k(this,O,void 0),k(this,fi,void 0),k(this,ut,void 0),k(this,Gt,null),k(this,Ht,null),k(this,Ie,Math.floor(Date.now()/1e3)+Ra),k(this,Re,[]),k(this,Oe,!1),Y(this,Fi,cn).call(this,n),n.video=Le(n.video),n.audio=Le(n.audio),n.fastStart=Le(n.fastStart),this.target=n.target,J(this,L,{firstTimestampBehavior:"strict",...n}),n.target instanceof za)J(this,O,new Fa(n.target));else if(n.target instanceof ln)J(this,O,n.target.options?.chunked?new pn(n.target):new fn(n.target));else if(n.target instanceof hn)J(this,O,new La(n.target));else throw new Error(`Invalid target: ${n.target}`);Y(this,Pi,_n).call(this),Y(this,ki,yn).call(this)}addVideoChunk(n,a,h){let f=new Uint8Array(n.byteLength);n.copyTo(f),this.addVideoChunkRaw(f,n.type,h??n.timestamp,n.duration,a)}addVideoChunkRaw(n,a,h,f,u){if(Y(this,ii,Di).call(this),!S(this,L).video)throw new Error("No video track declared.");if(typeof S(this,L).fastStart=="object"&&S(this,Gt).samples.length===S(this,L).fastStart.expectedVideoChunks)throw new Error(`Cannot add more video chunks than specified in 'fastStart' (${S(this,L).fastStart.expectedVideoChunks}).`);Y(this,ei,Li).call(this,S(this,Gt),n,a,h,f,u)}addAudioChunk(n,a,h){let f=new Uint8Array(n.byteLength);n.copyTo(f),this.addAudioChunkRaw(f,n.type,h??n.timestamp,n.duration,a)}addAudioChunkRaw(n,a,h,f,u){if(Y(this,ii,Di).call(this),!S(this,L).audio)throw new Error("No audio track declared.");if(typeof S(this,L).fastStart=="object"&&S(this,Ht).samples.length===S(this,L).fastStart.expectedAudioChunks)throw new Error(`Cannot add more audio chunks than specified in 'fastStart' (${S(this,L).fastStart.expectedAudioChunks}).`);Y(this,ei,Li).call(this,S(this,Ht),n,a,h,f,u)}finalize(){if(S(this,Oe))throw new Error("Cannot finalize a muxer more than once.");S(this,Gt)&&Y(this,Ne,di).call(this,S(this,Gt)),S(this,Ht)&&Y(this,Ne,di).call(this,S(this,Ht));let n=[S(this,Gt),S(this,Ht)].filter(Boolean);if(S(this,L).fastStart==="in-memory"){let a;for(let f=0;f<2;f++){let u=xi(n,S(this,Ie)),c=S(this,O).measureBox(u);a=S(this,O).measureBox(S(this,ut));let v=S(this,O).pos+c+a;for(let s of S(this,Re)){s.offset=v;for(let x of s.sampleData)v+=x.byteLength,a+=x.byteLength}if(v<2**32)break;a>=2**32&&(S(this,ut).largeSize=!0)}let h=xi(n,S(this,Ie));S(this,O).writeBox(h),S(this,ut).size=a,S(this,O).writeBox(S(this,ut));for(let f of S(this,Re)){for(let u of f.sampleData)S(this,O).write(u);f.sampleData=null}}else{let a=S(this,O).offsets.get(S(this,ut)),h=S(this,O).pos-a;S(this,ut).size=h,S(this,ut).largeSize=h>=2**32,S(this,O).patchBox(S(this,ut));let f=xi(n,S(this,Ie));if(typeof S(this,L).fastStart=="object"){S(this,O).seek(S(this,fi)),S(this,O).writeBox(f);let u=a-S(this,O).pos;S(this,O).writeBox(Qs(u))}else S(this,O).writeBox(f)}Y(this,Ye,vi).call(this),S(this,O).finalize(),J(this,Oe,!0)}};L=new WeakMap;O=new WeakMap;fi=new WeakMap;ut=new WeakMap;Gt=new WeakMap;Ht=new WeakMap;Ie=new WeakMap;Re=new WeakMap;Oe=new WeakMap;Fi=new WeakSet;cn=function(n){if(n.video){if(!Da.includes(n.video.codec))throw new Error(`Unsupported video codec: ${n.video.codec}`);if(n.video.rotation!==void 0&&![0,90,180,270].includes(n.video.rotation))throw new Error(`Invalid video rotation: ${n.video.rotation}. Has to be 0, 90, 180 or 270.`)}if(n.audio&&!Ma.includes(n.audio.codec))throw new Error(`Unsupported audio codec: ${n.audio.codec}`);if(n.firstTimestampBehavior&&!Na.includes(n.firstTimestampBehavior))throw new Error(`Invalid first timestamp behavior: ${n.firstTimestampBehavior}`);if(typeof n.fastStart=="object"){if(n.video&&n.fastStart.expectedVideoChunks===void 0)throw new Error("'fastStart' is an object but is missing property 'expectedVideoChunks'.");if(n.audio&&n.fastStart.expectedAudioChunks===void 0)throw new Error("'fastStart' is an object but is missing property 'expectedAudioChunks'.")}else if(![!1,"in-memory"].includes(n.fastStart))throw new Error("'fastStart' option must be false, 'in-memory' or an object.")};Pi=new WeakSet;_n=function(){let n=S(this,L).video?.codec==="hevc";if(S(this,O).writeBox(Js(n)),J(this,fi,S(this,O).pos),S(this,L).fastStart==="in-memory")J(this,ut,yr(!1));else{if(typeof S(this,L).fastStart=="object"){let a=Y(this,er,vn).call(this);S(this,O).seek(S(this,O).pos+a)}J(this,ut,yr(!0)),S(this,O).writeBox(S(this,ut))}Y(this,Ye,vi).call(this)};er=new WeakSet;vn=function(){if(typeof S(this,L).fastStart!="object")return;let n=0,a=[S(this,L).fastStart.expectedVideoChunks,S(this,L).fastStart.expectedAudioChunks];for(let h of a)h&&(n+=8*Math.ceil(2/3*h),n+=4*h,n+=12*Math.ceil(2/3*h),n+=4*h,n+=8*h);return n+=4096,n};ki=new WeakSet;yn=function(){if(S(this,L).video&&J(this,Gt,{id:1,info:{type:"video",codec:S(this,L).video.codec,width:S(this,L).video.width,height:S(this,L).video.height,rotation:S(this,L).video.rotation??0},timescale:720,codecPrivate:new Uint8Array(0),samples:[],finalizedChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]}),S(this,L).audio){let n=Y(this,ir,gn).call(this,2,S(this,L).audio.sampleRate,S(this,L).audio.numberOfChannels);J(this,Ht,{id:S(this,L).video?2:1,info:{type:"audio",codec:S(this,L).audio.codec,numberOfChannels:S(this,L).audio.numberOfChannels,sampleRate:S(this,L).audio.sampleRate},timescale:S(this,L).audio.sampleRate,codecPrivate:n,samples:[],finalizedChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]})}};ir=new WeakSet;gn=function(n,a,h){let u=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350].indexOf(a),c=h,v="";v+=n.toString(2).padStart(5,"0"),v+=u.toString(2).padStart(4,"0"),u===15&&(v+=a.toString(2).padStart(24,"0")),v+=c.toString(2).padStart(4,"0");let s=Math.ceil(v.length/8)*8;v=v.padEnd(s,"0");let x=new Uint8Array(v.length/8);for(let g=0;g<v.length;g+=8)x[g/8]=parseInt(v.slice(g,g+8),2);return x};ei=new WeakSet;Li=function(n,a,h,f,u,c){let v=f/1e6,s=u/1e6;if(n.firstTimestamp===void 0&&(n.firstTimestamp=v),v=Y(this,rr,mn).call(this,v,n),n.lastTimestamp=v,(!n.currentChunk||v-n.currentChunk.startTimestamp>=Oa)&&(n.currentChunk&&Y(this,Ne,di).call(this,n),n.currentChunk={startTimestamp:v,sampleData:[],sampleCount:0}),n.currentChunk.sampleData.push(a),n.currentChunk.sampleCount++,c?.decoderConfig?.description&&(n.codecPrivate=new Uint8Array(c.decoderConfig.description)),n.samples.push({timestamp:v,duration:s,size:a.byteLength,type:h}),n.lastTimescaleUnits!==null){let x=He(v,n.timescale,!1),g=Math.round(x-n.lastTimescaleUnits);n.lastTimescaleUnits+=g;let E=he(n.timeToSampleTable);E.sampleCount===1?(E.sampleDelta=g,E.sampleCount++):E.sampleDelta===g?E.sampleCount++:(E.sampleCount--,n.timeToSampleTable.push({sampleCount:2,sampleDelta:g}))}else n.lastTimescaleUnits=0,n.timeToSampleTable.push({sampleCount:1,sampleDelta:He(s,n.timescale)})};rr=new WeakSet;mn=function(n,a){if(S(this,L).firstTimestampBehavior==="strict"&&a.lastTimestamp===-1&&n!==0)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received ${n}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
`);if(S(this,L).firstTimestampBehavior==="offset"&&(n-=a.firstTimestamp),n<a.lastTimestamp)throw new Error(`Timestamps must be monotonically increasing (went from ${a.lastTimestamp*1e6} to ${n*1e6}).`);return n};Ne=new WeakSet;di=function(n){if(n.currentChunk){if((n.compactlyCodedChunkTable.length===0||he(n.compactlyCodedChunkTable).samplesPerChunk!==n.currentChunk.sampleCount)&&n.compactlyCodedChunkTable.push({firstChunk:n.finalizedChunks.length+1,samplesPerChunk:n.currentChunk.sampleCount}),n.finalizedChunks.push(n.currentChunk),S(this,Re).push(n.currentChunk),S(this,L).fastStart==="in-memory"){n.currentChunk.offset=0;return}n.currentChunk.offset=S(this,O).pos;for(let a of n.currentChunk.sampleData)S(this,O).write(a);n.currentChunk.sampleData=null,Y(this,Ye,vi).call(this)}};Ye=new WeakSet;vi=function(){S(this,O)instanceof fn&&S(this,O).flush()};ii=new WeakSet;Di=function(){if(S(this,Oe))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};function Ha(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var xn={};(function(n){var a=function(){var t=new Date,e=4,r=3,o=2,l=1,d=e,p={setLogLevel:function(_){_==this.debug?d=l:_==this.info?d=o:_==this.warn?d=r:(_==this.error,d=e)},debug:function(_,m){console.debug===void 0&&(console.debug=console.log),l>=d&&console.debug("["+a.getDurationString(new Date-t,1e3)+"]","["+_+"]",m)},log:function(_,m){this.debug(_.msg)},info:function(_,m){o>=d&&console.info("["+a.getDurationString(new Date-t,1e3)+"]","["+_+"]",m)},warn:function(_,m){r>=d&&console.warn("["+a.getDurationString(new Date-t,1e3)+"]","["+_+"]",m)},error:function(_,m){e>=d&&console.error("["+a.getDurationString(new Date-t,1e3)+"]","["+_+"]",m)}};return p}();a.getDurationString=function(t,e){var r;function o(w,b){for(var U=""+w,I=U.split(".");I[0].length<b;)I[0]="0"+I[0];return I.join(".")}t<0?(r=!0,t=-t):r=!1;var l=e||1,d=t/l,p=Math.floor(d/3600);d-=p*3600;var _=Math.floor(d/60);d-=_*60;var m=d*1e3;return d=Math.floor(d),m-=d*1e3,m=Math.floor(m),(r?"-":"")+p+":"+o(_,2)+":"+o(d,2)+"."+o(m,3)},a.printRanges=function(t){var e=t.length;if(e>0){for(var r="",o=0;o<e;o++)o>0&&(r+=","),r+="["+a.getDurationString(t.start(o))+","+a.getDurationString(t.end(o))+"]";return r}else return"(empty)"},n.Log=a;var h=function(t){if(t instanceof ArrayBuffer)this.buffer=t,this.dataview=new DataView(t);else throw"Needs an array buffer";this.position=0};h.prototype.getPosition=function(){return this.position},h.prototype.getEndPosition=function(){return this.buffer.byteLength},h.prototype.getLength=function(){return this.buffer.byteLength},h.prototype.seek=function(t){var e=Math.max(0,Math.min(this.buffer.byteLength,t));return this.position=isNaN(e)||!isFinite(e)?0:e,!0},h.prototype.isEos=function(){return this.getPosition()>=this.getEndPosition()},h.prototype.readAnyInt=function(t,e){var r=0;if(this.position+t<=this.buffer.byteLength){switch(t){case 1:e?r=this.dataview.getInt8(this.position):r=this.dataview.getUint8(this.position);break;case 2:e?r=this.dataview.getInt16(this.position):r=this.dataview.getUint16(this.position);break;case 3:if(e)throw"No method for reading signed 24 bits values";r=this.dataview.getUint8(this.position)<<16,r|=this.dataview.getUint8(this.position+1)<<8,r|=this.dataview.getUint8(this.position+2);break;case 4:e?r=this.dataview.getInt32(this.position):r=this.dataview.getUint32(this.position);break;case 8:if(e)throw"No method for reading signed 64 bits values";r=this.dataview.getUint32(this.position)<<32,r|=this.dataview.getUint32(this.position+4);break;default:throw"readInt method not implemented for size: "+t}return this.position+=t,r}else throw"Not enough bytes in buffer"},h.prototype.readUint8=function(){return this.readAnyInt(1,!1)},h.prototype.readUint16=function(){return this.readAnyInt(2,!1)},h.prototype.readUint24=function(){return this.readAnyInt(3,!1)},h.prototype.readUint32=function(){return this.readAnyInt(4,!1)},h.prototype.readUint64=function(){return this.readAnyInt(8,!1)},h.prototype.readString=function(t){if(this.position+t<=this.buffer.byteLength){for(var e="",r=0;r<t;r++)e+=String.fromCharCode(this.readUint8());return e}else throw"Not enough bytes in buffer"},h.prototype.readCString=function(){for(var t=[];;){var e=this.readUint8();if(e!==0)t.push(e);else break}return String.fromCharCode.apply(null,t)},h.prototype.readInt8=function(){return this.readAnyInt(1,!0)},h.prototype.readInt16=function(){return this.readAnyInt(2,!0)},h.prototype.readInt32=function(){return this.readAnyInt(4,!0)},h.prototype.readInt64=function(){return this.readAnyInt(8,!1)},h.prototype.readUint8Array=function(t){for(var e=new Uint8Array(t),r=0;r<t;r++)e[r]=this.readUint8();return e},h.prototype.readInt16Array=function(t){for(var e=new Int16Array(t),r=0;r<t;r++)e[r]=this.readInt16();return e},h.prototype.readUint16Array=function(t){for(var e=new Int16Array(t),r=0;r<t;r++)e[r]=this.readUint16();return e},h.prototype.readUint32Array=function(t){for(var e=new Uint32Array(t),r=0;r<t;r++)e[r]=this.readUint32();return e},h.prototype.readInt32Array=function(t){for(var e=new Int32Array(t),r=0;r<t;r++)e[r]=this.readInt32();return e},n.MP4BoxStream=h;var f=function(t,e,r){this._byteOffset=e||0,t instanceof ArrayBuffer?this.buffer=t:typeof t=="object"?(this.dataView=t,e&&(this._byteOffset+=e)):this.buffer=new ArrayBuffer(t||0),this.position=0,this.endianness=r??f.LITTLE_ENDIAN};f.prototype={},f.prototype.getPosition=function(){return this.position},f.prototype._realloc=function(t){if(this._dynamicSize){var e=this._byteOffset+this.position+t,r=this._buffer.byteLength;if(e<=r){e>this._byteLength&&(this._byteLength=e);return}for(r<1&&(r=1);e>r;)r*=2;var o=new ArrayBuffer(r),l=new Uint8Array(this._buffer),d=new Uint8Array(o,0,l.length);d.set(l),this.buffer=o,this._byteLength=e}},f.prototype._trimAlloc=function(){if(this._byteLength!=this._buffer.byteLength){var t=new ArrayBuffer(this._byteLength),e=new Uint8Array(t),r=new Uint8Array(this._buffer,0,e.length);e.set(r),this.buffer=t}},f.BIG_ENDIAN=!1,f.LITTLE_ENDIAN=!0,f.prototype._byteLength=0,Object.defineProperty(f.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(f.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(t){this._buffer=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(f.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(t){this._byteOffset=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(f.prototype,"dataView",{get:function(){return this._dataView},set:function(t){this._byteOffset=t.byteOffset,this._buffer=t.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+t.byteLength}}),f.prototype.seek=function(t){var e=Math.max(0,Math.min(this.byteLength,t));this.position=isNaN(e)||!isFinite(e)?0:e},f.prototype.isEof=function(){return this.position>=this._byteLength},f.prototype.mapUint8Array=function(t){this._realloc(t*1);var e=new Uint8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=t*1,e},f.prototype.readInt32Array=function(t,e){t=t??this.byteLength-this.position/4;var r=new Int32Array(t);return f.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,t*r.BYTES_PER_ELEMENT),f.arrayToNative(r,e??this.endianness),this.position+=r.byteLength,r},f.prototype.readInt16Array=function(t,e){t=t??this.byteLength-this.position/2;var r=new Int16Array(t);return f.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,t*r.BYTES_PER_ELEMENT),f.arrayToNative(r,e??this.endianness),this.position+=r.byteLength,r},f.prototype.readInt8Array=function(t){t=t??this.byteLength-this.position;var e=new Int8Array(t);return f.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e},f.prototype.readUint32Array=function(t,e){t=t??this.byteLength-this.position/4;var r=new Uint32Array(t);return f.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,t*r.BYTES_PER_ELEMENT),f.arrayToNative(r,e??this.endianness),this.position+=r.byteLength,r},f.prototype.readUint16Array=function(t,e){t=t??this.byteLength-this.position/2;var r=new Uint16Array(t);return f.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,t*r.BYTES_PER_ELEMENT),f.arrayToNative(r,e??this.endianness),this.position+=r.byteLength,r},f.prototype.readUint8Array=function(t){t=t??this.byteLength-this.position;var e=new Uint8Array(t);return f.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e},f.prototype.readFloat64Array=function(t,e){t=t??this.byteLength-this.position/8;var r=new Float64Array(t);return f.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,t*r.BYTES_PER_ELEMENT),f.arrayToNative(r,e??this.endianness),this.position+=r.byteLength,r},f.prototype.readFloat32Array=function(t,e){t=t??this.byteLength-this.position/4;var r=new Float32Array(t);return f.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,t*r.BYTES_PER_ELEMENT),f.arrayToNative(r,e??this.endianness),this.position+=r.byteLength,r},f.prototype.readInt32=function(t){var e=this._dataView.getInt32(this.position,t??this.endianness);return this.position+=4,e},f.prototype.readInt16=function(t){var e=this._dataView.getInt16(this.position,t??this.endianness);return this.position+=2,e},f.prototype.readInt8=function(){var t=this._dataView.getInt8(this.position);return this.position+=1,t},f.prototype.readUint32=function(t){var e=this._dataView.getUint32(this.position,t??this.endianness);return this.position+=4,e},f.prototype.readUint16=function(t){var e=this._dataView.getUint16(this.position,t??this.endianness);return this.position+=2,e},f.prototype.readUint8=function(){var t=this._dataView.getUint8(this.position);return this.position+=1,t},f.prototype.readFloat32=function(t){var e=this._dataView.getFloat32(this.position,t??this.endianness);return this.position+=4,e},f.prototype.readFloat64=function(t){var e=this._dataView.getFloat64(this.position,t??this.endianness);return this.position+=8,e},f.endianness=new Int8Array(new Int16Array([1]).buffer)[0]>0,f.memcpy=function(t,e,r,o,l){var d=new Uint8Array(t,e,l),p=new Uint8Array(r,o,l);d.set(p)},f.arrayToNative=function(t,e){return e==this.endianness?t:this.flipArrayEndianness(t)},f.nativeToEndian=function(t,e){return this.endianness==e?t:this.flipArrayEndianness(t)},f.flipArrayEndianness=function(t){for(var e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),r=0;r<t.byteLength;r+=t.BYTES_PER_ELEMENT)for(var o=r+t.BYTES_PER_ELEMENT-1,l=r;o>l;o--,l++){var d=e[l];e[l]=e[o],e[o]=d}return t},f.prototype.failurePosition=0,String.fromCharCodeUint8=function(t){for(var e=[],r=0;r<t.length;r++)e[r]=t[r];return String.fromCharCode.apply(null,e)},f.prototype.readString=function(t,e){return e==null||e=="ASCII"?String.fromCharCodeUint8.apply(null,[this.mapUint8Array(t??this.byteLength-this.position)]):new TextDecoder(e).decode(this.mapUint8Array(t))},f.prototype.readCString=function(t){var e=this.byteLength-this.position,r=new Uint8Array(this._buffer,this._byteOffset+this.position),o=e;t!=null&&(o=Math.min(t,e));for(var l=0;l<o&&r[l]!==0;l++);var d=String.fromCharCodeUint8.apply(null,[this.mapUint8Array(l)]);return t!=null?this.position+=o-l:l!=e&&(this.position+=1),d};var u=Math.pow(2,32);f.prototype.readInt64=function(){return this.readInt32()*u+this.readUint32()},f.prototype.readUint64=function(){return this.readUint32()*u+this.readUint32()},f.prototype.readInt64=function(){return this.readUint32()*u+this.readUint32()},f.prototype.readUint24=function(){return(this.readUint8()<<16)+(this.readUint8()<<8)+this.readUint8()},n.DataStream=f,f.prototype.save=function(t){var e=new Blob([this.buffer]);if(window.URL&&URL.createObjectURL){var r=window.URL.createObjectURL(e),o=document.createElement("a");document.body.appendChild(o),o.setAttribute("href",r),o.setAttribute("download",t),o.setAttribute("target","_self"),o.click(),window.URL.revokeObjectURL(r)}else throw"DataStream.save: Can't create object URL."},f.prototype._dynamicSize=!0,Object.defineProperty(f.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(t){t||this._trimAlloc(),this._dynamicSize=t}}),f.prototype.shift=function(t){var e=new ArrayBuffer(this._byteLength-t),r=new Uint8Array(e),o=new Uint8Array(this._buffer,t,r.length);r.set(o),this.buffer=e,this.position-=t},f.prototype.writeInt32Array=function(t,e){if(this._realloc(t.length*4),t instanceof Int32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt32Array(t.length,e);else for(var r=0;r<t.length;r++)this.writeInt32(t[r],e)},f.prototype.writeInt16Array=function(t,e){if(this._realloc(t.length*2),t instanceof Int16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt16Array(t.length,e);else for(var r=0;r<t.length;r++)this.writeInt16(t[r],e)},f.prototype.writeInt8Array=function(t){if(this._realloc(t.length*1),t instanceof Int8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt8Array(t.length);else for(var e=0;e<t.length;e++)this.writeInt8(t[e])},f.prototype.writeUint32Array=function(t,e){if(this._realloc(t.length*4),t instanceof Uint32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint32Array(t.length,e);else for(var r=0;r<t.length;r++)this.writeUint32(t[r],e)},f.prototype.writeUint16Array=function(t,e){if(this._realloc(t.length*2),t instanceof Uint16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint16Array(t.length,e);else for(var r=0;r<t.length;r++)this.writeUint16(t[r],e)},f.prototype.writeUint8Array=function(t){if(this._realloc(t.length*1),t instanceof Uint8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint8Array(t.length);else for(var e=0;e<t.length;e++)this.writeUint8(t[e])},f.prototype.writeFloat64Array=function(t,e){if(this._realloc(t.length*8),t instanceof Float64Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat64Array(t.length,e);else for(var r=0;r<t.length;r++)this.writeFloat64(t[r],e)},f.prototype.writeFloat32Array=function(t,e){if(this._realloc(t.length*4),t instanceof Float32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat32Array(t.length,e);else for(var r=0;r<t.length;r++)this.writeFloat32(t[r],e)},f.prototype.writeInt32=function(t,e){this._realloc(4),this._dataView.setInt32(this.position,t,e??this.endianness),this.position+=4},f.prototype.writeInt16=function(t,e){this._realloc(2),this._dataView.setInt16(this.position,t,e??this.endianness),this.position+=2},f.prototype.writeInt8=function(t){this._realloc(1),this._dataView.setInt8(this.position,t),this.position+=1},f.prototype.writeUint32=function(t,e){this._realloc(4),this._dataView.setUint32(this.position,t,e??this.endianness),this.position+=4},f.prototype.writeUint16=function(t,e){this._realloc(2),this._dataView.setUint16(this.position,t,e??this.endianness),this.position+=2},f.prototype.writeUint8=function(t){this._realloc(1),this._dataView.setUint8(this.position,t),this.position+=1},f.prototype.writeFloat32=function(t,e){this._realloc(4),this._dataView.setFloat32(this.position,t,e??this.endianness),this.position+=4},f.prototype.writeFloat64=function(t,e){this._realloc(8),this._dataView.setFloat64(this.position,t,e??this.endianness),this.position+=8},f.prototype.writeUCS2String=function(t,e,r){r==null&&(r=t.length);for(var o=0;o<t.length&&o<r;o++)this.writeUint16(t.charCodeAt(o),e);for(;o<r;o++)this.writeUint16(0)},f.prototype.writeString=function(t,e,r){var o=0;if(e==null||e=="ASCII")if(r!=null){var l=Math.min(t.length,r);for(o=0;o<l;o++)this.writeUint8(t.charCodeAt(o));for(;o<r;o++)this.writeUint8(0)}else for(o=0;o<t.length;o++)this.writeUint8(t.charCodeAt(o));else this.writeUint8Array(new TextEncoder(e).encode(t.substring(0,r)))},f.prototype.writeCString=function(t,e){var r=0;if(e!=null){var o=Math.min(t.length,e);for(r=0;r<o;r++)this.writeUint8(t.charCodeAt(r));for(;r<e;r++)this.writeUint8(0)}else{for(r=0;r<t.length;r++)this.writeUint8(t.charCodeAt(r));this.writeUint8(0)}},f.prototype.writeStruct=function(t,e){for(var r=0;r<t.length;r+=2){var o=t[r+1];this.writeType(o,e[t[r]],e)}},f.prototype.writeType=function(t,e,r){var o;if(typeof t=="function")return t(this,e);if(typeof t=="object"&&!(t instanceof Array))return t.set(this,e,r);var l=null,d="ASCII",p=this.position;switch(typeof t=="string"&&/:/.test(t)&&(o=t.split(":"),t=o[0],l=parseInt(o[1])),typeof t=="string"&&/,/.test(t)&&(o=t.split(","),t=o[0],d=parseInt(o[1])),t){case"uint8":this.writeUint8(e);break;case"int8":this.writeInt8(e);break;case"uint16":this.writeUint16(e,this.endianness);break;case"int16":this.writeInt16(e,this.endianness);break;case"uint32":this.writeUint32(e,this.endianness);break;case"int32":this.writeInt32(e,this.endianness);break;case"float32":this.writeFloat32(e,this.endianness);break;case"float64":this.writeFloat64(e,this.endianness);break;case"uint16be":this.writeUint16(e,f.BIG_ENDIAN);break;case"int16be":this.writeInt16(e,f.BIG_ENDIAN);break;case"uint32be":this.writeUint32(e,f.BIG_ENDIAN);break;case"int32be":this.writeInt32(e,f.BIG_ENDIAN);break;case"float32be":this.writeFloat32(e,f.BIG_ENDIAN);break;case"float64be":this.writeFloat64(e,f.BIG_ENDIAN);break;case"uint16le":this.writeUint16(e,f.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(e,f.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(e,f.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(e,f.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(e,f.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(e,f.LITTLE_ENDIAN);break;case"cstring":this.writeCString(e,l);break;case"string":this.writeString(e,d,l);break;case"u16string":this.writeUCS2String(e,this.endianness,l);break;case"u16stringle":this.writeUCS2String(e,f.LITTLE_ENDIAN,l);break;case"u16stringbe":this.writeUCS2String(e,f.BIG_ENDIAN,l);break;default:if(t.length==3){for(var _=t[1],m=0;m<e.length;m++)this.writeType(_,e[m]);break}else{this.writeStruct(t,e);break}}l!=null&&(this.position=p,this._realloc(l),this.position=p+l)},f.prototype.writeUint64=function(t){var e=Math.floor(t/u);this.writeUint32(e),this.writeUint32(t&4294967295)},f.prototype.writeUint24=function(t){this.writeUint8((t&16711680)>>16),this.writeUint8((t&65280)>>8),this.writeUint8(t&255)},f.prototype.adjustUint32=function(t,e){var r=this.position;this.seek(t),this.writeUint32(e),this.seek(r)},f.prototype.mapInt32Array=function(t,e){this._realloc(t*4);var r=new Int32Array(this._buffer,this.byteOffset+this.position,t);return f.arrayToNative(r,e??this.endianness),this.position+=t*4,r},f.prototype.mapInt16Array=function(t,e){this._realloc(t*2);var r=new Int16Array(this._buffer,this.byteOffset+this.position,t);return f.arrayToNative(r,e??this.endianness),this.position+=t*2,r},f.prototype.mapInt8Array=function(t){this._realloc(t*1);var e=new Int8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=t*1,e},f.prototype.mapUint32Array=function(t,e){this._realloc(t*4);var r=new Uint32Array(this._buffer,this.byteOffset+this.position,t);return f.arrayToNative(r,e??this.endianness),this.position+=t*4,r},f.prototype.mapUint16Array=function(t,e){this._realloc(t*2);var r=new Uint16Array(this._buffer,this.byteOffset+this.position,t);return f.arrayToNative(r,e??this.endianness),this.position+=t*2,r},f.prototype.mapFloat64Array=function(t,e){this._realloc(t*8);var r=new Float64Array(this._buffer,this.byteOffset+this.position,t);return f.arrayToNative(r,e??this.endianness),this.position+=t*8,r},f.prototype.mapFloat32Array=function(t,e){this._realloc(t*4);var r=new Float32Array(this._buffer,this.byteOffset+this.position,t);return f.arrayToNative(r,e??this.endianness),this.position+=t*4,r};var c=function(t){this.buffers=[],this.bufferIndex=-1,t&&(this.insertBuffer(t),this.bufferIndex=0)};c.prototype=new f(new ArrayBuffer,0,f.BIG_ENDIAN),c.prototype.initialized=function(){var t;return this.bufferIndex>-1?!0:this.buffers.length>0?(t=this.buffers[0],t.fileStart===0?(this.buffer=t,this.bufferIndex=0,a.debug("MultiBufferStream","Stream ready for parsing"),!0):(a.warn("MultiBufferStream","The first buffer should have a fileStart of 0"),this.logBufferLevel(),!1)):(a.warn("MultiBufferStream","No buffer to start parsing from"),this.logBufferLevel(),!1)},ArrayBuffer.concat=function(t,e){a.debug("ArrayBuffer","Trying to create a new buffer of size: "+(t.byteLength+e.byteLength));var r=new Uint8Array(t.byteLength+e.byteLength);return r.set(new Uint8Array(t),0),r.set(new Uint8Array(e),t.byteLength),r.buffer},c.prototype.reduceBuffer=function(t,e,r){var o;return o=new Uint8Array(r),o.set(new Uint8Array(t,e,r)),o.buffer.fileStart=t.fileStart+e,o.buffer.usedBytes=0,o.buffer},c.prototype.insertBuffer=function(t){for(var e=!0,r=0;r<this.buffers.length;r++){var o=this.buffers[r];if(t.fileStart<=o.fileStart){if(t.fileStart===o.fileStart)if(t.byteLength>o.byteLength){this.buffers.splice(r,1),r--;continue}else a.warn("MultiBufferStream","Buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+") already appended, ignoring");else t.fileStart+t.byteLength<=o.fileStart||(t=this.reduceBuffer(t,0,o.fileStart-t.fileStart)),a.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.splice(r,0,t),r===0&&(this.buffer=t);e=!1;break}else if(t.fileStart<o.fileStart+o.byteLength){var l=o.fileStart+o.byteLength-t.fileStart,d=t.byteLength-l;if(d>0)t=this.reduceBuffer(t,l,d);else{e=!1;break}}}e&&(a.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.push(t),r===0&&(this.buffer=t))},c.prototype.logBufferLevel=function(t){var e,r,o,l,d=[],p,_="";for(o=0,l=0,e=0;e<this.buffers.length;e++)r=this.buffers[e],e===0?(p={},d.push(p),p.start=r.fileStart,p.end=r.fileStart+r.byteLength,_+="["+p.start+"-"):p.end===r.fileStart?p.end=r.fileStart+r.byteLength:(p={},p.start=r.fileStart,_+=d[d.length-1].end-1+"], ["+p.start+"-",p.end=r.fileStart+r.byteLength,d.push(p)),o+=r.usedBytes,l+=r.byteLength;d.length>0&&(_+=p.end-1+"]");var m=t?a.info:a.debug;this.buffers.length===0?m("MultiBufferStream","No more buffer in memory"):m("MultiBufferStream",""+this.buffers.length+" stored buffer(s) ("+o+"/"+l+" bytes), continuous ranges: "+_)},c.prototype.cleanBuffers=function(){var t,e;for(t=0;t<this.buffers.length;t++)e=this.buffers[t],e.usedBytes===e.byteLength&&(a.debug("MultiBufferStream","Removing buffer #"+t),this.buffers.splice(t,1),t--)},c.prototype.mergeNextBuffer=function(){var t;if(this.bufferIndex+1<this.buffers.length)if(t=this.buffers[this.bufferIndex+1],t.fileStart===this.buffer.fileStart+this.buffer.byteLength){var e=this.buffer.byteLength,r=this.buffer.usedBytes,o=this.buffer.fileStart;return this.buffers[this.bufferIndex]=ArrayBuffer.concat(this.buffer,t),this.buffer=this.buffers[this.bufferIndex],this.buffers.splice(this.bufferIndex+1,1),this.buffer.usedBytes=r,this.buffer.fileStart=o,a.debug("ISOFile","Concatenating buffer for box parsing (length: "+e+"->"+this.buffer.byteLength+")"),!0}else return!1;else return!1},c.prototype.findPosition=function(t,e,r){var o,l=null,d=-1;for(t===!0?o=0:o=this.bufferIndex;o<this.buffers.length&&(l=this.buffers[o],l.fileStart<=e);){d=o,r&&(l.fileStart+l.byteLength<=e?l.usedBytes=l.byteLength:l.usedBytes=e-l.fileStart,this.logBufferLevel());o++}return d!==-1?(l=this.buffers[d],l.fileStart+l.byteLength>=e?(a.debug("MultiBufferStream","Found position in existing buffer #"+d),d):-1):-1},c.prototype.findEndContiguousBuf=function(t){var e,r,o,l=t!==void 0?t:this.bufferIndex;if(r=this.buffers[l],this.buffers.length>l+1)for(e=l+1;e<this.buffers.length&&(o=this.buffers[e],o.fileStart===r.fileStart+r.byteLength);e++)r=o;return r.fileStart+r.byteLength},c.prototype.getEndFilePositionAfter=function(t){var e=this.findPosition(!0,t,!1);return e!==-1?this.findEndContiguousBuf(e):t},c.prototype.addUsedBytes=function(t){this.buffer.usedBytes+=t,this.logBufferLevel()},c.prototype.setAllUsedBytes=function(){this.buffer.usedBytes=this.buffer.byteLength,this.logBufferLevel()},c.prototype.seek=function(t,e,r){var o;return o=this.findPosition(e,t,r),o!==-1?(this.buffer=this.buffers[o],this.bufferIndex=o,this.position=t-this.buffer.fileStart,a.debug("MultiBufferStream","Repositioning parser at buffer position: "+this.position),!0):(a.debug("MultiBufferStream","Position "+t+" not found in buffered data"),!1)},c.prototype.getPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.position},c.prototype.getLength=function(){return this.byteLength},c.prototype.getEndPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.byteLength},n.MultiBufferStream=c;var v=function(){var t=3,e=4,r=5,o=6,l=[];l[t]="ES_Descriptor",l[e]="DecoderConfigDescriptor",l[r]="DecoderSpecificInfo",l[o]="SLConfigDescriptor",this.getDescriptorName=function(_){return l[_]};var d=this,p={};return this.parseOneDescriptor=function(_){var m=0,w,b,U;for(w=_.readUint8(),U=_.readUint8();U&128;)m=(m<<7)+(U&127),U=_.readUint8();return m=(m<<7)+(U&127),a.debug("MPEG4DescriptorParser","Found "+(l[w]||"Descriptor "+w)+", size "+m+" at position "+_.getPosition()),l[w]?b=new p[l[w]](m):b=new p.Descriptor(m),b.parse(_),b},p.Descriptor=function(_,m){this.tag=_,this.size=m,this.descs=[]},p.Descriptor.prototype.parse=function(_){this.data=_.readUint8Array(this.size)},p.Descriptor.prototype.findDescriptor=function(_){for(var m=0;m<this.descs.length;m++)if(this.descs[m].tag==_)return this.descs[m];return null},p.Descriptor.prototype.parseRemainingDescriptors=function(_){for(var m=_.position;_.position<m+this.size;){var w=d.parseOneDescriptor(_);this.descs.push(w)}},p.ES_Descriptor=function(_){p.Descriptor.call(this,t,_)},p.ES_Descriptor.prototype=new p.Descriptor,p.ES_Descriptor.prototype.parse=function(_){if(this.ES_ID=_.readUint16(),this.flags=_.readUint8(),this.size-=3,this.flags&128?(this.dependsOn_ES_ID=_.readUint16(),this.size-=2):this.dependsOn_ES_ID=0,this.flags&64){var m=_.readUint8();this.URL=_.readString(m),this.size-=m+1}else this.URL="";this.flags&32?(this.OCR_ES_ID=_.readUint16(),this.size-=2):this.OCR_ES_ID=0,this.parseRemainingDescriptors(_)},p.ES_Descriptor.prototype.getOTI=function(_){var m=this.findDescriptor(e);return m?m.oti:0},p.ES_Descriptor.prototype.getAudioConfig=function(_){var m=this.findDescriptor(e);if(!m)return null;var w=m.findDescriptor(r);if(w&&w.data){var b=(w.data[0]&248)>>3;return b===31&&w.data.length>=2&&(b=32+((w.data[0]&7)<<3)+((w.data[1]&224)>>5)),b}else return null},p.DecoderConfigDescriptor=function(_){p.Descriptor.call(this,e,_)},p.DecoderConfigDescriptor.prototype=new p.Descriptor,p.DecoderConfigDescriptor.prototype.parse=function(_){this.oti=_.readUint8(),this.streamType=_.readUint8(),this.upStream=(this.streamType>>1&1)!==0,this.streamType=this.streamType>>>2,this.bufferSize=_.readUint24(),this.maxBitrate=_.readUint32(),this.avgBitrate=_.readUint32(),this.size-=13,this.parseRemainingDescriptors(_)},p.DecoderSpecificInfo=function(_){p.Descriptor.call(this,r,_)},p.DecoderSpecificInfo.prototype=new p.Descriptor,p.SLConfigDescriptor=function(_){p.Descriptor.call(this,o,_)},p.SLConfigDescriptor.prototype=new p.Descriptor,this};n.MPEG4DescriptorParser=v;var s={ERR_INVALID_DATA:-1,ERR_NOT_ENOUGH_DATA:0,OK:1,BASIC_BOXES:[{type:"mdat",name:"MediaDataBox"},{type:"idat",name:"ItemDataBox"},{type:"free",name:"FreeSpaceBox"},{type:"skip",name:"FreeSpaceBox"},{type:"meco",name:"AdditionalMetadataContainerBox"},{type:"strk",name:"SubTrackBox"}],FULL_BOXES:[{type:"hmhd",name:"HintMediaHeaderBox"},{type:"nmhd",name:"NullMediaHeaderBox"},{type:"iods",name:"ObjectDescriptorBox"},{type:"xml ",name:"XMLBox"},{type:"bxml",name:"BinaryXMLBox"},{type:"ipro",name:"ItemProtectionBox"},{type:"mere",name:"MetaboxRelationBox"}],CONTAINER_BOXES:[[{type:"moov",name:"CompressedMovieBox"},["trak","pssh"]],[{type:"trak",name:"TrackBox"}],[{type:"edts",name:"EditBox"}],[{type:"mdia",name:"MediaBox"}],[{type:"minf",name:"MediaInformationBox"}],[{type:"dinf",name:"DataInformationBox"}],[{type:"stbl",name:"SampleTableBox"},["sgpd","sbgp"]],[{type:"mvex",name:"MovieExtendsBox"},["trex"]],[{type:"moof",name:"CompressedMovieFragmentBox"},["traf"]],[{type:"traf",name:"TrackFragmentBox"},["trun","sgpd","sbgp"]],[{type:"vttc",name:"VTTCueBox"}],[{type:"tref",name:"TrackReferenceBox"}],[{type:"iref",name:"ItemReferenceBox"}],[{type:"mfra",name:"MovieFragmentRandomAccessBox"},["tfra"]],[{type:"meco",name:"AdditionalMetadataContainerBox"}],[{type:"hnti",name:"trackhintinformation"}],[{type:"hinf",name:"hintstatisticsbox"}],[{type:"strk",name:"SubTrackBox"}],[{type:"strd",name:"SubTrackDefinitionBox"}],[{type:"sinf",name:"ProtectionSchemeInfoBox"}],[{type:"rinf",name:"RestrictedSchemeInfoBox"}],[{type:"schi",name:"SchemeInformationBox"}],[{type:"trgr",name:"TrackGroupBox"}],[{type:"udta",name:"UserDataBox"},["kind"]],[{type:"iprp",name:"ItemPropertiesBox"},["ipma"]],[{type:"ipco",name:"ItemPropertyContainerBox"}],[{type:"grpl",name:"GroupsListBox"}],[{type:"j2kH",name:"J2KHeaderInfoBox"}],[{type:"etyp",name:"ExtendedTypeBox"},["tyco"]]],boxCodes:[],fullBoxCodes:[],containerBoxCodes:[],sampleEntryCodes:{},sampleGroupEntryCodes:[],trackGroupTypes:[],UUIDBoxes:{},UUIDs:[],initialize:function(){s.FullBox.prototype=new s.Box,s.ContainerBox.prototype=new s.Box,s.SampleEntry.prototype=new s.Box,s.TrackGroupTypeBox.prototype=new s.FullBox,s.BASIC_BOXES.forEach(function(t){s.createBoxCtor(t.type,t.name)}),s.FULL_BOXES.forEach(function(t){s.createFullBoxCtor(t.type,t.name)}),s.CONTAINER_BOXES.forEach(function(t){s.createContainerBoxCtor(t[0].type,t[0].name,null,t[1])})},Box:function(t,e,r,o){this.type=t,this.box_name=r,this.size=e,this.uuid=o},FullBox:function(t,e,r,o){s.Box.call(this,t,e,r,o),this.flags=0,this.version=0},ContainerBox:function(t,e,r,o){s.Box.call(this,t,e,r,o),this.boxes=[]},SampleEntry:function(t,e,r,o){s.ContainerBox.call(this,t,e),this.hdr_size=r,this.start=o},SampleGroupEntry:function(t){this.grouping_type=t},TrackGroupTypeBox:function(t,e){s.FullBox.call(this,t,e)},createBoxCtor:function(t,e,r){s.boxCodes.push(t),s[t+"Box"]=function(o){s.Box.call(this,t,o,e)},s[t+"Box"].prototype=new s.Box,r&&(s[t+"Box"].prototype.parse=r)},createFullBoxCtor:function(t,e,r){s[t+"Box"]=function(o){s.FullBox.call(this,t,o,e)},s[t+"Box"].prototype=new s.FullBox,s[t+"Box"].prototype.parse=function(o){this.parseFullHeader(o),r&&r.call(this,o)}},addSubBoxArrays:function(t){if(t){this.subBoxNames=t;for(var e=t.length,r=0;r<e;r++)this[t[r]+"s"]=[]}},createContainerBoxCtor:function(t,e,r,o){s[t+"Box"]=function(l){s.ContainerBox.call(this,t,l,e),s.addSubBoxArrays.call(this,o)},s[t+"Box"].prototype=new s.ContainerBox,r&&(s[t+"Box"].prototype.parse=r)},createMediaSampleEntryCtor:function(t,e,r){s.sampleEntryCodes[t]=[],s[t+"SampleEntry"]=function(o,l){s.SampleEntry.call(this,o,l),s.addSubBoxArrays.call(this,r)},s[t+"SampleEntry"].prototype=new s.SampleEntry,e&&(s[t+"SampleEntry"].prototype.parse=e)},createSampleEntryCtor:function(t,e,r,o){s.sampleEntryCodes[t].push(e),s[e+"SampleEntry"]=function(l){s[t+"SampleEntry"].call(this,e,l),s.addSubBoxArrays.call(this,o)},s[e+"SampleEntry"].prototype=new s[t+"SampleEntry"],r&&(s[e+"SampleEntry"].prototype.parse=r)},createEncryptedSampleEntryCtor:function(t,e,r){s.createSampleEntryCtor.call(this,t,e,r,["sinf"])},createSampleGroupCtor:function(t,e){s[t+"SampleGroupEntry"]=function(r){s.SampleGroupEntry.call(this,t,r)},s[t+"SampleGroupEntry"].prototype=new s.SampleGroupEntry,e&&(s[t+"SampleGroupEntry"].prototype.parse=e)},createTrackGroupCtor:function(t,e){s[t+"TrackGroupTypeBox"]=function(r){s.TrackGroupTypeBox.call(this,t,r)},s[t+"TrackGroupTypeBox"].prototype=new s.TrackGroupTypeBox,e&&(s[t+"TrackGroupTypeBox"].prototype.parse=e)},createUUIDBox:function(t,e,r,o,l){s.UUIDs.push(t),s.UUIDBoxes[t]=function(d){r?s.FullBox.call(this,"uuid",d,e,t):o?s.ContainerBox.call(this,"uuid",d,e,t):s.Box.call(this,"uuid",d,e,t)},s.UUIDBoxes[t].prototype=r?new s.FullBox:o?new s.ContainerBox:new s.Box,l&&(r?s.UUIDBoxes[t].prototype.parse=function(d){this.parseFullHeader(d),l&&l.call(this,d)}:s.UUIDBoxes[t].prototype.parse=l)}};s.initialize(),s.TKHD_FLAG_ENABLED=1,s.TKHD_FLAG_IN_MOVIE=2,s.TKHD_FLAG_IN_PREVIEW=4,s.TFHD_FLAG_BASE_DATA_OFFSET=1,s.TFHD_FLAG_SAMPLE_DESC=2,s.TFHD_FLAG_SAMPLE_DUR=8,s.TFHD_FLAG_SAMPLE_SIZE=16,s.TFHD_FLAG_SAMPLE_FLAGS=32,s.TFHD_FLAG_DUR_EMPTY=65536,s.TFHD_FLAG_DEFAULT_BASE_IS_MOOF=131072,s.TRUN_FLAGS_DATA_OFFSET=1,s.TRUN_FLAGS_FIRST_FLAG=4,s.TRUN_FLAGS_DURATION=256,s.TRUN_FLAGS_SIZE=512,s.TRUN_FLAGS_FLAGS=1024,s.TRUN_FLAGS_CTS_OFFSET=2048,s.Box.prototype.add=function(t){return this.addBox(new s[t+"Box"])},s.Box.prototype.addBox=function(t){return this.boxes.push(t),this[t.type+"s"]?this[t.type+"s"].push(t):this[t.type]=t,t},s.Box.prototype.set=function(t,e){return this[t]=e,this},s.Box.prototype.addEntry=function(t,e){var r=e||"entries";return this[r]||(this[r]=[]),this[r].push(t),this},n.BoxParser=s,s.parseUUID=function(t){return s.parseHex16(t)},s.parseHex16=function(t){for(var e="",r=0;r<16;r++){var o=t.readUint8().toString(16);e+=o.length===1?"0"+o:o}return e},s.parseOneBox=function(t,e,r){var o,l=t.getPosition(),d=0,p,_;if(t.getEndPosition()-l<8)return a.debug("BoxParser","Not enough data in stream to parse the type and size of the box"),{code:s.ERR_NOT_ENOUGH_DATA};if(r&&r<8)return a.debug("BoxParser","Not enough bytes left in the parent box to parse a new box"),{code:s.ERR_NOT_ENOUGH_DATA};var m=t.readUint32(),w=t.readString(4),b=w;if(a.debug("BoxParser","Found box of type '"+w+"' and size "+m+" at position "+l),d=8,w=="uuid"){if(t.getEndPosition()-t.getPosition()<16||r-d<16)return t.seek(l),a.debug("BoxParser","Not enough bytes left in the parent box to parse a UUID box"),{code:s.ERR_NOT_ENOUGH_DATA};_=s.parseUUID(t),d+=16,b=_}if(m==1){if(t.getEndPosition()-t.getPosition()<8||r&&r-d<8)return t.seek(l),a.warn("BoxParser",'Not enough data in stream to parse the extended size of the "'+w+'" box'),{code:s.ERR_NOT_ENOUGH_DATA};m=t.readUint64(),d+=8}else if(m===0){if(r)m=r;else if(w!=="mdat")return a.error("BoxParser","Unlimited box size not supported for type: '"+w+"'"),o=new s.Box(w,m),{code:s.OK,box:o,size:o.size}}return m!==0&&m<d?(a.error("BoxParser","Box of type "+w+" has an invalid size "+m+" (too small to be a box)"),{code:s.ERR_NOT_ENOUGH_DATA,type:w,size:m,hdr_size:d,start:l}):m!==0&&r&&m>r?(a.error("BoxParser","Box of type '"+w+"' has a size "+m+" greater than its container size "+r),{code:s.ERR_NOT_ENOUGH_DATA,type:w,size:m,hdr_size:d,start:l}):m!==0&&l+m>t.getEndPosition()?(t.seek(l),a.info("BoxParser","Not enough data in stream to parse the entire '"+w+"' box"),{code:s.ERR_NOT_ENOUGH_DATA,type:w,size:m,hdr_size:d,start:l}):e?{code:s.OK,type:w,size:m,hdr_size:d,start:l}:(s[w+"Box"]?o=new s[w+"Box"](m):w!=="uuid"?(a.warn("BoxParser","Unknown box type: '"+w+"'"),o=new s.Box(w,m),o.has_unparsed_data=!0):s.UUIDBoxes[_]?o=new s.UUIDBoxes[_](m):(a.warn("BoxParser","Unknown uuid type: '"+_+"'"),o=new s.Box(w,m),o.uuid=_,o.has_unparsed_data=!0),o.hdr_size=d,o.start=l,o.write===s.Box.prototype.write&&o.type!=="mdat"&&(a.info("BoxParser","'"+b+"' box writing not yet implemented, keeping unparsed data in memory for later write"),o.parseDataAndRewind(t)),o.parse(t),p=t.getPosition()-(o.start+o.size),p<0?(a.warn("BoxParser","Parsing of box '"+b+"' did not read the entire indicated box data size (missing "+-p+" bytes), seeking forward"),t.seek(o.start+o.size)):p>0&&(a.error("BoxParser","Parsing of box '"+b+"' read "+p+" more bytes than the indicated box data size, seeking backwards"),o.size!==0&&t.seek(o.start+o.size)),{code:s.OK,box:o,size:o.size})},s.Box.prototype.parse=function(t){this.type!="mdat"?this.data=t.readUint8Array(this.size-this.hdr_size):this.size===0?t.seek(t.getEndPosition()):t.seek(this.start+this.size)},s.Box.prototype.parseDataAndRewind=function(t){this.data=t.readUint8Array(this.size-this.hdr_size),t.position-=this.size-this.hdr_size},s.FullBox.prototype.parseDataAndRewind=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=4,t.position-=this.size-this.hdr_size},s.FullBox.prototype.parseFullHeader=function(t){this.version=t.readUint8(),this.flags=t.readUint24(),this.hdr_size+=4},s.FullBox.prototype.parse=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)},s.ContainerBox.prototype.parse=function(t){for(var e,r;t.getPosition()<this.start+this.size;)if(e=s.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),e.code===s.OK)if(r=e.box,this.boxes.push(r),this.subBoxNames&&this.subBoxNames.indexOf(r.type)!=-1)this[this.subBoxNames[this.subBoxNames.indexOf(r.type)]+"s"].push(r);else{var o=r.type!=="uuid"?r.type:r.uuid;this[o]?a.warn("Box of type "+o+" already stored in field of this type"):this[o]=r}else return},s.Box.prototype.parseLanguage=function(t){this.language=t.readUint16();var e=[];e[0]=this.language>>10&31,e[1]=this.language>>5&31,e[2]=this.language&31,this.languageString=String.fromCharCode(e[0]+96,e[1]+96,e[2]+96)},s.SAMPLE_ENTRY_TYPE_VISUAL="Visual",s.SAMPLE_ENTRY_TYPE_AUDIO="Audio",s.SAMPLE_ENTRY_TYPE_HINT="Hint",s.SAMPLE_ENTRY_TYPE_METADATA="Metadata",s.SAMPLE_ENTRY_TYPE_SUBTITLE="Subtitle",s.SAMPLE_ENTRY_TYPE_SYSTEM="System",s.SAMPLE_ENTRY_TYPE_TEXT="Text",s.SampleEntry.prototype.parseHeader=function(t){t.readUint8Array(6),this.data_reference_index=t.readUint16(),this.hdr_size+=8},s.SampleEntry.prototype.parse=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)},s.SampleEntry.prototype.parseDataAndRewind=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=8,t.position-=this.size-this.hdr_size},s.SampleEntry.prototype.parseFooter=function(t){s.ContainerBox.prototype.parse.call(this,t)},s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_HINT),s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_METADATA),s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE),s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SYSTEM),s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_TEXT),s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,function(t){var e;this.parseHeader(t),t.readUint16(),t.readUint16(),t.readUint32Array(3),this.width=t.readUint16(),this.height=t.readUint16(),this.horizresolution=t.readUint32(),this.vertresolution=t.readUint32(),t.readUint32(),this.frame_count=t.readUint16(),e=Math.min(31,t.readUint8()),this.compressorname=t.readString(e),e<31&&t.readString(31-e),this.depth=t.readUint16(),t.readUint16(),this.parseFooter(t)}),s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,function(t){this.parseHeader(t),t.readUint32Array(2),this.channel_count=t.readUint16(),this.samplesize=t.readUint16(),t.readUint16(),t.readUint16(),this.samplerate=t.readUint32()/65536,this.parseFooter(t)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"avc1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"avc2"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"avc3"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"avc4"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"av01"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"dav1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"hvc1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"hev1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"hvt1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"lhe1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"dvh1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"dvhe"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vvc1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vvi1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vvs1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vvcN"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vp08"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vp09"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"avs3"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"j2ki"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"mjp2"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"mjpg"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"uncv"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"mp4a"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"ac-3"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"ac-4"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"ec-3"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"Opus"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"mha1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"mha2"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"mhm1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"mhm2"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"fLaC"),s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"encv"),s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"enca"),s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE,"encu"),s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SYSTEM,"encs"),s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_TEXT,"enct"),s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_METADATA,"encm"),s.createBoxCtor("a1lx","AV1LayeredImageIndexingProperty",function(t){var e=t.readUint8()&1,r=((e&1)+1)*16;this.layer_size=[];for(var o=0;o<3;o++)r==16?this.layer_size[o]=t.readUint16():this.layer_size[o]=t.readUint32()}),s.createBoxCtor("a1op","OperatingPointSelectorProperty",function(t){this.op_index=t.readUint8()}),s.createFullBoxCtor("auxC","AuxiliaryTypeProperty",function(t){this.aux_type=t.readCString();var e=this.size-this.hdr_size-(this.aux_type.length+1);this.aux_subtype=t.readUint8Array(e)}),s.createBoxCtor("av1C","AV1CodecConfigurationBox",function(t){var e=t.readUint8();if((e>>7&1)!==1){a.error("av1C marker problem");return}if(this.version=e&127,this.version!==1){a.error("av1C version "+this.version+" not supported");return}if(e=t.readUint8(),this.seq_profile=e>>5&7,this.seq_level_idx_0=e&31,e=t.readUint8(),this.seq_tier_0=e>>7&1,this.high_bitdepth=e>>6&1,this.twelve_bit=e>>5&1,this.monochrome=e>>4&1,this.chroma_subsampling_x=e>>3&1,this.chroma_subsampling_y=e>>2&1,this.chroma_sample_position=e&3,e=t.readUint8(),this.reserved_1=e>>5&7,this.reserved_1!==0){a.error("av1C reserved_1 parsing problem");return}if(this.initial_presentation_delay_present=e>>4&1,this.initial_presentation_delay_present===1)this.initial_presentation_delay_minus_one=e&15;else if(this.reserved_2=e&15,this.reserved_2!==0){a.error("av1C reserved_2 parsing problem");return}var r=this.size-this.hdr_size-4;this.configOBUs=t.readUint8Array(r)});function x(t){var e="<table class='inner-table'>";e+="<thead><tr><th>length</th><th>nalu_data</th></tr></thead>",e+="<tbody>";for(var r=0;r<t.length;r++){var o=t[r];e+="<tr>",e+="<td>"+o.length+"</td>",e+="<td>",e+=o.nalu.reduce(function(l,d){return l+d.toString(16).padStart(2,"0")},"0x"),e+="</td></tr>"}return e+="</tbody></table>",e}s.createBoxCtor("avcC","AVCConfigurationBox",function(t){var e,r;for(this.configurationVersion=t.readUint8(),this.AVCProfileIndication=t.readUint8(),this.profile_compatibility=t.readUint8(),this.AVCLevelIndication=t.readUint8(),this.lengthSizeMinusOne=t.readUint8()&3,this.nb_SPS_nalus=t.readUint8()&31,r=this.size-this.hdr_size-6,this.SPS=[],this.SPS.toString=function(){return x(this)},e=0;e<this.nb_SPS_nalus;e++)this.SPS[e]={},this.SPS[e].length=t.readUint16(),this.SPS[e].nalu=t.readUint8Array(this.SPS[e].length),r-=2+this.SPS[e].length;for(this.nb_PPS_nalus=t.readUint8(),r--,this.PPS=[],this.PPS.toString=function(){return x(this)},e=0;e<this.nb_PPS_nalus;e++)this.PPS[e]={},this.PPS[e].length=t.readUint16(),this.PPS[e].nalu=t.readUint8Array(this.PPS[e].length),r-=2+this.PPS[e].length;r>0&&(this.ext=t.readUint8Array(r))}),s.createBoxCtor("btrt","BitRateBox",function(t){this.bufferSizeDB=t.readUint32(),this.maxBitrate=t.readUint32(),this.avgBitrate=t.readUint32()}),s.createFullBoxCtor("ccst","CodingConstraintsBox",function(t){var e=t.readUint8();this.all_ref_pics_intra=(e&128)==128,this.intra_pred_used=(e&64)==64,this.max_ref_per_pic=(e&63)>>2,t.readUint24()}),s.createBoxCtor("cdef","ComponentDefinitionBox",function(t){var e;for(this.channel_count=t.readUint16(),this.channel_indexes=[],this.channel_types=[],this.channel_associations=[],e=0;e<this.channel_count;e++)this.channel_indexes.push(t.readUint16()),this.channel_types.push(t.readUint16()),this.channel_associations.push(t.readUint16())}),s.createBoxCtor("clap","CleanApertureBox",function(t){this.cleanApertureWidthN=t.readUint32(),this.cleanApertureWidthD=t.readUint32(),this.cleanApertureHeightN=t.readUint32(),this.cleanApertureHeightD=t.readUint32(),this.horizOffN=t.readUint32(),this.horizOffD=t.readUint32(),this.vertOffN=t.readUint32(),this.vertOffD=t.readUint32()}),s.createBoxCtor("clli","ContentLightLevelBox",function(t){this.max_content_light_level=t.readUint16(),this.max_pic_average_light_level=t.readUint16()}),s.createFullBoxCtor("cmex","CameraExtrinsicMatrixProperty",function(t){this.flags&1&&(this.pos_x=t.readInt32()),this.flags&2&&(this.pos_y=t.readInt32()),this.flags&4&&(this.pos_z=t.readInt32()),this.flags&8&&(this.version==0?this.flags&16?(this.quat_x=t.readInt32(),this.quat_y=t.readInt32(),this.quat_z=t.readInt32()):(this.quat_x=t.readInt16(),this.quat_y=t.readInt16(),this.quat_z=t.readInt16()):this.version==1),this.flags&32&&(this.id=t.readUint32())}),s.createFullBoxCtor("cmin","CameraIntrinsicMatrixProperty",function(t){this.focal_length_x=t.readInt32(),this.principal_point_x=t.readInt32(),this.principal_point_y=t.readInt32(),this.flags&1&&(this.focal_length_y=t.readInt32(),this.skew_factor=t.readInt32())}),s.createBoxCtor("cmpd","ComponentDefinitionBox",function(t){for(this.component_count=t.readUint32(),this.component_types=[],this.component_type_urls=[],i=0;i<this.component_count;i++){var e=t.readUint16();this.component_types.push(e),e>=32768&&this.component_type_urls.push(t.readCString())}}),s.createFullBoxCtor("co64","ChunkLargeOffsetBox",function(t){var e,r;if(e=t.readUint32(),this.chunk_offsets=[],this.version===0)for(r=0;r<e;r++)this.chunk_offsets.push(t.readUint64())}),s.createFullBoxCtor("CoLL","ContentLightLevelBox",function(t){this.maxCLL=t.readUint16(),this.maxFALL=t.readUint16()}),s.createBoxCtor("colr","ColourInformationBox",function(t){if(this.colour_type=t.readString(4),this.colour_type==="nclx"){this.colour_primaries=t.readUint16(),this.transfer_characteristics=t.readUint16(),this.matrix_coefficients=t.readUint16();var e=t.readUint8();this.full_range_flag=e>>7}else this.colour_type==="rICC"?this.ICC_profile=t.readUint8Array(this.size-4):this.colour_type==="prof"&&(this.ICC_profile=t.readUint8Array(this.size-4))}),s.createFullBoxCtor("cprt","CopyrightBox",function(t){this.parseLanguage(t),this.notice=t.readCString()}),s.createFullBoxCtor("cslg","CompositionToDecodeBox",function(t){this.version===0&&(this.compositionToDTSShift=t.readInt32(),this.leastDecodeToDisplayDelta=t.readInt32(),this.greatestDecodeToDisplayDelta=t.readInt32(),this.compositionStartTime=t.readInt32(),this.compositionEndTime=t.readInt32())}),s.createFullBoxCtor("ctts","CompositionOffsetBox",function(t){var e,r;if(e=t.readUint32(),this.sample_counts=[],this.sample_offsets=[],this.version===0)for(r=0;r<e;r++){this.sample_counts.push(t.readUint32());var o=t.readInt32();o<0&&a.warn("BoxParser","ctts box uses negative values without using version 1"),this.sample_offsets.push(o)}else if(this.version==1)for(r=0;r<e;r++)this.sample_counts.push(t.readUint32()),this.sample_offsets.push(t.readInt32())}),s.createBoxCtor("dac3","AC3SpecificBox",function(t){var e=t.readUint8(),r=t.readUint8(),o=t.readUint8();this.fscod=e>>6,this.bsid=e>>1&31,this.bsmod=(e&1)<<2|r>>6&3,this.acmod=r>>3&7,this.lfeon=r>>2&1,this.bit_rate_code=r&3|o>>5&7}),s.createBoxCtor("dec3","EC3SpecificBox",function(t){var e=t.readUint16();this.data_rate=e>>3,this.num_ind_sub=e&7,this.ind_subs=[];for(var r=0;r<this.num_ind_sub+1;r++){var o={};this.ind_subs.push(o);var l=t.readUint8(),d=t.readUint8(),p=t.readUint8();o.fscod=l>>6,o.bsid=l>>1&31,o.bsmod=(l&1)<<4|d>>4&15,o.acmod=d>>1&7,o.lfeon=d&1,o.num_dep_sub=p>>1&15,o.num_dep_sub>0&&(o.chan_loc=(p&1)<<8|t.readUint8())}}),s.createFullBoxCtor("dfLa","FLACSpecificBox",function(t){var e=127,r=128,o=[],l=["STREAMINFO","PADDING","APPLICATION","SEEKTABLE","VORBIS_COMMENT","CUESHEET","PICTURE","RESERVED"];do{var d=t.readUint8(),p=Math.min(d&e,l.length-1);if(p?t.readUint8Array(t.readUint24()):(t.readUint8Array(13),this.samplerate=t.readUint32()>>12,t.readUint8Array(20)),o.push(l[p]),d&r)break}while(!0);this.numMetadataBlocks=o.length+" ("+o.join(", ")+")"}),s.createBoxCtor("dimm","hintimmediateBytesSent",function(t){this.bytessent=t.readUint64()}),s.createBoxCtor("dmax","hintlongestpacket",function(t){this.time=t.readUint32()}),s.createBoxCtor("dmed","hintmediaBytesSent",function(t){this.bytessent=t.readUint64()}),s.createBoxCtor("dOps","OpusSpecificBox",function(t){if(this.Version=t.readUint8(),this.OutputChannelCount=t.readUint8(),this.PreSkip=t.readUint16(),this.InputSampleRate=t.readUint32(),this.OutputGain=t.readInt16(),this.ChannelMappingFamily=t.readUint8(),this.ChannelMappingFamily!==0){this.StreamCount=t.readUint8(),this.CoupledCount=t.readUint8(),this.ChannelMapping=[];for(var e=0;e<this.OutputChannelCount;e++)this.ChannelMapping[e]=t.readUint8()}}),s.createFullBoxCtor("dref","DataReferenceBox",function(t){var e,r;this.entries=[];for(var o=t.readUint32(),l=0;l<o;l++)if(e=s.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),e.code===s.OK)r=e.box,this.entries.push(r);else return}),s.createBoxCtor("drep","hintrepeatedBytesSent",function(t){this.bytessent=t.readUint64()}),s.createFullBoxCtor("elng","ExtendedLanguageBox",function(t){this.extended_language=t.readString(this.size-this.hdr_size)}),s.createFullBoxCtor("elst","EditListBox",function(t){this.entries=[];for(var e=t.readUint32(),r=0;r<e;r++){var o={};this.entries.push(o),this.version===1?(o.segment_duration=t.readUint64(),o.media_time=t.readInt64()):(o.segment_duration=t.readUint32(),o.media_time=t.readInt32()),o.media_rate_integer=t.readInt16(),o.media_rate_fraction=t.readInt16()}}),s.createFullBoxCtor("emsg","EventMessageBox",function(t){this.version==1?(this.timescale=t.readUint32(),this.presentation_time=t.readUint64(),this.event_duration=t.readUint32(),this.id=t.readUint32(),this.scheme_id_uri=t.readCString(),this.value=t.readCString()):(this.scheme_id_uri=t.readCString(),this.value=t.readCString(),this.timescale=t.readUint32(),this.presentation_time_delta=t.readUint32(),this.event_duration=t.readUint32(),this.id=t.readUint32());var e=this.size-this.hdr_size-(4*4+(this.scheme_id_uri.length+1)+(this.value.length+1));this.version==1&&(e-=4),this.message_data=t.readUint8Array(e)}),s.createEntityToGroupCtor=function(t,e){s[t+"Box"]=function(r){s.FullBox.call(this,t,r)},s[t+"Box"].prototype=new s.FullBox,s[t+"Box"].prototype.parse=function(r){if(this.parseFullHeader(r),e)e.call(this,r);else for(this.group_id=r.readUint32(),this.num_entities_in_group=r.readUint32(),this.entity_ids=[],i=0;i<this.num_entities_in_group;i++){var o=r.readUint32();this.entity_ids.push(o)}}},s.createEntityToGroupCtor("aebr"),s.createEntityToGroupCtor("afbr"),s.createEntityToGroupCtor("albc"),s.createEntityToGroupCtor("altr"),s.createEntityToGroupCtor("brst"),s.createEntityToGroupCtor("dobr"),s.createEntityToGroupCtor("eqiv"),s.createEntityToGroupCtor("favc"),s.createEntityToGroupCtor("fobr"),s.createEntityToGroupCtor("iaug"),s.createEntityToGroupCtor("pano"),s.createEntityToGroupCtor("slid"),s.createEntityToGroupCtor("ster"),s.createEntityToGroupCtor("tsyn"),s.createEntityToGroupCtor("wbbr"),s.createEntityToGroupCtor("prgr"),s.createEntityToGroupCtor("pymd",function(t){this.group_id=t.readUint32(),this.num_entities_in_group=t.readUint32(),this.entity_ids=[];for(var e=0;e<this.num_entities_in_group;e++){var r=t.readUint32();this.entity_ids.push(r)}for(this.tile_size_x=t.readUint16(),this.tile_size_y=t.readUint16(),this.layer_binning=[],this.tiles_in_layer_column_minus1=[],this.tiles_in_layer_row_minus1=[],e=0;e<this.num_entities_in_group;e++)this.layer_binning[e]=t.readUint16(),this.tiles_in_layer_row_minus1[e]=t.readUint16(),this.tiles_in_layer_column_minus1[e]=t.readUint16()}),s.createFullBoxCtor("esds","ElementaryStreamDescriptorBox",function(t){var e=t.readUint8Array(this.size-this.hdr_size);if(typeof v<"u"){var r=new v;this.esd=r.parseOneDescriptor(new f(e.buffer,0,f.BIG_ENDIAN))}}),s.createBoxCtor("fiel","FieldHandlingBox",function(t){this.fieldCount=t.readUint8(),this.fieldOrdering=t.readUint8()}),s.createBoxCtor("frma","OriginalFormatBox",function(t){this.data_format=t.readString(4)}),s.createBoxCtor("ftyp","FileTypeBox",function(t){var e=this.size-this.hdr_size;this.major_brand=t.readString(4),this.minor_version=t.readUint32(),e-=8,this.compatible_brands=[];for(var r=0;e>=4;)this.compatible_brands[r]=t.readString(4),e-=4,r++}),s.createFullBoxCtor("hdlr","HandlerBox",function(t){this.version===0&&(t.readUint32(),this.handler=t.readString(4),t.readUint32Array(3),this.name=t.readString(this.size-this.hdr_size-20),this.name[this.name.length-1]==="\0"&&(this.name=this.name.slice(0,-1)))}),s.createBoxCtor("hvcC","HEVCConfigurationBox",function(t){var e,r,o,l;this.configurationVersion=t.readUint8(),l=t.readUint8(),this.general_profile_space=l>>6,this.general_tier_flag=(l&32)>>5,this.general_profile_idc=l&31,this.general_profile_compatibility=t.readUint32(),this.general_constraint_indicator=t.readUint8Array(6),this.general_level_idc=t.readUint8(),this.min_spatial_segmentation_idc=t.readUint16()&4095,this.parallelismType=t.readUint8()&3,this.chroma_format_idc=t.readUint8()&3,this.bit_depth_luma_minus8=t.readUint8()&7,this.bit_depth_chroma_minus8=t.readUint8()&7,this.avgFrameRate=t.readUint16(),l=t.readUint8(),this.constantFrameRate=l>>6,this.numTemporalLayers=(l&13)>>3,this.temporalIdNested=(l&4)>>2,this.lengthSizeMinusOne=l&3,this.nalu_arrays=[],this.nalu_arrays.toString=function(){var w="<table class='inner-table'>";w+="<thead><tr><th>completeness</th><th>nalu_type</th><th>nalu_data</th></tr></thead>",w+="<tbody>";for(var b=0;b<this.length;b++){var U=this[b];w+="<tr>",w+="<td rowspan='"+U.length+"'>"+U.completeness+"</td>",w+="<td rowspan='"+U.length+"'>"+U.nalu_type+"</td>";for(var I=0;I<U.length;I++){var A=U[I];I!==0&&(w+="<tr>"),w+="<td>",w+=A.data.reduce(function(q,H){return q+H.toString(16).padStart(2,"0")},"0x"),w+="</td></tr>"}}return w+="</tbody></table>",w};var d=t.readUint8();for(e=0;e<d;e++){var p=[];this.nalu_arrays.push(p),l=t.readUint8(),p.completeness=(l&128)>>7,p.nalu_type=l&63;var _=t.readUint16();for(r=0;r<_;r++){var m={};p.push(m),o=t.readUint16(),m.data=t.readUint8Array(o)}}}),s.createFullBoxCtor("iinf","ItemInfoBox",function(t){var e;this.version===0?this.entry_count=t.readUint16():this.entry_count=t.readUint32(),this.item_infos=[];for(var r=0;r<this.entry_count;r++)if(e=s.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),e.code===s.OK)e.box.type!=="infe"&&a.error("BoxParser","Expected 'infe' box, got "+e.box.type),this.item_infos[r]=e.box;else return}),s.createFullBoxCtor("iloc","ItemLocationBox",function(t){var e;e=t.readUint8(),this.offset_size=e>>4&15,this.length_size=e&15,e=t.readUint8(),this.base_offset_size=e>>4&15,this.version===1||this.version===2?this.index_size=e&15:this.index_size=0,this.items=[];var r=0;if(this.version<2)r=t.readUint16();else if(this.version===2)r=t.readUint32();else throw"version of iloc box not supported";for(var o=0;o<r;o++){var l={};if(this.items.push(l),this.version<2)l.item_ID=t.readUint16();else if(this.version===2)l.item_ID=t.readUint32();else throw"version of iloc box not supported";switch(this.version===1||this.version===2?l.construction_method=t.readUint16()&15:l.construction_method=0,l.data_reference_index=t.readUint16(),this.base_offset_size){case 0:l.base_offset=0;break;case 4:l.base_offset=t.readUint32();break;case 8:l.base_offset=t.readUint64();break;default:throw"Error reading base offset size"}var d=t.readUint16();l.extents=[];for(var p=0;p<d;p++){var _={};if(l.extents.push(_),this.version===1||this.version===2)switch(this.index_size){case 0:_.extent_index=0;break;case 4:_.extent_index=t.readUint32();break;case 8:_.extent_index=t.readUint64();break;default:throw"Error reading extent index"}switch(this.offset_size){case 0:_.extent_offset=0;break;case 4:_.extent_offset=t.readUint32();break;case 8:_.extent_offset=t.readUint64();break;default:throw"Error reading extent index"}switch(this.length_size){case 0:_.extent_length=0;break;case 4:_.extent_length=t.readUint32();break;case 8:_.extent_length=t.readUint64();break;default:throw"Error reading extent index"}}}}),s.createBoxCtor("imir","ImageMirror",function(t){var e=t.readUint8();this.reserved=e>>7,this.axis=e&1}),s.createFullBoxCtor("infe","ItemInfoEntry",function(t){if((this.version===0||this.version===1)&&(this.item_ID=t.readUint16(),this.item_protection_index=t.readUint16(),this.item_name=t.readCString(),this.content_type=t.readCString(),this.content_encoding=t.readCString()),this.version===1){this.extension_type=t.readString(4),a.warn("BoxParser","Cannot parse extension type"),t.seek(this.start+this.size);return}this.version>=2&&(this.version===2?this.item_ID=t.readUint16():this.version===3&&(this.item_ID=t.readUint32()),this.item_protection_index=t.readUint16(),this.item_type=t.readString(4),this.item_name=t.readCString(),this.item_type==="mime"?(this.content_type=t.readCString(),this.content_encoding=t.readCString()):this.item_type==="uri "&&(this.item_uri_type=t.readCString()))}),s.createFullBoxCtor("ipma","ItemPropertyAssociationBox",function(t){var e,r;for(entry_count=t.readUint32(),this.associations=[],e=0;e<entry_count;e++){var o={};this.associations.push(o),this.version<1?o.id=t.readUint16():o.id=t.readUint32();var l=t.readUint8();for(o.props=[],r=0;r<l;r++){var d=t.readUint8(),p={};o.props.push(p),p.essential=(d&128)>>7===1,this.flags&1?p.property_index=(d&127)<<8|t.readUint8():p.property_index=d&127}}}),s.createFullBoxCtor("iref","ItemReferenceBox",function(t){var e,r;for(this.references=[];t.getPosition()<this.start+this.size;)if(e=s.parseOneBox(t,!0,this.size-(t.getPosition()-this.start)),e.code===s.OK)this.version===0?r=new s.SingleItemTypeReferenceBox(e.type,e.size,e.hdr_size,e.start):r=new s.SingleItemTypeReferenceBoxLarge(e.type,e.size,e.hdr_size,e.start),r.write===s.Box.prototype.write&&r.type!=="mdat"&&(a.warn("BoxParser",r.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),r.parseDataAndRewind(t)),r.parse(t),this.references.push(r);else return}),s.createBoxCtor("irot","ImageRotation",function(t){this.angle=t.readUint8()&3}),s.createFullBoxCtor("ispe","ImageSpatialExtentsProperty",function(t){this.image_width=t.readUint32(),this.image_height=t.readUint32()}),s.createFullBoxCtor("kind","KindBox",function(t){this.schemeURI=t.readCString(),this.value=t.readCString()}),s.createFullBoxCtor("leva","LevelAssignmentBox",function(t){var e=t.readUint8();this.levels=[];for(var r=0;r<e;r++){var o={};this.levels[r]=o,o.track_ID=t.readUint32();var l=t.readUint8();switch(o.padding_flag=l>>7,o.assignment_type=l&127,o.assignment_type){case 0:o.grouping_type=t.readString(4);break;case 1:o.grouping_type=t.readString(4),o.grouping_type_parameter=t.readUint32();break;case 2:break;case 3:break;case 4:o.sub_track_id=t.readUint32();break;default:a.warn("BoxParser","Unknown leva assignement type")}}}),s.createBoxCtor("lhvC","LHEVCConfigurationBox",function(t){var e,r,o;this.configurationVersion=t.readUint8(),this.min_spatial_segmentation_idc=t.readUint16()&4095,this.parallelismType=t.readUint8()&3,o=t.readUint8(),this.numTemporalLayers=(o&13)>>3,this.temporalIdNested=(o&4)>>2,this.lengthSizeMinusOne=o&3,this.nalu_arrays=[],this.nalu_arrays.toString=function(){var w="<table class='inner-table'>";w+="<thead><tr><th>completeness</th><th>nalu_type</th><th>nalu_data</th></tr></thead>",w+="<tbody>";for(var b=0;b<this.length;b++){var U=this[b];w+="<tr>",w+="<td rowspan='"+U.length+"'>"+U.completeness+"</td>",w+="<td rowspan='"+U.length+"'>"+U.nalu_type+"</td>";for(var I=0;I<U.length;I++){var A=U[I];I!==0&&(w+="<tr>"),w+="<td>",w+=A.data.reduce(function(q,H){return q+H.toString(16).padStart(2,"0")},"0x"),w+="</td></tr>"}}return w+="</tbody></table>",w};var l=t.readUint8();for(e=0;e<l;e++){var d=[];this.nalu_arrays.push(d),o=t.readUint8(),d.completeness=(o&128)>>7,d.nalu_type=o&63;var p=t.readUint16();for(r=0;r<p;r++){var _={};d.push(_);var m=t.readUint16();_.data=t.readUint8Array(m)}}}),s.createBoxCtor("lsel","LayerSelectorProperty",function(t){this.layer_id=t.readUint16()}),s.createBoxCtor("maxr","hintmaxrate",function(t){this.period=t.readUint32(),this.bytes=t.readUint32()});function g(t,e){this.x=t,this.y=e}g.prototype.toString=function(){return"("+this.x+","+this.y+")"},s.createBoxCtor("mdcv","MasteringDisplayColourVolumeBox",function(t){this.display_primaries=[],this.display_primaries[0]=new g(t.readUint16(),t.readUint16()),this.display_primaries[1]=new g(t.readUint16(),t.readUint16()),this.display_primaries[2]=new g(t.readUint16(),t.readUint16()),this.white_point=new g(t.readUint16(),t.readUint16()),this.max_display_mastering_luminance=t.readUint32(),this.min_display_mastering_luminance=t.readUint32()}),s.createFullBoxCtor("mdhd","MediaHeaderBox",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.parseLanguage(t),t.readUint16()}),s.createFullBoxCtor("mehd","MovieExtendsHeaderBox",function(t){this.flags&1&&(a.warn("BoxParser","mehd box incorrectly uses flags set to 1, converting version to 1"),this.version=1),this.version==1?this.fragment_duration=t.readUint64():this.fragment_duration=t.readUint32()}),s.createFullBoxCtor("meta","MetaBox",function(t){this.boxes=[],s.ContainerBox.prototype.parse.call(this,t)}),s.createFullBoxCtor("mfhd","MovieFragmentHeaderBox",function(t){this.sequence_number=t.readUint32()}),s.createFullBoxCtor("mfro","MovieFragmentRandomAccessOffsetBox",function(t){this._size=t.readUint32()}),s.createFullBoxCtor("mskC","MaskConfigurationProperty",function(t){this.bits_per_pixel=t.readUint8()}),s.createFullBoxCtor("mvhd","MovieHeaderBox",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.rate=t.readUint32(),this.volume=t.readUint16()>>8,t.readUint16(),t.readUint32Array(2),this.matrix=t.readUint32Array(9),t.readUint32Array(6),this.next_track_id=t.readUint32()}),s.createBoxCtor("npck","hintPacketsSent",function(t){this.packetssent=t.readUint32()}),s.createBoxCtor("nump","hintPacketsSent",function(t){this.packetssent=t.readUint64()}),s.createFullBoxCtor("padb","PaddingBitsBox",function(t){var e=t.readUint32();this.padbits=[];for(var r=0;r<Math.floor((e+1)/2);r++)this.padbits=t.readUint8()}),s.createBoxCtor("pasp","PixelAspectRatioBox",function(t){this.hSpacing=t.readUint32(),this.vSpacing=t.readUint32()}),s.createBoxCtor("payl","CuePayloadBox",function(t){this.text=t.readString(this.size-this.hdr_size)}),s.createBoxCtor("payt","hintpayloadID",function(t){this.payloadID=t.readUint32();var e=t.readUint8();this.rtpmap_string=t.readString(e)}),s.createFullBoxCtor("pdin","ProgressiveDownloadInfoBox",function(t){var e=(this.size-this.hdr_size)/8;this.rate=[],this.initial_delay=[];for(var r=0;r<e;r++)this.rate[r]=t.readUint32(),this.initial_delay[r]=t.readUint32()}),s.createFullBoxCtor("pitm","PrimaryItemBox",function(t){this.version===0?this.item_id=t.readUint16():this.item_id=t.readUint32()}),s.createFullBoxCtor("pixi","PixelInformationProperty",function(t){var e;for(this.num_channels=t.readUint8(),this.bits_per_channels=[],e=0;e<this.num_channels;e++)this.bits_per_channels[e]=t.readUint8()}),s.createBoxCtor("pmax","hintlargestpacket",function(t){this.bytes=t.readUint32()}),s.createFullBoxCtor("prdi","ProgressiveDerivedImageItemInformationProperty",function(t){if(this.step_count=t.readUint16(),this.item_count=[],this.flags&2)for(var e=0;e<this.step_count;e++)this.item_count[e]=t.readUint16()}),s.createFullBoxCtor("prft","ProducerReferenceTimeBox",function(t){this.ref_track_id=t.readUint32(),this.ntp_timestamp=t.readUint64(),this.version===0?this.media_time=t.readUint32():this.media_time=t.readUint64()}),s.createFullBoxCtor("pssh","ProtectionSystemSpecificHeaderBox",function(t){if(this.system_id=s.parseHex16(t),this.version>0){var e=t.readUint32();this.kid=[];for(var r=0;r<e;r++)this.kid[r]=s.parseHex16(t)}var o=t.readUint32();o>0&&(this.data=t.readUint8Array(o))}),s.createFullBoxCtor("clef","TrackCleanApertureDimensionsBox",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),s.createFullBoxCtor("enof","TrackEncodedPixelsDimensionsBox",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),s.createFullBoxCtor("prof","TrackProductionApertureDimensionsBox",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),s.createContainerBoxCtor("tapt","TrackApertureModeDimensionsBox",null,["clef","prof","enof"]),s.createBoxCtor("rtp ","rtpmoviehintinformation",function(t){this.descriptionformat=t.readString(4),this.sdptext=t.readString(this.size-this.hdr_size-4)}),s.createFullBoxCtor("saio","SampleAuxiliaryInformationOffsetsBox",function(t){this.flags&1&&(this.aux_info_type=t.readString(4),this.aux_info_type_parameter=t.readUint32());var e=t.readUint32();this.offset=[];for(var r=0;r<e;r++)this.version===0?this.offset[r]=t.readUint32():this.offset[r]=t.readUint64()}),s.createFullBoxCtor("saiz","SampleAuxiliaryInformationSizesBox",function(t){if(this.flags&1&&(this.aux_info_type=t.readString(4),this.aux_info_type_parameter=t.readUint32()),this.default_sample_info_size=t.readUint8(),this.sample_count=t.readUint32(),this.sample_info_size=[],this.default_sample_info_size===0)for(var e=0;e<this.sample_count;e++)this.sample_info_size[e]=t.readUint8()}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_METADATA,"mett",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_METADATA,"metx",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.parseFooter(t)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE,"sbtt",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE,"stpp",function(t){this.parseHeader(t),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.auxiliary_mime_types=t.readCString(),this.parseFooter(t)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE,"stxt",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE,"tx3g",function(t){this.parseHeader(t),this.displayFlags=t.readUint32(),this.horizontal_justification=t.readInt8(),this.vertical_justification=t.readInt8(),this.bg_color_rgba=t.readUint8Array(4),this.box_record=t.readInt16Array(4),this.style_record=t.readUint8Array(12),this.parseFooter(t)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_METADATA,"wvtt",function(t){this.parseHeader(t),this.parseFooter(t)}),s.createSampleGroupCtor("alst",function(t){var e,r=t.readUint16();for(this.first_output_sample=t.readUint16(),this.sample_offset=[],e=0;e<r;e++)this.sample_offset[e]=t.readUint32();var o=this.description_length-4-4*r;for(this.num_output_samples=[],this.num_total_samples=[],e=0;e<o/4;e++)this.num_output_samples[e]=t.readUint16(),this.num_total_samples[e]=t.readUint16()}),s.createSampleGroupCtor("avll",function(t){this.layerNumber=t.readUint8(),this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()}),s.createSampleGroupCtor("avss",function(t){this.subSequenceIdentifier=t.readUint16(),this.layerNumber=t.readUint8();var e=t.readUint8();this.durationFlag=e>>7,this.avgRateFlag=e>>6&1,this.durationFlag&&(this.duration=t.readUint32()),this.avgRateFlag&&(this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()),this.dependency=[];for(var r=t.readUint8(),o=0;o<r;o++){var l={};this.dependency.push(l),l.subSeqDirectionFlag=t.readUint8(),l.layerNumber=t.readUint8(),l.subSequenceIdentifier=t.readUint16()}}),s.createSampleGroupCtor("dtrt",function(t){a.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("mvif",function(t){a.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("prol",function(t){this.roll_distance=t.readInt16()}),s.createSampleGroupCtor("rap ",function(t){var e=t.readUint8();this.num_leading_samples_known=e>>7,this.num_leading_samples=e&127}),s.createSampleGroupCtor("rash",function(t){if(this.operation_point_count=t.readUint16(),this.description_length!==2+(this.operation_point_count===1?2:this.operation_point_count*6)+9)a.warn("BoxParser","Mismatch in "+this.grouping_type+" sample group length"),this.data=t.readUint8Array(this.description_length-2);else{if(this.operation_point_count===1)this.target_rate_share=t.readUint16();else{this.target_rate_share=[],this.available_bitrate=[];for(var e=0;e<this.operation_point_count;e++)this.available_bitrate[e]=t.readUint32(),this.target_rate_share[e]=t.readUint16()}this.maximum_bitrate=t.readUint32(),this.minimum_bitrate=t.readUint32(),this.discard_priority=t.readUint8()}}),s.createSampleGroupCtor("roll",function(t){this.roll_distance=t.readInt16()}),s.SampleGroupEntry.prototype.parse=function(t){a.warn("BoxParser","Unknown Sample Group type: "+this.grouping_type),this.data=t.readUint8Array(this.description_length)},s.createSampleGroupCtor("scif",function(t){a.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("scnm",function(t){a.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("seig",function(t){this.reserved=t.readUint8();var e=t.readUint8();this.crypt_byte_block=e>>4,this.skip_byte_block=e&15,this.isProtected=t.readUint8(),this.Per_Sample_IV_Size=t.readUint8(),this.KID=s.parseHex16(t),this.constant_IV_size=0,this.constant_IV=0,this.isProtected===1&&this.Per_Sample_IV_Size===0&&(this.constant_IV_size=t.readUint8(),this.constant_IV=t.readUint8Array(this.constant_IV_size))}),s.createSampleGroupCtor("stsa",function(t){a.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("sync",function(t){var e=t.readUint8();this.NAL_unit_type=e&63}),s.createSampleGroupCtor("tele",function(t){var e=t.readUint8();this.level_independently_decodable=e>>7}),s.createSampleGroupCtor("tsas",function(t){a.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("tscl",function(t){a.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("vipr",function(t){a.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createFullBoxCtor("sbgp","SampleToGroupBox",function(t){this.grouping_type=t.readString(4),this.version===1?this.grouping_type_parameter=t.readUint32():this.grouping_type_parameter=0,this.entries=[];for(var e=t.readUint32(),r=0;r<e;r++){var o={};this.entries.push(o),o.sample_count=t.readInt32(),o.group_description_index=t.readInt32()}});function E(t,e){this.bad_pixel_row=t,this.bad_pixel_column=e}E.prototype.toString=function(){return"[row: "+this.bad_pixel_row+", column: "+this.bad_pixel_column+"]"},s.createFullBoxCtor("sbpm","SensorBadPixelsMapBox",function(t){var e;for(this.component_count=t.readUint16(),this.component_index=[],e=0;e<this.component_count;e++)this.component_index.push(t.readUint16());var r=t.readUint8();for(this.correction_applied=(r&128)==128,this.num_bad_rows=t.readUint32(),this.num_bad_cols=t.readUint32(),this.num_bad_pixels=t.readUint32(),this.bad_rows=[],this.bad_columns=[],this.bad_pixels=[],e=0;e<this.num_bad_rows;e++)this.bad_rows.push(t.readUint32());for(e=0;e<this.num_bad_cols;e++)this.bad_columns.push(t.readUint32());for(e=0;e<this.num_bad_pixels;e++){var o=t.readUint32(),l=t.readUint32();this.bad_pixels.push(new E(o,l))}}),s.createFullBoxCtor("schm","SchemeTypeBox",function(t){this.scheme_type=t.readString(4),this.scheme_version=t.readUint32(),this.flags&1&&(this.scheme_uri=t.readString(this.size-this.hdr_size-8))}),s.createBoxCtor("sdp ","rtptracksdphintinformation",function(t){this.sdptext=t.readString(this.size-this.hdr_size)}),s.createFullBoxCtor("sdtp","SampleDependencyTypeBox",function(t){var e,r=this.size-this.hdr_size;this.is_leading=[],this.sample_depends_on=[],this.sample_is_depended_on=[],this.sample_has_redundancy=[];for(var o=0;o<r;o++)e=t.readUint8(),this.is_leading[o]=e>>6,this.sample_depends_on[o]=e>>4&3,this.sample_is_depended_on[o]=e>>2&3,this.sample_has_redundancy[o]=e&3}),s.createFullBoxCtor("senc","SampleEncryptionBox"),s.createFullBoxCtor("sgpd","SampleGroupDescriptionBox",function(t){this.grouping_type=t.readString(4),a.debug("BoxParser","Found Sample Groups of type "+this.grouping_type),this.version===1?this.default_length=t.readUint32():this.default_length=0,this.version>=2&&(this.default_group_description_index=t.readUint32()),this.entries=[];for(var e=t.readUint32(),r=0;r<e;r++){var o;s[this.grouping_type+"SampleGroupEntry"]?o=new s[this.grouping_type+"SampleGroupEntry"](this.grouping_type):o=new s.SampleGroupEntry(this.grouping_type),this.entries.push(o),this.version===1?this.default_length===0?o.description_length=t.readUint32():o.description_length=this.default_length:o.description_length=this.default_length,o.write===s.SampleGroupEntry.prototype.write&&(a.info("BoxParser","SampleGroup for type "+this.grouping_type+" writing not yet implemented, keeping unparsed data in memory for later write"),o.data=t.readUint8Array(o.description_length),t.position-=o.description_length),o.parse(t)}}),s.createFullBoxCtor("sidx","CompressedSegmentIndexBox",function(t){this.reference_ID=t.readUint32(),this.timescale=t.readUint32(),this.version===0?(this.earliest_presentation_time=t.readUint32(),this.first_offset=t.readUint32()):(this.earliest_presentation_time=t.readUint64(),this.first_offset=t.readUint64()),t.readUint16(),this.references=[];for(var e=t.readUint16(),r=0;r<e;r++){var o={};this.references.push(o);var l=t.readUint32();o.reference_type=l>>31&1,o.referenced_size=l&2147483647,o.subsegment_duration=t.readUint32(),l=t.readUint32(),o.starts_with_SAP=l>>31&1,o.SAP_type=l>>28&7,o.SAP_delta_time=l&268435455}}),s.SingleItemTypeReferenceBox=function(t,e,r,o){s.Box.call(this,t,e),this.hdr_size=r,this.start=o},s.SingleItemTypeReferenceBox.prototype=new s.Box,s.SingleItemTypeReferenceBox.prototype.parse=function(t){this.from_item_ID=t.readUint16();var e=t.readUint16();this.references=[];for(var r=0;r<e;r++)this.references[r]={},this.references[r].to_item_ID=t.readUint16()},s.SingleItemTypeReferenceBoxLarge=function(t,e,r,o){s.Box.call(this,t,e),this.hdr_size=r,this.start=o},s.SingleItemTypeReferenceBoxLarge.prototype=new s.Box,s.SingleItemTypeReferenceBoxLarge.prototype.parse=function(t){this.from_item_ID=t.readUint32();var e=t.readUint16();this.references=[];for(var r=0;r<e;r++)this.references[r]={},this.references[r].to_item_ID=t.readUint32()},s.createFullBoxCtor("SmDm","SMPTE2086MasteringDisplayMetadataBox",function(t){this.primaryRChromaticity_x=t.readUint16(),this.primaryRChromaticity_y=t.readUint16(),this.primaryGChromaticity_x=t.readUint16(),this.primaryGChromaticity_y=t.readUint16(),this.primaryBChromaticity_x=t.readUint16(),this.primaryBChromaticity_y=t.readUint16(),this.whitePointChromaticity_x=t.readUint16(),this.whitePointChromaticity_y=t.readUint16(),this.luminanceMax=t.readUint32(),this.luminanceMin=t.readUint32()}),s.createFullBoxCtor("smhd","SoundMediaHeaderBox",function(t){this.balance=t.readUint16(),t.readUint16()}),s.createFullBoxCtor("ssix","CompressedSubsegmentIndexBox",function(t){this.subsegments=[];for(var e=t.readUint32(),r=0;r<e;r++){var o={};this.subsegments.push(o),o.ranges=[];for(var l=t.readUint32(),d=0;d<l;d++){var p={};o.ranges.push(p),p.level=t.readUint8(),p.range_size=t.readUint24()}}}),s.createFullBoxCtor("stco","ChunkOffsetBox",function(t){var e;if(e=t.readUint32(),this.chunk_offsets=[],this.version===0)for(var r=0;r<e;r++)this.chunk_offsets.push(t.readUint32())}),s.createFullBoxCtor("stdp","DegradationPriorityBox",function(t){var e=(this.size-this.hdr_size)/2;this.priority=[];for(var r=0;r<e;r++)this.priority[r]=t.readUint16()}),s.createFullBoxCtor("sthd","SubtitleMediaHeaderBox"),s.createFullBoxCtor("stri","SubTrackInformationBox",function(t){this.switch_group=t.readUint16(),this.alternate_group=t.readUint16(),this.sub_track_id=t.readUint32();var e=(this.size-this.hdr_size-8)/4;this.attribute_list=[];for(var r=0;r<e;r++)this.attribute_list[r]=t.readUint32()}),s.createFullBoxCtor("stsc","SampleToChunkBox",function(t){var e,r;if(e=t.readUint32(),this.first_chunk=[],this.samples_per_chunk=[],this.sample_description_index=[],this.version===0)for(r=0;r<e;r++)this.first_chunk.push(t.readUint32()),this.samples_per_chunk.push(t.readUint32()),this.sample_description_index.push(t.readUint32())}),s.createFullBoxCtor("stsd","SampleDescriptionBox",function(t){var e,r,o,l;for(this.entries=[],o=t.readUint32(),e=1;e<=o;e++)if(r=s.parseOneBox(t,!0,this.size-(t.getPosition()-this.start)),r.code===s.OK)s[r.type+"SampleEntry"]?(l=new s[r.type+"SampleEntry"](r.size),l.hdr_size=r.hdr_size,l.start=r.start):(a.warn("BoxParser","Unknown sample entry type: "+r.type),l=new s.SampleEntry(r.type,r.size,r.hdr_size,r.start)),l.write===s.SampleEntry.prototype.write&&(a.info("BoxParser","SampleEntry "+l.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),l.parseDataAndRewind(t)),l.parse(t),this.entries.push(l);else return}),s.createFullBoxCtor("stsg","SubTrackSampleGroupBox",function(t){this.grouping_type=t.readUint32();var e=t.readUint16();this.group_description_index=[];for(var r=0;r<e;r++)this.group_description_index[r]=t.readUint32()}),s.createFullBoxCtor("stsh","ShadowSyncSampleBox",function(t){var e,r;if(e=t.readUint32(),this.shadowed_sample_numbers=[],this.sync_sample_numbers=[],this.version===0)for(r=0;r<e;r++)this.shadowed_sample_numbers.push(t.readUint32()),this.sync_sample_numbers.push(t.readUint32())}),s.createFullBoxCtor("stss","SyncSampleBox",function(t){var e,r;if(r=t.readUint32(),this.version===0)for(this.sample_numbers=[],e=0;e<r;e++)this.sample_numbers.push(t.readUint32())}),s.createFullBoxCtor("stsz","SampleSizeBox",function(t){var e;if(this.sample_sizes=[],this.version===0)for(this.sample_size=t.readUint32(),this.sample_count=t.readUint32(),e=0;e<this.sample_count;e++)this.sample_size===0?this.sample_sizes.push(t.readUint32()):this.sample_sizes[e]=this.sample_size}),s.createFullBoxCtor("stts","TimeToSampleBox",function(t){var e,r,o;if(e=t.readUint32(),this.sample_counts=[],this.sample_deltas=[],this.version===0)for(r=0;r<e;r++)this.sample_counts.push(t.readUint32()),o=t.readInt32(),o<0&&(a.warn("BoxParser","File uses negative stts sample delta, using value 1 instead, sync may be lost!"),o=1),this.sample_deltas.push(o)}),s.createFullBoxCtor("stvi","StereoVideoBox",function(t){var e=t.readUint32();this.single_view_allowed=e&3,this.stereo_scheme=t.readUint32();var r=t.readUint32();this.stereo_indication_type=t.readString(r);var o,l;for(this.boxes=[];t.getPosition()<this.start+this.size;)if(o=s.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),o.code===s.OK)l=o.box,this.boxes.push(l),this[l.type]=l;else return}),s.createBoxCtor("styp","SegmentTypeBox",function(t){s.ftypBox.prototype.parse.call(this,t)}),s.createFullBoxCtor("stz2","CompactSampleSizeBox",function(t){var e,r;if(this.sample_sizes=[],this.version===0)if(this.reserved=t.readUint24(),this.field_size=t.readUint8(),r=t.readUint32(),this.field_size===4)for(e=0;e<r;e+=2){var o=t.readUint8();this.sample_sizes[e]=o>>4&15,this.sample_sizes[e+1]=o&15}else if(this.field_size===8)for(e=0;e<r;e++)this.sample_sizes[e]=t.readUint8();else if(this.field_size===16)for(e=0;e<r;e++)this.sample_sizes[e]=t.readUint16();else a.error("BoxParser","Error in length field in stz2 box")}),s.createFullBoxCtor("subs","SubSampleInformationBox",function(t){var e,r,o,l;for(o=t.readUint32(),this.entries=[],e=0;e<o;e++){var d={};if(this.entries[e]=d,d.sample_delta=t.readUint32(),d.subsamples=[],l=t.readUint16(),l>0)for(r=0;r<l;r++){var p={};d.subsamples.push(p),this.version==1?p.size=t.readUint32():p.size=t.readUint16(),p.priority=t.readUint8(),p.discardable=t.readUint8(),p.codec_specific_parameters=t.readUint32()}}}),s.createFullBoxCtor("tenc","TrackEncryptionBox",function(t){if(t.readUint8(),this.version===0)t.readUint8();else{var e=t.readUint8();this.default_crypt_byte_block=e>>4&15,this.default_skip_byte_block=e&15}this.default_isProtected=t.readUint8(),this.default_Per_Sample_IV_Size=t.readUint8(),this.default_KID=s.parseHex16(t),this.default_isProtected===1&&this.default_Per_Sample_IV_Size===0&&(this.default_constant_IV_size=t.readUint8(),this.default_constant_IV=t.readUint8Array(this.default_constant_IV_size))}),s.createFullBoxCtor("tfdt","TrackFragmentBaseMediaDecodeTimeBox",function(t){this.version==1?this.baseMediaDecodeTime=t.readUint64():this.baseMediaDecodeTime=t.readUint32()}),s.createFullBoxCtor("tfhd","TrackFragmentHeaderBox",function(t){var e=0;this.track_id=t.readUint32(),this.size-this.hdr_size>e&&this.flags&s.TFHD_FLAG_BASE_DATA_OFFSET?(this.base_data_offset=t.readUint64(),e+=8):this.base_data_offset=0,this.size-this.hdr_size>e&&this.flags&s.TFHD_FLAG_SAMPLE_DESC?(this.default_sample_description_index=t.readUint32(),e+=4):this.default_sample_description_index=0,this.size-this.hdr_size>e&&this.flags&s.TFHD_FLAG_SAMPLE_DUR?(this.default_sample_duration=t.readUint32(),e+=4):this.default_sample_duration=0,this.size-this.hdr_size>e&&this.flags&s.TFHD_FLAG_SAMPLE_SIZE?(this.default_sample_size=t.readUint32(),e+=4):this.default_sample_size=0,this.size-this.hdr_size>e&&this.flags&s.TFHD_FLAG_SAMPLE_FLAGS?(this.default_sample_flags=t.readUint32(),e+=4):this.default_sample_flags=0}),s.createFullBoxCtor("tfra","TrackFragmentRandomAccessBox",function(t){this.track_ID=t.readUint32(),t.readUint24();var e=t.readUint8();this.length_size_of_traf_num=e>>4&3,this.length_size_of_trun_num=e>>2&3,this.length_size_of_sample_num=e&3,this.entries=[];for(var r=t.readUint32(),o=0;o<r;o++)this.version===1?(this.time=t.readUint64(),this.moof_offset=t.readUint64()):(this.time=t.readUint32(),this.moof_offset=t.readUint32()),this.traf_number=t["readUint"+8*(this.length_size_of_traf_num+1)](),this.trun_number=t["readUint"+8*(this.length_size_of_trun_num+1)](),this.sample_number=t["readUint"+8*(this.length_size_of_sample_num+1)]()}),s.createFullBoxCtor("tkhd","TrackHeaderBox",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint32()),t.readUint32Array(2),this.layer=t.readInt16(),this.alternate_group=t.readInt16(),this.volume=t.readInt16()>>8,t.readUint16(),this.matrix=t.readInt32Array(9),this.width=t.readUint32(),this.height=t.readUint32()}),s.createBoxCtor("tmax","hintmaxrelativetime",function(t){this.time=t.readUint32()}),s.createBoxCtor("tmin","hintminrelativetime",function(t){this.time=t.readUint32()}),s.createBoxCtor("totl","hintBytesSent",function(t){this.bytessent=t.readUint32()}),s.createBoxCtor("tpay","hintBytesSent",function(t){this.bytessent=t.readUint32()}),s.createBoxCtor("tpyl","hintBytesSent",function(t){this.bytessent=t.readUint64()}),s.TrackGroupTypeBox.prototype.parse=function(t){this.parseFullHeader(t),this.track_group_id=t.readUint32()},s.createTrackGroupCtor("msrc"),s.TrackReferenceTypeBox=function(t,e,r,o){s.Box.call(this,t,e),this.hdr_size=r,this.start=o},s.TrackReferenceTypeBox.prototype=new s.Box,s.TrackReferenceTypeBox.prototype.parse=function(t){this.track_ids=t.readUint32Array((this.size-this.hdr_size)/4)},s.trefBox.prototype.parse=function(t){for(var e,r;t.getPosition()<this.start+this.size;)if(e=s.parseOneBox(t,!0,this.size-(t.getPosition()-this.start)),e.code===s.OK)r=new s.TrackReferenceTypeBox(e.type,e.size,e.hdr_size,e.start),r.write===s.Box.prototype.write&&r.type!=="mdat"&&(a.info("BoxParser","TrackReference "+r.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),r.parseDataAndRewind(t)),r.parse(t),this.boxes.push(r);else return},s.createFullBoxCtor("trep","TrackExtensionPropertiesBox",function(t){for(this.track_ID=t.readUint32(),this.boxes=[];t.getPosition()<this.start+this.size;)if(ret=s.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),ret.code===s.OK)box=ret.box,this.boxes.push(box);else return}),s.createFullBoxCtor("trex","TrackExtendsBox",function(t){this.track_id=t.readUint32(),this.default_sample_description_index=t.readUint32(),this.default_sample_duration=t.readUint32(),this.default_sample_size=t.readUint32(),this.default_sample_flags=t.readUint32()}),s.createBoxCtor("trpy","hintBytesSent",function(t){this.bytessent=t.readUint64()}),s.createFullBoxCtor("trun","TrackRunBox",function(t){var e=0;if(this.sample_count=t.readUint32(),e+=4,this.size-this.hdr_size>e&&this.flags&s.TRUN_FLAGS_DATA_OFFSET?(this.data_offset=t.readInt32(),e+=4):this.data_offset=0,this.size-this.hdr_size>e&&this.flags&s.TRUN_FLAGS_FIRST_FLAG?(this.first_sample_flags=t.readUint32(),e+=4):this.first_sample_flags=0,this.sample_duration=[],this.sample_size=[],this.sample_flags=[],this.sample_composition_time_offset=[],this.size-this.hdr_size>e)for(var r=0;r<this.sample_count;r++)this.flags&s.TRUN_FLAGS_DURATION&&(this.sample_duration[r]=t.readUint32()),this.flags&s.TRUN_FLAGS_SIZE&&(this.sample_size[r]=t.readUint32()),this.flags&s.TRUN_FLAGS_FLAGS&&(this.sample_flags[r]=t.readUint32()),this.flags&s.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?this.sample_composition_time_offset[r]=t.readUint32():this.sample_composition_time_offset[r]=t.readInt32())}),s.createFullBoxCtor("tsel","TrackSelectionBox",function(t){this.switch_group=t.readUint32();var e=(this.size-this.hdr_size-4)/4;this.attribute_list=[];for(var r=0;r<e;r++)this.attribute_list[r]=t.readUint32()}),s.createFullBoxCtor("txtC","TextConfigBox",function(t){this.config=t.readCString()}),s.createBoxCtor("tyco","TypeCombinationBox",function(t){var e=(this.size-this.hdr_size)/4;this.compatible_brands=[];for(var r=0;r<e;r++)this.compatible_brands[r]=t.readString(4)}),s.createFullBoxCtor("udes","UserDescriptionProperty",function(t){this.lang=t.readCString(),this.name=t.readCString(),this.description=t.readCString(),this.tags=t.readCString()}),s.createFullBoxCtor("uncC","UncompressedFrameConfigBox",function(t){var e;if(this.profile=t.readString(4),this.version!=1){if(this.version==0){for(this.component_count=t.readUint32(),this.component_index=[],this.component_bit_depth_minus_one=[],this.component_format=[],this.component_align_size=[],e=0;e<this.component_count;e++)this.component_index.push(t.readUint16()),this.component_bit_depth_minus_one.push(t.readUint8()),this.component_format.push(t.readUint8()),this.component_align_size.push(t.readUint8());this.sampling_type=t.readUint8(),this.interleave_type=t.readUint8(),this.block_size=t.readUint8();var r=t.readUint8();this.component_little_endian=r>>7&1,this.block_pad_lsb=r>>6&1,this.block_little_endian=r>>5&1,this.block_reversed=r>>4&1,this.pad_unknown=r>>3&1,this.pixel_size=t.readUint32(),this.row_align_size=t.readUint32(),this.tile_align_size=t.readUint32(),this.num_tile_cols_minus_one=t.readUint32(),this.num_tile_rows_minus_one=t.readUint32()}}}),s.createFullBoxCtor("url ","DataEntryUrlBox",function(t){this.flags!==1&&(this.location=t.readCString())}),s.createFullBoxCtor("urn ","DataEntryUrnBox",function(t){this.name=t.readCString(),this.size-this.hdr_size-this.name.length-1>0&&(this.location=t.readCString())}),s.createUUIDBox("a5d40b30e81411ddba2f0800200c9a66","LiveServerManifestBox",!0,!1,function(t){this.LiveServerManifest=t.readString(this.size-this.hdr_size).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}),s.createUUIDBox("d08a4f1810f34a82b6c832d8aba183d3","PiffProtectionSystemSpecificHeaderBox",!0,!1,function(t){this.system_id=s.parseHex16(t);var e=t.readUint32();e>0&&(this.data=t.readUint8Array(e))}),s.createUUIDBox("a2394f525a9b4f14a2446c427c648df4","PiffSampleEncryptionBox",!0,!1),s.createUUIDBox("8974dbce7be74c5184f97148f9882554","PiffTrackEncryptionBox",!0,!1,function(t){this.default_AlgorithmID=t.readUint24(),this.default_IV_size=t.readUint8(),this.default_KID=s.parseHex16(t)}),s.createUUIDBox("d4807ef2ca3946958e5426cb9e46a79f","TfrfBox",!0,!1,function(t){this.fragment_count=t.readUint8(),this.entries=[];for(var e=0;e<this.fragment_count;e++){var r={},o=0,l=0;this.version===1?(o=t.readUint64(),l=t.readUint64()):(o=t.readUint32(),l=t.readUint32()),r.absolute_time=o,r.absolute_duration=l,this.entries.push(r)}}),s.createUUIDBox("6d1d9b0542d544e680e2141daff757b2","TfxdBox",!0,!1,function(t){this.version===1?(this.absolute_time=t.readUint64(),this.duration=t.readUint64()):(this.absolute_time=t.readUint32(),this.duration=t.readUint32())}),s.createFullBoxCtor("vmhd","VideoMediaHeaderBox",function(t){this.graphicsmode=t.readUint16(),this.opcolor=t.readUint16Array(3)}),s.createFullBoxCtor("vpcC","VPCodecConfigurationRecord",function(t){var e;this.version===1?(this.profile=t.readUint8(),this.level=t.readUint8(),e=t.readUint8(),this.bitDepth=e>>4,this.chromaSubsampling=e>>1&7,this.videoFullRangeFlag=e&1,this.colourPrimaries=t.readUint8(),this.transferCharacteristics=t.readUint8(),this.matrixCoefficients=t.readUint8(),this.codecIntializationDataSize=t.readUint16(),this.codecIntializationData=t.readUint8Array(this.codecIntializationDataSize)):(this.profile=t.readUint8(),this.level=t.readUint8(),e=t.readUint8(),this.bitDepth=e>>4&15,this.colorSpace=e&15,e=t.readUint8(),this.chromaSubsampling=e>>4&15,this.transferFunction=e>>1&7,this.videoFullRangeFlag=e&1,this.codecIntializationDataSize=t.readUint16(),this.codecIntializationData=t.readUint8Array(this.codecIntializationDataSize))}),s.createBoxCtor("vttC","WebVTTConfigurationBox",function(t){this.text=t.readString(this.size-this.hdr_size)}),s.createFullBoxCtor("vvcC","VvcConfigurationBox",function(t){var e,r,o={held_bits:void 0,num_held_bits:0,stream_read_1_bytes:function(A){this.held_bits=A.readUint8(),this.num_held_bits=8},stream_read_2_bytes:function(A){this.held_bits=A.readUint16(),this.num_held_bits=16},extract_bits:function(A){var q=this.held_bits>>this.num_held_bits-A&(1<<A)-1;return this.num_held_bits-=A,q}};if(o.stream_read_1_bytes(t),o.extract_bits(5),this.lengthSizeMinusOne=o.extract_bits(2),this.ptl_present_flag=o.extract_bits(1),this.ptl_present_flag){o.stream_read_2_bytes(t),this.ols_idx=o.extract_bits(9),this.num_sublayers=o.extract_bits(3),this.constant_frame_rate=o.extract_bits(2),this.chroma_format_idc=o.extract_bits(2),o.stream_read_1_bytes(t),this.bit_depth_minus8=o.extract_bits(3),o.extract_bits(5);{if(o.stream_read_2_bytes(t),o.extract_bits(2),this.num_bytes_constraint_info=o.extract_bits(6),this.general_profile_idc=o.extract_bits(7),this.general_tier_flag=o.extract_bits(1),this.general_level_idc=t.readUint8(),o.stream_read_1_bytes(t),this.ptl_frame_only_constraint_flag=o.extract_bits(1),this.ptl_multilayer_enabled_flag=o.extract_bits(1),this.general_constraint_info=new Uint8Array(this.num_bytes_constraint_info),this.num_bytes_constraint_info){for(e=0;e<this.num_bytes_constraint_info-1;e++){var l=o.extract_bits(6);o.stream_read_1_bytes(t);var d=o.extract_bits(2);this.general_constraint_info[e]=l<<2|d}this.general_constraint_info[this.num_bytes_constraint_info-1]=o.extract_bits(6)}else o.extract_bits(6);if(this.num_sublayers>1){for(o.stream_read_1_bytes(t),this.ptl_sublayer_present_mask=0,r=this.num_sublayers-2;r>=0;--r){var p=o.extract_bits(1);this.ptl_sublayer_present_mask|=p<<r}for(r=this.num_sublayers;r<=8&&this.num_sublayers>1;++r)o.extract_bits(1);for(this.sublayer_level_idc=[],r=this.num_sublayers-2;r>=0;--r)this.ptl_sublayer_present_mask&1<<r&&(this.sublayer_level_idc[r]=t.readUint8())}if(this.ptl_num_sub_profiles=t.readUint8(),this.general_sub_profile_idc=[],this.ptl_num_sub_profiles)for(e=0;e<this.ptl_num_sub_profiles;e++)this.general_sub_profile_idc.push(t.readUint32())}this.max_picture_width=t.readUint16(),this.max_picture_height=t.readUint16(),this.avg_frame_rate=t.readUint16()}var _=12,m=13;this.nalu_arrays=[];var w=t.readUint8();for(e=0;e<w;e++){var b=[];this.nalu_arrays.push(b),o.stream_read_1_bytes(t),b.completeness=o.extract_bits(1),o.extract_bits(2),b.nalu_type=o.extract_bits(5);var U=1;for(b.nalu_type!=m&&b.nalu_type!=_&&(U=t.readUint16()),r=0;r<U;r++){var I=t.readUint16();b.push({data:t.readUint8Array(I),length:I})}}}),s.createFullBoxCtor("vvnC","VvcNALUConfigBox",function(t){var e=strm.readUint8();this.lengthSizeMinusOne=e&3}),s.SampleEntry.prototype.isVideo=function(){return!1},s.SampleEntry.prototype.isAudio=function(){return!1},s.SampleEntry.prototype.isSubtitle=function(){return!1},s.SampleEntry.prototype.isMetadata=function(){return!1},s.SampleEntry.prototype.isHint=function(){return!1},s.SampleEntry.prototype.getCodec=function(){return this.type.replace(".","")},s.SampleEntry.prototype.getWidth=function(){return""},s.SampleEntry.prototype.getHeight=function(){return""},s.SampleEntry.prototype.getChannelCount=function(){return""},s.SampleEntry.prototype.getSampleRate=function(){return""},s.SampleEntry.prototype.getSampleSize=function(){return""},s.VisualSampleEntry.prototype.isVideo=function(){return!0},s.VisualSampleEntry.prototype.getWidth=function(){return this.width},s.VisualSampleEntry.prototype.getHeight=function(){return this.height},s.AudioSampleEntry.prototype.isAudio=function(){return!0},s.AudioSampleEntry.prototype.getChannelCount=function(){return this.channel_count},s.AudioSampleEntry.prototype.getSampleRate=function(){return this.samplerate},s.AudioSampleEntry.prototype.getSampleSize=function(){return this.samplesize},s.SubtitleSampleEntry.prototype.isSubtitle=function(){return!0},s.MetadataSampleEntry.prototype.isMetadata=function(){return!0},s.decimalToHex=function(t,e){var r=Number(t).toString(16);for(e=typeof e>"u"||e===null?e=2:e;r.length<e;)r="0"+r;return r},s.avc1SampleEntry.prototype.getCodec=s.avc2SampleEntry.prototype.getCodec=s.avc3SampleEntry.prototype.getCodec=s.avc4SampleEntry.prototype.getCodec=function(){var t=s.SampleEntry.prototype.getCodec.call(this);return this.avcC?t+"."+s.decimalToHex(this.avcC.AVCProfileIndication)+s.decimalToHex(this.avcC.profile_compatibility)+s.decimalToHex(this.avcC.AVCLevelIndication):t},s.hev1SampleEntry.prototype.getCodec=s.hvc1SampleEntry.prototype.getCodec=function(){var t,e=s.SampleEntry.prototype.getCodec.call(this);if(this.hvcC){switch(e+=".",this.hvcC.general_profile_space){case 0:e+="";break;case 1:e+="A";break;case 2:e+="B";break;case 3:e+="C";break}e+=this.hvcC.general_profile_idc,e+=".";var r=this.hvcC.general_profile_compatibility,o=0;for(t=0;t<32&&(o|=r&1,t!=31);t++)o<<=1,r>>=1;e+=s.decimalToHex(o,0),e+=".",this.hvcC.general_tier_flag===0?e+="L":e+="H",e+=this.hvcC.general_level_idc;var l=!1,d="";for(t=5;t>=0;t--)(this.hvcC.general_constraint_indicator[t]||l)&&(d="."+s.decimalToHex(this.hvcC.general_constraint_indicator[t],0)+d,l=!0);e+=d}return e},s.vvc1SampleEntry.prototype.getCodec=s.vvi1SampleEntry.prototype.getCodec=function(){var t,e=s.SampleEntry.prototype.getCodec.call(this);if(this.vvcC){e+="."+this.vvcC.general_profile_idc,this.vvcC.general_tier_flag?e+=".H":e+=".L",e+=this.vvcC.general_level_idc;var r="";if(this.vvcC.general_constraint_info){var o=[],l=0;l|=this.vvcC.ptl_frame_only_constraint<<7,l|=this.vvcC.ptl_multilayer_enabled<<6;var d;for(t=0;t<this.vvcC.general_constraint_info.length;++t)l|=this.vvcC.general_constraint_info[t]>>2&63,o.push(l),l&&(d=t),l=this.vvcC.general_constraint_info[t]>>2&3;if(d===void 0)r=".CA";else{r=".C";var p="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",_=0,m=0;for(t=0;t<=d;++t)for(_=_<<8|o[t],m+=8;m>=5;){var w=_>>m-5&31;r+=p[w],m-=5,_&=(1<<m)-1}m&&(_<<=5-m,r+=p[_&31])}}e+=r}return e},s.mp4aSampleEntry.prototype.getCodec=function(){var t=s.SampleEntry.prototype.getCodec.call(this);if(this.esds&&this.esds.esd){var e=this.esds.esd.getOTI(),r=this.esds.esd.getAudioConfig();return t+"."+s.decimalToHex(e)+(r?"."+r:"")}else return t},s.stxtSampleEntry.prototype.getCodec=function(){var t=s.SampleEntry.prototype.getCodec.call(this);return this.mime_format?t+"."+this.mime_format:t},s.vp08SampleEntry.prototype.getCodec=s.vp09SampleEntry.prototype.getCodec=function(){var t=s.SampleEntry.prototype.getCodec.call(this),e=this.vpcC.level;e==0&&(e="00");var r=this.vpcC.bitDepth;return r==8&&(r="08"),t+".0"+this.vpcC.profile+"."+e+"."+r},s.av01SampleEntry.prototype.getCodec=function(){var t=s.SampleEntry.prototype.getCodec.call(this),e=this.av1C.seq_level_idx_0;e<10&&(e="0"+e);var r;return this.av1C.seq_profile===2&&this.av1C.high_bitdepth===1?r=this.av1C.twelve_bit===1?"12":"10":this.av1C.seq_profile<=2&&(r=this.av1C.high_bitdepth===1?"10":"08"),t+"."+this.av1C.seq_profile+"."+e+(this.av1C.seq_tier_0?"H":"M")+"."+r},s.Box.prototype.writeHeader=function(t,e){this.size+=8,this.size>u&&(this.size+=8),this.type==="uuid"&&(this.size+=16),a.debug("BoxWriter","Writing box "+this.type+" of size: "+this.size+" at position "+t.getPosition()+(e||"")),this.size>u?t.writeUint32(1):(this.sizePosition=t.getPosition(),t.writeUint32(this.size)),t.writeString(this.type,null,4),this.type==="uuid"&&t.writeUint8Array(this.uuid),this.size>u&&t.writeUint64(this.size)},s.FullBox.prototype.writeHeader=function(t){this.size+=4,s.Box.prototype.writeHeader.call(this,t," v="+this.version+" f="+this.flags),t.writeUint8(this.version),t.writeUint24(this.flags)},s.Box.prototype.write=function(t){this.type==="mdat"?this.data&&(this.size=this.data.length,this.writeHeader(t),t.writeUint8Array(this.data)):(this.size=this.data?this.data.length:0,this.writeHeader(t),this.data&&t.writeUint8Array(this.data))},s.ContainerBox.prototype.write=function(t){this.size=0,this.writeHeader(t);for(var e=0;e<this.boxes.length;e++)this.boxes[e]&&(this.boxes[e].write(t),this.size+=this.boxes[e].size);a.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},s.TrackReferenceTypeBox.prototype.write=function(t){this.size=this.track_ids.length*4,this.writeHeader(t),t.writeUint32Array(this.track_ids)},s.avcCBox.prototype.write=function(t){var e;for(this.size=7,e=0;e<this.SPS.length;e++)this.size+=2+this.SPS[e].length;for(e=0;e<this.PPS.length;e++)this.size+=2+this.PPS[e].length;for(this.ext&&(this.size+=this.ext.length),this.writeHeader(t),t.writeUint8(this.configurationVersion),t.writeUint8(this.AVCProfileIndication),t.writeUint8(this.profile_compatibility),t.writeUint8(this.AVCLevelIndication),t.writeUint8(this.lengthSizeMinusOne+252),t.writeUint8(this.SPS.length+224),e=0;e<this.SPS.length;e++)t.writeUint16(this.SPS[e].length),t.writeUint8Array(this.SPS[e].nalu);for(t.writeUint8(this.PPS.length),e=0;e<this.PPS.length;e++)t.writeUint16(this.PPS[e].length),t.writeUint8Array(this.PPS[e].nalu);this.ext&&t.writeUint8Array(this.ext)},s.co64Box.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),e=0;e<this.chunk_offsets.length;e++)t.writeUint64(this.chunk_offsets[e])},s.cslgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(t),t.writeInt32(this.compositionToDTSShift),t.writeInt32(this.leastDecodeToDisplayDelta),t.writeInt32(this.greatestDecodeToDisplayDelta),t.writeInt32(this.compositionStartTime),t.writeInt32(this.compositionEndTime)},s.cttsBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),e=0;e<this.sample_counts.length;e++)t.writeUint32(this.sample_counts[e]),this.version===1?t.writeInt32(this.sample_offsets[e]):t.writeUint32(this.sample_offsets[e])},s.drefBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++)this.entries[e].write(t),this.size+=this.entries[e].size;a.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},s.elngBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.extended_language.length,this.writeHeader(t),t.writeString(this.extended_language)},s.elstBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+12*this.entries.length,this.writeHeader(t),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++){var r=this.entries[e];t.writeUint32(r.segment_duration),t.writeInt32(r.media_time),t.writeInt16(r.media_rate_integer),t.writeInt16(r.media_rate_fraction)}},s.emsgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*4+this.message_data.length+(this.scheme_id_uri.length+1)+(this.value.length+1),this.writeHeader(t),t.writeCString(this.scheme_id_uri),t.writeCString(this.value),t.writeUint32(this.timescale),t.writeUint32(this.presentation_time_delta),t.writeUint32(this.event_duration),t.writeUint32(this.id),t.writeUint8Array(this.message_data)},s.ftypBox.prototype.write=function(t){this.size=8+4*this.compatible_brands.length,this.writeHeader(t),t.writeString(this.major_brand,null,4),t.writeUint32(this.minor_version);for(var e=0;e<this.compatible_brands.length;e++)t.writeString(this.compatible_brands[e],null,4)},s.hdlrBox.prototype.write=function(t){this.size=5*4+this.name.length+1,this.version=0,this.flags=0,this.writeHeader(t),t.writeUint32(0),t.writeString(this.handler,null,4),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeCString(this.name)},s.hvcCBox.prototype.write=function(t){var e,r;for(this.size=23,e=0;e<this.nalu_arrays.length;e++)for(this.size+=3,r=0;r<this.nalu_arrays[e].length;r++)this.size+=2+this.nalu_arrays[e][r].data.length;for(this.writeHeader(t),t.writeUint8(this.configurationVersion),t.writeUint8((this.general_profile_space<<6)+(this.general_tier_flag<<5)+this.general_profile_idc),t.writeUint32(this.general_profile_compatibility),t.writeUint8Array(this.general_constraint_indicator),t.writeUint8(this.general_level_idc),t.writeUint16(this.min_spatial_segmentation_idc+(15<<24)),t.writeUint8(this.parallelismType+252),t.writeUint8(this.chroma_format_idc+252),t.writeUint8(this.bit_depth_luma_minus8+248),t.writeUint8(this.bit_depth_chroma_minus8+248),t.writeUint16(this.avgFrameRate),t.writeUint8((this.constantFrameRate<<6)+(this.numTemporalLayers<<3)+(this.temporalIdNested<<2)+this.lengthSizeMinusOne),t.writeUint8(this.nalu_arrays.length),e=0;e<this.nalu_arrays.length;e++)for(t.writeUint8((this.nalu_arrays[e].completeness<<7)+this.nalu_arrays[e].nalu_type),t.writeUint16(this.nalu_arrays[e].length),r=0;r<this.nalu_arrays[e].length;r++)t.writeUint16(this.nalu_arrays[e][r].data.length),t.writeUint8Array(this.nalu_arrays[e][r].data)},s.kindBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.schemeURI.length+1+(this.value.length+1),this.writeHeader(t),t.writeCString(this.schemeURI),t.writeCString(this.value)},s.mdhdBox.prototype.write=function(t){this.size=4*4+2*2,this.flags=0,this.version=0,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint16(this.language),t.writeUint16(0)},s.mehdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.fragment_duration)},s.mfhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.sequence_number)},s.mvhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=23*4+2*2,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint32(this.rate),t.writeUint16(this.volume<<8),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32Array(this.matrix),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(this.next_track_id)},s.SampleEntry.prototype.writeHeader=function(t){this.size=8,s.Box.prototype.writeHeader.call(this,t),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint16(this.data_reference_index)},s.SampleEntry.prototype.writeFooter=function(t){for(var e=0;e<this.boxes.length;e++)this.boxes[e].write(t),this.size+=this.boxes[e].size;a.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},s.SampleEntry.prototype.write=function(t){this.writeHeader(t),t.writeUint8Array(this.data),this.size+=this.data.length,a.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},s.VisualSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=2*7+6*4+32,t.writeUint16(0),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.width),t.writeUint16(this.height),t.writeUint32(this.horizresolution),t.writeUint32(this.vertresolution),t.writeUint32(0),t.writeUint16(this.frame_count),t.writeUint8(Math.min(31,this.compressorname.length)),t.writeString(this.compressorname,null,31),t.writeUint16(this.depth),t.writeInt16(-1),this.writeFooter(t)},s.AudioSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=2*4+3*4,t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.channel_count),t.writeUint16(this.samplesize),t.writeUint16(0),t.writeUint16(0),t.writeUint32(this.samplerate<<16),this.writeFooter(t)},s.stppSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=this.namespace.length+1+this.schema_location.length+1+this.auxiliary_mime_types.length+1,t.writeCString(this.namespace),t.writeCString(this.schema_location),t.writeCString(this.auxiliary_mime_types),this.writeFooter(t)},s.SampleGroupEntry.prototype.write=function(t){t.writeUint8Array(this.data)},s.sbgpBox.prototype.write=function(t){this.version=1,this.flags=0,this.size=12+8*this.entries.length,this.writeHeader(t),t.writeString(this.grouping_type,null,4),t.writeUint32(this.grouping_type_parameter),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++){var r=this.entries[e];t.writeInt32(r.sample_count),t.writeInt32(r.group_description_index)}},s.sgpdBox.prototype.write=function(t){var e,r;for(this.flags=0,this.size=12,e=0;e<this.entries.length;e++)r=this.entries[e],this.version===1&&(this.default_length===0&&(this.size+=4),this.size+=r.data.length);for(this.writeHeader(t),t.writeString(this.grouping_type,null,4),this.version===1&&t.writeUint32(this.default_length),this.version>=2&&t.writeUint32(this.default_sample_description_index),t.writeUint32(this.entries.length),e=0;e<this.entries.length;e++)r=this.entries[e],this.version===1&&this.default_length===0&&t.writeUint32(r.description_length),r.write(t)},s.sidxBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*4+2+2+12*this.references.length,this.writeHeader(t),t.writeUint32(this.reference_ID),t.writeUint32(this.timescale),t.writeUint32(this.earliest_presentation_time),t.writeUint32(this.first_offset),t.writeUint16(0),t.writeUint16(this.references.length);for(var e=0;e<this.references.length;e++){var r=this.references[e];t.writeUint32(r.reference_type<<31|r.referenced_size),t.writeUint32(r.subsegment_duration),t.writeUint32(r.starts_with_SAP<<31|r.SAP_type<<28|r.SAP_delta_time)}},s.smhdBox.prototype.write=function(t){this.version=0,this.flags=1,this.size=4,this.writeHeader(t),t.writeUint16(this.balance),t.writeUint16(0)},s.stcoBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),t.writeUint32Array(this.chunk_offsets)},s.stscBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+12*this.first_chunk.length,this.writeHeader(t),t.writeUint32(this.first_chunk.length),e=0;e<this.first_chunk.length;e++)t.writeUint32(this.first_chunk[e]),t.writeUint32(this.samples_per_chunk[e]),t.writeUint32(this.sample_description_index[e])},s.stsdBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=0,this.writeHeader(t),t.writeUint32(this.entries.length),this.size+=4,e=0;e<this.entries.length;e++)this.entries[e].write(t),this.size+=this.entries[e].size;a.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},s.stshBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.shadowed_sample_numbers.length,this.writeHeader(t),t.writeUint32(this.shadowed_sample_numbers.length),e=0;e<this.shadowed_sample_numbers.length;e++)t.writeUint32(this.shadowed_sample_numbers[e]),t.writeUint32(this.sync_sample_numbers[e])},s.stssBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.sample_numbers.length,this.writeHeader(t),t.writeUint32(this.sample_numbers.length),t.writeUint32Array(this.sample_numbers)},s.stszBox.prototype.write=function(t){var e,r=!0;if(this.version=0,this.flags=0,this.sample_sizes.length>0)for(e=0;e+1<this.sample_sizes.length;)if(this.sample_sizes[e+1]!==this.sample_sizes[0]){r=!1;break}else e++;else r=!1;this.size=8,r||(this.size+=4*this.sample_sizes.length),this.writeHeader(t),r?t.writeUint32(this.sample_sizes[0]):t.writeUint32(0),t.writeUint32(this.sample_sizes.length),r||t.writeUint32Array(this.sample_sizes)},s.sttsBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),e=0;e<this.sample_counts.length;e++)t.writeUint32(this.sample_counts[e]),t.writeUint32(this.sample_deltas[e])},s.tfdtBox.prototype.write=function(t){var e=Math.pow(2,32)-1;this.version=this.baseMediaDecodeTime>e?1:0,this.flags=0,this.size=4,this.version===1&&(this.size+=4),this.writeHeader(t),this.version===1?t.writeUint64(this.baseMediaDecodeTime):t.writeUint32(this.baseMediaDecodeTime)},s.tfhdBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&s.TFHD_FLAG_BASE_DATA_OFFSET&&(this.size+=8),this.flags&s.TFHD_FLAG_SAMPLE_DESC&&(this.size+=4),this.flags&s.TFHD_FLAG_SAMPLE_DUR&&(this.size+=4),this.flags&s.TFHD_FLAG_SAMPLE_SIZE&&(this.size+=4),this.flags&s.TFHD_FLAG_SAMPLE_FLAGS&&(this.size+=4),this.writeHeader(t),t.writeUint32(this.track_id),this.flags&s.TFHD_FLAG_BASE_DATA_OFFSET&&t.writeUint64(this.base_data_offset),this.flags&s.TFHD_FLAG_SAMPLE_DESC&&t.writeUint32(this.default_sample_description_index),this.flags&s.TFHD_FLAG_SAMPLE_DUR&&t.writeUint32(this.default_sample_duration),this.flags&s.TFHD_FLAG_SAMPLE_SIZE&&t.writeUint32(this.default_sample_size),this.flags&s.TFHD_FLAG_SAMPLE_FLAGS&&t.writeUint32(this.default_sample_flags)},s.tkhdBox.prototype.write=function(t){this.version=0,this.size=4*18+2*4,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.track_id),t.writeUint32(0),t.writeUint32(this.duration),t.writeUint32(0),t.writeUint32(0),t.writeInt16(this.layer),t.writeInt16(this.alternate_group),t.writeInt16(this.volume<<8),t.writeUint16(0),t.writeInt32Array(this.matrix),t.writeUint32(this.width),t.writeUint32(this.height)},s.trexBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(t),t.writeUint32(this.track_id),t.writeUint32(this.default_sample_description_index),t.writeUint32(this.default_sample_duration),t.writeUint32(this.default_sample_size),t.writeUint32(this.default_sample_flags)},s.trunBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&s.TRUN_FLAGS_DATA_OFFSET&&(this.size+=4),this.flags&s.TRUN_FLAGS_FIRST_FLAG&&(this.size+=4),this.flags&s.TRUN_FLAGS_DURATION&&(this.size+=4*this.sample_duration.length),this.flags&s.TRUN_FLAGS_SIZE&&(this.size+=4*this.sample_size.length),this.flags&s.TRUN_FLAGS_FLAGS&&(this.size+=4*this.sample_flags.length),this.flags&s.TRUN_FLAGS_CTS_OFFSET&&(this.size+=4*this.sample_composition_time_offset.length),this.writeHeader(t),t.writeUint32(this.sample_count),this.flags&s.TRUN_FLAGS_DATA_OFFSET&&(this.data_offset_position=t.getPosition(),t.writeInt32(this.data_offset)),this.flags&s.TRUN_FLAGS_FIRST_FLAG&&t.writeUint32(this.first_sample_flags);for(var e=0;e<this.sample_count;e++)this.flags&s.TRUN_FLAGS_DURATION&&t.writeUint32(this.sample_duration[e]),this.flags&s.TRUN_FLAGS_SIZE&&t.writeUint32(this.sample_size[e]),this.flags&s.TRUN_FLAGS_FLAGS&&t.writeUint32(this.sample_flags[e]),this.flags&s.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?t.writeUint32(this.sample_composition_time_offset[e]):t.writeInt32(this.sample_composition_time_offset[e]))},s["url Box"].prototype.write=function(t){this.version=0,this.location?(this.flags=0,this.size=this.location.length+1):(this.flags=1,this.size=0),this.writeHeader(t),this.location&&t.writeCString(this.location)},s["urn Box"].prototype.write=function(t){this.version=0,this.flags=0,this.size=this.name.length+1+(this.location?this.location.length+1:0),this.writeHeader(t),t.writeCString(this.name),this.location&&t.writeCString(this.location)},s.vmhdBox.prototype.write=function(t){this.version=0,this.flags=1,this.size=8,this.writeHeader(t),t.writeUint16(this.graphicsmode),t.writeUint16Array(this.opcolor)},s.cttsBox.prototype.unpack=function(t){var e,r,o;for(o=0,e=0;e<this.sample_counts.length;e++)for(r=0;r<this.sample_counts[e];r++)t[o].pts=t[o].dts+this.sample_offsets[e],o++},s.sttsBox.prototype.unpack=function(t){var e,r,o;for(o=0,e=0;e<this.sample_counts.length;e++)for(r=0;r<this.sample_counts[e];r++)o===0?t[o].dts=0:t[o].dts=t[o-1].dts+this.sample_deltas[e],o++},s.stcoBox.prototype.unpack=function(t){var e;for(e=0;e<this.chunk_offsets.length;e++)t[e].offset=this.chunk_offsets[e]},s.stscBox.prototype.unpack=function(t){var e,r,o,l,d;for(l=0,d=0,e=0;e<this.first_chunk.length;e++)for(r=0;r<(e+1<this.first_chunk.length?this.first_chunk[e+1]:1/0);r++)for(d++,o=0;o<this.samples_per_chunk[e];o++){if(t[l])t[l].description_index=this.sample_description_index[e],t[l].chunk_index=d;else return;l++}},s.stszBox.prototype.unpack=function(t){var e;for(e=0;e<this.sample_sizes.length;e++)t[e].size=this.sample_sizes[e]},s.DIFF_BOXES_PROP_NAMES=["boxes","entries","references","subsamples","items","item_infos","extents","associations","subsegments","ranges","seekLists","seekPoints","esd","levels"],s.DIFF_PRIMITIVE_ARRAY_PROP_NAMES=["compatible_brands","matrix","opcolor","sample_counts","sample_deltas","first_chunk","samples_per_chunk","sample_sizes","chunk_offsets","sample_offsets","sample_description_index","sample_duration"],s.boxEqualFields=function(t,e){if(t&&!e)return!1;var r;for(r in t)if(!(s.DIFF_BOXES_PROP_NAMES.indexOf(r)>-1)){if(t[r]instanceof s.Box||e[r]instanceof s.Box)continue;if(typeof t[r]>"u"||typeof e[r]>"u")continue;if(typeof t[r]=="function"||typeof e[r]=="function")continue;if(t.subBoxNames&&t.subBoxNames.indexOf(r.slice(0,4))>-1||e.subBoxNames&&e.subBoxNames.indexOf(r.slice(0,4))>-1)continue;if(r==="data"||r==="start"||r==="size"||r==="creation_time"||r==="modification_time")continue;if(s.DIFF_PRIMITIVE_ARRAY_PROP_NAMES.indexOf(r)>-1)continue;if(t[r]!==e[r])return!1}return!0},s.boxEqual=function(t,e){if(!s.boxEqualFields(t,e))return!1;for(var r=0;r<s.DIFF_BOXES_PROP_NAMES.length;r++){var o=s.DIFF_BOXES_PROP_NAMES[r];if(t[o]&&e[o]&&!s.boxEqual(t[o],e[o]))return!1}return!0};var B=function(){};B.prototype.parseSample=function(t){var e,r,o=new h(t.buffer);for(e=[];!o.isEos();)r=s.parseOneBox(o,!1),r.code===s.OK&&r.box.type==="vttc"&&e.push(r.box);return e},B.prototype.getText=function(t,e,r){function o(w,b,U){return U=U||"0",w=w+"",w.length>=b?w:new Array(b-w.length+1).join(U)+w}function l(w){var b=Math.floor(w/3600),U=Math.floor((w-b*3600)/60),I=Math.floor(w-b*3600-U*60),A=Math.floor((w-b*3600-U*60-I)*1e3);return""+o(b,2)+":"+o(U,2)+":"+o(I,2)+"."+o(A,3)}for(var d=this.parseSample(r),p="",_=0;_<d.length;_++){var m=d[_];p+=l(t)+" --> "+l(e)+`\r
`,p+=m.payl.text}return p};var C=function(){};C.prototype.parseSample=function(t){var e={},r;e.resources=[];var o=new h(t.data.buffer);if(!t.subsamples||t.subsamples.length===0)e.documentString=o.readString(t.data.length);else if(e.documentString=o.readString(t.subsamples[0].size),t.subsamples.length>1)for(r=1;r<t.subsamples.length;r++)e.resources[r]=o.readUint8Array(t.subsamples[r].size);return typeof DOMParser<"u"&&(e.document=new DOMParser().parseFromString(e.documentString,"application/xml")),e};var T=function(){};T.prototype.parseSample=function(t){var e,r=new h(t.data.buffer);return e=r.readString(t.data.length),e},T.prototype.parseConfig=function(t){var e,r=new h(t.buffer);return r.readUint32(),e=r.readCString(),e},n.VTTin4Parser=B,n.XMLSubtitlein4Parser=C,n.Textin4Parser=T;var y=function(t){this.stream=t||new c,this.boxes=[],this.mdats=[],this.moofs=[],this.isProgressive=!1,this.moovStartFound=!1,this.onMoovStart=null,this.moovStartSent=!1,this.onReady=null,this.readySent=!1,this.onSegment=null,this.onSamples=null,this.onError=null,this.sampleListBuilt=!1,this.fragmentedTracks=[],this.extractedTracks=[],this.isFragmentationInitialized=!1,this.sampleProcessingStarted=!1,this.nextMoofNumber=0,this.itemListBuilt=!1,this.items=[],this.entity_groups=[],this.onSidx=null,this.sidxSent=!1};y.prototype.setSegmentOptions=function(t,e,r){var o=this.getTrackById(t);if(o){var l={};this.fragmentedTracks.push(l),l.id=t,l.user=e,l.trak=o,o.nextSample=0,l.segmentStream=null,l.nb_samples=1e3,l.rapAlignement=!0,r&&(r.nbSamples&&(l.nb_samples=r.nbSamples),r.rapAlignement&&(l.rapAlignement=r.rapAlignement))}},y.prototype.unsetSegmentOptions=function(t){for(var e=-1,r=0;r<this.fragmentedTracks.length;r++){var o=this.fragmentedTracks[r];o.id==t&&(e=r)}e>-1&&this.fragmentedTracks.splice(e,1)},y.prototype.setExtractionOptions=function(t,e,r){var o=this.getTrackById(t);if(o){var l={};this.extractedTracks.push(l),l.id=t,l.user=e,l.trak=o,o.nextSample=0,l.nb_samples=1e3,l.samples=[],r&&r.nbSamples&&(l.nb_samples=r.nbSamples)}},y.prototype.unsetExtractionOptions=function(t){for(var e=-1,r=0;r<this.extractedTracks.length;r++){var o=this.extractedTracks[r];o.id==t&&(e=r)}e>-1&&this.extractedTracks.splice(e,1)},y.prototype.parse=function(){var t,e,r=!1;if(!(this.restoreParsePosition&&!this.restoreParsePosition()))for(;;)if(this.hasIncompleteMdat&&this.hasIncompleteMdat()){if(this.processIncompleteMdat())continue;return}else if(this.saveParsePosition&&this.saveParsePosition(),t=s.parseOneBox(this.stream,r),t.code===s.ERR_NOT_ENOUGH_DATA)if(this.processIncompleteBox){if(this.processIncompleteBox(t))continue;return}else return;else{var o;switch(e=t.box,o=e.type!=="uuid"?e.type:e.uuid,this.boxes.push(e),o){case"mdat":this.mdats.push(e);break;case"moof":this.moofs.push(e);break;case"moov":this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0);default:this[o]!==void 0&&a.warn("ISOFile","Duplicate Box of type: "+o+", overriding previous occurrence"),this[o]=e;break}this.updateUsedBytes&&this.updateUsedBytes(e,t)}},y.prototype.checkBuffer=function(t){if(t==null)throw"Buffer must be defined and non empty";if(t.fileStart===void 0)throw"Buffer must have a fileStart property";return t.byteLength===0?(a.warn("ISOFile","Ignoring empty buffer (fileStart: "+t.fileStart+")"),this.stream.logBufferLevel(),!1):(a.info("ISOFile","Processing buffer (fileStart: "+t.fileStart+")"),t.usedBytes=0,this.stream.insertBuffer(t),this.stream.logBufferLevel(),this.stream.initialized()?!0:(a.warn("ISOFile","Not ready to start parsing"),!1))},y.prototype.appendBuffer=function(t,e){var r;if(this.checkBuffer(t))return this.parse(),this.moovStartFound&&!this.moovStartSent&&(this.moovStartSent=!0,this.onMoovStart&&this.onMoovStart()),this.moov?(this.sampleListBuilt||(this.buildSampleLists(),this.sampleListBuilt=!0),this.updateSampleLists(),this.onReady&&!this.readySent&&(this.readySent=!0,this.onReady(this.getInfo())),this.processSamples(e),this.nextSeekPosition?(r=this.nextSeekPosition,this.nextSeekPosition=void 0):r=this.nextParsePosition,this.stream.getEndFilePositionAfter&&(r=this.stream.getEndFilePositionAfter(r))):this.nextParsePosition?r=this.nextParsePosition:r=0,this.sidx&&this.onSidx&&!this.sidxSent&&(this.onSidx(this.sidx),this.sidxSent=!0),this.meta&&(this.flattenItemInfo&&!this.itemListBuilt&&(this.flattenItemInfo(),this.itemListBuilt=!0),this.processItems&&this.processItems(this.onItem)),this.stream.cleanBuffers&&(a.info("ISOFile","Done processing buffer (fileStart: "+t.fileStart+") - next buffer to fetch should have a fileStart position of "+r),this.stream.logBufferLevel(),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0),a.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize())),r},y.prototype.getInfo=function(){var t,e,r={},o,l,d,p,_=new Date("1904-01-01T00:00:00Z").getTime();if(this.moov)for(r.hasMoov=!0,r.duration=this.moov.mvhd.duration,r.timescale=this.moov.mvhd.timescale,r.isFragmented=this.moov.mvex!=null,r.isFragmented&&this.moov.mvex.mehd&&(r.fragment_duration=this.moov.mvex.mehd.fragment_duration),r.isProgressive=this.isProgressive,r.hasIOD=this.moov.iods!=null,r.brands=[],r.brands.push(this.ftyp.major_brand),r.brands=r.brands.concat(this.ftyp.compatible_brands),r.created=new Date(_+this.moov.mvhd.creation_time*1e3),r.modified=new Date(_+this.moov.mvhd.modification_time*1e3),r.tracks=[],r.audioTracks=[],r.videoTracks=[],r.subtitleTracks=[],r.metadataTracks=[],r.hintTracks=[],r.otherTracks=[],t=0;t<this.moov.traks.length;t++){if(o=this.moov.traks[t],p=o.mdia.minf.stbl.stsd.entries[0],l={},r.tracks.push(l),l.id=o.tkhd.track_id,l.name=o.mdia.hdlr.name,l.references=[],o.tref)for(e=0;e<o.tref.boxes.length;e++)d={},l.references.push(d),d.type=o.tref.boxes[e].type,d.track_ids=o.tref.boxes[e].track_ids;o.edts&&(l.edits=o.edts.elst.entries),l.created=new Date(_+o.tkhd.creation_time*1e3),l.modified=new Date(_+o.tkhd.modification_time*1e3),l.movie_duration=o.tkhd.duration,l.movie_timescale=r.timescale,l.layer=o.tkhd.layer,l.alternate_group=o.tkhd.alternate_group,l.volume=o.tkhd.volume,l.matrix=o.tkhd.matrix,l.track_width=o.tkhd.width/65536,l.track_height=o.tkhd.height/65536,l.timescale=o.mdia.mdhd.timescale,l.cts_shift=o.mdia.minf.stbl.cslg,l.duration=o.mdia.mdhd.duration,l.samples_duration=o.samples_duration,l.codec=p.getCodec(),l.kind=o.udta&&o.udta.kinds.length?o.udta.kinds[0]:{schemeURI:"",value:""},l.language=o.mdia.elng?o.mdia.elng.extended_language:o.mdia.mdhd.languageString,l.nb_samples=o.samples.length,l.size=o.samples_size,l.bitrate=l.size*8*l.timescale/l.samples_duration,p.isAudio()?(l.type="audio",r.audioTracks.push(l),l.audio={},l.audio.sample_rate=p.getSampleRate(),l.audio.channel_count=p.getChannelCount(),l.audio.sample_size=p.getSampleSize()):p.isVideo()?(l.type="video",r.videoTracks.push(l),l.video={},l.video.width=p.getWidth(),l.video.height=p.getHeight()):p.isSubtitle()?(l.type="subtitles",r.subtitleTracks.push(l)):p.isHint()?(l.type="metadata",r.hintTracks.push(l)):p.isMetadata()?(l.type="metadata",r.metadataTracks.push(l)):(l.type="metadata",r.otherTracks.push(l))}else r.hasMoov=!1;if(r.mime="",r.hasMoov&&r.tracks){for(r.videoTracks&&r.videoTracks.length>0?r.mime+='video/mp4; codecs="':r.audioTracks&&r.audioTracks.length>0?r.mime+='audio/mp4; codecs="':r.mime+='application/mp4; codecs="',t=0;t<r.tracks.length;t++)t!==0&&(r.mime+=","),r.mime+=r.tracks[t].codec;r.mime+='"; profiles="',r.mime+=this.ftyp.compatible_brands.join(),r.mime+='"'}return r},y.prototype.setNextSeekPositionFromSample=function(t){t&&(this.nextSeekPosition?this.nextSeekPosition=Math.min(t.offset+t.alreadyRead,this.nextSeekPosition):this.nextSeekPosition=t.offset+t.alreadyRead)},y.prototype.processSamples=function(t){var e,r;if(this.sampleProcessingStarted){if(this.isFragmentationInitialized&&this.onSegment!==null)for(e=0;e<this.fragmentedTracks.length;e++){var o=this.fragmentedTracks[e];for(r=o.trak;r.nextSample<r.samples.length&&this.sampleProcessingStarted;){a.debug("ISOFile","Creating media fragment on track #"+o.id+" for sample "+r.nextSample);var l=this.createFragment(o.id,r.nextSample,o.segmentStream);if(l)o.segmentStream=l,r.nextSample++;else break;if((r.nextSample%o.nb_samples===0||t||r.nextSample>=r.samples.length)&&(a.info("ISOFile","Sending fragmented data on track #"+o.id+" for samples ["+Math.max(0,r.nextSample-o.nb_samples)+","+(r.nextSample-1)+"]"),a.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize()),this.onSegment&&this.onSegment(o.id,o.user,o.segmentStream.buffer,r.nextSample,t||r.nextSample>=r.samples.length),o.segmentStream=null,o!==this.fragmentedTracks[e]))break}}if(this.onSamples!==null)for(e=0;e<this.extractedTracks.length;e++){var d=this.extractedTracks[e];for(r=d.trak;r.nextSample<r.samples.length&&this.sampleProcessingStarted;){a.debug("ISOFile","Exporting on track #"+d.id+" sample #"+r.nextSample);var p=this.getSample(r,r.nextSample);if(p)r.nextSample++,d.samples.push(p);else{this.setNextSeekPositionFromSample(r.samples[r.nextSample]);break}if((r.nextSample%d.nb_samples===0||r.nextSample>=r.samples.length)&&(a.debug("ISOFile","Sending samples on track #"+d.id+" for sample "+r.nextSample),this.onSamples&&this.onSamples(d.id,d.user,d.samples),d.samples=[],d!==this.extractedTracks[e]))break}}}},y.prototype.getBox=function(t){var e=this.getBoxes(t,!0);return e.length?e[0]:null},y.prototype.getBoxes=function(t,e){var r=[];return y._sweep.call(this,t,r,e),r},y._sweep=function(t,e,r){this.type&&this.type==t&&e.push(this);for(var o in this.boxes){if(e.length&&r)return;y._sweep.call(this.boxes[o],t,e,r)}},y.prototype.getTrackSamplesInfo=function(t){var e=this.getTrackById(t);if(e)return e.samples},y.prototype.getTrackSample=function(t,e){var r=this.getTrackById(t),o=this.getSample(r,e);return o},y.prototype.releaseUsedSamples=function(t,e){var r=0,o=this.getTrackById(t);o.lastValidSample||(o.lastValidSample=0);for(var l=o.lastValidSample;l<e;l++)r+=this.releaseSample(o,l);a.info("ISOFile","Track #"+t+" released samples up to "+e+" (released size: "+r+", remaining: "+this.samplesDataSize+")"),o.lastValidSample=e},y.prototype.start=function(){this.sampleProcessingStarted=!0,this.processSamples(!1)},y.prototype.stop=function(){this.sampleProcessingStarted=!1},y.prototype.flush=function(){a.info("ISOFile","Flushing remaining samples"),this.updateSampleLists(),this.processSamples(!0),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0)},y.prototype.seekTrack=function(t,e,r){var o,l,d=1/0,p=0,_=0,m;if(r.samples.length===0)return a.info("ISOFile","No sample in track, cannot seek! Using time "+a.getDurationString(0,1)+" and offset: 0"),{offset:0,time:0};for(o=0;o<r.samples.length;o++){if(l=r.samples[o],o===0)_=0,m=l.timescale;else if(l.cts>t*l.timescale){_=o-1;break}e&&l.is_sync&&(p=o)}for(e&&(_=p),t=r.samples[_].cts,r.nextSample=_;r.samples[_].alreadyRead===r.samples[_].size&&r.samples[_+1];)_++;return d=r.samples[_].offset+r.samples[_].alreadyRead,a.info("ISOFile","Seeking to "+(e?"RAP":"")+" sample #"+r.nextSample+" on track "+r.tkhd.track_id+", time "+a.getDurationString(t,m)+" and offset: "+d),{offset:d,time:t/m}},y.prototype.getTrackDuration=function(t){var e;return t.samples?(e=t.samples[t.samples.length-1],(e.cts+e.duration)/e.timescale):1/0},y.prototype.seek=function(t,e){var r=this.moov,o,l,d,p={offset:1/0,time:1/0};if(this.moov){for(d=0;d<r.traks.length;d++)o=r.traks[d],!(t>this.getTrackDuration(o))&&(l=this.seekTrack(t,e,o),l.offset<p.offset&&(p.offset=l.offset),l.time<p.time&&(p.time=l.time));return a.info("ISOFile","Seeking at time "+a.getDurationString(p.time,1)+" needs a buffer with a fileStart position of "+p.offset),p.offset===1/0?p={offset:this.nextParsePosition,time:0}:p.offset=this.stream.getEndFilePositionAfter(p.offset),a.info("ISOFile","Adjusted seek position (after checking data already in buffer): "+p.offset),p}else throw"Cannot seek: moov not received!"},y.prototype.equal=function(t){for(var e=0;e<this.boxes.length&&e<t.boxes.length;){var r=this.boxes[e],o=t.boxes[e];if(!s.boxEqual(r,o))return!1;e++}return!0},n.ISOFile=y,y.prototype.lastBoxStartPosition=0,y.prototype.parsingMdat=null,y.prototype.nextParsePosition=0,y.prototype.discardMdatData=!1,y.prototype.processIncompleteBox=function(t){var e,r,o;return t.type==="mdat"?(e=new s[t.type+"Box"](t.size),this.parsingMdat=e,this.boxes.push(e),this.mdats.push(e),e.start=t.start,e.hdr_size=t.hdr_size,this.stream.addUsedBytes(e.hdr_size),this.lastBoxStartPosition=e.start+e.size,o=this.stream.seek(e.start+e.size,!1,this.discardMdatData),o?(this.parsingMdat=null,!0):(this.moovStartFound?this.nextParsePosition=this.stream.findEndContiguousBuf():this.nextParsePosition=e.start+e.size,!1)):(t.type==="moov"&&(this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0)),r=this.stream.mergeNextBuffer?this.stream.mergeNextBuffer():!1,r?(this.nextParsePosition=this.stream.getEndPosition(),!0):(t.type?this.moovStartFound?this.nextParsePosition=this.stream.getEndPosition():this.nextParsePosition=this.stream.getPosition()+t.size:this.nextParsePosition=this.stream.getEndPosition(),!1))},y.prototype.hasIncompleteMdat=function(){return this.parsingMdat!==null},y.prototype.processIncompleteMdat=function(){var t,e;return t=this.parsingMdat,e=this.stream.seek(t.start+t.size,!1,this.discardMdatData),e?(a.debug("ISOFile","Found 'mdat' end in buffered data"),this.parsingMdat=null,!0):(this.nextParsePosition=this.stream.findEndContiguousBuf(),!1)},y.prototype.restoreParsePosition=function(){return this.stream.seek(this.lastBoxStartPosition,!0,this.discardMdatData)},y.prototype.saveParsePosition=function(){this.lastBoxStartPosition=this.stream.getPosition()},y.prototype.updateUsedBytes=function(t,e){this.stream.addUsedBytes&&(t.type==="mdat"?(this.stream.addUsedBytes(t.hdr_size),this.discardMdatData&&this.stream.addUsedBytes(t.size-t.hdr_size)):this.stream.addUsedBytes(t.size))},y.prototype.add=s.Box.prototype.add,y.prototype.addBox=s.Box.prototype.addBox,y.prototype.init=function(t){var e=t||{};this.add("ftyp").set("major_brand",e.brands&&e.brands[0]||"iso4").set("minor_version",0).set("compatible_brands",e.brands||["iso4"]);var r=this.add("moov");return r.add("mvhd").set("timescale",e.timescale||600).set("rate",e.rate||65536).set("creation_time",0).set("modification_time",0).set("duration",e.duration||0).set("volume",e.width?0:256).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("next_track_id",1),r.add("mvex"),this},y.prototype.addTrack=function(t){this.moov||this.init(t);var e=t||{};e.width=e.width||320,e.height=e.height||320,e.id=e.id||this.moov.mvhd.next_track_id,e.type=e.type||"avc1";var r=this.moov.add("trak");this.moov.mvhd.next_track_id=e.id+1,r.add("tkhd").set("flags",s.TKHD_FLAG_ENABLED|s.TKHD_FLAG_IN_MOVIE|s.TKHD_FLAG_IN_PREVIEW).set("creation_time",0).set("modification_time",0).set("track_id",e.id).set("duration",e.duration||0).set("layer",e.layer||0).set("alternate_group",0).set("volume",1).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("width",e.width<<16).set("height",e.height<<16);var o=r.add("mdia");o.add("mdhd").set("creation_time",0).set("modification_time",0).set("timescale",e.timescale||1).set("duration",e.media_duration||0).set("language",e.language||"und"),o.add("hdlr").set("handler",e.hdlr||"vide").set("name",e.name||"Track created with MP4Box.js"),o.add("elng").set("extended_language",e.language||"fr-FR");var l=o.add("minf");if(s[e.type+"SampleEntry"]!==void 0){var d=new s[e.type+"SampleEntry"];d.data_reference_index=1;var p="";for(var _ in s.sampleEntryCodes)for(var m=s.sampleEntryCodes[_],w=0;w<m.length;w++)if(m.indexOf(e.type)>-1){p=_;break}switch(p){case"Visual":if(l.add("vmhd").set("graphicsmode",0).set("opcolor",[0,0,0]),d.set("width",e.width).set("height",e.height).set("horizresolution",72<<16).set("vertresolution",72<<16).set("frame_count",1).set("compressorname",e.type+" Compressor").set("depth",24),e.avcDecoderConfigRecord){var b=new s.avcCBox;b.parse(new h(e.avcDecoderConfigRecord)),d.addBox(b)}else if(e.hevcDecoderConfigRecord){var U=new s.hvcCBox;U.parse(new h(e.hevcDecoderConfigRecord)),d.addBox(U)}break;case"Audio":l.add("smhd").set("balance",e.balance||0),d.set("channel_count",e.channel_count||2).set("samplesize",e.samplesize||16).set("samplerate",e.samplerate||65536);break;case"Hint":l.add("hmhd");break;case"Subtitle":switch(l.add("sthd"),e.type){case"stpp":d.set("namespace",e.namespace||"nonamespace").set("schema_location",e.schema_location||"").set("auxiliary_mime_types",e.auxiliary_mime_types||"");break}break;case"Metadata":l.add("nmhd");break;case"System":l.add("nmhd");break;default:l.add("nmhd");break}e.description&&d.addBox(e.description),e.description_boxes&&e.description_boxes.forEach(function(A){d.addBox(A)}),l.add("dinf").add("dref").addEntry(new s["url Box"]().set("flags",1));var I=l.add("stbl");return I.add("stsd").addEntry(d),I.add("stts").set("sample_counts",[]).set("sample_deltas",[]),I.add("stsc").set("first_chunk",[]).set("samples_per_chunk",[]).set("sample_description_index",[]),I.add("stco").set("chunk_offsets",[]),I.add("stsz").set("sample_sizes",[]),this.moov.mvex.add("trex").set("track_id",e.id).set("default_sample_description_index",e.default_sample_description_index||1).set("default_sample_duration",e.default_sample_duration||0).set("default_sample_size",e.default_sample_size||0).set("default_sample_flags",e.default_sample_flags||0),this.buildTrakSampleLists(r),e.id}},s.Box.prototype.computeSize=function(t){var e=t||new f;e.endianness=f.BIG_ENDIAN,this.write(e)},y.prototype.addSample=function(t,e,r){var o=r||{},l={},d=this.getTrackById(t);if(d!==null){l.number=d.samples.length,l.track_id=d.tkhd.track_id,l.timescale=d.mdia.mdhd.timescale,l.description_index=o.sample_description_index?o.sample_description_index-1:0,l.description=d.mdia.minf.stbl.stsd.entries[l.description_index],l.data=e,l.size=e.byteLength,l.alreadyRead=l.size,l.duration=o.duration||1,l.cts=o.cts||0,l.dts=o.dts||0,l.is_sync=o.is_sync||!1,l.is_leading=o.is_leading||0,l.depends_on=o.depends_on||0,l.is_depended_on=o.is_depended_on||0,l.has_redundancy=o.has_redundancy||0,l.degradation_priority=o.degradation_priority||0,l.offset=0,l.subsamples=o.subsamples,d.samples.push(l),d.samples_size+=l.size,d.samples_duration+=l.duration,d.first_dts===void 0&&(d.first_dts=o.dts),this.processSamples();var p=this.createSingleSampleMoof(l);return this.addBox(p),p.computeSize(),p.trafs[0].truns[0].data_offset=p.size+8,this.add("mdat").data=new Uint8Array(e),l}},y.prototype.createSingleSampleMoof=function(t){var e=0;t.is_sync?e=1<<25:e=65536;var r=new s.moofBox;r.add("mfhd").set("sequence_number",this.nextMoofNumber),this.nextMoofNumber++;var o=r.add("traf"),l=this.getTrackById(t.track_id);return o.add("tfhd").set("track_id",t.track_id).set("flags",s.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),o.add("tfdt").set("baseMediaDecodeTime",t.dts-(l.first_dts||0)),o.add("trun").set("flags",s.TRUN_FLAGS_DATA_OFFSET|s.TRUN_FLAGS_DURATION|s.TRUN_FLAGS_SIZE|s.TRUN_FLAGS_FLAGS|s.TRUN_FLAGS_CTS_OFFSET).set("data_offset",0).set("first_sample_flags",0).set("sample_count",1).set("sample_duration",[t.duration]).set("sample_size",[t.size]).set("sample_flags",[e]).set("sample_composition_time_offset",[t.cts-t.dts]),r},y.prototype.lastMoofIndex=0,y.prototype.samplesDataSize=0,y.prototype.resetTables=function(){var t,e,r,o,l,d,p,_;for(this.initial_duration=this.moov.mvhd.duration,this.moov.mvhd.duration=0,t=0;t<this.moov.traks.length;t++){e=this.moov.traks[t],e.tkhd.duration=0,e.mdia.mdhd.duration=0,r=e.mdia.minf.stbl.stco||e.mdia.minf.stbl.co64,r.chunk_offsets=[],o=e.mdia.minf.stbl.stsc,o.first_chunk=[],o.samples_per_chunk=[],o.sample_description_index=[],l=e.mdia.minf.stbl.stsz||e.mdia.minf.stbl.stz2,l.sample_sizes=[],d=e.mdia.minf.stbl.stts,d.sample_counts=[],d.sample_deltas=[],p=e.mdia.minf.stbl.ctts,p&&(p.sample_counts=[],p.sample_offsets=[]),_=e.mdia.minf.stbl.stss;var m=e.mdia.minf.stbl.boxes.indexOf(_);m!=-1&&(e.mdia.minf.stbl.boxes[m]=null)}},y.initSampleGroups=function(t,e,r,o,l){var d,p,_,m;function w(b,U,I){this.grouping_type=b,this.grouping_type_parameter=U,this.sbgp=I,this.last_sample_in_run=-1,this.entry_index=-1}for(e&&(e.sample_groups_info=[]),t.sample_groups_info||(t.sample_groups_info=[]),p=0;p<r.length;p++){for(m=r[p].grouping_type+"/"+r[p].grouping_type_parameter,_=new w(r[p].grouping_type,r[p].grouping_type_parameter,r[p]),e&&(e.sample_groups_info[m]=_),t.sample_groups_info[m]||(t.sample_groups_info[m]=_),d=0;d<o.length;d++)o[d].grouping_type===r[p].grouping_type&&(_.description=o[d],_.description.used=!0);if(l)for(d=0;d<l.length;d++)l[d].grouping_type===r[p].grouping_type&&(_.fragment_description=l[d],_.fragment_description.used=!0,_.is_fragment=!0)}if(e){if(l)for(p=0;p<l.length;p++)!l[p].used&&l[p].version>=2&&(m=l[p].grouping_type+"/0",_=new w(l[p].grouping_type,0),_.is_fragment=!0,e.sample_groups_info[m]||(e.sample_groups_info[m]=_))}else for(p=0;p<o.length;p++)!o[p].used&&o[p].version>=2&&(m=o[p].grouping_type+"/0",_=new w(o[p].grouping_type,0),t.sample_groups_info[m]||(t.sample_groups_info[m]=_))},y.setSampleGroupProperties=function(t,e,r,o){var l,d;e.sample_groups=[];for(l in o)if(e.sample_groups[l]={},e.sample_groups[l].grouping_type=o[l].grouping_type,e.sample_groups[l].grouping_type_parameter=o[l].grouping_type_parameter,r>=o[l].last_sample_in_run&&(o[l].last_sample_in_run<0&&(o[l].last_sample_in_run=0),o[l].entry_index++,o[l].entry_index<=o[l].sbgp.entries.length-1&&(o[l].last_sample_in_run+=o[l].sbgp.entries[o[l].entry_index].sample_count)),o[l].entry_index<=o[l].sbgp.entries.length-1?e.sample_groups[l].group_description_index=o[l].sbgp.entries[o[l].entry_index].group_description_index:e.sample_groups[l].group_description_index=-1,e.sample_groups[l].group_description_index!==0){var p;o[l].fragment_description?p=o[l].fragment_description:p=o[l].description,e.sample_groups[l].group_description_index>0?(e.sample_groups[l].group_description_index>65535?d=(e.sample_groups[l].group_description_index>>16)-1:d=e.sample_groups[l].group_description_index-1,p&&d>=0&&(e.sample_groups[l].description=p.entries[d])):p&&p.version>=2&&p.default_group_description_index>0&&(e.sample_groups[l].description=p.entries[p.default_group_description_index-1])}},y.process_sdtp=function(t,e,r){e&&(t?(e.is_leading=t.is_leading[r],e.depends_on=t.sample_depends_on[r],e.is_depended_on=t.sample_is_depended_on[r],e.has_redundancy=t.sample_has_redundancy[r]):(e.is_leading=0,e.depends_on=0,e.is_depended_on=0,e.has_redundancy=0))},y.prototype.buildSampleLists=function(){var t,e;for(t=0;t<this.moov.traks.length;t++)e=this.moov.traks[t],this.buildTrakSampleLists(e)},y.prototype.buildTrakSampleLists=function(t){var e,r,o,l,d,p,_,m,w,b,U,I,A,q,H,K,ht,st,j,ft,de,ue,wt,Kt;if(t.samples=[],t.samples_duration=0,t.samples_size=0,r=t.mdia.minf.stbl.stco||t.mdia.minf.stbl.co64,o=t.mdia.minf.stbl.stsc,l=t.mdia.minf.stbl.stsz||t.mdia.minf.stbl.stz2,d=t.mdia.minf.stbl.stts,p=t.mdia.minf.stbl.ctts,_=t.mdia.minf.stbl.stss,m=t.mdia.minf.stbl.stsd,w=t.mdia.minf.stbl.subs,I=t.mdia.minf.stbl.stdp,b=t.mdia.minf.stbl.sbgps,U=t.mdia.minf.stbl.sgpds,st=-1,j=-1,ft=-1,de=-1,ue=0,wt=0,Kt=0,y.initSampleGroups(t,null,b,U),!(typeof l>"u")){for(e=0;e<l.sample_sizes.length;e++){var P={};P.number=e,P.track_id=t.tkhd.track_id,P.timescale=t.mdia.mdhd.timescale,P.alreadyRead=0,t.samples[e]=P,P.size=l.sample_sizes[e],t.samples_size+=P.size,e===0?(q=1,A=0,P.chunk_index=q,P.chunk_run_index=A,ht=o.samples_per_chunk[A],K=0,A+1<o.first_chunk.length?H=o.first_chunk[A+1]-1:H=1/0):e<ht?(P.chunk_index=q,P.chunk_run_index=A):(q++,P.chunk_index=q,K=0,q<=H||(A++,A+1<o.first_chunk.length?H=o.first_chunk[A+1]-1:H=1/0),P.chunk_run_index=A,ht+=o.samples_per_chunk[A]),P.description_index=o.sample_description_index[P.chunk_run_index]-1,P.description=m.entries[P.description_index],P.offset=r.chunk_offsets[P.chunk_index-1]+K,K+=P.size,e>st&&(j++,st<0&&(st=0),st+=d.sample_counts[j]),e>0?(t.samples[e-1].duration=d.sample_deltas[j],t.samples_duration+=t.samples[e-1].duration,P.dts=t.samples[e-1].dts+t.samples[e-1].duration):P.dts=0,p?(e>=ft&&(de++,ft<0&&(ft=0),ft+=p.sample_counts[de]),P.cts=t.samples[e].dts+p.sample_offsets[de]):P.cts=P.dts,_?(e==_.sample_numbers[ue]-1?(P.is_sync=!0,ue++):(P.is_sync=!1,P.degradation_priority=0),w&&w.entries[wt].sample_delta+Kt==e+1&&(P.subsamples=w.entries[wt].subsamples,Kt+=w.entries[wt].sample_delta,wt++)):P.is_sync=!0,y.process_sdtp(t.mdia.minf.stbl.sdtp,P,P.number),I?P.degradation_priority=I.priority[e]:P.degradation_priority=0,w&&w.entries[wt].sample_delta+Kt==e&&(P.subsamples=w.entries[wt].subsamples,Kt+=w.entries[wt].sample_delta),(b.length>0||U.length>0)&&y.setSampleGroupProperties(t,P,e,t.sample_groups_info)}e>0&&(t.samples[e-1].duration=Math.max(t.mdia.mdhd.duration-t.samples[e-1].dts,0),t.samples_duration+=t.samples[e-1].duration)}},y.prototype.updateSampleLists=function(){var t,e,r,o,l,d,p,_,m,w,b,U,I,A,q;if(this.moov!==void 0){for(;this.lastMoofIndex<this.moofs.length;)if(m=this.moofs[this.lastMoofIndex],this.lastMoofIndex++,m.type=="moof")for(w=m,t=0;t<w.trafs.length;t++){for(b=w.trafs[t],U=this.getTrackById(b.tfhd.track_id),I=this.getTrexById(b.tfhd.track_id),b.tfhd.flags&s.TFHD_FLAG_SAMPLE_DESC?o=b.tfhd.default_sample_description_index:o=I?I.default_sample_description_index:1,b.tfhd.flags&s.TFHD_FLAG_SAMPLE_DUR?l=b.tfhd.default_sample_duration:l=I?I.default_sample_duration:0,b.tfhd.flags&s.TFHD_FLAG_SAMPLE_SIZE?d=b.tfhd.default_sample_size:d=I?I.default_sample_size:0,b.tfhd.flags&s.TFHD_FLAG_SAMPLE_FLAGS?p=b.tfhd.default_sample_flags:p=I?I.default_sample_flags:0,b.sample_number=0,b.sbgps.length>0&&y.initSampleGroups(U,b,b.sbgps,U.mdia.minf.stbl.sgpds,b.sgpds),e=0;e<b.truns.length;e++){var H=b.truns[e];for(r=0;r<H.sample_count;r++){A={},A.moof_number=this.lastMoofIndex,A.number_in_traf=b.sample_number,b.sample_number++,A.number=U.samples.length,b.first_sample_index=U.samples.length,U.samples.push(A),A.track_id=U.tkhd.track_id,A.timescale=U.mdia.mdhd.timescale,A.description_index=o-1,A.description=U.mdia.minf.stbl.stsd.entries[A.description_index],A.size=d,H.flags&s.TRUN_FLAGS_SIZE&&(A.size=H.sample_size[r]),U.samples_size+=A.size,A.duration=l,H.flags&s.TRUN_FLAGS_DURATION&&(A.duration=H.sample_duration[r]),U.samples_duration+=A.duration,U.first_traf_merged||r>0?A.dts=U.samples[U.samples.length-2].dts+U.samples[U.samples.length-2].duration:(b.tfdt?A.dts=b.tfdt.baseMediaDecodeTime:A.dts=0,U.first_traf_merged=!0),A.cts=A.dts,H.flags&s.TRUN_FLAGS_CTS_OFFSET&&(A.cts=A.dts+H.sample_composition_time_offset[r]),q=p,H.flags&s.TRUN_FLAGS_FLAGS?q=H.sample_flags[r]:r===0&&H.flags&s.TRUN_FLAGS_FIRST_FLAG&&(q=H.first_sample_flags),A.is_sync=!(q>>16&1),A.is_leading=q>>26&3,A.depends_on=q>>24&3,A.is_depended_on=q>>22&3,A.has_redundancy=q>>20&3,A.degradation_priority=q&65535;var K=!!(b.tfhd.flags&s.TFHD_FLAG_BASE_DATA_OFFSET),ht=!!(b.tfhd.flags&s.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),st=!!(H.flags&s.TRUN_FLAGS_DATA_OFFSET),j=0;K?j=b.tfhd.base_data_offset:ht||e===0?j=w.start:j=_,e===0&&r===0?st?A.offset=j+H.data_offset:A.offset=j:A.offset=_,_=A.offset+A.size,(b.sbgps.length>0||b.sgpds.length>0||U.mdia.minf.stbl.sbgps.length>0||U.mdia.minf.stbl.sgpds.length>0)&&y.setSampleGroupProperties(U,A,A.number_in_traf,b.sample_groups_info)}}if(b.subs){U.has_fragment_subsamples=!0;var ft=b.first_sample_index;for(e=0;e<b.subs.entries.length;e++)ft+=b.subs.entries[e].sample_delta,A=U.samples[ft-1],A.subsamples=b.subs.entries[e].subsamples}}}},y.prototype.getSample=function(t,e){var r,o=t.samples[e];if(!this.moov)return null;if(!o.data)o.data=new Uint8Array(o.size),o.alreadyRead=0,this.samplesDataSize+=o.size,a.debug("ISOFile","Allocating sample #"+e+" on track #"+t.tkhd.track_id+" of size "+o.size+" (total: "+this.samplesDataSize+")");else if(o.alreadyRead==o.size)return o;for(;;){var l=this.stream.findPosition(!0,o.offset+o.alreadyRead,!1);if(l>-1){r=this.stream.buffers[l];var d=r.byteLength-(o.offset+o.alreadyRead-r.fileStart);if(o.size-o.alreadyRead<=d)return a.debug("ISOFile","Getting sample #"+e+" data (alreadyRead: "+o.alreadyRead+" offset: "+(o.offset+o.alreadyRead-r.fileStart)+" read size: "+(o.size-o.alreadyRead)+" full size: "+o.size+")"),f.memcpy(o.data.buffer,o.alreadyRead,r,o.offset+o.alreadyRead-r.fileStart,o.size-o.alreadyRead),r.usedBytes+=o.size-o.alreadyRead,this.stream.logBufferLevel(),o.alreadyRead=o.size,o;if(d===0)return null;a.debug("ISOFile","Getting sample #"+e+" partial data (alreadyRead: "+o.alreadyRead+" offset: "+(o.offset+o.alreadyRead-r.fileStart)+" read size: "+d+" full size: "+o.size+")"),f.memcpy(o.data.buffer,o.alreadyRead,r,o.offset+o.alreadyRead-r.fileStart,d),o.alreadyRead+=d,r.usedBytes+=d,this.stream.logBufferLevel()}else return null}},y.prototype.releaseSample=function(t,e){var r=t.samples[e];return r.data?(this.samplesDataSize-=r.size,r.data=null,r.alreadyRead=0,r.size):0},y.prototype.getAllocatedSampleDataSize=function(){return this.samplesDataSize},y.prototype.getCodecs=function(){var t,e="";for(t=0;t<this.moov.traks.length;t++){var r=this.moov.traks[t];t>0&&(e+=","),e+=r.mdia.minf.stbl.stsd.entries[0].getCodec()}return e},y.prototype.getTrexById=function(t){var e;if(!this.moov||!this.moov.mvex)return null;for(e=0;e<this.moov.mvex.trexs.length;e++){var r=this.moov.mvex.trexs[e];if(r.track_id==t)return r}return null},y.prototype.getTrackById=function(t){if(this.moov===void 0)return null;for(var e=0;e<this.moov.traks.length;e++){var r=this.moov.traks[e];if(r.tkhd.track_id==t)return r}return null},y.prototype.itemsDataSize=0,y.prototype.flattenItemInfo=function(){var t=this.items,e=this.entity_groups,r,o,l,d=this.meta;if(d!=null&&d.hdlr!==void 0&&d.iinf!==void 0){for(r=0;r<d.iinf.item_infos.length;r++)l={},l.id=d.iinf.item_infos[r].item_ID,t[l.id]=l,l.ref_to=[],l.name=d.iinf.item_infos[r].item_name,d.iinf.item_infos[r].protection_index>0&&(l.protection=d.ipro.protections[d.iinf.item_infos[r].protection_index-1]),d.iinf.item_infos[r].item_type?l.type=d.iinf.item_infos[r].item_type:l.type="mime",l.content_type=d.iinf.item_infos[r].content_type,l.content_encoding=d.iinf.item_infos[r].content_encoding,l.item_uri_type=d.iinf.item_infos[r].item_uri_type;if(d.grpl)for(r=0;r<d.grpl.boxes.length;r++)entity_group={},entity_group.id=d.grpl.boxes[r].group_id,entity_group.entity_ids=d.grpl.boxes[r].entity_ids,entity_group.type=d.grpl.boxes[r].type,e[entity_group.id]=entity_group;if(d.iloc)for(r=0;r<d.iloc.items.length;r++){var p=d.iloc.items[r];switch(l=t[p.item_ID],p.data_reference_index!==0&&(a.warn("Item storage with reference to other files: not supported"),l.source=d.dinf.boxes[p.data_reference_index-1]),p.construction_method){case 0:break;case 1:break;case 2:a.warn("Item storage with construction_method : not supported");break}for(l.extents=[],l.size=0,o=0;o<p.extents.length;o++)l.extents[o]={},l.extents[o].offset=p.extents[o].extent_offset+p.base_offset,p.construction_method==1&&(l.extents[o].offset+=d.idat.start+d.idat.hdr_size),l.extents[o].length=p.extents[o].extent_length,l.extents[o].alreadyRead=0,l.size+=l.extents[o].length}if(d.pitm&&(t[d.pitm.item_id].primary=!0),d.iref)for(r=0;r<d.iref.references.length;r++){var _=d.iref.references[r];for(o=0;o<_.references.length;o++)t[_.from_item_ID].ref_to.push({type:_.type,id:_.references[o]})}if(d.iprp)for(var m=0;m<d.iprp.ipmas.length;m++){var w=d.iprp.ipmas[m];for(r=0;r<w.associations.length;r++){var b=w.associations[r];if(l=t[b.id],l||(l=e[b.id]),l)for(l.properties===void 0&&(l.properties={},l.properties.boxes=[]),o=0;o<b.props.length;o++){var U=b.props[o];if(U.property_index>0&&U.property_index-1<d.iprp.ipco.boxes.length){var I=d.iprp.ipco.boxes[U.property_index-1];l.properties[I.type]=I,l.properties.boxes.push(I)}}}}}},y.prototype.getItem=function(t){var e,r;if(!this.meta)return null;if(r=this.items[t],!r.data&&r.size)r.data=new Uint8Array(r.size),r.alreadyRead=0,this.itemsDataSize+=r.size,a.debug("ISOFile","Allocating item #"+t+" of size "+r.size+" (total: "+this.itemsDataSize+")");else if(r.alreadyRead===r.size)return r;for(var o=0;o<r.extents.length;o++){var l=r.extents[o];if(l.alreadyRead!==l.length){var d=this.stream.findPosition(!0,l.offset+l.alreadyRead,!1);if(d>-1){e=this.stream.buffers[d];var p=e.byteLength-(l.offset+l.alreadyRead-e.fileStart);if(l.length-l.alreadyRead<=p)a.debug("ISOFile","Getting item #"+t+" extent #"+o+" data (alreadyRead: "+l.alreadyRead+" offset: "+(l.offset+l.alreadyRead-e.fileStart)+" read size: "+(l.length-l.alreadyRead)+" full extent size: "+l.length+" full item size: "+r.size+")"),f.memcpy(r.data.buffer,r.alreadyRead,e,l.offset+l.alreadyRead-e.fileStart,l.length-l.alreadyRead),e.usedBytes+=l.length-l.alreadyRead,this.stream.logBufferLevel(),r.alreadyRead+=l.length-l.alreadyRead,l.alreadyRead=l.length;else return a.debug("ISOFile","Getting item #"+t+" extent #"+o+" partial data (alreadyRead: "+l.alreadyRead+" offset: "+(l.offset+l.alreadyRead-e.fileStart)+" read size: "+p+" full extent size: "+l.length+" full item size: "+r.size+")"),f.memcpy(r.data.buffer,r.alreadyRead,e,l.offset+l.alreadyRead-e.fileStart,p),l.alreadyRead+=p,r.alreadyRead+=p,e.usedBytes+=p,this.stream.logBufferLevel(),null}else return null}}return r.alreadyRead===r.size?r:null},y.prototype.releaseItem=function(t){var e=this.items[t];if(e.data){this.itemsDataSize-=e.size,e.data=null,e.alreadyRead=0;for(var r=0;r<e.extents.length;r++){var o=e.extents[r];o.alreadyRead=0}return e.size}else return 0},y.prototype.processItems=function(t){for(var e in this.items){var r=this.items[e];this.getItem(r.id),t&&!r.sent&&(t(r),r.sent=!0,r.data=null)}},y.prototype.hasItem=function(t){for(var e in this.items){var r=this.items[e];if(r.name===t)return r.id}return-1},y.prototype.getMetaHandler=function(){return this.meta?this.meta.hdlr.handler:null},y.prototype.getPrimaryItem=function(){return!this.meta||!this.meta.pitm?null:this.getItem(this.meta.pitm.item_id)},y.prototype.itemToFragmentedTrackFile=function(t){var e=t||{},r=null;if(e.itemId?r=this.getItem(e.itemId):r=this.getPrimaryItem(),r==null)return null;var o=new y;o.discardMdatData=!1;var l={type:r.type,description_boxes:r.properties.boxes};r.properties.ispe&&(l.width=r.properties.ispe.image_width,l.height=r.properties.ispe.image_height);var d=o.addTrack(l);return d?(o.addSample(d,r.data),o):null},y.prototype.write=function(t){for(var e=0;e<this.boxes.length;e++)this.boxes[e].write(t)},y.prototype.createFragment=function(t,e,r){var o=this.getTrackById(t),l=this.getSample(o,e);if(l==null)return this.setNextSeekPositionFromSample(o.samples[e]),null;var d=r||new f;d.endianness=f.BIG_ENDIAN;var p=this.createSingleSampleMoof(l);p.write(d),p.trafs[0].truns[0].data_offset=p.size+8,a.debug("MP4Box","Adjusting data_offset with new value "+p.trafs[0].truns[0].data_offset),d.adjustUint32(p.trafs[0].truns[0].data_offset_position,p.trafs[0].truns[0].data_offset);var _=new s.mdatBox;return _.data=l.data,_.write(d),d},y.writeInitializationSegment=function(t,e,r,o){var l;a.debug("ISOFile","Generating initialization segment");var d=new f;d.endianness=f.BIG_ENDIAN,t.write(d);var p=e.add("mvex");for(r&&p.add("mehd").set("fragment_duration",r),l=0;l<e.traks.length;l++)p.add("trex").set("track_id",e.traks[l].tkhd.track_id).set("default_sample_description_index",1).set("default_sample_duration",o).set("default_sample_size",0).set("default_sample_flags",65536);return e.write(d),d.buffer},y.prototype.save=function(t){var e=new f;e.endianness=f.BIG_ENDIAN,this.write(e),e.save(t)},y.prototype.getBuffer=function(){var t=new f;return t.endianness=f.BIG_ENDIAN,this.write(t),t.buffer},y.prototype.initializeSegmentation=function(){var t,e,r,o;for(this.onSegment===null&&a.warn("MP4Box","No segmentation callback set!"),this.isFragmentationInitialized||(this.isFragmentationInitialized=!0,this.nextMoofNumber=0,this.resetTables()),e=[],t=0;t<this.fragmentedTracks.length;t++){var l=new s.moovBox;l.mvhd=this.moov.mvhd,l.boxes.push(l.mvhd),r=this.getTrackById(this.fragmentedTracks[t].id),l.boxes.push(r),l.traks.push(r),o={},o.id=r.tkhd.track_id,o.user=this.fragmentedTracks[t].user,o.buffer=y.writeInitializationSegment(this.ftyp,l,this.moov.mvex&&this.moov.mvex.mehd?this.moov.mvex.mehd.fragment_duration:void 0,this.moov.traks[t].samples.length>0?this.moov.traks[t].samples[0].duration:0),e.push(o)}return e},s.Box.prototype.printHeader=function(t){this.size+=8,this.size>u&&(this.size+=8),this.type==="uuid"&&(this.size+=16),t.log(t.indent+"size:"+this.size),t.log(t.indent+"type:"+this.type)},s.FullBox.prototype.printHeader=function(t){this.size+=4,s.Box.prototype.printHeader.call(this,t),t.log(t.indent+"version:"+this.version),t.log(t.indent+"flags:"+this.flags)},s.Box.prototype.print=function(t){this.printHeader(t)},s.ContainerBox.prototype.print=function(t){this.printHeader(t);for(var e=0;e<this.boxes.length;e++)if(this.boxes[e]){var r=t.indent;t.indent+=" ",this.boxes[e].print(t),t.indent=r}},y.prototype.print=function(t){t.indent="";for(var e=0;e<this.boxes.length;e++)this.boxes[e]&&this.boxes[e].print(t)},s.mvhdBox.prototype.print=function(t){s.FullBox.prototype.printHeader.call(this,t),t.log(t.indent+"creation_time: "+this.creation_time),t.log(t.indent+"modification_time: "+this.modification_time),t.log(t.indent+"timescale: "+this.timescale),t.log(t.indent+"duration: "+this.duration),t.log(t.indent+"rate: "+this.rate),t.log(t.indent+"volume: "+(this.volume>>8)),t.log(t.indent+"matrix: "+this.matrix.join(", ")),t.log(t.indent+"next_track_id: "+this.next_track_id)},s.tkhdBox.prototype.print=function(t){s.FullBox.prototype.printHeader.call(this,t),t.log(t.indent+"creation_time: "+this.creation_time),t.log(t.indent+"modification_time: "+this.modification_time),t.log(t.indent+"track_id: "+this.track_id),t.log(t.indent+"duration: "+this.duration),t.log(t.indent+"volume: "+(this.volume>>8)),t.log(t.indent+"matrix: "+this.matrix.join(", ")),t.log(t.indent+"layer: "+this.layer),t.log(t.indent+"alternate_group: "+this.alternate_group),t.log(t.indent+"width: "+this.width),t.log(t.indent+"height: "+this.height)};var M={};M.createFile=function(t,e){var r=t!==void 0?t:!0,o=new y(e);return o.discardMdatData=!r,o},n.createFile=M.createFile})(xn);const ze=Ha(xn),gr=10;async function Va(n,a,h,f,u){return new Promise((c,v)=>{const s=ze.createFile();let x=null,g=null,E=!1,B=null,C=0;s.onReady=e=>{const r=e.videoTracks?.[0];if(r){x=r.id,C=r.nb_samples??0;const l=s.getTrackById(x).mdia.minf.stbl.stsd.entries[0],d=Ya(l);a.configure({codec:r.codec,codedWidth:r.video.width,codedHeight:r.video.height,description:d}),s.setExtractionOptions(x,"video",{nbSamples:100})}const o=e.audioTracks?.[0];o&&h&&(E=!0,g=o.id,B={sampleRate:o.audio.sample_rate,numberOfChannels:o.audio.channel_count},h.configure({codec:o.codec,sampleRate:o.audio.sample_rate,numberOfChannels:o.audio.channel_count}),s.setExtractionOptions(g,"audio",{nbSamples:100})),f({hasAudio:E,audioFormat:B,totalFrames:C}),s.start()},s.onSamples=(e,r,o)=>{if(e===x)for(const l of o){const d=new EncodedVideoChunk({type:l.is_sync?"key":"delta",timestamp:Math.round(1e6*l.cts/l.timescale),duration:Math.round(1e6*l.duration/l.timescale),data:l.data});a.decode(d)}else if(e===g)for(const l of o){const d=new EncodedAudioChunk({type:"key",timestamp:Math.round(1e6*l.cts/l.timescale),duration:Math.round(1e6*l.duration/l.timescale),data:l.data});h.decode(d)}};const T=1024*1024*5;let y=0;const M=new FileReader;M.onload=e=>{const r=e.target.result;r.fileStart=y,s.appendBuffer(r),y+=r.byteLength;const o=Math.min(gr,y/n.size*gr);u(o),y<n.size?t():(s.flush(),c({hasAudio:E}))},M.onerror=()=>{v(new Error("Failed to read file"))};function t(){const e=n.slice(y,y+T);M.readAsArrayBuffer(e)}t()})}function Ya(n){if(n.avcC){const a=new ze.DataStream(void 0,0,ze.DataStream.BIG_ENDIAN);return n.avcC.write(a),new Uint8Array(a.buffer.slice(8))}else if(n.hvcC){const a=new ze.DataStream(void 0,0,ze.DataStream.BIG_ENDIAN);return n.hvcC.write(a),new Uint8Array(a.buffer.slice(8))}return null}const Mi=10,qa=100-Mi;async function Wa(n,a,h){const u=await(await window.showSaveFilePicker({suggestedName:"output.mp4",types:[{description:"Video File",accept:{"video/mp4":[".mp4"]}}]})).createWritable();let c=null,v=null,s=null,x=0,g=0;const E=performance.now(),B=100;let C=0,T=0,y=!1,M;const t=new Promise(p=>{M=p});let e=null;const r=()=>{y&&C===0&&T===0&&(e&&clearTimeout(e),e=setTimeout(()=>{C===0&&T===0&&M()},B))},o=p=>{const{hasAudio:_,audioFormat:m,totalFrames:w}=p;g=w??0;const b={target:new hn(u),video:{codec:"avc",width:a.video.width,height:a.video.height},fastStart:!1,firstTimestampBehavior:"offset"};_&&a.audio&&m&&(b.audio={codec:"aac",sampleRate:m.sampleRate,numberOfChannels:m.numberOfChannels}),c=new Ga(b),v=new VideoEncoder({output:(U,I)=>{C++;try{c.addVideoChunk(U,I)}finally{C--,r()}},error:U=>console.error("VideoEncoder error",U)}),v.configure({codec:a.video.codec??"avc1.640028",width:a.video.width,height:a.video.height,bitrate:a.video.bitrate,framerate:a.video.framerate,latencyMode:"quality"}),_&&a.audio&&m&&(s=new AudioEncoder({output:(U,I)=>{T++;try{c.addAudioChunk(U,I)}finally{T--,r()}},error:U=>console.error("AudioEncoder error",U)}),s.configure({codec:a.audio.codec??"mp4a.40.2",sampleRate:m.sampleRate,numberOfChannels:m.numberOfChannels,bitrate:a.audio.bitrate}))},l=new VideoDecoder({output:p=>{if(x++,v&&v.state==="configured")try{v.encode(p)}catch(U){console.error("VideoEncoder encode error:",U)}p.close();const _=performance.now()-E,m=x/(_/1e3);let w=Mi;g>0&&(w=Mi+x/g*qa);let b=0;if(g>0&&x>0&&x<g){const U=x/g;b=_/U-_}h(w,{fps:m,elapsedMs:_,etaMs:b})},error:p=>console.error("VideoDecoder error",p)}),d=new AudioDecoder({output:p=>{if(s&&s.state==="configured")try{s.encode(p)}catch(_){console.error("AudioEncoder encode error:",_)}p.close()},error:p=>console.error("AudioDecoder error",p)});await Va(n,l,d,o,p=>h(p));try{await v.flush()}catch(p){console.error("VideoEncoder flush error:",p)}if(s)try{await s.flush()}catch(p){console.error("AudioEncoder flush error:",p)}y=!0,r(),await t,h(100),c.finalize(),await u.close()}const ja="video-encoder-presets",mr=[{name:"1080p30 (5Mbps)",config_json:{codec:"avc1.640028",width:1920,height:1080,bitrate:5e6,framerate:30,audio_bitrate:128e3}},{name:"720p30 (3Mbps)",config_json:{codec:"avc1.42001f",width:1280,height:720,bitrate:3e6,framerate:30,audio_bitrate:128e3}}];function Ka(){try{const n=localStorage.getItem(ja);if(!n)return mr;const a=JSON.parse(n);if(Array.isArray(a)&&a.length>0)return a}catch{}return mr}var Xa=jt('<div class="panel svelte-1n46o8q"><p class="svelte-1n46o8q"> </p></div>'),Za=jt("<option> </option>"),$a=jt('<p class="svelte-1n46o8q"> </p>'),Ja=jt('<div class="panel svelte-1n46o8q"><div class="progress svelte-1n46o8q"><div class="svelte-1n46o8q"></div></div> <p class="svelte-1n46o8q"> </p> <p class="svelte-1n46o8q"> </p> <!></div>'),Qa=jt('<div class="panel svelte-1n46o8q"><p style="color: #2e7d32; background: #e8f5e9; padding: 12px; border-radius: 4px;" class="svelte-1n46o8q"> </p></div>'),to=jt('<div class="panel svelte-1n46o8q"><div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <select class="svelte-1n46o8q"></select></div></div> <div class="panel svelte-1n46o8q"><button class="svelte-1n46o8q"></button></div> <!> <!>',1),eo=jt('<div class="panel svelte-1n46o8q"><p style="color: #999;" class="svelte-1n46o8q">...</p></div>'),io=jt('<div class="container svelte-1n46o8q"><h1 class="svelte-1n46o8q"></h1> <div class="dropzone svelte-1n46o8q"><input type="file" id="fileInput" accept="video/mp4" class="svelte-1n46o8q"/> <p class="svelte-1n46o8q">MP4&  </p></div> <!> <!></div>');function ro(n,a){Cr(a,!1);let h=Ut(null),f=Ut([]),u=Ut(0),c=Ut(0),v=Ut(0),s=Ut(0),x=Ut(0),g=Ut(!1),E=Ut("");const B=d=>{const p=d.target;X(h,p.files?.[0]??null)};async function C(){if(!F(h))return;X(E,""),X(g,!0);const d=F(f)[F(u)]?.config_json??F(f)[F(u)]??{codec:"avc1.640028",width:1920,height:1080,bitrate:5e6,framerate:30,audio_bitrate:128e3},p={video:{codec:d.codec,width:d.width,height:d.height,bitrate:d.bitrate,framerate:d.framerate},audio:{codec:"mp4a.40.2",sampleRate:44100,numberOfChannels:2,bitrate:d.audio_bitrate??128e3}},_=performance.now();await Wa(F(h),p,(b,U)=>{b!==void 0&&X(c,b),U&&(X(v,U.fps),X(s,U.elapsedMs),X(x,U.etaMs??0))});const m=performance.now(),w={process_time_ms:Math.round(m-_),source_size_byte:F(h).size,avg_fps:F(v)};X(E,` (: ${w.process_time_ms}ms, FPS: ${w.avg_fps.toFixed(1)})`),X(g,!1)}Ws(()=>{X(f,Ka())}),qs();var T=io(),y=bt(rt(T),2),M=rt(y),t=bt(y,2);{var e=d=>{var p=Xa(),_=rt(p),m=rt(_);Xt(w=>pe(m,`: ${F(h).name??""} (${w??""} MB)`),[()=>(F(h).size/1024/1024).toFixed(2)]),Ot(d,p)};Ue(t,d=>{F(h)&&d(e)})}var r=bt(t,2);{var o=d=>{var p=to(),_=hs(p),m=rt(_),w=bt(rt(m),2);Xt(()=>{F(u),ws(()=>{F(f)})}),Rs(w,5,()=>F(f),Ds,(K,ht,st)=>{var j=Za(),ft=rt(j);j.value=j.__value=st,Xt(()=>pe(ft,F(ht).name)),Ot(K,j)});var b=bt(_,2),U=rt(b),I=bt(b,2);{var A=K=>{var ht=Ja(),st=rt(ht),j=rt(st),ft=bt(st,2),de=rt(ft),ue=bt(ft,2),wt=rt(ue),Kt=bt(ue,2);{var P=be=>{var Ze=$a(),yi=rt(Ze);Xt(Sn=>pe(yi,`: ${Sn??""}s`),[()=>(F(x)/1e3).toFixed(1)]),Ot(be,Ze)};Ue(Kt,be=>{F(x)>0&&F(c)<100&&be(P)})}Xt((be,Ze,yi)=>{Hs(j,`width:${F(c)??""}%`),pe(de,`: ${be??""}%`),pe(wt,`FPS: ${Ze??""} | : ${yi??""}s`)},[()=>Math.round(F(c)),()=>F(v)>0?F(v).toFixed(1):"-",()=>(F(s)/1e3).toFixed(1)]),Ot(K,ht)};Ue(I,K=>{F(g)&&K(A)})}var q=bt(I,2);{var H=K=>{var ht=Qa(),st=rt(ht),j=rt(st);Xt(()=>pe(j,F(E))),Ot(K,ht)};Ue(q,K=>{F(E)&&K(H)})}Xt(()=>U.disabled=!F(h)||F(g)),Ys(w,()=>F(u),K=>X(u,K)),gi("click",U,C),Ot(d,p)},l=d=>{var p=eo();Ot(d,p)};Ue(r,d=>{F(f).length>0?d(o):d(l,!1)})}gi("change",M,B),gi("click",y,()=>document.getElementById("fileInput")?.click()),Ot(n,T),Ar()}Fs(ro,{target:document.getElementById("app")});
