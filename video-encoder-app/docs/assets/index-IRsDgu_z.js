(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))h(d);new MutationObserver(d=>{for(const u of d)if(u.type==="childList")for(const m of u.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&h(m)}).observe(document,{childList:!0,subtree:!0});function l(d){const u={};return d.integrity&&(u.integrity=d.integrity),d.referrerPolicy&&(u.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?u.credentials="include":d.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function h(d){if(d.ep)return;d.ep=!0;const u=l(d);fetch(d.href,u)}})();const os=!1;var Ms=Array.isArray,vh=Array.prototype.indexOf,Pn=Array.from,gh=Object.defineProperty,br=Object.getOwnPropertyDescriptor,uo=Object.getOwnPropertyDescriptors,mh=Object.prototype,yh=Array.prototype,Ds=Object.getPrototypeOf,Ya=Object.isExtensible;function wh(r){return r()}function ls(r){for(var s=0;s<r.length;s++)r[s]()}function co(){var r,s,l=new Promise((h,d)=>{r=h,s=d});return{promise:l,resolve:r,reject:s}}const Ft=2,yn=4,jr=8,po=1<<24,Oe=16,Ne=32,zi=64,Rs=128,he=512,zt=1024,Nt=2048,Ee=4096,ie=8192,Je=16384,Os=32768,Qi=65536,qa=1<<17,_o=1<<18,ar=1<<19,vo=1<<20,Ze=1<<25,Bi=32768,hs=1<<21,Ns=1<<22,Qe=1<<23,wi=Symbol("$state"),Hi=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function bh(r){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function xh(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Sh(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Uh(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Eh(r){throw new Error("https://svelte.dev/e/effect_orphan")}function Ch(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Bh(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Ah(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Th(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function kh(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Ih=1,zh=2,Fh=16,Ph=1,Lh=2,kt=Symbol(),Mh="http://www.w3.org/1999/xhtml";function Dh(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Rh(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function go(r){return r===this.v}function Oh(r,s){return r!=r?s==s:r!==s||r!==null&&typeof r=="object"||typeof r=="function"}function mo(r){return!Oh(r,this.v)}let $r=!1,Nh=!1;function Hh(){$r=!0}let yt=null;function tr(r){yt=r}function yo(r,s=!1,l){yt={p:yt,i:!1,c:null,e:null,s:r,x:null,l:$r&&!s?{s:null,u:null,$:[]}:null}}function wo(r){var s=yt,l=s.e;if(l!==null){s.e=null;for(var h of l)Ro(h)}return s.i=!0,yt=s.p,{}}function Kr(){return!$r||yt!==null&&yt.l===null}let mi=[];function bo(){var r=mi;mi=[],ls(r)}function bi(r){if(mi.length===0&&!xr){var s=mi;queueMicrotask(()=>{s===mi&&bo()})}mi.push(r)}function Gh(){for(;mi.length>0;)bo()}function xo(r){var s=ot;if(s===null)return J.f|=Qe,r;if(s.f&Os)er(r,s);else{if(!(s.f&Rs))throw r;s.b.error(r)}}function er(r,s){for(;s!==null;){if(s.f&Rs)try{s.b.error(r);return}catch(l){r=l}s=s.parent}throw r}const Vh=-7169;function Et(r,s){r.f=r.f&Vh|s}function Hs(r){r.f&he||r.deps===null?Et(r,zt):Et(r,Ee)}function So(r){if(r!==null)for(const s of r)!(s.f&Ft)||!(s.f&Bi)||(s.f^=Bi,So(s.deps))}function Uo(r,s,l){r.f&Nt?s.add(r):r.f&Ee&&l.add(r),So(r.deps),Et(r,zt)}const sn=new Set;let rt=null,wn=null,pe=null,Qt=[],Ln=null,fs=!1,xr=!1;class ti{committed=!1;current=new Map;previous=new Map;#e=new Set;#a=new Set;#t=0;#n=0;#s=null;#r=new Set;#i=new Set;skipped_effects=new Set;is_fork=!1;#o=!1;is_deferred(){return this.is_fork||this.#n>0}process(s){Qt=[],this.apply();var l=[],h=[];for(const d of s)this.#l(d,l,h);if(this.is_deferred())this.#h(h),this.#h(l);else{for(const d of this.#e)d();this.#e.clear(),this.#t===0&&this.#f(),wn=this,rt=null,ja(h),ja(l),wn=null,this.#s?.resolve()}pe=null}#l(s,l,h){s.f^=zt;for(var d=s.first,u=null;d!==null;){var m=d.f,a=(m&(Ne|zi))!==0,b=a&&(m&zt)!==0,w=b||(m&ie)!==0||this.skipped_effects.has(d);if(!w&&d.fn!==null){a?d.f^=zt:u!==null&&m&(yn|jr|po)?u.b.defer_effect(d):m&yn?l.push(d):or(d)&&(m&Oe&&this.#r.add(d),ir(d));var B=d.first;if(B!==null){d=B;continue}}var T=d.parent;for(d=d.next;d===null&&T!==null;)T===u&&(u=null),d=T.next,T=T.parent}}#h(s){for(var l=0;l<s.length;l+=1)Uo(s[l],this.#r,this.#i)}capture(s,l){l!==kt&&!this.previous.has(s)&&this.previous.set(s,l),s.f&Qe||(this.current.set(s,s.v),pe?.set(s,s.v))}activate(){rt=this,this.apply()}deactivate(){rt===this&&(rt=null,pe=null)}flush(){if(this.activate(),Qt.length>0){if(Eo(),rt!==null&&rt!==this)return}else this.#t===0&&this.process([]);this.deactivate()}discard(){for(const s of this.#a)s(this);this.#a.clear()}#f(){if(sn.size>1){this.previous.clear();var s=pe,l=!0;for(const d of sn){if(d===this){l=!1;continue}const u=[];for(const[a,b]of this.current){if(d.current.has(a))if(l&&b!==d.current.get(a))d.current.set(a,b);else continue;u.push(a)}if(u.length===0)continue;const m=[...d.current.keys()].filter(a=>!this.current.has(a));if(m.length>0){var h=Qt;Qt=[];const a=new Set,b=new Map;for(const w of u)Co(w,m,a,b);if(Qt.length>0){rt=d,d.apply();for(const w of Qt)d.#l(w,[],[]);d.deactivate()}Qt=h}}rt=null,pe=s}this.committed=!0,sn.delete(this)}increment(s){this.#t+=1,s&&(this.#n+=1)}decrement(s){this.#t-=1,s&&(this.#n-=1),!this.#o&&(this.#o=!0,bi(()=>{this.#o=!1,this.is_deferred()?Qt.length>0&&this.flush():this.revive()}))}revive(){for(const s of this.#r)this.#i.delete(s),Et(s,Nt),De(s);for(const s of this.#i)Et(s,Ee),De(s);this.flush()}oncommit(s){this.#e.add(s)}ondiscard(s){this.#a.add(s)}settled(){return(this.#s??=co()).promise}static ensure(){if(rt===null){const s=rt=new ti;sn.add(rt),xr||bi(()=>{rt===s&&s.flush()})}return rt}apply(){}}function Wh(r){var s=xr;xr=!0;try{for(var l;;){if(Gh(),Qt.length===0&&(rt?.flush(),Qt.length===0))return Ln=null,l;Eo()}}finally{xr=s}}function Eo(){fs=!0;var r=null;try{for(var s=0;Qt.length>0;){var l=ti.ensure();if(s++>1e3){var h,d;Yh()}l.process(Qt),ei.clear()}}finally{fs=!1,Ln=null}}function Yh(){try{Ch()}catch(r){er(r,Ln)}}let Ie=null;function ja(r){var s=r.length;if(s!==0){for(var l=0;l<s;){var h=r[l++];if(!(h.f&(Je|ie))&&or(h)&&(Ie=new Set,ir(h),h.deps===null&&h.first===null&&h.nodes===null&&(h.teardown===null&&h.ac===null?Ho(h):h.fn=null),Ie?.size>0)){ei.clear();for(const d of Ie){if(d.f&(Je|ie))continue;const u=[d];let m=d.parent;for(;m!==null;)Ie.has(m)&&(Ie.delete(m),u.push(m)),m=m.parent;for(let a=u.length-1;a>=0;a--){const b=u[a];b.f&(Je|ie)||ir(b)}}Ie.clear()}}Ie=null}}function Co(r,s,l,h){if(!l.has(r)&&(l.add(r),r.reactions!==null))for(const d of r.reactions){const u=d.f;u&Ft?Co(d,s,l,h):u&(Ns|Oe)&&!(u&Nt)&&Bo(d,s,h)&&(Et(d,Nt),De(d))}}function Bo(r,s,l){const h=l.get(r);if(h!==void 0)return h;if(r.deps!==null)for(const d of r.deps){if(s.includes(d))return!0;if(d.f&Ft&&Bo(d,s,l))return l.set(d,!0),!0}return l.set(r,!1),!1}function De(r){for(var s=Ln=r;s.parent!==null;){s=s.parent;var l=s.f;if(fs&&s===ot&&l&Oe&&!(l&_o))return;if(l&(zi|Ne)){if(!(l&zt))return;s.f^=zt}}Qt.push(s)}function qh(r){let s=0,l=Ai(0),h;return()=>{Ys()&&(p(l),Zr(()=>(s===0&&(h=ht(()=>r(()=>Sr(l)))),s+=1,()=>{bi(()=>{s-=1,s===0&&(h?.(),h=void 0,Sr(l))})})))}}var jh=Qi|ar|Rs;function $h(r,s,l){new Kh(r,s,l)}class Kh{parent;is_pending=!1;#e;#a=null;#t;#n;#s;#r=null;#i=null;#o=null;#l=null;#h=null;#f=0;#u=0;#p=!1;#c=!1;#_=new Set;#v=new Set;#d=null;#b=qh(()=>(this.#d=Ai(this.#f),()=>{this.#d=null}));constructor(s,l,h){this.#e=s,this.#t=l,this.#n=h,this.parent=ot.b,this.is_pending=!!this.#t.pending,this.#s=js(()=>{ot.b=this;{var d=this.#y();try{this.#r=le(()=>h(d))}catch(u){this.error(u)}this.#u>0?this.#m():this.is_pending=!1}return()=>{this.#h?.remove()}},jh)}#x(){try{this.#r=le(()=>this.#n(this.#e))}catch(s){this.error(s)}}#S(){const s=this.#t.pending;s&&(this.#i=le(()=>s(this.#e)),bi(()=>{var l=this.#y();this.#r=this.#g(()=>(ti.ensure(),le(()=>this.#n(l)))),this.#u>0?this.#m():(xi(this.#i,()=>{this.#i=null}),this.is_pending=!1)}))}#y(){var s=this.#e;return this.is_pending&&(this.#h=Pe(),this.#e.before(this.#h),s=this.#h),s}defer_effect(s){Uo(s,this.#_,this.#v)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#t.pending}#g(s){var l=ot,h=J,d=yt;Ue(this.#s),Yt(this.#s),tr(this.#s.ctx);try{return s()}catch(u){return xo(u),null}finally{Ue(l),Yt(h),tr(d)}}#m(){const s=this.#t.pending;this.#r!==null&&(this.#l=document.createDocumentFragment(),this.#l.append(this.#h),Wo(this.#r,this.#l)),this.#i===null&&(this.#i=le(()=>s(this.#e)))}#w(s){if(!this.has_pending_snippet()){this.parent&&this.parent.#w(s);return}if(this.#u+=s,this.#u===0){this.is_pending=!1;for(const l of this.#_)Et(l,Nt),De(l);for(const l of this.#v)Et(l,Ee),De(l);this.#_.clear(),this.#v.clear(),this.#i&&xi(this.#i,()=>{this.#i=null}),this.#l&&(this.#e.before(this.#l),this.#l=null)}}update_pending_count(s){this.#w(s),this.#f+=s,!(!this.#d||this.#p)&&(this.#p=!0,bi(()=>{this.#p=!1,this.#d&&Ti(this.#d,this.#f)}))}get_effect_pending(){return this.#b(),p(this.#d)}error(s){var l=this.#t.onerror;let h=this.#t.failed;if(this.#c||!l&&!h)throw s;this.#r&&(qt(this.#r),this.#r=null),this.#i&&(qt(this.#i),this.#i=null),this.#o&&(qt(this.#o),this.#o=null);var d=!1,u=!1;const m=()=>{if(d){Rh();return}d=!0,u&&kh(),ti.ensure(),this.#f=0,this.#o!==null&&xi(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#r=this.#g(()=>(this.#c=!1,le(()=>this.#n(this.#e)))),this.#u>0?this.#m():this.is_pending=!1};var a=J;try{Yt(null),u=!0,l?.(s,m),u=!1}catch(b){er(b,this.#s&&this.#s.parent)}finally{Yt(a)}h&&bi(()=>{this.#o=this.#g(()=>{ti.ensure(),this.#c=!0;try{return le(()=>{h(this.#e,()=>s,()=>m)})}catch(b){return er(b,this.#s.parent),null}finally{this.#c=!1}})})}}function Xh(r,s,l,h){const d=Kr()?Gs:Ao;var u=r.filter(C=>!C.settled);if(l.length===0&&u.length===0){h(s.map(d));return}var m=rt,a=ot,b=Zh(),w=u.length===1?u[0].promise:u.length>1?Promise.all(u.map(C=>C.promise)):null;function B(C){b();try{h(C)}catch(P){a.f&Je||er(P,a)}m?.deactivate(),ds()}if(l.length===0){w.then(()=>B(s.map(d)));return}function T(){b(),Promise.all(l.map(C=>Jh(C))).then(C=>B([...s.map(d),...C])).catch(C=>er(C,a))}w?w.then(T):T()}function Zh(){var r=ot,s=J,l=yt,h=rt;return function(u=!0){Ue(r),Yt(s),tr(l),u&&h?.activate()}}function ds(){Ue(null),Yt(null),tr(null)}function Gs(r){var s=Ft|Nt,l=J!==null&&J.f&Ft?J:null;return ot!==null&&(ot.f|=ar),{ctx:yt,deps:null,effects:null,equals:go,f:s,fn:r,reactions:null,rv:0,v:kt,wv:0,parent:l??ot,ac:null}}function Jh(r,s,l){let h=ot;h===null&&xh();var d=h.b,u=void 0,m=Ai(kt),a=!J,b=new Map;return df(()=>{var w=co();u=w.promise;try{Promise.resolve(r()).then(w.resolve,w.reject).then(()=>{B===rt&&B.committed&&B.deactivate(),ds()})}catch(P){w.reject(P),ds()}var B=rt;if(a){var T=d.is_rendered();d.update_pending_count(1),B.increment(T),b.get(B)?.reject(Hi),b.delete(B),b.set(B,w)}const C=(P,y=void 0)=>{if(B.activate(),y)y!==Hi&&(m.f|=Qe,Ti(m,y));else{m.f&Qe&&(m.f^=Qe),Ti(m,P);for(const[N,t]of b){if(b.delete(N),N===B)break;t.reject(Hi)}}a&&(d.update_pending_count(-1),B.decrement(T))};w.promise.then(C,P=>C(null,P||"unknown"))}),qs(()=>{for(const w of b.values())w.reject(Hi)}),new Promise(w=>{function B(T){function C(){T===u?w(m):B(u)}T.then(C,C)}B(u)})}function Ao(r){const s=Gs(r);return s.equals=mo,s}function To(r){var s=r.effects;if(s!==null){r.effects=null;for(var l=0;l<s.length;l+=1)qt(s[l])}}function Qh(r){for(var s=r.parent;s!==null;){if(!(s.f&Ft))return s.f&Je?null:s;s=s.parent}return null}function Vs(r){var s,l=ot;Ue(Qh(r));try{r.f&=~Bi,To(r),s=$o(r)}finally{Ue(l)}return s}function ko(r){var s=Vs(r);if(!r.equals(s)&&(r.wv=qo(),(!rt?.is_fork||r.deps===null)&&(r.v=s,r.deps===null))){Et(r,zt);return}ki||(pe!==null?(Ys()||rt?.is_fork)&&pe.set(r,s):Hs(r))}let us=new Set;const ei=new Map;let Io=!1;function Ai(r,s){var l={f:0,v:r,reactions:null,equals:go,rv:0,wv:0};return l}function Ye(r,s){const l=Ai(r);return _f(l),l}function j(r,s=!1,l=!0){const h=Ai(r);return s||(h.equals=mo),$r&&l&&yt!==null&&yt.l!==null&&(yt.l.s??=[]).push(h),h}function k(r,s,l=!1){J!==null&&(!_e||J.f&qa)&&Kr()&&J.f&(Ft|Oe|Ns|qa)&&!Le?.includes(r)&&Th();let h=l?dr(s):s;return Ti(r,h)}function Ti(r,s){if(!r.equals(s)){var l=r.v;ki?ei.set(r,s):ei.set(r,l),r.v=s;var h=ti.ensure();if(h.capture(r,l),r.f&Ft){const d=r;r.f&Nt&&Vs(d),Hs(d)}r.wv=qo(),zo(r,Nt),Kr()&&ot!==null&&ot.f&zt&&!(ot.f&(Ne|zi))&&(ae===null?vf([r]):ae.push(r)),!h.is_fork&&us.size>0&&!Io&&tf()}return s}function tf(){Io=!1;for(const r of us)r.f&zt&&Et(r,Ee),or(r)&&ir(r);us.clear()}function Sr(r){k(r,r.v+1)}function zo(r,s){var l=r.reactions;if(l!==null)for(var h=Kr(),d=l.length,u=0;u<d;u++){var m=l[u],a=m.f;if(!(!h&&m===ot)){var b=(a&Nt)===0;if(b&&Et(m,s),a&Ft){var w=m;pe?.delete(w),a&Bi||(a&he&&(m.f|=Bi),zo(w,Ee))}else b&&(a&Oe&&Ie!==null&&Ie.add(m),De(m))}}}function dr(r){if(typeof r!="object"||r===null||wi in r)return r;const s=Ds(r);if(s!==mh&&s!==yh)return r;var l=new Map,h=Ms(r),d=Ye(0),u=Si,m=a=>{if(Si===u)return a();var b=J,w=Si;Yt(null),Ja(u);var B=a();return Yt(b),Ja(w),B};return h&&l.set("length",Ye(r.length)),new Proxy(r,{defineProperty(a,b,w){(!("value"in w)||w.configurable===!1||w.enumerable===!1||w.writable===!1)&&Bh();var B=l.get(b);return B===void 0?B=m(()=>{var T=Ye(w.value);return l.set(b,T),T}):k(B,w.value,!0),!0},deleteProperty(a,b){var w=l.get(b);if(w===void 0){if(b in a){const B=m(()=>Ye(kt));l.set(b,B),Sr(d)}}else k(w,kt),Sr(d);return!0},get(a,b,w){if(b===wi)return r;var B=l.get(b),T=b in a;if(B===void 0&&(!T||br(a,b)?.writable)&&(B=m(()=>{var P=dr(T?a[b]:kt),y=Ye(P);return y}),l.set(b,B)),B!==void 0){var C=p(B);return C===kt?void 0:C}return Reflect.get(a,b,w)},getOwnPropertyDescriptor(a,b){var w=Reflect.getOwnPropertyDescriptor(a,b);if(w&&"value"in w){var B=l.get(b);B&&(w.value=p(B))}else if(w===void 0){var T=l.get(b),C=T?.v;if(T!==void 0&&C!==kt)return{enumerable:!0,configurable:!0,value:C,writable:!0}}return w},has(a,b){if(b===wi)return!0;var w=l.get(b),B=w!==void 0&&w.v!==kt||Reflect.has(a,b);if(w!==void 0||ot!==null&&(!B||br(a,b)?.writable)){w===void 0&&(w=m(()=>{var C=B?dr(a[b]):kt,P=Ye(C);return P}),l.set(b,w));var T=p(w);if(T===kt)return!1}return B},set(a,b,w,B){var T=l.get(b),C=b in a;if(h&&b==="length")for(var P=w;P<T.v;P+=1){var y=l.get(P+"");y!==void 0?k(y,kt):P in a&&(y=m(()=>Ye(kt)),l.set(P+"",y))}if(T===void 0)(!C||br(a,b)?.writable)&&(T=m(()=>Ye(void 0)),k(T,dr(w)),l.set(b,T));else{C=T.v!==kt;var N=m(()=>dr(w));k(T,N)}var t=Reflect.getOwnPropertyDescriptor(a,b);if(t?.set&&t.set.call(B,w),!C){if(h&&typeof b=="string"){var e=l.get("length"),n=Number(b);Number.isInteger(n)&&n>=e.v&&k(e,n+1)}Sr(d)}return!0},ownKeys(a){p(d);var b=Reflect.ownKeys(a).filter(T=>{var C=l.get(T);return C===void 0||C.v!==kt});for(var[w,B]of l)B.v!==kt&&!(w in a)&&b.push(w);return b},setPrototypeOf(){Ah()}})}function $a(r){try{if(r!==null&&typeof r=="object"&&wi in r)return r[wi]}catch{}return r}function ef(r,s){return Object.is($a(r),$a(s))}var Ka,Fo,Po,Lo;function rf(){if(Ka===void 0){Ka=window,Fo=/Firefox/.test(navigator.userAgent);var r=Element.prototype,s=Node.prototype,l=Text.prototype;Po=br(s,"firstChild").get,Lo=br(s,"nextSibling").get,Ya(r)&&(r.__click=void 0,r.__className=void 0,r.__attributes=null,r.__style=void 0,r.__e=void 0),Ya(l)&&(l.__t=void 0)}}function Pe(r=""){return document.createTextNode(r)}function bn(r){return Po.call(r)}function Xr(r){return Lo.call(r)}function O(r,s){return bn(r)}function ce(r,s=!1){{var l=bn(r);return l instanceof Comment&&l.data===""?Xr(l):l}}function I(r,s=1,l=!1){let h=r;for(;s--;)h=Xr(h);return h}function nf(r){r.textContent=""}function Mo(){return!1}let Xa=!1;function sf(){Xa||(Xa=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{if(!r.defaultPrevented)for(const s of r.target.elements)s.__on_r?.()})},{capture:!0}))}function Mn(r){var s=J,l=ot;Yt(null),Ue(null);try{return r()}finally{Yt(s),Ue(l)}}function Ws(r,s,l,h=l){r.addEventListener(s,()=>Mn(l));const d=r.__on_r;d?r.__on_r=()=>{d(),h(!0)}:r.__on_r=()=>h(!0),sf()}function Do(r){ot===null&&(J===null&&Eh(),Uh()),ki&&Sh()}function af(r,s){var l=s.last;l===null?s.last=s.first=r:(l.next=r,r.prev=l,s.last=r)}function Ce(r,s,l){var h=ot;h!==null&&h.f&ie&&(r|=ie);var d={ctx:yt,deps:null,nodes:null,f:r|Nt|he,first:null,fn:s,last:null,next:null,parent:h,b:h&&h.b,prev:null,teardown:null,wv:0,ac:null};if(l)try{ir(d),d.f|=Os}catch(a){throw qt(d),a}else s!==null&&De(d);var u=d;if(l&&u.deps===null&&u.teardown===null&&u.nodes===null&&u.first===u.last&&!(u.f&ar)&&(u=u.first,r&Oe&&r&Qi&&u!==null&&(u.f|=Qi)),u!==null&&(u.parent=h,h!==null&&af(u,h),J!==null&&J.f&Ft&&!(r&zi))){var m=J;(m.effects??=[]).push(u)}return d}function Ys(){return J!==null&&!_e}function qs(r){const s=Ce(jr,null,!1);return Et(s,zt),s.teardown=r,s}function cs(r){Do();var s=ot.f,l=!J&&(s&Ne)!==0&&(s&Os)===0;if(l){var h=yt;(h.e??=[]).push(r)}else return Ro(r)}function Ro(r){return Ce(yn|vo,r,!1)}function of(r){return Do(),Ce(jr|vo,r,!0)}function lf(r){ti.ensure();const s=Ce(zi|ar,r,!0);return(l={})=>new Promise(h=>{l.outro?xi(s,()=>{qt(s),h(void 0)}):(qt(s),h(void 0))})}function hf(r){return Ce(yn,r,!1)}function an(r,s){var l=yt,h={effect:null,ran:!1,deps:r};l.l.$.push(h),h.effect=Zr(()=>{r(),!h.ran&&(h.ran=!0,ht(s))})}function ff(){var r=yt;Zr(()=>{for(var s of r.l.$){s.deps();var l=s.effect;l.f&zt&&l.deps!==null&&Et(l,Ee),or(l)&&ir(l),s.ran=!1}})}function df(r){return Ce(Ns|ar,r,!0)}function Zr(r,s=0){return Ce(jr|s,r,!0)}function _t(r,s=[],l=[],h=[]){Xh(h,s,l,d=>{Ce(jr,()=>r(...d.map(p)),!0)})}function js(r,s=0){var l=Ce(Oe|s,r,!0);return l}function le(r){return Ce(Ne|ar,r,!0)}function Oo(r){var s=r.teardown;if(s!==null){const l=ki,h=J;Za(!0),Yt(null);try{s.call(null)}finally{Za(l),Yt(h)}}}function No(r,s=!1){var l=r.first;for(r.first=r.last=null;l!==null;){const d=l.ac;d!==null&&Mn(()=>{d.abort(Hi)});var h=l.next;l.f&zi?l.parent=null:qt(l,s),l=h}}function uf(r){for(var s=r.first;s!==null;){var l=s.next;s.f&Ne||qt(s),s=l}}function qt(r,s=!0){var l=!1;(s||r.f&_o)&&r.nodes!==null&&r.nodes.end!==null&&(cf(r.nodes.start,r.nodes.end),l=!0),No(r,s&&!l),xn(r,0),Et(r,Je);var h=r.nodes&&r.nodes.t;if(h!==null)for(const u of h)u.stop();Oo(r);var d=r.parent;d!==null&&d.first!==null&&Ho(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes=r.ac=null}function cf(r,s){for(;r!==null;){var l=r===s?null:Xr(r);r.remove(),r=l}}function Ho(r){var s=r.parent,l=r.prev,h=r.next;l!==null&&(l.next=h),h!==null&&(h.prev=l),s!==null&&(s.first===r&&(s.first=h),s.last===r&&(s.last=l))}function xi(r,s,l=!0){var h=[];Go(r,h,!0);var d=()=>{l&&qt(r),s&&s()},u=h.length;if(u>0){var m=()=>--u||d();for(var a of h)a.out(m)}else d()}function Go(r,s,l){if(!(r.f&ie)){r.f^=ie;var h=r.nodes&&r.nodes.t;if(h!==null)for(const a of h)(a.is_global||l)&&s.push(a);for(var d=r.first;d!==null;){var u=d.next,m=(d.f&Qi)!==0||(d.f&Ne)!==0&&(r.f&Oe)!==0;Go(d,s,m?l:!1),d=u}}}function $s(r){Vo(r,!0)}function Vo(r,s){if(r.f&ie){r.f^=ie,r.f&zt||(Et(r,Nt),De(r));for(var l=r.first;l!==null;){var h=l.next,d=(l.f&Qi)!==0||(l.f&Ne)!==0;Vo(l,d?s:!1),l=h}var u=r.nodes&&r.nodes.t;if(u!==null)for(const m of u)(m.is_global||s)&&m.in()}}function Wo(r,s){if(r.nodes)for(var l=r.nodes.start,h=r.nodes.end;l!==null;){var d=l===h?null:Xr(l);s.append(l),l=d}}let Ri=null;function pf(r){var s=Ri;try{if(Ri=new Set,ht(r),s!==null)for(var l of Ri)s.add(l);return Ri}finally{Ri=s}}function Te(r){for(var s of pf(r))Ti(s,s.v)}let ln=!1,ki=!1;function Za(r){ki=r}let J=null,_e=!1;function Yt(r){J=r}let ot=null;function Ue(r){ot=r}let Le=null;function _f(r){J!==null&&(Le===null?Le=[r]:Le.push(r))}let Wt=null,Zt=0,ae=null;function vf(r){ae=r}let Yo=1,yi=0,Si=yi;function Ja(r){Si=r}function qo(){return++Yo}function or(r){var s=r.f;if(s&Nt)return!0;if(s&Ft&&(r.f&=~Bi),s&Ee){for(var l=r.deps,h=l.length,d=0;d<h;d++){var u=l[d];if(or(u)&&ko(u),u.wv>r.wv)return!0}s&he&&pe===null&&Et(r,zt)}return!1}function jo(r,s,l=!0){var h=r.reactions;if(h!==null&&!Le?.includes(r))for(var d=0;d<h.length;d++){var u=h[d];u.f&Ft?jo(u,s,!1):s===u&&(l?Et(u,Nt):u.f&zt&&Et(u,Ee),De(u))}}function $o(r){var s=Wt,l=Zt,h=ae,d=J,u=Le,m=yt,a=_e,b=Si,w=r.f;Wt=null,Zt=0,ae=null,J=w&(Ne|zi)?null:r,Le=null,tr(r.ctx),_e=!1,Si=++yi,r.ac!==null&&(Mn(()=>{r.ac.abort(Hi)}),r.ac=null);try{r.f|=hs;var B=r.fn,T=B(),C=r.deps;if(Wt!==null){var P;if(xn(r,Zt),C!==null&&Zt>0)for(C.length=Zt+Wt.length,P=0;P<Wt.length;P++)C[Zt+P]=Wt[P];else r.deps=C=Wt;if(Ys()&&r.f&he)for(P=Zt;P<C.length;P++)(C[P].reactions??=[]).push(r)}else C!==null&&Zt<C.length&&(xn(r,Zt),C.length=Zt);if(Kr()&&ae!==null&&!_e&&C!==null&&!(r.f&(Ft|Ee|Nt)))for(P=0;P<ae.length;P++)jo(ae[P],r);if(d!==null&&d!==r){if(yi++,d.deps!==null)for(let y=0;y<l;y+=1)d.deps[y].rv=yi;if(s!==null)for(const y of s)y.rv=yi;ae!==null&&(h===null?h=ae:h.push(...ae))}return r.f&Qe&&(r.f^=Qe),T}catch(y){return xo(y)}finally{r.f^=hs,Wt=s,Zt=l,ae=h,J=d,Le=u,tr(m),_e=a,Si=b}}function gf(r,s){let l=s.reactions;if(l!==null){var h=vh.call(l,r);if(h!==-1){var d=l.length-1;d===0?l=s.reactions=null:(l[h]=l[d],l.pop())}}if(l===null&&s.f&Ft&&(Wt===null||!Wt.includes(s))){var u=s;u.f&he&&(u.f^=he,u.f&=~Bi),Hs(u),To(u),xn(u,0)}}function xn(r,s){var l=r.deps;if(l!==null)for(var h=s;h<l.length;h++)gf(r,l[h])}function ir(r){var s=r.f;if(!(s&Je)){Et(r,zt);var l=ot,h=ln;ot=r,ln=!0;try{s&(Oe|po)?uf(r):No(r),Oo(r);var d=$o(r);r.teardown=typeof d=="function"?d:null,r.wv=Yo;var u;os&&Nh&&r.f&Nt&&r.deps}finally{ln=h,ot=l}}}async function mf(){await Promise.resolve(),Wh()}function p(r){var s=r.f,l=(s&Ft)!==0;if(Ri?.add(r),J!==null&&!_e){var h=ot!==null&&(ot.f&Je)!==0;if(!h&&!Le?.includes(r)){var d=J.deps;if(J.f&hs)r.rv<yi&&(r.rv=yi,Wt===null&&d!==null&&d[Zt]===r?Zt++:Wt===null?Wt=[r]:Wt.push(r));else{(J.deps??=[]).push(r);var u=r.reactions;u===null?r.reactions=[J]:u.includes(J)||u.push(J)}}}if(ki&&ei.has(r))return ei.get(r);if(l){var m=r;if(ki){var a=m.v;return(!(m.f&zt)&&m.reactions!==null||Xo(m))&&(a=Vs(m)),ei.set(m,a),a}var b=(m.f&he)===0&&!_e&&J!==null&&(ln||(J.f&he)!==0),w=m.deps===null;or(m)&&(b&&(m.f|=he),ko(m)),b&&!w&&Ko(m)}if(pe?.has(r))return pe.get(r);if(r.f&Qe)throw r.v;return r.v}function Ko(r){if(r.deps!==null){r.f|=he;for(const s of r.deps)(s.reactions??=[]).push(r),s.f&Ft&&!(s.f&he)&&Ko(s)}}function Xo(r){if(r.v===kt)return!0;if(r.deps===null)return!1;for(const s of r.deps)if(ei.has(s)||s.f&Ft&&Xo(s))return!0;return!1}function ht(r){var s=_e;try{return _e=!0,r()}finally{_e=s}}function yf(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if(wi in r)ps(r);else if(!Array.isArray(r))for(let s in r){const l=r[s];typeof l=="object"&&l&&wi in l&&ps(l)}}}function ps(r,s=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!s.has(r)){s.add(r),r instanceof Date&&r.getTime();for(let h in r)try{ps(r[h],s)}catch{}const l=Ds(r);if(l!==Object.prototype&&l!==Array.prototype&&l!==Map.prototype&&l!==Set.prototype&&l!==Date.prototype){const h=uo(l);for(let d in h){const u=h[d].get;if(u)try{u.call(r)}catch{}}}}}const wf=["touchstart","touchmove"];function bf(r){return wf.includes(r)}const xf=new Set,Qa=new Set;function Sf(r,s,l,h={}){function d(u){if(h.capture||ur.call(s,u),!u.cancelBubble)return Mn(()=>l?.call(this,u))}return r.startsWith("pointer")||r.startsWith("touch")||r==="wheel"?bi(()=>{s.addEventListener(r,d,h)}):s.addEventListener(r,d,h),d}function Li(r,s,l,h,d){var u={capture:h,passive:d},m=Sf(r,s,l,u);(s===document.body||s===window||s===document||s instanceof HTMLMediaElement)&&qs(()=>{s.removeEventListener(r,m,u)})}let to=null;function ur(r){var s=this,l=s.ownerDocument,h=r.type,d=r.composedPath?.()||[],u=d[0]||r.target;to=r;var m=0,a=to===r&&r.__root;if(a){var b=d.indexOf(a);if(b!==-1&&(s===document||s===window)){r.__root=s;return}var w=d.indexOf(s);if(w===-1)return;b<=w&&(m=b)}if(u=d[m]||r.target,u!==s){gh(r,"currentTarget",{configurable:!0,get(){return u||l}});var B=J,T=ot;Yt(null),Ue(null);try{for(var C,P=[];u!==null;){var y=u.assignedSlot||u.parentNode||u.host||null;try{var N=u["__"+h];N!=null&&(!u.disabled||r.target===u)&&N.call(u,r)}catch(t){C?P.push(t):C=t}if(r.cancelBubble||y===s||y===null)break;u=y}if(C){for(let t of P)queueMicrotask(()=>{throw t});throw C}}finally{r.__root=s,delete r.currentTarget,Yt(B),Ue(T)}}}function Uf(r){var s=document.createElement("template");return s.innerHTML=r.replaceAll("<!>","<!---->"),s.content}function Sn(r,s){var l=ot;l.nodes===null&&(l.nodes={start:r,end:s,a:null,t:null})}function bt(r,s){var l=(s&Ph)!==0,h=(s&Lh)!==0,d,u=!r.startsWith("<!>");return()=>{d===void 0&&(d=Uf(u?r:"<!>"+r),l||(d=bn(d)));var m=h||Fo?document.importNode(d,!0):d.cloneNode(!0);if(l){var a=bn(m),b=m.lastChild;Sn(a,b)}else Sn(m,m);return m}}function on(r=""){{var s=Pe(r+"");return Sn(s,s),s}}function fr(){var r=document.createDocumentFragment(),s=document.createComment(""),l=Pe();return r.append(s,l),Sn(s,l),r}function it(r,s){r!==null&&r.before(s)}function Bt(r,s){var l=s==null?"":typeof s=="object"?s+"":s;l!==(r.__t??=r.nodeValue)&&(r.__t=l,r.nodeValue=l+"")}function Ef(r,s){return Cf(r,s)}const Mi=new Map;function Cf(r,{target:s,anchor:l,props:h={},events:d,context:u,intro:m=!0}){rf();var a=new Set,b=T=>{for(var C=0;C<T.length;C++){var P=T[C];if(!a.has(P)){a.add(P);var y=bf(P);s.addEventListener(P,ur,{passive:y});var N=Mi.get(P);N===void 0?(document.addEventListener(P,ur,{passive:y}),Mi.set(P,1)):Mi.set(P,N+1)}}};b(Pn(xf)),Qa.add(b);var w=void 0,B=lf(()=>{var T=l??s.appendChild(Pe());return $h(T,{pending:()=>{}},C=>{if(u){yo({});var P=yt;P.c=u}d&&(h.$$events=d),w=r(C,h)||{},u&&wo()}),()=>{for(var C of a){s.removeEventListener(C,ur);var P=Mi.get(C);--P===0?(document.removeEventListener(C,ur),Mi.delete(C)):Mi.set(C,P)}Qa.delete(b),T!==l&&T.parentNode?.removeChild(T)}});return Bf.set(w,B),w}let Bf=new WeakMap;class Af{anchor;#e=new Map;#a=new Map;#t=new Map;#n=new Set;#s=!0;constructor(s,l=!0){this.anchor=s,this.#s=l}#r=()=>{var s=rt;if(this.#e.has(s)){var l=this.#e.get(s),h=this.#a.get(l);if(h)$s(h),this.#n.delete(l);else{var d=this.#t.get(l);d&&(this.#a.set(l,d.effect),this.#t.delete(l),d.fragment.lastChild.remove(),this.anchor.before(d.fragment),h=d.effect)}for(const[u,m]of this.#e){if(this.#e.delete(u),u===s)break;const a=this.#t.get(m);a&&(qt(a.effect),this.#t.delete(m))}for(const[u,m]of this.#a){if(u===l||this.#n.has(u))continue;const a=()=>{if(Array.from(this.#e.values()).includes(u)){var w=document.createDocumentFragment();Wo(m,w),w.append(Pe()),this.#t.set(u,{effect:m,fragment:w})}else qt(m);this.#n.delete(u),this.#a.delete(u)};this.#s||!h?(this.#n.add(u),xi(m,a,!1)):a()}}};#i=s=>{this.#e.delete(s);const l=Array.from(this.#e.values());for(const[h,d]of this.#t)l.includes(h)||(qt(d.effect),this.#t.delete(h))};ensure(s,l){var h=rt,d=Mo();if(l&&!this.#a.has(s)&&!this.#t.has(s))if(d){var u=document.createDocumentFragment(),m=Pe();u.append(m),this.#t.set(s,{effect:le(()=>l(m)),fragment:u})}else this.#a.set(s,le(()=>l(this.anchor)));if(this.#e.set(h,s),d){for(const[a,b]of this.#a)a===s?h.skipped_effects.delete(b):h.skipped_effects.add(b);for(const[a,b]of this.#t)a===s?h.skipped_effects.delete(b.effect):h.skipped_effects.add(b.effect);h.oncommit(this.#r),h.ondiscard(this.#i)}else this.#r()}}function mt(r,s,l=!1){var h=new Af(r),d=l?Qi:0;function u(m,a){h.ensure(m,a)}js(()=>{var m=!1;s((a,b=!0)=>{m=!0,u(b,a)}),m||u(!1,null)},d)}function eo(r,s){return s}function Tf(r,s,l){for(var h=[],d=s.length,u,m=s.length,a=0;a<d;a++){let T=s[a];xi(T,()=>{if(u){if(u.pending.delete(T),u.done.add(T),u.pending.size===0){var C=r.outrogroups;_s(Pn(u.done)),C.delete(u),C.size===0&&(r.outrogroups=null)}}else m-=1},!1)}if(m===0){var b=h.length===0&&l!==null;if(b){var w=l,B=w.parentNode;nf(B),B.append(w),r.items.clear()}_s(s,!b)}else u={pending:new Set(s),done:new Set},(r.outrogroups??=new Set).add(u)}function _s(r,s=!0){for(var l=0;l<r.length;l++)qt(r[l],s)}var io;function ro(r,s,l,h,d,u=null){var m=r,a=new Map;{var b=r;m=b.appendChild(Pe())}var w=null,B=Ao(()=>{var t=l();return Ms(t)?t:t==null?[]:Pn(t)}),T,C=!0;function P(){N.fallback=w,kf(N,T,m,s,h),w!==null&&(T.length===0?w.f&Ze?(w.f^=Ze,cr(w,null,m)):$s(w):xi(w,()=>{w=null}))}var y=js(()=>{T=p(B);for(var t=T.length,e=new Set,n=rt,o=Mo(),f=0;f<t;f+=1){var c=T[f],v=h(c,f),g=C?null:a.get(v);g?(g.v&&Ti(g.v,c),g.i&&Ti(g.i,f),o&&n.skipped_effects.delete(g.e)):(g=If(a,C?m:io??=Pe(),c,v,f,d,s,l),C||(g.e.f|=Ze),a.set(v,g)),e.add(v)}if(t===0&&u&&!w&&(C?w=le(()=>u(m)):(w=le(()=>u(io??=Pe())),w.f|=Ze)),!C)if(o){for(const[x,S]of a)e.has(x)||n.skipped_effects.add(S.e);n.oncommit(P),n.ondiscard(()=>{})}else P();p(B)}),N={effect:y,items:a,outrogroups:null,fallback:w};C=!1}function kf(r,s,l,h,d){var u=s.length,m=r.items,a=r.effect.first,b,w=null,B=[],T=[],C,P,y,N;for(N=0;N<u;N+=1){if(C=s[N],P=d(C,N),y=m.get(P).e,r.outrogroups!==null)for(const x of r.outrogroups)x.pending.delete(y),x.done.delete(y);if(y.f&Ze)if(y.f^=Ze,y===a)cr(y,null,l);else{var t=w?w.next:a;y===r.effect.last&&(r.effect.last=y.prev),y.prev&&(y.prev.next=y.next),y.next&&(y.next.prev=y.prev),qe(r,w,y),qe(r,y,t),cr(y,t,l),w=y,B=[],T=[],a=w.next;continue}if(y.f&ie&&$s(y),y!==a){if(b!==void 0&&b.has(y)){if(B.length<T.length){var e=T[0],n;w=e.prev;var o=B[0],f=B[B.length-1];for(n=0;n<B.length;n+=1)cr(B[n],e,l);for(n=0;n<T.length;n+=1)b.delete(T[n]);qe(r,o.prev,f.next),qe(r,w,o),qe(r,f,e),a=e,w=f,N-=1,B=[],T=[]}else b.delete(y),cr(y,a,l),qe(r,y.prev,y.next),qe(r,y,w===null?r.effect.first:w.next),qe(r,w,y),w=y;continue}for(B=[],T=[];a!==null&&a!==y;)(b??=new Set).add(a),T.push(a),a=a.next;if(a===null)continue}y.f&Ze||B.push(y),w=y,a=y.next}if(r.outrogroups!==null){for(const x of r.outrogroups)x.pending.size===0&&(_s(Pn(x.done)),r.outrogroups?.delete(x));r.outrogroups.size===0&&(r.outrogroups=null)}if(a!==null||b!==void 0){var c=[];if(b!==void 0)for(y of b)y.f&ie||c.push(y);for(;a!==null;)!(a.f&ie)&&a!==r.fallback&&c.push(a),a=a.next;var v=c.length;if(v>0){var g=u===0?l:null;Tf(r,c,g)}}}function If(r,s,l,h,d,u,m,a){var b=m&Ih?m&Fh?Ai(l):j(l,!1,!1):null,w=m&zh?Ai(d):null;return{v:b,i:w,e:le(()=>(u(s,b??l,w??d,a),()=>{r.delete(h)}))}}function cr(r,s,l){if(r.nodes)for(var h=r.nodes.start,d=r.nodes.end,u=s&&!(s.f&Ze)?s.nodes.start:l;h!==null;){var m=Xr(h);if(u.before(h),h===d)return;h=m}}function qe(r,s,l){s===null?r.effect.first=l:s.next=l,l===null?r.effect.last=s:l.prev=s}function zf(r,s){return r==null?null:String(r)}function Ff(r,s,l,h){var d=r.__style;if(d!==s){var u=zf(s);u==null?r.removeAttribute("style"):r.style.cssText=u,r.__style=s}return h}function Zo(r,s,l=!1){if(r.multiple){if(s==null)return;if(!Ms(s))return Dh();for(var h of r.options)h.selected=s.includes(Ur(h));return}for(h of r.options){var d=Ur(h);if(ef(d,s)){h.selected=!0;return}}(!l||s!==void 0)&&(r.selectedIndex=-1)}function Pf(r){var s=new MutationObserver(()=>{Zo(r,r.__value)});s.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),qs(()=>{s.disconnect()})}function ke(r,s,l=s){var h=new WeakSet,d=!0;Ws(r,"change",u=>{var m=u?"[selected]":":checked",a;if(r.multiple)a=[].map.call(r.querySelectorAll(m),Ur);else{var b=r.querySelector(m)??r.querySelector("option:not([disabled])");a=b&&Ur(b)}l(a),rt!==null&&h.add(rt)}),hf(()=>{var u=s();if(r===document.activeElement){var m=wn??rt;if(h.has(m))return}if(Zo(r,u,d),d&&u===void 0){var a=r.querySelector(":checked");a!==null&&(u=Ur(a),l(u))}r.__value=u,d=!1}),Pf(r)}function Ur(r){return"__value"in r?r.__value:r.value}const Lf=Symbol("is custom element"),Mf=Symbol("is html");function Df(r,s,l,h){var d=Rf(r);d[s]!==(d[s]=l)&&(l==null?r.removeAttribute(s):typeof l!="string"&&Of(r).includes(s)?r[s]=l:r.setAttribute(s,l))}function Rf(r){return r.__attributes??={[Lf]:r.nodeName.includes("-"),[Mf]:r.namespaceURI===Mh}}var no=new Map;function Of(r){var s=r.getAttribute("is")||r.nodeName,l=no.get(s);if(l)return l;no.set(s,l=[]);for(var h,d=r,u=Element.prototype;u!==d;){h=uo(d);for(var m in h)h[m].set&&l.push(m);d=Ds(d)}return l}function fi(r,s,l=s){var h=new WeakSet;Ws(r,"input",async d=>{var u=d?r.defaultValue:r.value;if(u=rs(r)?ns(u):u,l(u),rt!==null&&h.add(rt),await mf(),u!==(u=s())){var m=r.selectionStart,a=r.selectionEnd,b=r.value.length;if(r.value=u??"",a!==null){var w=r.value.length;m===a&&a===b&&w>b?(r.selectionStart=w,r.selectionEnd=w):(r.selectionStart=m,r.selectionEnd=Math.min(a,w))}}}),ht(s)==null&&r.value&&(l(rs(r)?ns(r.value):r.value),rt!==null&&h.add(rt)),Zr(()=>{var d=s();if(r===document.activeElement){var u=wn??rt;if(h.has(u))return}rs(r)&&d===ns(r.value)||r.type==="date"&&!d&&!r.value||d!==r.value&&(r.value=d??"")})}function so(r,s,l=s){Ws(r,"change",h=>{var d=h?r.defaultChecked:r.checked;l(d)}),ht(s)==null&&l(r.checked),Zr(()=>{var h=s();r.checked=!!h})}function rs(r){var s=r.type;return s==="number"||s==="range"}function ns(r){return r===""?null:+r}function Nf(r=!1){const s=yt,l=s.l.u;if(!l)return;let h=()=>yf(s.s);if(r){let d=0,u={};const m=Gs(()=>{let a=!1;const b=s.s;for(const w in b)b[w]!==u[w]&&(u[w]=b[w],a=!0);return a&&d++,d});h=()=>p(m)}l.b.length&&of(()=>{ao(s,h),ls(l.b)}),cs(()=>{const d=ht(()=>l.m.map(wh));return()=>{for(const u of d)typeof u=="function"&&u()}}),l.a.length&&cs(()=>{ao(s,h),ls(l.a)})}function ao(r,s){if(r.l.s)for(const l of r.l.s)p(l);s()}function Hf(r){yt===null&&bh(),$r&&yt.l!==null?Gf(yt).m.push(r):cs(()=>{const s=ht(r);if(typeof s=="function")return s})}function Gf(r){var s=r.l;return s.u??={a:[],b:[],m:[]}}const Vf="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Vf);Hh();var Ks=(r,s,l)=>{if(!s.has(r))throw TypeError("Cannot "+l)},U=(r,s,l)=>(Ks(r,s,"read from private field"),l?l.call(r):s.get(r)),X=(r,s,l)=>{if(s.has(r))throw TypeError("Cannot add the same private member more than once");s instanceof WeakSet?s.add(r):s.set(r,l)},It=(r,s,l,h)=>(Ks(r,s,"write to private field"),s.set(r,l),l),ut=(r,s,l)=>(Ks(r,s,"access private method"),l),nt=new Uint8Array(8),Re=new DataView(nt.buffer),oe=r=>[(r%256+256)%256],ft=r=>(Re.setUint16(0,r,!1),[nt[0],nt[1]]),Wf=r=>(Re.setInt16(0,r,!1),[nt[0],nt[1]]),Jo=r=>(Re.setUint32(0,r,!1),[nt[1],nt[2],nt[3]]),G=r=>(Re.setUint32(0,r,!1),[nt[0],nt[1],nt[2],nt[3]]),Yf=r=>(Re.setUint32(0,Math.floor(r/2**32),!1),Re.setUint32(4,r,!1),[nt[0],nt[1],nt[2],nt[3],nt[4],nt[5],nt[6],nt[7]]),Xs=r=>(Re.setInt16(0,2**8*r,!1),[nt[0],nt[1]]),xe=r=>(Re.setInt32(0,2**16*r,!1),[nt[0],nt[1],nt[2],nt[3]]),ss=r=>(Re.setInt32(0,2**30*r,!1),[nt[0],nt[1],nt[2],nt[3]]),be=(r,s=!1)=>{let l=Array(r.length).fill(null).map((h,d)=>r.charCodeAt(d));return s&&l.push(0),l},Ii=r=>r&&r[r.length-1],Rr=(r,s,l=!0)=>{let h=r*s;return l?Math.round(h):h},Qo=r=>{let s=r*(Math.PI/180),l=Math.cos(s),h=Math.sin(s);return[l,h,0,-h,l,0,0,0,1]},qf=Qo(0),tl=r=>[xe(r[0]),xe(r[1]),ss(r[2]),xe(r[3]),xe(r[4]),ss(r[5]),xe(r[6]),xe(r[7]),ss(r[8])],Er=r=>!r||typeof r!="object"?r:Array.isArray(r)?r.map(Er):Object.fromEntries(Object.entries(r).map(([s,l])=>[s,Er(l)])),Mt=(r,s,l)=>({type:r,contents:s&&new Uint8Array(s.flat(10)),children:l}),Dt=(r,s,l,h,d)=>Mt(r,[oe(s),Jo(l),h??[]],d),jf=r=>r?Mt("ftyp",[be("isom"),G(0),be("iso4"),be("hvc1")]):Mt("ftyp",[be("isom"),G(0),be("isom"),be("avc1"),be("mp41")]),oo=r=>({type:"mdat",largeSize:r}),$f=r=>({type:"free",size:r}),as=(r,s)=>Mt("moov",null,[Kf(s,r),...r.map(l=>Xf(l,s))]),Kf=(r,s)=>{let l=Rr(Math.max(0,...s.filter(d=>d.samples.length>0).map(d=>Ii(d.samples).timestamp+Ii(d.samples).duration)),ms),h=Math.max(...s.map(d=>d.id))+1;return Dt("mvhd",0,0,[G(r),G(r),G(ms),G(l),xe(1),Xs(1),Array(10).fill(0),tl(qf),Array(24).fill(0),G(h)])},Xf=(r,s)=>Mt("trak",null,[Zf(r,s),Jf(r,s)]),Zf=(r,s)=>{let l=Ii(r.samples),h=Rr(l?l.timestamp+l.duration:0,ms);return Dt("tkhd",0,3,[G(s),G(s),G(r.id),G(0),G(h),Array(8).fill(0),ft(0),ft(0),Xs(r.info.type==="audio"?1:0),ft(0),tl(Qo(r.info.type==="video"?r.info.rotation:0)),xe(r.info.type==="video"?r.info.width:0),xe(r.info.type==="video"?r.info.height:0)])},Jf=(r,s)=>Mt("mdia",null,[Qf(r,s),td(r.info.type==="video"?"vide":"soun"),ed(r)]),Qf=(r,s)=>{let l=Ii(r.samples),h=Rr(l?l.timestamp+l.duration:0,r.timescale);return Dt("mdhd",0,0,[G(s),G(s),G(r.timescale),G(h),ft(21956),ft(0)])},td=r=>Dt("hdlr",0,0,[be("mhlr"),be(r),G(0),G(0),G(0),be("mp4-muxer-hdlr")]),ed=r=>Mt("minf",null,[r.info.type==="video"?id():rd(),nd(),od(r)]),id=()=>Dt("vmhd",0,1,[ft(0),ft(0),ft(0),ft(0)]),rd=()=>Dt("smhd",0,0,[ft(0),ft(0)]),nd=()=>Mt("dinf",null,[sd()]),sd=()=>Dt("dref",0,0,[G(1)],[ad()]),ad=()=>Dt("url ",0,1),od=r=>Mt("stbl",null,[ld(r),gd(r),md(r),yd(r),wd(r),bd(r)]),ld=r=>Dt("stsd",0,0,[G(1)],[r.info.type==="video"?hd(xd[r.info.codec],r):pd(Ud[r.info.codec],r)]),hd=(r,s)=>Mt(r,[Array(6).fill(0),ft(1),ft(0),ft(0),Array(12).fill(0),ft(s.info.width),ft(s.info.height),G(4718592),G(4718592),G(0),ft(1),Array(32).fill(0),ft(24),Wf(65535)],[Sd[s.info.codec](s)]),fd=r=>r.codecPrivate&&Mt("avcC",[...r.codecPrivate]),dd=r=>r.codecPrivate&&Mt("hvcC",[...r.codecPrivate]),ud=r=>r.codecPrivate&&Mt("vpcC",[...r.codecPrivate]),cd=r=>r.codecPrivate&&Mt("av1C",[...r.codecPrivate]),pd=(r,s)=>Mt(r,[Array(6).fill(0),ft(1),ft(0),ft(0),G(0),ft(s.info.numberOfChannels),ft(16),ft(0),ft(0),xe(s.info.sampleRate)],[Ed[s.info.codec](s)]),_d=r=>Dt("esds",0,0,[G(58753152),oe(32+r.codecPrivate.byteLength),ft(1),oe(0),G(75530368),oe(18+r.codecPrivate.byteLength),oe(64),oe(21),Jo(0),G(130071),G(130071),G(92307584),oe(r.codecPrivate.byteLength),...r.codecPrivate,G(109084800),oe(1),oe(2)]),vd=r=>Mt("dOps",[oe(0),oe(r.info.numberOfChannels),ft(3840),G(r.info.sampleRate),Xs(0),oe(0)]),gd=r=>Dt("stts",0,0,[G(r.timeToSampleTable.length),r.timeToSampleTable.map(s=>[G(s.sampleCount),G(s.sampleDelta)])]),md=r=>{if(r.samples.every(l=>l.type==="key"))return null;let s=[...r.samples.entries()].filter(([,l])=>l.type==="key");return Dt("stss",0,0,[G(s.length),s.map(([l])=>G(l+1))])},yd=r=>Dt("stsc",0,0,[G(r.compactlyCodedChunkTable.length),r.compactlyCodedChunkTable.map(s=>[G(s.firstChunk),G(s.samplesPerChunk),G(1)])]),wd=r=>Dt("stsz",0,0,[G(0),G(r.samples.length),r.samples.map(s=>G(s.size))]),bd=r=>r.finalizedChunks.length>0&&Ii(r.finalizedChunks).offset>=2**32?Dt("co64",0,0,[G(r.finalizedChunks.length),r.finalizedChunks.map(s=>Yf(s.offset))]):Dt("stco",0,0,[G(r.finalizedChunks.length),r.finalizedChunks.map(s=>G(s.offset))]),xd={avc:"avc1",hevc:"hvc1",vp9:"vp09",av1:"av01"},Sd={avc:fd,hevc:dd,vp9:ud,av1:cd},Ud={aac:"mp4a",opus:"Opus"},Ed={aac:_d,opus:vd},Cd=class{constructor(){this.buffer=null}},el=class{constructor(s,l,h){this.onData=s,this.onDone=l,this.options=h}},il=class{constructor(s,l){this.stream=s,this.options=l}},di,Oi,Zs=class{constructor(){this.pos=0,X(this,di,new Uint8Array(8)),X(this,Oi,new DataView(U(this,di).buffer)),this.offsets=new WeakMap}seek(s){this.pos=s}writeU32(s){U(this,Oi).setUint32(0,s,!1),this.write(U(this,di).subarray(0,4))}writeU64(s){U(this,Oi).setUint32(0,Math.floor(s/2**32),!1),U(this,Oi).setUint32(4,s,!1),this.write(U(this,di).subarray(0,8))}writeAscii(s){for(let l=0;l<s.length;l++)U(this,Oi).setUint8(l%8,s.charCodeAt(l)),l%8===7&&this.write(U(this,di));s.length%8!==0&&this.write(U(this,di).subarray(0,s.length%8))}writeBox(s){if(this.offsets.set(s,this.pos),s.contents&&!s.children)this.writeBoxHeader(s,s.size??s.contents.byteLength+8),this.write(s.contents);else{let l=this.pos;if(this.writeBoxHeader(s,0),s.contents&&this.write(s.contents),s.children)for(let u of s.children)u&&this.writeBox(u);let h=this.pos,d=s.size??h-l;this.seek(l),this.writeBoxHeader(s,d),this.seek(h)}}writeBoxHeader(s,l){this.writeU32(s.largeSize?1:l),this.writeAscii(s.type),s.largeSize&&this.writeU64(l)}measureBoxHeader(s){return 8+(s.largeSize?8:0)}patchBox(s){let l=this.pos;this.seek(this.offsets.get(s)),this.writeBox(s),this.seek(l)}measureBox(s){if(s.contents&&!s.children)return this.measureBoxHeader(s)+s.contents.byteLength;{let l=this.measureBoxHeader(s);if(s.contents&&(l+=s.contents.byteLength),s.children)for(let h of s.children)h&&(l+=this.measureBox(h));return l}}};di=new WeakMap;Oi=new WeakMap;var hn,Ui,Or,pr,fn,vs,Bd=class extends Zs{constructor(s){super(),X(this,fn),X(this,hn,void 0),X(this,Ui,new ArrayBuffer(2**16)),X(this,Or,new Uint8Array(U(this,Ui))),X(this,pr,0),It(this,hn,s)}write(s){ut(this,fn,vs).call(this,this.pos+s.byteLength),U(this,Or).set(s,this.pos),this.pos+=s.byteLength,It(this,pr,Math.max(U(this,pr),this.pos))}finalize(){ut(this,fn,vs).call(this,this.pos),U(this,hn).buffer=U(this,Ui).slice(0,Math.max(U(this,pr),this.pos))}};hn=new WeakMap;Ui=new WeakMap;Or=new WeakMap;pr=new WeakMap;fn=new WeakSet;vs=function(r){let s=U(this,Ui).byteLength;for(;s<r;)s*=2;if(s===U(this,Ui).byteLength)return;let l=new ArrayBuffer(s),h=new Uint8Array(l);h.set(U(this,Or),0),It(this,Ui,l),It(this,Or,h)};var _r,ui,rl=class extends Zs{constructor(s){super(),X(this,_r,void 0),X(this,ui,[]),It(this,_r,s)}write(s){U(this,ui).push({data:s.slice(),start:this.pos}),this.pos+=s.byteLength}flush(){if(U(this,ui).length===0)return;let s=[],l=[...U(this,ui)].sort((h,d)=>h.start-d.start);s.push({start:l[0].start,size:l[0].data.byteLength});for(let h=1;h<l.length;h++){let d=s[s.length-1],u=l[h];u.start<=d.start+d.size?d.size=Math.max(d.size,u.start+u.data.byteLength-d.start):s.push({start:u.start,size:u.data.byteLength})}for(let h of s){h.data=new Uint8Array(h.size);for(let d of U(this,ui))h.start<=d.start&&d.start<h.start+h.size&&h.data.set(d.data,d.start-h.start);U(this,_r).onData(h.data,h.start)}U(this,ui).length=0}finalize(){U(this,_r).onDone?.()}};_r=new WeakMap;ui=new WeakMap;var Ad=2**24,Td=2,Cr,ve,te,Un,gs,Js,nl,Qs,sl,Br,En,al=class extends Zs{constructor(r){if(super(),X(this,Un),X(this,Js),X(this,Qs),X(this,Br),X(this,Cr,void 0),X(this,ve,void 0),X(this,te,[]),It(this,Cr,r),It(this,ve,r.options?.chunkSize??Ad),!Number.isInteger(U(this,ve))||U(this,ve)<2**10)throw new Error("Invalid StreamTarget options: chunkSize must be an integer not smaller than 1024.")}write(r){ut(this,Un,gs).call(this,r,this.pos),ut(this,Br,En).call(this),this.pos+=r.byteLength}finalize(){ut(this,Br,En).call(this,!0),U(this,Cr).onDone?.()}};Cr=new WeakMap;ve=new WeakMap;te=new WeakMap;Un=new WeakSet;gs=function(r,s){let l=U(this,te).findIndex(a=>a.start<=s&&s<a.start+U(this,ve));l===-1&&(l=ut(this,Qs,sl).call(this,s));let h=U(this,te)[l],d=s-h.start,u=r.subarray(0,Math.min(U(this,ve)-d,r.byteLength));h.data.set(u,d);let m={start:d,end:d+u.byteLength};if(ut(this,Js,nl).call(this,h,m),h.written[0].start===0&&h.written[0].end===U(this,ve)&&(h.shouldFlush=!0),U(this,te).length>Td){for(let a=0;a<U(this,te).length-1;a++)U(this,te)[a].shouldFlush=!0;ut(this,Br,En).call(this)}u.byteLength<r.byteLength&&ut(this,Un,gs).call(this,r.subarray(u.byteLength),s+u.byteLength)};Js=new WeakSet;nl=function(r,s){let l=0,h=r.written.length-1,d=-1;for(;l<=h;){let u=Math.floor(l+(h-l+1)/2);r.written[u].start<=s.start?(l=u+1,d=u):h=u-1}for(r.written.splice(d+1,0,s),(d===-1||r.written[d].end<s.start)&&d++;d<r.written.length-1&&r.written[d].end>=r.written[d+1].start;)r.written[d].end=Math.max(r.written[d].end,r.written[d+1].end),r.written.splice(d+1,1)};Qs=new WeakSet;sl=function(r){let l={start:Math.floor(r/U(this,ve))*U(this,ve),data:new Uint8Array(U(this,ve)),written:[],shouldFlush:!1};return U(this,te).push(l),U(this,te).sort((h,d)=>h.start-d.start),U(this,te).indexOf(l)};Br=new WeakSet;En=function(r=!1){for(let s=0;s<U(this,te).length;s++){let l=U(this,te)[s];if(!(!l.shouldFlush&&!r)){for(let h of l.written)U(this,Cr).onData(l.data.subarray(h.start,h.end),l.start+h.start);U(this,te).splice(s--,1)}}};var kd=class extends al{constructor(s){super(new el((l,h)=>s.stream.write({type:"write",data:l,position:h}),void 0,{chunkSize:s.options?.chunkSize}))}},ms=1e3,Id=["avc","hevc","vp9","av1"],zd=["aac","opus"],Fd=2082844800,Pd=.5,Ld=["strict","offset"],Z,at,Cn,Jt,Ke,Xe,vr,Ar,Tr,ys,ol,ws,ll,ta,hl,bs,fl,ea,dl,dn,xs,ia,ul,kr,Bn,Nr,Dn,un,Ss,Md=class{constructor(s){if(X(this,ys),X(this,ws),X(this,ta),X(this,bs),X(this,ea),X(this,dn),X(this,ia),X(this,kr),X(this,Nr),X(this,un),X(this,Z,void 0),X(this,at,void 0),X(this,Cn,void 0),X(this,Jt,void 0),X(this,Ke,null),X(this,Xe,null),X(this,vr,Math.floor(Date.now()/1e3)+Fd),X(this,Ar,[]),X(this,Tr,!1),ut(this,ys,ol).call(this,s),s.video=Er(s.video),s.audio=Er(s.audio),s.fastStart=Er(s.fastStart),this.target=s.target,It(this,Z,{firstTimestampBehavior:"strict",...s}),s.target instanceof Cd)It(this,at,new Bd(s.target));else if(s.target instanceof el)It(this,at,s.target.options?.chunked?new al(s.target):new rl(s.target));else if(s.target instanceof il)It(this,at,new kd(s.target));else throw new Error(`Invalid target: ${s.target}`);ut(this,ws,ll).call(this),ut(this,bs,fl).call(this)}addVideoChunk(s,l,h){let d=new Uint8Array(s.byteLength);s.copyTo(d),this.addVideoChunkRaw(d,s.type,h??s.timestamp,s.duration,l)}addVideoChunkRaw(s,l,h,d,u){if(ut(this,un,Ss).call(this),!U(this,Z).video)throw new Error("No video track declared.");if(typeof U(this,Z).fastStart=="object"&&U(this,Ke).samples.length===U(this,Z).fastStart.expectedVideoChunks)throw new Error(`Cannot add more video chunks than specified in 'fastStart' (${U(this,Z).fastStart.expectedVideoChunks}).`);ut(this,dn,xs).call(this,U(this,Ke),s,l,h,d,u)}addAudioChunk(s,l,h){let d=new Uint8Array(s.byteLength);s.copyTo(d),this.addAudioChunkRaw(d,s.type,h??s.timestamp,s.duration,l)}addAudioChunkRaw(s,l,h,d,u){if(ut(this,un,Ss).call(this),!U(this,Z).audio)throw new Error("No audio track declared.");if(typeof U(this,Z).fastStart=="object"&&U(this,Xe).samples.length===U(this,Z).fastStart.expectedAudioChunks)throw new Error(`Cannot add more audio chunks than specified in 'fastStart' (${U(this,Z).fastStart.expectedAudioChunks}).`);ut(this,dn,xs).call(this,U(this,Xe),s,l,h,d,u)}finalize(){if(U(this,Tr))throw new Error("Cannot finalize a muxer more than once.");U(this,Ke)&&ut(this,kr,Bn).call(this,U(this,Ke)),U(this,Xe)&&ut(this,kr,Bn).call(this,U(this,Xe));let s=[U(this,Ke),U(this,Xe)].filter(Boolean);if(U(this,Z).fastStart==="in-memory"){let l;for(let d=0;d<2;d++){let u=as(s,U(this,vr)),m=U(this,at).measureBox(u);l=U(this,at).measureBox(U(this,Jt));let a=U(this,at).pos+m+l;for(let b of U(this,Ar)){b.offset=a;for(let w of b.sampleData)a+=w.byteLength,l+=w.byteLength}if(a<2**32)break;l>=2**32&&(U(this,Jt).largeSize=!0)}let h=as(s,U(this,vr));U(this,at).writeBox(h),U(this,Jt).size=l,U(this,at).writeBox(U(this,Jt));for(let d of U(this,Ar)){for(let u of d.sampleData)U(this,at).write(u);d.sampleData=null}}else{let l=U(this,at).offsets.get(U(this,Jt)),h=U(this,at).pos-l;U(this,Jt).size=h,U(this,Jt).largeSize=h>=2**32,U(this,at).patchBox(U(this,Jt));let d=as(s,U(this,vr));if(typeof U(this,Z).fastStart=="object"){U(this,at).seek(U(this,Cn)),U(this,at).writeBox(d);let u=l-U(this,at).pos;U(this,at).writeBox($f(u))}else U(this,at).writeBox(d)}ut(this,Nr,Dn).call(this),U(this,at).finalize(),It(this,Tr,!0)}};Z=new WeakMap;at=new WeakMap;Cn=new WeakMap;Jt=new WeakMap;Ke=new WeakMap;Xe=new WeakMap;vr=new WeakMap;Ar=new WeakMap;Tr=new WeakMap;ys=new WeakSet;ol=function(r){if(r.video){if(!Id.includes(r.video.codec))throw new Error(`Unsupported video codec: ${r.video.codec}`);if(r.video.rotation!==void 0&&![0,90,180,270].includes(r.video.rotation))throw new Error(`Invalid video rotation: ${r.video.rotation}. Has to be 0, 90, 180 or 270.`)}if(r.audio&&!zd.includes(r.audio.codec))throw new Error(`Unsupported audio codec: ${r.audio.codec}`);if(r.firstTimestampBehavior&&!Ld.includes(r.firstTimestampBehavior))throw new Error(`Invalid first timestamp behavior: ${r.firstTimestampBehavior}`);if(typeof r.fastStart=="object"){if(r.video&&r.fastStart.expectedVideoChunks===void 0)throw new Error("'fastStart' is an object but is missing property 'expectedVideoChunks'.");if(r.audio&&r.fastStart.expectedAudioChunks===void 0)throw new Error("'fastStart' is an object but is missing property 'expectedAudioChunks'.")}else if(![!1,"in-memory"].includes(r.fastStart))throw new Error("'fastStart' option must be false, 'in-memory' or an object.")};ws=new WeakSet;ll=function(){let r=U(this,Z).video?.codec==="hevc";if(U(this,at).writeBox(jf(r)),It(this,Cn,U(this,at).pos),U(this,Z).fastStart==="in-memory")It(this,Jt,oo(!1));else{if(typeof U(this,Z).fastStart=="object"){let s=ut(this,ta,hl).call(this);U(this,at).seek(U(this,at).pos+s)}It(this,Jt,oo(!0)),U(this,at).writeBox(U(this,Jt))}ut(this,Nr,Dn).call(this)};ta=new WeakSet;hl=function(){if(typeof U(this,Z).fastStart!="object")return;let r=0,s=[U(this,Z).fastStart.expectedVideoChunks,U(this,Z).fastStart.expectedAudioChunks];for(let l of s)l&&(r+=8*Math.ceil(2/3*l),r+=4*l,r+=12*Math.ceil(2/3*l),r+=4*l,r+=8*l);return r+=4096,r};bs=new WeakSet;fl=function(){if(U(this,Z).video&&It(this,Ke,{id:1,info:{type:"video",codec:U(this,Z).video.codec,width:U(this,Z).video.width,height:U(this,Z).video.height,rotation:U(this,Z).video.rotation??0},timescale:720,codecPrivate:new Uint8Array(0),samples:[],finalizedChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]}),U(this,Z).audio){let r=ut(this,ea,dl).call(this,2,U(this,Z).audio.sampleRate,U(this,Z).audio.numberOfChannels);It(this,Xe,{id:U(this,Z).video?2:1,info:{type:"audio",codec:U(this,Z).audio.codec,numberOfChannels:U(this,Z).audio.numberOfChannels,sampleRate:U(this,Z).audio.sampleRate},timescale:U(this,Z).audio.sampleRate,codecPrivate:r,samples:[],finalizedChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]})}};ea=new WeakSet;dl=function(r,s,l){let d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350].indexOf(s),u=l,m="";m+=r.toString(2).padStart(5,"0"),m+=d.toString(2).padStart(4,"0"),d===15&&(m+=s.toString(2).padStart(24,"0")),m+=u.toString(2).padStart(4,"0");let a=Math.ceil(m.length/8)*8;m=m.padEnd(a,"0");let b=new Uint8Array(m.length/8);for(let w=0;w<m.length;w+=8)b[w/8]=parseInt(m.slice(w,w+8),2);return b};dn=new WeakSet;xs=function(r,s,l,h,d,u){let m=h/1e6,a=d/1e6;if(r.firstTimestamp===void 0&&(r.firstTimestamp=m),m=ut(this,ia,ul).call(this,m,r),r.lastTimestamp=m,(!r.currentChunk||m-r.currentChunk.startTimestamp>=Pd)&&(r.currentChunk&&ut(this,kr,Bn).call(this,r),r.currentChunk={startTimestamp:m,sampleData:[],sampleCount:0}),r.currentChunk.sampleData.push(s),r.currentChunk.sampleCount++,u?.decoderConfig?.description&&(r.codecPrivate=new Uint8Array(u.decoderConfig.description)),r.samples.push({timestamp:m,duration:a,size:s.byteLength,type:l}),r.lastTimescaleUnits!==null){let b=Rr(m,r.timescale,!1),w=Math.round(b-r.lastTimescaleUnits);r.lastTimescaleUnits+=w;let B=Ii(r.timeToSampleTable);B.sampleCount===1?(B.sampleDelta=w,B.sampleCount++):B.sampleDelta===w?B.sampleCount++:(B.sampleCount--,r.timeToSampleTable.push({sampleCount:2,sampleDelta:w}))}else r.lastTimescaleUnits=0,r.timeToSampleTable.push({sampleCount:1,sampleDelta:Rr(a,r.timescale)})};ia=new WeakSet;ul=function(r,s){if(U(this,Z).firstTimestampBehavior==="strict"&&s.lastTimestamp===-1&&r!==0)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received ${r}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
`);if(U(this,Z).firstTimestampBehavior==="offset"&&(r-=s.firstTimestamp),r<s.lastTimestamp)throw new Error(`Timestamps must be monotonically increasing (went from ${s.lastTimestamp*1e6} to ${r*1e6}).`);return r};kr=new WeakSet;Bn=function(r){if(r.currentChunk){if((r.compactlyCodedChunkTable.length===0||Ii(r.compactlyCodedChunkTable).samplesPerChunk!==r.currentChunk.sampleCount)&&r.compactlyCodedChunkTable.push({firstChunk:r.finalizedChunks.length+1,samplesPerChunk:r.currentChunk.sampleCount}),r.finalizedChunks.push(r.currentChunk),U(this,Ar).push(r.currentChunk),U(this,Z).fastStart==="in-memory"){r.currentChunk.offset=0;return}r.currentChunk.offset=U(this,at).pos;for(let s of r.currentChunk.sampleData)U(this,at).write(s);r.currentChunk.sampleData=null,ut(this,Nr,Dn).call(this)}};Nr=new WeakSet;Dn=function(){U(this,at)instanceof rl&&U(this,at).flush()};un=new WeakSet;Ss=function(){if(U(this,Tr))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};var ra=(r,s,l)=>{if(!s.has(r))throw TypeError("Cannot "+l)},_=(r,s,l)=>(ra(r,s,"read from private field"),l?l.call(r):s.get(r)),F=(r,s,l)=>{if(s.has(r))throw TypeError("Cannot add the same private member more than once");s instanceof WeakSet?s.add(r):s.set(r,l)},V=(r,s,l,h)=>(ra(r,s,"write to private field"),s.set(r,l),l),D=(r,s,l)=>(ra(r,s,"access private method"),l),cl=class{constructor(r){this.value=r}},na=class{constructor(r){this.value=r}},pl=r=>r<256?1:r<65536?2:r<1<<24?3:r<2**32?4:r<2**40?5:6,Dd=r=>{if(r<127)return 1;if(r<16383)return 2;if(r<(1<<21)-1)return 3;if(r<(1<<28)-1)return 4;if(r<2**35-1)return 5;if(r<2**42-1)return 6;throw new Error("EBML VINT size not supported "+r)},Di=(r,s,l)=>{let h=0;for(let d=s;d<l;d++){let u=Math.floor(d/8),m=r[u],a=7-(d&7),b=(m&1<<a)>>a;h<<=1,h|=b}return h},Rd=(r,s,l,h)=>{for(let d=s;d<l;d++){let u=Math.floor(d/8),m=r[u],a=7-(d&7);m&=~(1<<a),m|=(h&1<<l-d-1)>>l-d-1<<a,r[u]=m}},Rn=class{},Od=class extends Rn{constructor(){super(...arguments),this.buffer=null}},_l=class extends Rn{constructor(r){if(super(),this.options=r,typeof r!="object")throw new TypeError("StreamTarget requires an options object to be passed to its constructor.");if(r.onData){if(typeof r.onData!="function")throw new TypeError("options.onData, when provided, must be a function.");if(r.onData.length<2)throw new TypeError("options.onData, when provided, must be a function that takes in at least two arguments (data and position). Ignoring the position argument, which specifies the byte offset at which the data is to be written, can lead to broken outputs.")}if(r.onHeader&&typeof r.onHeader!="function")throw new TypeError("options.onHeader, when provided, must be a function.");if(r.onCluster&&typeof r.onCluster!="function")throw new TypeError("options.onCluster, when provided, must be a function.");if(r.chunked!==void 0&&typeof r.chunked!="boolean")throw new TypeError("options.chunked, when provided, must be a boolean.");if(r.chunkSize!==void 0&&(!Number.isInteger(r.chunkSize)||r.chunkSize<1024))throw new TypeError("options.chunkSize, when provided, must be an integer and not smaller than 1024.")}},vl=class extends Rn{constructor(r,s){if(super(),this.stream=r,this.options=s,!(r instanceof FileSystemWritableFileStream))throw new TypeError("FileSystemWritableFileStreamTarget requires a FileSystemWritableFileStream instance.");if(s!==void 0&&typeof s!="object")throw new TypeError("FileSystemWritableFileStreamTarget's options, when provided, must be an object.");if(s&&s.chunkSize!==void 0&&(!Number.isInteger(s.chunkSize)||s.chunkSize<=0))throw new TypeError("options.chunkSize, when provided, must be a positive integer")}},ii,tt,Us,gl,Es,ml,Cs,yl,cn,Bs,As,wl,bl=class{constructor(){F(this,Us),F(this,Es),F(this,Cs),F(this,cn),F(this,As),this.pos=0,F(this,ii,new Uint8Array(8)),F(this,tt,new DataView(_(this,ii).buffer)),this.offsets=new WeakMap,this.dataOffsets=new WeakMap}seek(r){this.pos=r}writeEBMLVarInt(r,s=Dd(r)){let l=0;switch(s){case 1:_(this,tt).setUint8(l++,128|r);break;case 2:_(this,tt).setUint8(l++,64|r>>8),_(this,tt).setUint8(l++,r);break;case 3:_(this,tt).setUint8(l++,32|r>>16),_(this,tt).setUint8(l++,r>>8),_(this,tt).setUint8(l++,r);break;case 4:_(this,tt).setUint8(l++,16|r>>24),_(this,tt).setUint8(l++,r>>16),_(this,tt).setUint8(l++,r>>8),_(this,tt).setUint8(l++,r);break;case 5:_(this,tt).setUint8(l++,8|r/2**32&7),_(this,tt).setUint8(l++,r>>24),_(this,tt).setUint8(l++,r>>16),_(this,tt).setUint8(l++,r>>8),_(this,tt).setUint8(l++,r);break;case 6:_(this,tt).setUint8(l++,4|r/2**40&3),_(this,tt).setUint8(l++,r/2**32|0),_(this,tt).setUint8(l++,r>>24),_(this,tt).setUint8(l++,r>>16),_(this,tt).setUint8(l++,r>>8),_(this,tt).setUint8(l++,r);break;default:throw new Error("Bad EBML VINT size "+s)}this.write(_(this,ii).subarray(0,l))}writeEBML(r){if(r!==null)if(r instanceof Uint8Array)this.write(r);else if(Array.isArray(r))for(let s of r)this.writeEBML(s);else if(this.offsets.set(r,this.pos),D(this,cn,Bs).call(this,r.id),Array.isArray(r.data)){let s=this.pos,l=r.size===-1?1:r.size??4;r.size===-1?D(this,Us,gl).call(this,255):this.seek(this.pos+l);let h=this.pos;if(this.dataOffsets.set(r,h),this.writeEBML(r.data),r.size!==-1){let d=this.pos-h,u=this.pos;this.seek(s),this.writeEBMLVarInt(d,l),this.seek(u)}}else if(typeof r.data=="number"){let s=r.size??pl(r.data);this.writeEBMLVarInt(s),D(this,cn,Bs).call(this,r.data,s)}else typeof r.data=="string"?(this.writeEBMLVarInt(r.data.length),D(this,As,wl).call(this,r.data)):r.data instanceof Uint8Array?(this.writeEBMLVarInt(r.data.byteLength,r.size),this.write(r.data)):r.data instanceof cl?(this.writeEBMLVarInt(4),D(this,Es,ml).call(this,r.data.value)):r.data instanceof na&&(this.writeEBMLVarInt(8),D(this,Cs,yl).call(this,r.data.value))}};ii=new WeakMap;tt=new WeakMap;Us=new WeakSet;gl=function(r){_(this,tt).setUint8(0,r),this.write(_(this,ii).subarray(0,1))};Es=new WeakSet;ml=function(r){_(this,tt).setFloat32(0,r,!1),this.write(_(this,ii).subarray(0,4))};Cs=new WeakSet;yl=function(r){_(this,tt).setFloat64(0,r,!1),this.write(_(this,ii))};cn=new WeakSet;Bs=function(r,s=pl(r)){let l=0;switch(s){case 6:_(this,tt).setUint8(l++,r/2**40|0);case 5:_(this,tt).setUint8(l++,r/2**32|0);case 4:_(this,tt).setUint8(l++,r>>24);case 3:_(this,tt).setUint8(l++,r>>16);case 2:_(this,tt).setUint8(l++,r>>8);case 1:_(this,tt).setUint8(l++,r);break;default:throw new Error("Bad UINT size "+s)}this.write(_(this,ii).subarray(0,l))};As=new WeakSet;wl=function(r){this.write(new Uint8Array(r.split("").map(s=>s.charCodeAt(0))))};var pn,Ei,Hr,_n,Ts,Nd=class extends bl{constructor(r){super(),F(this,_n),F(this,pn,void 0),F(this,Ei,new ArrayBuffer(2**16)),F(this,Hr,new Uint8Array(_(this,Ei))),V(this,pn,r)}write(r){D(this,_n,Ts).call(this,this.pos+r.byteLength),_(this,Hr).set(r,this.pos),this.pos+=r.byteLength}finalize(){D(this,_n,Ts).call(this,this.pos),_(this,pn).buffer=_(this,Ei).slice(0,this.pos)}};pn=new WeakMap;Ei=new WeakMap;Hr=new WeakMap;_n=new WeakSet;Ts=function(r){let s=_(this,Ei).byteLength;for(;s<r;)s*=2;if(s===_(this,Ei).byteLength)return;let l=new ArrayBuffer(s),h=new Uint8Array(l);h.set(_(this,Hr),0),V(this,Ei,l),V(this,Hr,h)};var Ni,me,ye,ci,Jr=class extends bl{constructor(r){super(),this.target=r,F(this,Ni,!1),F(this,me,void 0),F(this,ye,void 0),F(this,ci,void 0)}write(r){if(!_(this,Ni))return;let s=this.pos;if(s<_(this,ye)){if(s+r.byteLength<=_(this,ye))return;r=r.subarray(_(this,ye)-s),s=0}let l=s+r.byteLength-_(this,ye),h=_(this,me).byteLength;for(;h<l;)h*=2;if(h!==_(this,me).byteLength){let d=new Uint8Array(h);d.set(_(this,me),0),V(this,me,d)}_(this,me).set(r,s-_(this,ye)),V(this,ci,Math.max(_(this,ci),s+r.byteLength))}startTrackingWrites(){V(this,Ni,!0),V(this,me,new Uint8Array(2**10)),V(this,ye,this.pos),V(this,ci,this.pos)}getTrackedWrites(){if(!_(this,Ni))throw new Error("Can't get tracked writes since nothing was tracked.");let s={data:_(this,me).subarray(0,_(this,ci)-_(this,ye)),start:_(this,ye),end:_(this,ci)};return V(this,me,void 0),V(this,Ni,!1),s}};Ni=new WeakMap;me=new WeakMap;ye=new WeakMap;ci=new WeakMap;var Hd=2**24,Gd=2,pi,qi,Ir,gr,Me,ee,An,ks,sa,xl,aa,Sl,zr,Tn,oa=class extends Jr{constructor(r,s){super(r),F(this,An),F(this,sa),F(this,aa),F(this,zr),F(this,pi,[]),F(this,qi,0),F(this,Ir,void 0),F(this,gr,void 0),F(this,Me,void 0),F(this,ee,[]),V(this,Ir,s),V(this,gr,r.options?.chunked??!1),V(this,Me,r.options?.chunkSize??Hd)}write(r){super.write(r),_(this,pi).push({data:r.slice(),start:this.pos}),this.pos+=r.byteLength}flush(){if(_(this,pi).length===0)return;let r=[],s=[..._(this,pi)].sort((l,h)=>l.start-h.start);r.push({start:s[0].start,size:s[0].data.byteLength});for(let l=1;l<s.length;l++){let h=r[r.length-1],d=s[l];d.start<=h.start+h.size?h.size=Math.max(h.size,d.start+d.data.byteLength-h.start):r.push({start:d.start,size:d.data.byteLength})}for(let l of r){l.data=new Uint8Array(l.size);for(let h of _(this,pi))l.start<=h.start&&h.start<l.start+l.size&&l.data.set(h.data,h.start-l.start);if(_(this,gr))D(this,An,ks).call(this,l.data,l.start),D(this,zr,Tn).call(this);else{if(_(this,Ir)&&l.start<_(this,qi))throw new Error("Internal error: Monotonicity violation.");this.target.options.onData?.(l.data,l.start),V(this,qi,l.start+l.data.byteLength)}}_(this,pi).length=0}finalize(){_(this,gr)&&D(this,zr,Tn).call(this,!0)}};pi=new WeakMap;qi=new WeakMap;Ir=new WeakMap;gr=new WeakMap;Me=new WeakMap;ee=new WeakMap;An=new WeakSet;ks=function(r,s){let l=_(this,ee).findIndex(a=>a.start<=s&&s<a.start+_(this,Me));l===-1&&(l=D(this,aa,Sl).call(this,s));let h=_(this,ee)[l],d=s-h.start,u=r.subarray(0,Math.min(_(this,Me)-d,r.byteLength));h.data.set(u,d);let m={start:d,end:d+u.byteLength};if(D(this,sa,xl).call(this,h,m),h.written[0].start===0&&h.written[0].end===_(this,Me)&&(h.shouldFlush=!0),_(this,ee).length>Gd){for(let a=0;a<_(this,ee).length-1;a++)_(this,ee)[a].shouldFlush=!0;D(this,zr,Tn).call(this)}u.byteLength<r.byteLength&&D(this,An,ks).call(this,r.subarray(u.byteLength),s+u.byteLength)};sa=new WeakSet;xl=function(r,s){let l=0,h=r.written.length-1,d=-1;for(;l<=h;){let u=Math.floor(l+(h-l+1)/2);r.written[u].start<=s.start?(l=u+1,d=u):h=u-1}for(r.written.splice(d+1,0,s),(d===-1||r.written[d].end<s.start)&&d++;d<r.written.length-1&&r.written[d].end>=r.written[d+1].start;)r.written[d].end=Math.max(r.written[d].end,r.written[d+1].end),r.written.splice(d+1,1)};aa=new WeakSet;Sl=function(r){let l={start:Math.floor(r/_(this,Me))*_(this,Me),data:new Uint8Array(_(this,Me)),written:[],shouldFlush:!1};return _(this,ee).push(l),_(this,ee).sort((h,d)=>h.start-d.start),_(this,ee).indexOf(l)};zr=new WeakSet;Tn=function(r=!1){for(let s=0;s<_(this,ee).length;s++){let l=_(this,ee)[s];if(!(!l.shouldFlush&&!r)){for(let h of l.written){if(_(this,Ir)&&l.start+h.start<_(this,qi))throw new Error("Internal error: Monotonicity violation.");this.target.options.onData?.(l.data.subarray(h.start,h.end),l.start+h.start),V(this,qi,l.start+h.end)}_(this,ee).splice(s--,1)}}};var Vd=class extends oa{constructor(r,s){super(new _l({onData:(l,h)=>r.stream.write({type:"write",data:l,position:h}),chunked:!0,chunkSize:r.options?.chunkSize}),s)}},rr=1,Gr=2,kn=3,Wd=1,Yd=2,qd=17,jd=2**15,Fr=2**13,lo="https://github.com/Vanilagy/webm-muxer",Ul=6,El=5,$d=["strict","offset","permissive"],H,R,Vr,Wr,Fe,nr,Gi,Ci,sr,ri,ji,$i,Se,Qr,Ki,je,$e,_i,Pr,Lr,Xi,Zi,In,Yr,Mr,Is,Cl,zs,Bl,la,Al,ha,Tl,fa,kl,da,Il,ua,zl,On,ca,Nn,pa,_a,Fl,vi,Vi,gi,Wi,Fs,Pl,Ps,Ll,mr,vn,yr,gn,va,Ml,we,ze,Ji,qr,Dr,zn,ga,Dl,Fn,ma,wr,mn,Kd=class{constructor(r){F(this,Is),F(this,zs),F(this,la),F(this,ha),F(this,fa),F(this,da),F(this,ua),F(this,On),F(this,Nn),F(this,_a),F(this,vi),F(this,gi),F(this,Fs),F(this,Ps),F(this,mr),F(this,yr),F(this,va),F(this,we),F(this,Ji),F(this,Dr),F(this,ga),F(this,Fn),F(this,wr),F(this,H,void 0),F(this,R,void 0),F(this,Vr,void 0),F(this,Wr,void 0),F(this,Fe,void 0),F(this,nr,void 0),F(this,Gi,void 0),F(this,Ci,void 0),F(this,sr,void 0),F(this,ri,void 0),F(this,ji,void 0),F(this,$i,void 0),F(this,Se,void 0),F(this,Qr,void 0),F(this,Ki,0),F(this,je,[]),F(this,$e,[]),F(this,_i,[]),F(this,Pr,void 0),F(this,Lr,void 0),F(this,Xi,-1),F(this,Zi,-1),F(this,In,-1),F(this,Yr,void 0),F(this,Mr,!1),D(this,Is,Cl).call(this,r),V(this,H,{type:"webm",firstTimestampBehavior:"strict",...r}),this.target=r.target;let s=!!_(this,H).streaming;if(r.target instanceof Od)V(this,R,new Nd(r.target));else if(r.target instanceof _l)V(this,R,new oa(r.target,s));else if(r.target instanceof vl)V(this,R,new Vd(r.target,s));else throw new Error(`Invalid target: ${r.target}`);D(this,zs,Bl).call(this)}addVideoChunk(r,s,l){if(!(r instanceof EncodedVideoChunk))throw new TypeError("addVideoChunk's first argument (chunk) must be of type EncodedVideoChunk.");if(s&&typeof s!="object")throw new TypeError("addVideoChunk's second argument (meta), when provided, must be an object.");if(l!==void 0&&(!Number.isFinite(l)||l<0))throw new TypeError("addVideoChunk's third argument (timestamp), when provided, must be a non-negative real number.");let h=new Uint8Array(r.byteLength);r.copyTo(h),this.addVideoChunkRaw(h,r.type,l??r.timestamp,s)}addVideoChunkRaw(r,s,l,h){if(!(r instanceof Uint8Array))throw new TypeError("addVideoChunkRaw's first argument (data) must be an instance of Uint8Array.");if(s!=="key"&&s!=="delta")throw new TypeError("addVideoChunkRaw's second argument (type) must be either 'key' or 'delta'.");if(!Number.isFinite(l)||l<0)throw new TypeError("addVideoChunkRaw's third argument (timestamp) must be a non-negative real number.");if(h&&typeof h!="object")throw new TypeError("addVideoChunkRaw's fourth argument (meta), when provided, must be an object.");if(D(this,wr,mn).call(this),!_(this,H).video)throw new Error("No video track declared.");_(this,Pr)===void 0&&V(this,Pr,l),h&&D(this,Fs,Pl).call(this,h);let d=D(this,yr,gn).call(this,r,s,l,rr);for(_(this,H).video.codec==="V_VP9"&&D(this,Ps,Ll).call(this,d),V(this,Xi,d.timestamp);_(this,$e).length>0&&_(this,$e)[0].timestamp<=d.timestamp;){let u=_(this,$e).shift();D(this,we,ze).call(this,u,!1)}!_(this,H).audio||d.timestamp<=_(this,Zi)?D(this,we,ze).call(this,d,!0):_(this,je).push(d),D(this,mr,vn).call(this),D(this,vi,Vi).call(this)}addAudioChunk(r,s,l){if(!(r instanceof EncodedAudioChunk))throw new TypeError("addAudioChunk's first argument (chunk) must be of type EncodedAudioChunk.");if(s&&typeof s!="object")throw new TypeError("addAudioChunk's second argument (meta), when provided, must be an object.");if(l!==void 0&&(!Number.isFinite(l)||l<0))throw new TypeError("addAudioChunk's third argument (timestamp), when provided, must be a non-negative real number.");let h=new Uint8Array(r.byteLength);r.copyTo(h),this.addAudioChunkRaw(h,r.type,l??r.timestamp,s)}addAudioChunkRaw(r,s,l,h){if(!(r instanceof Uint8Array))throw new TypeError("addAudioChunkRaw's first argument (data) must be an instance of Uint8Array.");if(s!=="key"&&s!=="delta")throw new TypeError("addAudioChunkRaw's second argument (type) must be either 'key' or 'delta'.");if(!Number.isFinite(l)||l<0)throw new TypeError("addAudioChunkRaw's third argument (timestamp) must be a non-negative real number.");if(h&&typeof h!="object")throw new TypeError("addAudioChunkRaw's fourth argument (meta), when provided, must be an object.");if(D(this,wr,mn).call(this),!_(this,H).audio)throw new Error("No audio track declared.");_(this,Lr)===void 0&&V(this,Lr,l),h?.decoderConfig&&(_(this,H).streaming?V(this,ri,D(this,Ji,qr).call(this,h.decoderConfig.description)):D(this,Dr,zn).call(this,_(this,ri),h.decoderConfig.description));let d=D(this,yr,gn).call(this,r,s,l,Gr);for(V(this,Zi,d.timestamp);_(this,je).length>0&&_(this,je)[0].timestamp<=d.timestamp;){let u=_(this,je).shift();D(this,we,ze).call(this,u,!0)}!_(this,H).video||d.timestamp<=_(this,Xi)?D(this,we,ze).call(this,d,!_(this,H).video):_(this,$e).push(d),D(this,mr,vn).call(this),D(this,vi,Vi).call(this)}addSubtitleChunk(r,s,l){if(typeof r!="object"||!r)throw new TypeError("addSubtitleChunk's first argument (chunk) must be an object.");if(!(r.body instanceof Uint8Array))throw new TypeError("body must be an instance of Uint8Array.");if(!Number.isFinite(r.timestamp)||r.timestamp<0)throw new TypeError("timestamp must be a non-negative real number.");if(!Number.isFinite(r.duration)||r.duration<0)throw new TypeError("duration must be a non-negative real number.");if(r.additions&&!(r.additions instanceof Uint8Array))throw new TypeError("additions, when present, must be an instance of Uint8Array.");if(typeof s!="object")throw new TypeError("addSubtitleChunk's second argument (meta) must be an object.");if(D(this,wr,mn).call(this),!_(this,H).subtitles)throw new Error("No subtitle track declared.");s?.decoderConfig&&(_(this,H).streaming?V(this,ji,D(this,Ji,qr).call(this,s.decoderConfig.description)):D(this,Dr,zn).call(this,_(this,ji),s.decoderConfig.description));let h=D(this,yr,gn).call(this,r.body,"key",l??r.timestamp,kn,r.duration,r.additions);V(this,In,h.timestamp),_(this,_i).push(h),D(this,mr,vn).call(this),D(this,vi,Vi).call(this)}finalize(){if(_(this,Mr))throw new Error("Cannot finalize a muxer more than once.");for(;_(this,je).length>0;)D(this,we,ze).call(this,_(this,je).shift(),!0);for(;_(this,$e).length>0;)D(this,we,ze).call(this,_(this,$e).shift(),!0);for(;_(this,_i).length>0&&_(this,_i)[0].timestamp<=_(this,Ki);)D(this,we,ze).call(this,_(this,_i).shift(),!1);if(_(this,Se)&&D(this,Fn,ma).call(this),_(this,R).writeEBML(_(this,$i)),!_(this,H).streaming){let r=_(this,R).pos,s=_(this,R).pos-_(this,gi,Wi);_(this,R).seek(_(this,R).offsets.get(_(this,Vr))+4),_(this,R).writeEBMLVarInt(s,Ul),_(this,Gi).data=new na(_(this,Ki)),_(this,R).seek(_(this,R).offsets.get(_(this,Gi))),_(this,R).writeEBML(_(this,Gi)),_(this,Fe).data[0].data[1].data=_(this,R).offsets.get(_(this,$i))-_(this,gi,Wi),_(this,Fe).data[1].data[1].data=_(this,R).offsets.get(_(this,Wr))-_(this,gi,Wi),_(this,Fe).data[2].data[1].data=_(this,R).offsets.get(_(this,nr))-_(this,gi,Wi),_(this,R).seek(_(this,R).offsets.get(_(this,Fe))),_(this,R).writeEBML(_(this,Fe)),_(this,R).seek(r)}D(this,vi,Vi).call(this),_(this,R).finalize(),V(this,Mr,!0)}};H=new WeakMap;R=new WeakMap;Vr=new WeakMap;Wr=new WeakMap;Fe=new WeakMap;nr=new WeakMap;Gi=new WeakMap;Ci=new WeakMap;sr=new WeakMap;ri=new WeakMap;ji=new WeakMap;$i=new WeakMap;Se=new WeakMap;Qr=new WeakMap;Ki=new WeakMap;je=new WeakMap;$e=new WeakMap;_i=new WeakMap;Pr=new WeakMap;Lr=new WeakMap;Xi=new WeakMap;Zi=new WeakMap;In=new WeakMap;Yr=new WeakMap;Mr=new WeakMap;Is=new WeakSet;Cl=function(r){if(typeof r!="object")throw new TypeError("The muxer requires an options object to be passed to its constructor.");if(!(r.target instanceof Rn))throw new TypeError("The target must be provided and an instance of Target.");if(r.video){if(typeof r.video.codec!="string")throw new TypeError(`Invalid video codec: ${r.video.codec}. Must be a string.`);if(!Number.isInteger(r.video.width)||r.video.width<=0)throw new TypeError(`Invalid video width: ${r.video.width}. Must be a positive integer.`);if(!Number.isInteger(r.video.height)||r.video.height<=0)throw new TypeError(`Invalid video height: ${r.video.height}. Must be a positive integer.`);if(r.video.frameRate!==void 0&&(!Number.isFinite(r.video.frameRate)||r.video.frameRate<=0))throw new TypeError(`Invalid video frame rate: ${r.video.frameRate}. Must be a positive number.`);if(r.video.alpha!==void 0&&typeof r.video.alpha!="boolean")throw new TypeError(`Invalid video alpha: ${r.video.alpha}. Must be a boolean.`)}if(r.audio){if(typeof r.audio.codec!="string")throw new TypeError(`Invalid audio codec: ${r.audio.codec}. Must be a string.`);if(!Number.isInteger(r.audio.numberOfChannels)||r.audio.numberOfChannels<=0)throw new TypeError(`Invalid number of audio channels: ${r.audio.numberOfChannels}. Must be a positive integer.`);if(!Number.isInteger(r.audio.sampleRate)||r.audio.sampleRate<=0)throw new TypeError(`Invalid audio sample rate: ${r.audio.sampleRate}. Must be a positive integer.`);if(r.audio.bitDepth!==void 0&&(!Number.isInteger(r.audio.bitDepth)||r.audio.bitDepth<=0))throw new TypeError(`Invalid audio bit depth: ${r.audio.bitDepth}. Must be a positive integer.`)}if(r.subtitles&&typeof r.subtitles.codec!="string")throw new TypeError(`Invalid subtitles codec: ${r.subtitles.codec}. Must be a string.`);if(r.type!==void 0&&!["webm","matroska"].includes(r.type))throw new TypeError(`Invalid type: ${r.type}. Must be 'webm' or 'matroska'.`);if(r.firstTimestampBehavior&&!$d.includes(r.firstTimestampBehavior))throw new TypeError(`Invalid first timestamp behavior: ${r.firstTimestampBehavior}`);if(r.streaming!==void 0&&typeof r.streaming!="boolean")throw new TypeError(`Invalid streaming option: ${r.streaming}. Must be a boolean.`)};zs=new WeakSet;Bl=function(){_(this,R)instanceof Jr&&_(this,R).target.options.onHeader&&_(this,R).startTrackingWrites(),D(this,la,Al).call(this),_(this,H).streaming||D(this,da,Il).call(this),D(this,ua,zl).call(this),D(this,ha,Tl).call(this),D(this,fa,kl).call(this),_(this,H).streaming||(D(this,On,ca).call(this),D(this,Nn,pa).call(this)),D(this,_a,Fl).call(this),D(this,vi,Vi).call(this)};la=new WeakSet;Al=function(){let r={id:440786851,data:[{id:17030,data:1},{id:17143,data:1},{id:17138,data:4},{id:17139,data:8},{id:17026,data:_(this,H).type??"webm"},{id:17031,data:2},{id:17029,data:2}]};_(this,R).writeEBML(r)};ha=new WeakSet;Tl=function(){V(this,sr,{id:236,size:4,data:new Uint8Array(Fr)}),V(this,ri,{id:236,size:4,data:new Uint8Array(Fr)}),V(this,ji,{id:236,size:4,data:new Uint8Array(Fr)})};fa=new WeakSet;kl=function(){V(this,Ci,{id:21936,data:[{id:21937,data:2},{id:21946,data:2},{id:21947,data:2},{id:21945,data:0}]})};da=new WeakSet;Il=function(){const r=new Uint8Array([28,83,187,107]),s=new Uint8Array([21,73,169,102]),l=new Uint8Array([22,84,174,107]);V(this,Fe,{id:290298740,data:[{id:19899,data:[{id:21419,data:r},{id:21420,size:5,data:0}]},{id:19899,data:[{id:21419,data:s},{id:21420,size:5,data:0}]},{id:19899,data:[{id:21419,data:l},{id:21420,size:5,data:0}]}]})};ua=new WeakSet;zl=function(){let r={id:17545,data:new na(0)};V(this,Gi,r);let s={id:357149030,data:[{id:2807729,data:1e6},{id:19840,data:lo},{id:22337,data:lo},_(this,H).streaming?null:r]};V(this,Wr,s)};On=new WeakSet;ca=function(){let r={id:374648427,data:[]};V(this,nr,r),_(this,H).video&&r.data.push({id:174,data:[{id:215,data:rr},{id:29637,data:rr},{id:131,data:Wd},{id:134,data:_(this,H).video.codec},_(this,sr),_(this,H).video.frameRate?{id:2352003,data:1e9/_(this,H).video.frameRate}:null,{id:224,data:[{id:176,data:_(this,H).video.width},{id:186,data:_(this,H).video.height},_(this,H).video.alpha?{id:21440,data:1}:null,_(this,Ci)]}]}),_(this,H).audio&&(V(this,ri,_(this,H).streaming?_(this,ri)||null:{id:236,size:4,data:new Uint8Array(Fr)}),r.data.push({id:174,data:[{id:215,data:Gr},{id:29637,data:Gr},{id:131,data:Yd},{id:134,data:_(this,H).audio.codec},_(this,ri),{id:225,data:[{id:181,data:new cl(_(this,H).audio.sampleRate)},{id:159,data:_(this,H).audio.numberOfChannels},_(this,H).audio.bitDepth?{id:25188,data:_(this,H).audio.bitDepth}:null]}]})),_(this,H).subtitles&&r.data.push({id:174,data:[{id:215,data:kn},{id:29637,data:kn},{id:131,data:qd},{id:134,data:_(this,H).subtitles.codec},_(this,ji)]})};Nn=new WeakSet;pa=function(){let r={id:408125543,size:_(this,H).streaming?-1:Ul,data:[_(this,H).streaming?null:_(this,Fe),_(this,Wr),_(this,nr)]};if(V(this,Vr,r),_(this,R).writeEBML(r),_(this,R)instanceof Jr&&_(this,R).target.options.onHeader){let{data:s,start:l}=_(this,R).getTrackedWrites();_(this,R).target.options.onHeader(s,l)}};_a=new WeakSet;Fl=function(){V(this,$i,{id:475249515,data:[]})};vi=new WeakSet;Vi=function(){_(this,R)instanceof oa&&_(this,R).flush()};gi=new WeakSet;Wi=function(){return _(this,R).dataOffsets.get(_(this,Vr))};Fs=new WeakSet;Pl=function(r){if(r.decoderConfig){if(r.decoderConfig.colorSpace){let s=r.decoderConfig.colorSpace;if(V(this,Yr,s),_(this,Ci).data=[{id:21937,data:{rgb:1,bt709:1,bt470bg:5,smpte170m:6}[s.matrix]},{id:21946,data:{bt709:1,smpte170m:6,"iec61966-2-1":13}[s.transfer]},{id:21947,data:{bt709:1,bt470bg:5,smpte170m:6}[s.primaries]},{id:21945,data:[1,2][Number(s.fullRange)]}],!_(this,H).streaming){let l=_(this,R).pos;_(this,R).seek(_(this,R).offsets.get(_(this,Ci))),_(this,R).writeEBML(_(this,Ci)),_(this,R).seek(l)}}r.decoderConfig.description&&(_(this,H).streaming?V(this,sr,D(this,Ji,qr).call(this,r.decoderConfig.description)):D(this,Dr,zn).call(this,_(this,sr),r.decoderConfig.description))}};Ps=new WeakSet;Ll=function(r){if(r.type!=="key"||!_(this,Yr))return;let s=0;if(Di(r.data,0,2)!==2)return;s+=2;let l=(Di(r.data,s+1,s+2)<<1)+Di(r.data,s+0,s+1);s+=2,l===3&&s++;let h=Di(r.data,s+0,s+1);if(s++,h)return;let d=Di(r.data,s+0,s+1);if(s++,d!==0)return;s+=2;let u=Di(r.data,s+0,s+24);if(s+=24,u!==4817730)return;l>=2&&s++;let m={rgb:7,bt709:2,bt470bg:1,smpte170m:3}[_(this,Yr).matrix];Rd(r.data,s+0,s+3,m)};mr=new WeakSet;vn=function(){let r=Math.min(_(this,H).video?_(this,Xi):1/0,_(this,H).audio?_(this,Zi):1/0),s=_(this,_i);for(;s.length>0&&s[0].timestamp<=r;)D(this,we,ze).call(this,s.shift(),!_(this,H).video&&!_(this,H).audio)};yr=new WeakSet;gn=function(r,s,l,h,d,u){let m=D(this,va,Ml).call(this,l,h);return{data:r,additions:u,type:s,timestamp:m,duration:d,trackNumber:h}};va=new WeakSet;Ml=function(r,s){let l=s===rr?_(this,Xi):s===Gr?_(this,Zi):_(this,In);if(s!==kn){let h=s===rr?_(this,Pr):_(this,Lr);if(_(this,H).firstTimestampBehavior==="strict"&&l===-1&&r!==0)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received ${r}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
If you want to allow non-zero first timestamps, set firstTimestampBehavior: 'permissive'.
`);_(this,H).firstTimestampBehavior==="offset"&&(r-=h)}if(r<l)throw new Error(`Timestamps must be monotonically increasing (went from ${l} to ${r}).`);if(r<0)throw new Error(`Timestamps must be non-negative (received ${r}).`);return r};we=new WeakSet;ze=function(r,s){_(this,H).streaming&&!_(this,nr)&&(D(this,On,ca).call(this),D(this,Nn,pa).call(this));let l=Math.floor(r.timestamp/1e3),h=l-_(this,Qr),d=s&&r.type==="key"&&h>=1e3,u=h>=jd;if((!_(this,Se)||d||u)&&(D(this,ga,Dl).call(this,l),h=0),h<0)return;let m=new Uint8Array(4),a=new DataView(m.buffer);if(a.setUint8(0,128|r.trackNumber),a.setInt16(1,h,!1),r.duration===void 0&&!r.additions){a.setUint8(3,+(r.type==="key")<<7);let b={id:163,data:[m,r.data]};_(this,R).writeEBML(b)}else{let b=Math.floor(r.duration/1e3),w={id:160,data:[{id:161,data:[m,r.data]},r.duration!==void 0?{id:155,data:b}:null,r.additions?{id:30113,data:r.additions}:null]};_(this,R).writeEBML(w)}V(this,Ki,Math.max(_(this,Ki),l))};Ji=new WeakSet;qr=function(r){return{id:25506,size:4,data:new Uint8Array(r)}};Dr=new WeakSet;zn=function(r,s){let l=_(this,R).pos;_(this,R).seek(_(this,R).offsets.get(r));let h=6+s.byteLength,d=Fr-h;if(d<0){let u=s.byteLength+d;s instanceof ArrayBuffer?s=s.slice(0,u):s=s.buffer.slice(0,u),d=0}r=[D(this,Ji,qr).call(this,s),{id:236,size:4,data:new Uint8Array(d)}],_(this,R).writeEBML(r),_(this,R).seek(l)};ga=new WeakSet;Dl=function(r){_(this,Se)&&D(this,Fn,ma).call(this),_(this,R)instanceof Jr&&_(this,R).target.options.onCluster&&_(this,R).startTrackingWrites(),V(this,Se,{id:524531317,size:_(this,H).streaming?-1:El,data:[{id:231,data:r}]}),_(this,R).writeEBML(_(this,Se)),V(this,Qr,r);let s=_(this,R).offsets.get(_(this,Se))-_(this,gi,Wi);_(this,$i).data.push({id:187,data:[{id:179,data:r},_(this,H).video?{id:183,data:[{id:247,data:rr},{id:241,data:s}]}:null,_(this,H).audio?{id:183,data:[{id:247,data:Gr},{id:241,data:s}]}:null]})};Fn=new WeakSet;ma=function(){if(!_(this,H).streaming){let r=_(this,R).pos-_(this,R).dataOffsets.get(_(this,Se)),s=_(this,R).pos;_(this,R).seek(_(this,R).offsets.get(_(this,Se))+4),_(this,R).writeEBMLVarInt(r,El),_(this,R).seek(s)}if(_(this,R)instanceof Jr&&_(this,R).target.options.onCluster){let{data:r,start:s}=_(this,R).getTrackedWrites();_(this,R).target.options.onCluster(r,s,_(this,Qr))}};wr=new WeakSet;mn=function(){if(_(this,Mr))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};new TextEncoder;function Xd(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Rl={};(function(r){var s=function(){var t=new Date,e=4,n=3,o=2,f=1,c=e,v={setLogLevel:function(g){g==this.debug?c=f:g==this.info?c=o:g==this.warn?c=n:(g==this.error,c=e)},debug:function(g,x){console.debug===void 0&&(console.debug=console.log),f>=c&&console.debug("["+s.getDurationString(new Date-t,1e3)+"]","["+g+"]",x)},log:function(g,x){this.debug(g.msg)},info:function(g,x){o>=c&&console.info("["+s.getDurationString(new Date-t,1e3)+"]","["+g+"]",x)},warn:function(g,x){n>=c&&console.warn("["+s.getDurationString(new Date-t,1e3)+"]","["+g+"]",x)},error:function(g,x){e>=c&&console.error("["+s.getDurationString(new Date-t,1e3)+"]","["+g+"]",x)}};return v}();s.getDurationString=function(t,e){var n;function o(S,E){for(var A=""+S,M=A.split(".");M[0].length<E;)M[0]="0"+M[0];return M.join(".")}t<0?(n=!0,t=-t):n=!1;var f=e||1,c=t/f,v=Math.floor(c/3600);c-=v*3600;var g=Math.floor(c/60);c-=g*60;var x=c*1e3;return c=Math.floor(c),x-=c*1e3,x=Math.floor(x),(n?"-":"")+v+":"+o(g,2)+":"+o(c,2)+"."+o(x,3)},s.printRanges=function(t){var e=t.length;if(e>0){for(var n="",o=0;o<e;o++)o>0&&(n+=","),n+="["+s.getDurationString(t.start(o))+","+s.getDurationString(t.end(o))+"]";return n}else return"(empty)"},r.Log=s;var l=function(t){if(t instanceof ArrayBuffer)this.buffer=t,this.dataview=new DataView(t);else throw"Needs an array buffer";this.position=0};l.prototype.getPosition=function(){return this.position},l.prototype.getEndPosition=function(){return this.buffer.byteLength},l.prototype.getLength=function(){return this.buffer.byteLength},l.prototype.seek=function(t){var e=Math.max(0,Math.min(this.buffer.byteLength,t));return this.position=isNaN(e)||!isFinite(e)?0:e,!0},l.prototype.isEos=function(){return this.getPosition()>=this.getEndPosition()},l.prototype.readAnyInt=function(t,e){var n=0;if(this.position+t<=this.buffer.byteLength){switch(t){case 1:e?n=this.dataview.getInt8(this.position):n=this.dataview.getUint8(this.position);break;case 2:e?n=this.dataview.getInt16(this.position):n=this.dataview.getUint16(this.position);break;case 3:if(e)throw"No method for reading signed 24 bits values";n=this.dataview.getUint8(this.position)<<16,n|=this.dataview.getUint8(this.position+1)<<8,n|=this.dataview.getUint8(this.position+2);break;case 4:e?n=this.dataview.getInt32(this.position):n=this.dataview.getUint32(this.position);break;case 8:if(e)throw"No method for reading signed 64 bits values";n=this.dataview.getUint32(this.position)<<32,n|=this.dataview.getUint32(this.position+4);break;default:throw"readInt method not implemented for size: "+t}return this.position+=t,n}else throw"Not enough bytes in buffer"},l.prototype.readUint8=function(){return this.readAnyInt(1,!1)},l.prototype.readUint16=function(){return this.readAnyInt(2,!1)},l.prototype.readUint24=function(){return this.readAnyInt(3,!1)},l.prototype.readUint32=function(){return this.readAnyInt(4,!1)},l.prototype.readUint64=function(){return this.readAnyInt(8,!1)},l.prototype.readString=function(t){if(this.position+t<=this.buffer.byteLength){for(var e="",n=0;n<t;n++)e+=String.fromCharCode(this.readUint8());return e}else throw"Not enough bytes in buffer"},l.prototype.readCString=function(){for(var t=[];;){var e=this.readUint8();if(e!==0)t.push(e);else break}return String.fromCharCode.apply(null,t)},l.prototype.readInt8=function(){return this.readAnyInt(1,!0)},l.prototype.readInt16=function(){return this.readAnyInt(2,!0)},l.prototype.readInt32=function(){return this.readAnyInt(4,!0)},l.prototype.readInt64=function(){return this.readAnyInt(8,!1)},l.prototype.readUint8Array=function(t){for(var e=new Uint8Array(t),n=0;n<t;n++)e[n]=this.readUint8();return e},l.prototype.readInt16Array=function(t){for(var e=new Int16Array(t),n=0;n<t;n++)e[n]=this.readInt16();return e},l.prototype.readUint16Array=function(t){for(var e=new Int16Array(t),n=0;n<t;n++)e[n]=this.readUint16();return e},l.prototype.readUint32Array=function(t){for(var e=new Uint32Array(t),n=0;n<t;n++)e[n]=this.readUint32();return e},l.prototype.readInt32Array=function(t){for(var e=new Int32Array(t),n=0;n<t;n++)e[n]=this.readInt32();return e},r.MP4BoxStream=l;var h=function(t,e,n){this._byteOffset=e||0,t instanceof ArrayBuffer?this.buffer=t:typeof t=="object"?(this.dataView=t,e&&(this._byteOffset+=e)):this.buffer=new ArrayBuffer(t||0),this.position=0,this.endianness=n??h.LITTLE_ENDIAN};h.prototype={},h.prototype.getPosition=function(){return this.position},h.prototype._realloc=function(t){if(this._dynamicSize){var e=this._byteOffset+this.position+t,n=this._buffer.byteLength;if(e<=n){e>this._byteLength&&(this._byteLength=e);return}for(n<1&&(n=1);e>n;)n*=2;var o=new ArrayBuffer(n),f=new Uint8Array(this._buffer),c=new Uint8Array(o,0,f.length);c.set(f),this.buffer=o,this._byteLength=e}},h.prototype._trimAlloc=function(){if(this._byteLength!=this._buffer.byteLength){var t=new ArrayBuffer(this._byteLength),e=new Uint8Array(t),n=new Uint8Array(this._buffer,0,e.length);e.set(n),this.buffer=t}},h.BIG_ENDIAN=!1,h.LITTLE_ENDIAN=!0,h.prototype._byteLength=0,Object.defineProperty(h.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(h.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(t){this._buffer=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(h.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(t){this._byteOffset=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(h.prototype,"dataView",{get:function(){return this._dataView},set:function(t){this._byteOffset=t.byteOffset,this._buffer=t.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+t.byteLength}}),h.prototype.seek=function(t){var e=Math.max(0,Math.min(this.byteLength,t));this.position=isNaN(e)||!isFinite(e)?0:e},h.prototype.isEof=function(){return this.position>=this._byteLength},h.prototype.mapUint8Array=function(t){this._realloc(t*1);var e=new Uint8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=t*1,e},h.prototype.readInt32Array=function(t,e){t=t??this.byteLength-this.position/4;var n=new Int32Array(t);return h.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,t*n.BYTES_PER_ELEMENT),h.arrayToNative(n,e??this.endianness),this.position+=n.byteLength,n},h.prototype.readInt16Array=function(t,e){t=t??this.byteLength-this.position/2;var n=new Int16Array(t);return h.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,t*n.BYTES_PER_ELEMENT),h.arrayToNative(n,e??this.endianness),this.position+=n.byteLength,n},h.prototype.readInt8Array=function(t){t=t??this.byteLength-this.position;var e=new Int8Array(t);return h.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e},h.prototype.readUint32Array=function(t,e){t=t??this.byteLength-this.position/4;var n=new Uint32Array(t);return h.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,t*n.BYTES_PER_ELEMENT),h.arrayToNative(n,e??this.endianness),this.position+=n.byteLength,n},h.prototype.readUint16Array=function(t,e){t=t??this.byteLength-this.position/2;var n=new Uint16Array(t);return h.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,t*n.BYTES_PER_ELEMENT),h.arrayToNative(n,e??this.endianness),this.position+=n.byteLength,n},h.prototype.readUint8Array=function(t){t=t??this.byteLength-this.position;var e=new Uint8Array(t);return h.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e},h.prototype.readFloat64Array=function(t,e){t=t??this.byteLength-this.position/8;var n=new Float64Array(t);return h.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,t*n.BYTES_PER_ELEMENT),h.arrayToNative(n,e??this.endianness),this.position+=n.byteLength,n},h.prototype.readFloat32Array=function(t,e){t=t??this.byteLength-this.position/4;var n=new Float32Array(t);return h.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,t*n.BYTES_PER_ELEMENT),h.arrayToNative(n,e??this.endianness),this.position+=n.byteLength,n},h.prototype.readInt32=function(t){var e=this._dataView.getInt32(this.position,t??this.endianness);return this.position+=4,e},h.prototype.readInt16=function(t){var e=this._dataView.getInt16(this.position,t??this.endianness);return this.position+=2,e},h.prototype.readInt8=function(){var t=this._dataView.getInt8(this.position);return this.position+=1,t},h.prototype.readUint32=function(t){var e=this._dataView.getUint32(this.position,t??this.endianness);return this.position+=4,e},h.prototype.readUint16=function(t){var e=this._dataView.getUint16(this.position,t??this.endianness);return this.position+=2,e},h.prototype.readUint8=function(){var t=this._dataView.getUint8(this.position);return this.position+=1,t},h.prototype.readFloat32=function(t){var e=this._dataView.getFloat32(this.position,t??this.endianness);return this.position+=4,e},h.prototype.readFloat64=function(t){var e=this._dataView.getFloat64(this.position,t??this.endianness);return this.position+=8,e},h.endianness=new Int8Array(new Int16Array([1]).buffer)[0]>0,h.memcpy=function(t,e,n,o,f){var c=new Uint8Array(t,e,f),v=new Uint8Array(n,o,f);c.set(v)},h.arrayToNative=function(t,e){return e==this.endianness?t:this.flipArrayEndianness(t)},h.nativeToEndian=function(t,e){return this.endianness==e?t:this.flipArrayEndianness(t)},h.flipArrayEndianness=function(t){for(var e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),n=0;n<t.byteLength;n+=t.BYTES_PER_ELEMENT)for(var o=n+t.BYTES_PER_ELEMENT-1,f=n;o>f;o--,f++){var c=e[f];e[f]=e[o],e[o]=c}return t},h.prototype.failurePosition=0,String.fromCharCodeUint8=function(t){for(var e=[],n=0;n<t.length;n++)e[n]=t[n];return String.fromCharCode.apply(null,e)},h.prototype.readString=function(t,e){return e==null||e=="ASCII"?String.fromCharCodeUint8.apply(null,[this.mapUint8Array(t??this.byteLength-this.position)]):new TextDecoder(e).decode(this.mapUint8Array(t))},h.prototype.readCString=function(t){var e=this.byteLength-this.position,n=new Uint8Array(this._buffer,this._byteOffset+this.position),o=e;t!=null&&(o=Math.min(t,e));for(var f=0;f<o&&n[f]!==0;f++);var c=String.fromCharCodeUint8.apply(null,[this.mapUint8Array(f)]);return t!=null?this.position+=o-f:f!=e&&(this.position+=1),c};var d=Math.pow(2,32);h.prototype.readInt64=function(){return this.readInt32()*d+this.readUint32()},h.prototype.readUint64=function(){return this.readUint32()*d+this.readUint32()},h.prototype.readInt64=function(){return this.readUint32()*d+this.readUint32()},h.prototype.readUint24=function(){return(this.readUint8()<<16)+(this.readUint8()<<8)+this.readUint8()},r.DataStream=h,h.prototype.save=function(t){var e=new Blob([this.buffer]);if(window.URL&&URL.createObjectURL){var n=window.URL.createObjectURL(e),o=document.createElement("a");document.body.appendChild(o),o.setAttribute("href",n),o.setAttribute("download",t),o.setAttribute("target","_self"),o.click(),window.URL.revokeObjectURL(n)}else throw"DataStream.save: Can't create object URL."},h.prototype._dynamicSize=!0,Object.defineProperty(h.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(t){t||this._trimAlloc(),this._dynamicSize=t}}),h.prototype.shift=function(t){var e=new ArrayBuffer(this._byteLength-t),n=new Uint8Array(e),o=new Uint8Array(this._buffer,t,n.length);n.set(o),this.buffer=e,this.position-=t},h.prototype.writeInt32Array=function(t,e){if(this._realloc(t.length*4),t instanceof Int32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)h.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt32Array(t.length,e);else for(var n=0;n<t.length;n++)this.writeInt32(t[n],e)},h.prototype.writeInt16Array=function(t,e){if(this._realloc(t.length*2),t instanceof Int16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)h.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt16Array(t.length,e);else for(var n=0;n<t.length;n++)this.writeInt16(t[n],e)},h.prototype.writeInt8Array=function(t){if(this._realloc(t.length*1),t instanceof Int8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)h.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt8Array(t.length);else for(var e=0;e<t.length;e++)this.writeInt8(t[e])},h.prototype.writeUint32Array=function(t,e){if(this._realloc(t.length*4),t instanceof Uint32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)h.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint32Array(t.length,e);else for(var n=0;n<t.length;n++)this.writeUint32(t[n],e)},h.prototype.writeUint16Array=function(t,e){if(this._realloc(t.length*2),t instanceof Uint16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)h.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint16Array(t.length,e);else for(var n=0;n<t.length;n++)this.writeUint16(t[n],e)},h.prototype.writeUint8Array=function(t){if(this._realloc(t.length*1),t instanceof Uint8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)h.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint8Array(t.length);else for(var e=0;e<t.length;e++)this.writeUint8(t[e])},h.prototype.writeFloat64Array=function(t,e){if(this._realloc(t.length*8),t instanceof Float64Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)h.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat64Array(t.length,e);else for(var n=0;n<t.length;n++)this.writeFloat64(t[n],e)},h.prototype.writeFloat32Array=function(t,e){if(this._realloc(t.length*4),t instanceof Float32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)h.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat32Array(t.length,e);else for(var n=0;n<t.length;n++)this.writeFloat32(t[n],e)},h.prototype.writeInt32=function(t,e){this._realloc(4),this._dataView.setInt32(this.position,t,e??this.endianness),this.position+=4},h.prototype.writeInt16=function(t,e){this._realloc(2),this._dataView.setInt16(this.position,t,e??this.endianness),this.position+=2},h.prototype.writeInt8=function(t){this._realloc(1),this._dataView.setInt8(this.position,t),this.position+=1},h.prototype.writeUint32=function(t,e){this._realloc(4),this._dataView.setUint32(this.position,t,e??this.endianness),this.position+=4},h.prototype.writeUint16=function(t,e){this._realloc(2),this._dataView.setUint16(this.position,t,e??this.endianness),this.position+=2},h.prototype.writeUint8=function(t){this._realloc(1),this._dataView.setUint8(this.position,t),this.position+=1},h.prototype.writeFloat32=function(t,e){this._realloc(4),this._dataView.setFloat32(this.position,t,e??this.endianness),this.position+=4},h.prototype.writeFloat64=function(t,e){this._realloc(8),this._dataView.setFloat64(this.position,t,e??this.endianness),this.position+=8},h.prototype.writeUCS2String=function(t,e,n){n==null&&(n=t.length);for(var o=0;o<t.length&&o<n;o++)this.writeUint16(t.charCodeAt(o),e);for(;o<n;o++)this.writeUint16(0)},h.prototype.writeString=function(t,e,n){var o=0;if(e==null||e=="ASCII")if(n!=null){var f=Math.min(t.length,n);for(o=0;o<f;o++)this.writeUint8(t.charCodeAt(o));for(;o<n;o++)this.writeUint8(0)}else for(o=0;o<t.length;o++)this.writeUint8(t.charCodeAt(o));else this.writeUint8Array(new TextEncoder(e).encode(t.substring(0,n)))},h.prototype.writeCString=function(t,e){var n=0;if(e!=null){var o=Math.min(t.length,e);for(n=0;n<o;n++)this.writeUint8(t.charCodeAt(n));for(;n<e;n++)this.writeUint8(0)}else{for(n=0;n<t.length;n++)this.writeUint8(t.charCodeAt(n));this.writeUint8(0)}},h.prototype.writeStruct=function(t,e){for(var n=0;n<t.length;n+=2){var o=t[n+1];this.writeType(o,e[t[n]],e)}},h.prototype.writeType=function(t,e,n){var o;if(typeof t=="function")return t(this,e);if(typeof t=="object"&&!(t instanceof Array))return t.set(this,e,n);var f=null,c="ASCII",v=this.position;switch(typeof t=="string"&&/:/.test(t)&&(o=t.split(":"),t=o[0],f=parseInt(o[1])),typeof t=="string"&&/,/.test(t)&&(o=t.split(","),t=o[0],c=parseInt(o[1])),t){case"uint8":this.writeUint8(e);break;case"int8":this.writeInt8(e);break;case"uint16":this.writeUint16(e,this.endianness);break;case"int16":this.writeInt16(e,this.endianness);break;case"uint32":this.writeUint32(e,this.endianness);break;case"int32":this.writeInt32(e,this.endianness);break;case"float32":this.writeFloat32(e,this.endianness);break;case"float64":this.writeFloat64(e,this.endianness);break;case"uint16be":this.writeUint16(e,h.BIG_ENDIAN);break;case"int16be":this.writeInt16(e,h.BIG_ENDIAN);break;case"uint32be":this.writeUint32(e,h.BIG_ENDIAN);break;case"int32be":this.writeInt32(e,h.BIG_ENDIAN);break;case"float32be":this.writeFloat32(e,h.BIG_ENDIAN);break;case"float64be":this.writeFloat64(e,h.BIG_ENDIAN);break;case"uint16le":this.writeUint16(e,h.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(e,h.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(e,h.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(e,h.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(e,h.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(e,h.LITTLE_ENDIAN);break;case"cstring":this.writeCString(e,f);break;case"string":this.writeString(e,c,f);break;case"u16string":this.writeUCS2String(e,this.endianness,f);break;case"u16stringle":this.writeUCS2String(e,h.LITTLE_ENDIAN,f);break;case"u16stringbe":this.writeUCS2String(e,h.BIG_ENDIAN,f);break;default:if(t.length==3){for(var g=t[1],x=0;x<e.length;x++)this.writeType(g,e[x]);break}else{this.writeStruct(t,e);break}}f!=null&&(this.position=v,this._realloc(f),this.position=v+f)},h.prototype.writeUint64=function(t){var e=Math.floor(t/d);this.writeUint32(e),this.writeUint32(t&4294967295)},h.prototype.writeUint24=function(t){this.writeUint8((t&16711680)>>16),this.writeUint8((t&65280)>>8),this.writeUint8(t&255)},h.prototype.adjustUint32=function(t,e){var n=this.position;this.seek(t),this.writeUint32(e),this.seek(n)},h.prototype.mapInt32Array=function(t,e){this._realloc(t*4);var n=new Int32Array(this._buffer,this.byteOffset+this.position,t);return h.arrayToNative(n,e??this.endianness),this.position+=t*4,n},h.prototype.mapInt16Array=function(t,e){this._realloc(t*2);var n=new Int16Array(this._buffer,this.byteOffset+this.position,t);return h.arrayToNative(n,e??this.endianness),this.position+=t*2,n},h.prototype.mapInt8Array=function(t){this._realloc(t*1);var e=new Int8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=t*1,e},h.prototype.mapUint32Array=function(t,e){this._realloc(t*4);var n=new Uint32Array(this._buffer,this.byteOffset+this.position,t);return h.arrayToNative(n,e??this.endianness),this.position+=t*4,n},h.prototype.mapUint16Array=function(t,e){this._realloc(t*2);var n=new Uint16Array(this._buffer,this.byteOffset+this.position,t);return h.arrayToNative(n,e??this.endianness),this.position+=t*2,n},h.prototype.mapFloat64Array=function(t,e){this._realloc(t*8);var n=new Float64Array(this._buffer,this.byteOffset+this.position,t);return h.arrayToNative(n,e??this.endianness),this.position+=t*8,n},h.prototype.mapFloat32Array=function(t,e){this._realloc(t*4);var n=new Float32Array(this._buffer,this.byteOffset+this.position,t);return h.arrayToNative(n,e??this.endianness),this.position+=t*4,n};var u=function(t){this.buffers=[],this.bufferIndex=-1,t&&(this.insertBuffer(t),this.bufferIndex=0)};u.prototype=new h(new ArrayBuffer,0,h.BIG_ENDIAN),u.prototype.initialized=function(){var t;return this.bufferIndex>-1?!0:this.buffers.length>0?(t=this.buffers[0],t.fileStart===0?(this.buffer=t,this.bufferIndex=0,s.debug("MultiBufferStream","Stream ready for parsing"),!0):(s.warn("MultiBufferStream","The first buffer should have a fileStart of 0"),this.logBufferLevel(),!1)):(s.warn("MultiBufferStream","No buffer to start parsing from"),this.logBufferLevel(),!1)},ArrayBuffer.concat=function(t,e){s.debug("ArrayBuffer","Trying to create a new buffer of size: "+(t.byteLength+e.byteLength));var n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n.buffer},u.prototype.reduceBuffer=function(t,e,n){var o;return o=new Uint8Array(n),o.set(new Uint8Array(t,e,n)),o.buffer.fileStart=t.fileStart+e,o.buffer.usedBytes=0,o.buffer},u.prototype.insertBuffer=function(t){for(var e=!0,n=0;n<this.buffers.length;n++){var o=this.buffers[n];if(t.fileStart<=o.fileStart){if(t.fileStart===o.fileStart)if(t.byteLength>o.byteLength){this.buffers.splice(n,1),n--;continue}else s.warn("MultiBufferStream","Buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+") already appended, ignoring");else t.fileStart+t.byteLength<=o.fileStart||(t=this.reduceBuffer(t,0,o.fileStart-t.fileStart)),s.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.splice(n,0,t),n===0&&(this.buffer=t);e=!1;break}else if(t.fileStart<o.fileStart+o.byteLength){var f=o.fileStart+o.byteLength-t.fileStart,c=t.byteLength-f;if(c>0)t=this.reduceBuffer(t,f,c);else{e=!1;break}}}e&&(s.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.push(t),n===0&&(this.buffer=t))},u.prototype.logBufferLevel=function(t){var e,n,o,f,c=[],v,g="";for(o=0,f=0,e=0;e<this.buffers.length;e++)n=this.buffers[e],e===0?(v={},c.push(v),v.start=n.fileStart,v.end=n.fileStart+n.byteLength,g+="["+v.start+"-"):v.end===n.fileStart?v.end=n.fileStart+n.byteLength:(v={},v.start=n.fileStart,g+=c[c.length-1].end-1+"], ["+v.start+"-",v.end=n.fileStart+n.byteLength,c.push(v)),o+=n.usedBytes,f+=n.byteLength;c.length>0&&(g+=v.end-1+"]");var x=t?s.info:s.debug;this.buffers.length===0?x("MultiBufferStream","No more buffer in memory"):x("MultiBufferStream",""+this.buffers.length+" stored buffer(s) ("+o+"/"+f+" bytes), continuous ranges: "+g)},u.prototype.cleanBuffers=function(){var t,e;for(t=0;t<this.buffers.length;t++)e=this.buffers[t],e.usedBytes===e.byteLength&&(s.debug("MultiBufferStream","Removing buffer #"+t),this.buffers.splice(t,1),t--)},u.prototype.mergeNextBuffer=function(){var t;if(this.bufferIndex+1<this.buffers.length)if(t=this.buffers[this.bufferIndex+1],t.fileStart===this.buffer.fileStart+this.buffer.byteLength){var e=this.buffer.byteLength,n=this.buffer.usedBytes,o=this.buffer.fileStart;return this.buffers[this.bufferIndex]=ArrayBuffer.concat(this.buffer,t),this.buffer=this.buffers[this.bufferIndex],this.buffers.splice(this.bufferIndex+1,1),this.buffer.usedBytes=n,this.buffer.fileStart=o,s.debug("ISOFile","Concatenating buffer for box parsing (length: "+e+"->"+this.buffer.byteLength+")"),!0}else return!1;else return!1},u.prototype.findPosition=function(t,e,n){var o,f=null,c=-1;for(t===!0?o=0:o=this.bufferIndex;o<this.buffers.length&&(f=this.buffers[o],f.fileStart<=e);){c=o,n&&(f.fileStart+f.byteLength<=e?f.usedBytes=f.byteLength:f.usedBytes=e-f.fileStart,this.logBufferLevel());o++}return c!==-1?(f=this.buffers[c],f.fileStart+f.byteLength>=e?(s.debug("MultiBufferStream","Found position in existing buffer #"+c),c):-1):-1},u.prototype.findEndContiguousBuf=function(t){var e,n,o,f=t!==void 0?t:this.bufferIndex;if(n=this.buffers[f],this.buffers.length>f+1)for(e=f+1;e<this.buffers.length&&(o=this.buffers[e],o.fileStart===n.fileStart+n.byteLength);e++)n=o;return n.fileStart+n.byteLength},u.prototype.getEndFilePositionAfter=function(t){var e=this.findPosition(!0,t,!1);return e!==-1?this.findEndContiguousBuf(e):t},u.prototype.addUsedBytes=function(t){this.buffer.usedBytes+=t,this.logBufferLevel()},u.prototype.setAllUsedBytes=function(){this.buffer.usedBytes=this.buffer.byteLength,this.logBufferLevel()},u.prototype.seek=function(t,e,n){var o;return o=this.findPosition(e,t,n),o!==-1?(this.buffer=this.buffers[o],this.bufferIndex=o,this.position=t-this.buffer.fileStart,s.debug("MultiBufferStream","Repositioning parser at buffer position: "+this.position),!0):(s.debug("MultiBufferStream","Position "+t+" not found in buffered data"),!1)},u.prototype.getPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.position},u.prototype.getLength=function(){return this.byteLength},u.prototype.getEndPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.byteLength},r.MultiBufferStream=u;var m=function(){var t=3,e=4,n=5,o=6,f=[];f[t]="ES_Descriptor",f[e]="DecoderConfigDescriptor",f[n]="DecoderSpecificInfo",f[o]="SLConfigDescriptor",this.getDescriptorName=function(g){return f[g]};var c=this,v={};return this.parseOneDescriptor=function(g){var x=0,S,E,A;for(S=g.readUint8(),A=g.readUint8();A&128;)x=(x<<7)+(A&127),A=g.readUint8();return x=(x<<7)+(A&127),s.debug("MPEG4DescriptorParser","Found "+(f[S]||"Descriptor "+S)+", size "+x+" at position "+g.getPosition()),f[S]?E=new v[f[S]](x):E=new v.Descriptor(x),E.parse(g),E},v.Descriptor=function(g,x){this.tag=g,this.size=x,this.descs=[]},v.Descriptor.prototype.parse=function(g){this.data=g.readUint8Array(this.size)},v.Descriptor.prototype.findDescriptor=function(g){for(var x=0;x<this.descs.length;x++)if(this.descs[x].tag==g)return this.descs[x];return null},v.Descriptor.prototype.parseRemainingDescriptors=function(g){for(var x=g.position;g.position<x+this.size;){var S=c.parseOneDescriptor(g);this.descs.push(S)}},v.ES_Descriptor=function(g){v.Descriptor.call(this,t,g)},v.ES_Descriptor.prototype=new v.Descriptor,v.ES_Descriptor.prototype.parse=function(g){if(this.ES_ID=g.readUint16(),this.flags=g.readUint8(),this.size-=3,this.flags&128?(this.dependsOn_ES_ID=g.readUint16(),this.size-=2):this.dependsOn_ES_ID=0,this.flags&64){var x=g.readUint8();this.URL=g.readString(x),this.size-=x+1}else this.URL="";this.flags&32?(this.OCR_ES_ID=g.readUint16(),this.size-=2):this.OCR_ES_ID=0,this.parseRemainingDescriptors(g)},v.ES_Descriptor.prototype.getOTI=function(g){var x=this.findDescriptor(e);return x?x.oti:0},v.ES_Descriptor.prototype.getAudioConfig=function(g){var x=this.findDescriptor(e);if(!x)return null;var S=x.findDescriptor(n);if(S&&S.data){var E=(S.data[0]&248)>>3;return E===31&&S.data.length>=2&&(E=32+((S.data[0]&7)<<3)+((S.data[1]&224)>>5)),E}else return null},v.DecoderConfigDescriptor=function(g){v.Descriptor.call(this,e,g)},v.DecoderConfigDescriptor.prototype=new v.Descriptor,v.DecoderConfigDescriptor.prototype.parse=function(g){this.oti=g.readUint8(),this.streamType=g.readUint8(),this.upStream=(this.streamType>>1&1)!==0,this.streamType=this.streamType>>>2,this.bufferSize=g.readUint24(),this.maxBitrate=g.readUint32(),this.avgBitrate=g.readUint32(),this.size-=13,this.parseRemainingDescriptors(g)},v.DecoderSpecificInfo=function(g){v.Descriptor.call(this,n,g)},v.DecoderSpecificInfo.prototype=new v.Descriptor,v.SLConfigDescriptor=function(g){v.Descriptor.call(this,o,g)},v.SLConfigDescriptor.prototype=new v.Descriptor,this};r.MPEG4DescriptorParser=m;var a={ERR_INVALID_DATA:-1,ERR_NOT_ENOUGH_DATA:0,OK:1,BASIC_BOXES:[{type:"mdat",name:"MediaDataBox"},{type:"idat",name:"ItemDataBox"},{type:"free",name:"FreeSpaceBox"},{type:"skip",name:"FreeSpaceBox"},{type:"meco",name:"AdditionalMetadataContainerBox"},{type:"strk",name:"SubTrackBox"}],FULL_BOXES:[{type:"hmhd",name:"HintMediaHeaderBox"},{type:"nmhd",name:"NullMediaHeaderBox"},{type:"iods",name:"ObjectDescriptorBox"},{type:"xml ",name:"XMLBox"},{type:"bxml",name:"BinaryXMLBox"},{type:"ipro",name:"ItemProtectionBox"},{type:"mere",name:"MetaboxRelationBox"}],CONTAINER_BOXES:[[{type:"moov",name:"CompressedMovieBox"},["trak","pssh"]],[{type:"trak",name:"TrackBox"}],[{type:"edts",name:"EditBox"}],[{type:"mdia",name:"MediaBox"}],[{type:"minf",name:"MediaInformationBox"}],[{type:"dinf",name:"DataInformationBox"}],[{type:"stbl",name:"SampleTableBox"},["sgpd","sbgp"]],[{type:"mvex",name:"MovieExtendsBox"},["trex"]],[{type:"moof",name:"CompressedMovieFragmentBox"},["traf"]],[{type:"traf",name:"TrackFragmentBox"},["trun","sgpd","sbgp"]],[{type:"vttc",name:"VTTCueBox"}],[{type:"tref",name:"TrackReferenceBox"}],[{type:"iref",name:"ItemReferenceBox"}],[{type:"mfra",name:"MovieFragmentRandomAccessBox"},["tfra"]],[{type:"meco",name:"AdditionalMetadataContainerBox"}],[{type:"hnti",name:"trackhintinformation"}],[{type:"hinf",name:"hintstatisticsbox"}],[{type:"strk",name:"SubTrackBox"}],[{type:"strd",name:"SubTrackDefinitionBox"}],[{type:"sinf",name:"ProtectionSchemeInfoBox"}],[{type:"rinf",name:"RestrictedSchemeInfoBox"}],[{type:"schi",name:"SchemeInformationBox"}],[{type:"trgr",name:"TrackGroupBox"}],[{type:"udta",name:"UserDataBox"},["kind"]],[{type:"iprp",name:"ItemPropertiesBox"},["ipma"]],[{type:"ipco",name:"ItemPropertyContainerBox"}],[{type:"grpl",name:"GroupsListBox"}],[{type:"j2kH",name:"J2KHeaderInfoBox"}],[{type:"etyp",name:"ExtendedTypeBox"},["tyco"]]],boxCodes:[],fullBoxCodes:[],containerBoxCodes:[],sampleEntryCodes:{},sampleGroupEntryCodes:[],trackGroupTypes:[],UUIDBoxes:{},UUIDs:[],initialize:function(){a.FullBox.prototype=new a.Box,a.ContainerBox.prototype=new a.Box,a.SampleEntry.prototype=new a.Box,a.TrackGroupTypeBox.prototype=new a.FullBox,a.BASIC_BOXES.forEach(function(t){a.createBoxCtor(t.type,t.name)}),a.FULL_BOXES.forEach(function(t){a.createFullBoxCtor(t.type,t.name)}),a.CONTAINER_BOXES.forEach(function(t){a.createContainerBoxCtor(t[0].type,t[0].name,null,t[1])})},Box:function(t,e,n,o){this.type=t,this.box_name=n,this.size=e,this.uuid=o},FullBox:function(t,e,n,o){a.Box.call(this,t,e,n,o),this.flags=0,this.version=0},ContainerBox:function(t,e,n,o){a.Box.call(this,t,e,n,o),this.boxes=[]},SampleEntry:function(t,e,n,o){a.ContainerBox.call(this,t,e),this.hdr_size=n,this.start=o},SampleGroupEntry:function(t){this.grouping_type=t},TrackGroupTypeBox:function(t,e){a.FullBox.call(this,t,e)},createBoxCtor:function(t,e,n){a.boxCodes.push(t),a[t+"Box"]=function(o){a.Box.call(this,t,o,e)},a[t+"Box"].prototype=new a.Box,n&&(a[t+"Box"].prototype.parse=n)},createFullBoxCtor:function(t,e,n){a[t+"Box"]=function(o){a.FullBox.call(this,t,o,e)},a[t+"Box"].prototype=new a.FullBox,a[t+"Box"].prototype.parse=function(o){this.parseFullHeader(o),n&&n.call(this,o)}},addSubBoxArrays:function(t){if(t){this.subBoxNames=t;for(var e=t.length,n=0;n<e;n++)this[t[n]+"s"]=[]}},createContainerBoxCtor:function(t,e,n,o){a[t+"Box"]=function(f){a.ContainerBox.call(this,t,f,e),a.addSubBoxArrays.call(this,o)},a[t+"Box"].prototype=new a.ContainerBox,n&&(a[t+"Box"].prototype.parse=n)},createMediaSampleEntryCtor:function(t,e,n){a.sampleEntryCodes[t]=[],a[t+"SampleEntry"]=function(o,f){a.SampleEntry.call(this,o,f),a.addSubBoxArrays.call(this,n)},a[t+"SampleEntry"].prototype=new a.SampleEntry,e&&(a[t+"SampleEntry"].prototype.parse=e)},createSampleEntryCtor:function(t,e,n,o){a.sampleEntryCodes[t].push(e),a[e+"SampleEntry"]=function(f){a[t+"SampleEntry"].call(this,e,f),a.addSubBoxArrays.call(this,o)},a[e+"SampleEntry"].prototype=new a[t+"SampleEntry"],n&&(a[e+"SampleEntry"].prototype.parse=n)},createEncryptedSampleEntryCtor:function(t,e,n){a.createSampleEntryCtor.call(this,t,e,n,["sinf"])},createSampleGroupCtor:function(t,e){a[t+"SampleGroupEntry"]=function(n){a.SampleGroupEntry.call(this,t,n)},a[t+"SampleGroupEntry"].prototype=new a.SampleGroupEntry,e&&(a[t+"SampleGroupEntry"].prototype.parse=e)},createTrackGroupCtor:function(t,e){a[t+"TrackGroupTypeBox"]=function(n){a.TrackGroupTypeBox.call(this,t,n)},a[t+"TrackGroupTypeBox"].prototype=new a.TrackGroupTypeBox,e&&(a[t+"TrackGroupTypeBox"].prototype.parse=e)},createUUIDBox:function(t,e,n,o,f){a.UUIDs.push(t),a.UUIDBoxes[t]=function(c){n?a.FullBox.call(this,"uuid",c,e,t):o?a.ContainerBox.call(this,"uuid",c,e,t):a.Box.call(this,"uuid",c,e,t)},a.UUIDBoxes[t].prototype=n?new a.FullBox:o?new a.ContainerBox:new a.Box,f&&(n?a.UUIDBoxes[t].prototype.parse=function(c){this.parseFullHeader(c),f&&f.call(this,c)}:a.UUIDBoxes[t].prototype.parse=f)}};a.initialize(),a.TKHD_FLAG_ENABLED=1,a.TKHD_FLAG_IN_MOVIE=2,a.TKHD_FLAG_IN_PREVIEW=4,a.TFHD_FLAG_BASE_DATA_OFFSET=1,a.TFHD_FLAG_SAMPLE_DESC=2,a.TFHD_FLAG_SAMPLE_DUR=8,a.TFHD_FLAG_SAMPLE_SIZE=16,a.TFHD_FLAG_SAMPLE_FLAGS=32,a.TFHD_FLAG_DUR_EMPTY=65536,a.TFHD_FLAG_DEFAULT_BASE_IS_MOOF=131072,a.TRUN_FLAGS_DATA_OFFSET=1,a.TRUN_FLAGS_FIRST_FLAG=4,a.TRUN_FLAGS_DURATION=256,a.TRUN_FLAGS_SIZE=512,a.TRUN_FLAGS_FLAGS=1024,a.TRUN_FLAGS_CTS_OFFSET=2048,a.Box.prototype.add=function(t){return this.addBox(new a[t+"Box"])},a.Box.prototype.addBox=function(t){return this.boxes.push(t),this[t.type+"s"]?this[t.type+"s"].push(t):this[t.type]=t,t},a.Box.prototype.set=function(t,e){return this[t]=e,this},a.Box.prototype.addEntry=function(t,e){var n=e||"entries";return this[n]||(this[n]=[]),this[n].push(t),this},r.BoxParser=a,a.parseUUID=function(t){return a.parseHex16(t)},a.parseHex16=function(t){for(var e="",n=0;n<16;n++){var o=t.readUint8().toString(16);e+=o.length===1?"0"+o:o}return e},a.parseOneBox=function(t,e,n){var o,f=t.getPosition(),c=0,v,g;if(t.getEndPosition()-f<8)return s.debug("BoxParser","Not enough data in stream to parse the type and size of the box"),{code:a.ERR_NOT_ENOUGH_DATA};if(n&&n<8)return s.debug("BoxParser","Not enough bytes left in the parent box to parse a new box"),{code:a.ERR_NOT_ENOUGH_DATA};var x=t.readUint32(),S=t.readString(4),E=S;if(s.debug("BoxParser","Found box of type '"+S+"' and size "+x+" at position "+f),c=8,S=="uuid"){if(t.getEndPosition()-t.getPosition()<16||n-c<16)return t.seek(f),s.debug("BoxParser","Not enough bytes left in the parent box to parse a UUID box"),{code:a.ERR_NOT_ENOUGH_DATA};g=a.parseUUID(t),c+=16,E=g}if(x==1){if(t.getEndPosition()-t.getPosition()<8||n&&n-c<8)return t.seek(f),s.warn("BoxParser",'Not enough data in stream to parse the extended size of the "'+S+'" box'),{code:a.ERR_NOT_ENOUGH_DATA};x=t.readUint64(),c+=8}else if(x===0){if(n)x=n;else if(S!=="mdat")return s.error("BoxParser","Unlimited box size not supported for type: '"+S+"'"),o=new a.Box(S,x),{code:a.OK,box:o,size:o.size}}return x!==0&&x<c?(s.error("BoxParser","Box of type "+S+" has an invalid size "+x+" (too small to be a box)"),{code:a.ERR_NOT_ENOUGH_DATA,type:S,size:x,hdr_size:c,start:f}):x!==0&&n&&x>n?(s.error("BoxParser","Box of type '"+S+"' has a size "+x+" greater than its container size "+n),{code:a.ERR_NOT_ENOUGH_DATA,type:S,size:x,hdr_size:c,start:f}):x!==0&&f+x>t.getEndPosition()?(t.seek(f),s.info("BoxParser","Not enough data in stream to parse the entire '"+S+"' box"),{code:a.ERR_NOT_ENOUGH_DATA,type:S,size:x,hdr_size:c,start:f}):e?{code:a.OK,type:S,size:x,hdr_size:c,start:f}:(a[S+"Box"]?o=new a[S+"Box"](x):S!=="uuid"?(s.warn("BoxParser","Unknown box type: '"+S+"'"),o=new a.Box(S,x),o.has_unparsed_data=!0):a.UUIDBoxes[g]?o=new a.UUIDBoxes[g](x):(s.warn("BoxParser","Unknown uuid type: '"+g+"'"),o=new a.Box(S,x),o.uuid=g,o.has_unparsed_data=!0),o.hdr_size=c,o.start=f,o.write===a.Box.prototype.write&&o.type!=="mdat"&&(s.info("BoxParser","'"+E+"' box writing not yet implemented, keeping unparsed data in memory for later write"),o.parseDataAndRewind(t)),o.parse(t),v=t.getPosition()-(o.start+o.size),v<0?(s.warn("BoxParser","Parsing of box '"+E+"' did not read the entire indicated box data size (missing "+-v+" bytes), seeking forward"),t.seek(o.start+o.size)):v>0&&(s.error("BoxParser","Parsing of box '"+E+"' read "+v+" more bytes than the indicated box data size, seeking backwards"),o.size!==0&&t.seek(o.start+o.size)),{code:a.OK,box:o,size:o.size})},a.Box.prototype.parse=function(t){this.type!="mdat"?this.data=t.readUint8Array(this.size-this.hdr_size):this.size===0?t.seek(t.getEndPosition()):t.seek(this.start+this.size)},a.Box.prototype.parseDataAndRewind=function(t){this.data=t.readUint8Array(this.size-this.hdr_size),t.position-=this.size-this.hdr_size},a.FullBox.prototype.parseDataAndRewind=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=4,t.position-=this.size-this.hdr_size},a.FullBox.prototype.parseFullHeader=function(t){this.version=t.readUint8(),this.flags=t.readUint24(),this.hdr_size+=4},a.FullBox.prototype.parse=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)},a.ContainerBox.prototype.parse=function(t){for(var e,n;t.getPosition()<this.start+this.size;)if(e=a.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),e.code===a.OK)if(n=e.box,this.boxes.push(n),this.subBoxNames&&this.subBoxNames.indexOf(n.type)!=-1)this[this.subBoxNames[this.subBoxNames.indexOf(n.type)]+"s"].push(n);else{var o=n.type!=="uuid"?n.type:n.uuid;this[o]?s.warn("Box of type "+o+" already stored in field of this type"):this[o]=n}else return},a.Box.prototype.parseLanguage=function(t){this.language=t.readUint16();var e=[];e[0]=this.language>>10&31,e[1]=this.language>>5&31,e[2]=this.language&31,this.languageString=String.fromCharCode(e[0]+96,e[1]+96,e[2]+96)},a.SAMPLE_ENTRY_TYPE_VISUAL="Visual",a.SAMPLE_ENTRY_TYPE_AUDIO="Audio",a.SAMPLE_ENTRY_TYPE_HINT="Hint",a.SAMPLE_ENTRY_TYPE_METADATA="Metadata",a.SAMPLE_ENTRY_TYPE_SUBTITLE="Subtitle",a.SAMPLE_ENTRY_TYPE_SYSTEM="System",a.SAMPLE_ENTRY_TYPE_TEXT="Text",a.SampleEntry.prototype.parseHeader=function(t){t.readUint8Array(6),this.data_reference_index=t.readUint16(),this.hdr_size+=8},a.SampleEntry.prototype.parse=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)},a.SampleEntry.prototype.parseDataAndRewind=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=8,t.position-=this.size-this.hdr_size},a.SampleEntry.prototype.parseFooter=function(t){a.ContainerBox.prototype.parse.call(this,t)},a.createMediaSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_HINT),a.createMediaSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_METADATA),a.createMediaSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_SUBTITLE),a.createMediaSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_SYSTEM),a.createMediaSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_TEXT),a.createMediaSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,function(t){var e;this.parseHeader(t),t.readUint16(),t.readUint16(),t.readUint32Array(3),this.width=t.readUint16(),this.height=t.readUint16(),this.horizresolution=t.readUint32(),this.vertresolution=t.readUint32(),t.readUint32(),this.frame_count=t.readUint16(),e=Math.min(31,t.readUint8()),this.compressorname=t.readString(e),e<31&&t.readString(31-e),this.depth=t.readUint16(),t.readUint16(),this.parseFooter(t)}),a.createMediaSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_AUDIO,function(t){this.parseHeader(t),t.readUint32Array(2),this.channel_count=t.readUint16(),this.samplesize=t.readUint16(),t.readUint16(),t.readUint16(),this.samplerate=t.readUint32()/65536,this.parseFooter(t)}),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"avc1"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"avc2"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"avc3"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"avc4"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"av01"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"dav1"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"hvc1"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"hev1"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"hvt1"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"lhe1"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"dvh1"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"dvhe"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"vvc1"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"vvi1"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"vvs1"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"vvcN"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"vp08"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"vp09"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"avs3"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"j2ki"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"mjp2"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"mjpg"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"uncv"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_AUDIO,"mp4a"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_AUDIO,"ac-3"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_AUDIO,"ac-4"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_AUDIO,"ec-3"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_AUDIO,"Opus"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_AUDIO,"mha1"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_AUDIO,"mha2"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_AUDIO,"mhm1"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_AUDIO,"mhm2"),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_AUDIO,"fLaC"),a.createEncryptedSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_VISUAL,"encv"),a.createEncryptedSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_AUDIO,"enca"),a.createEncryptedSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_SUBTITLE,"encu"),a.createEncryptedSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_SYSTEM,"encs"),a.createEncryptedSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_TEXT,"enct"),a.createEncryptedSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_METADATA,"encm"),a.createBoxCtor("a1lx","AV1LayeredImageIndexingProperty",function(t){var e=t.readUint8()&1,n=((e&1)+1)*16;this.layer_size=[];for(var o=0;o<3;o++)n==16?this.layer_size[o]=t.readUint16():this.layer_size[o]=t.readUint32()}),a.createBoxCtor("a1op","OperatingPointSelectorProperty",function(t){this.op_index=t.readUint8()}),a.createFullBoxCtor("auxC","AuxiliaryTypeProperty",function(t){this.aux_type=t.readCString();var e=this.size-this.hdr_size-(this.aux_type.length+1);this.aux_subtype=t.readUint8Array(e)}),a.createBoxCtor("av1C","AV1CodecConfigurationBox",function(t){var e=t.readUint8();if((e>>7&1)!==1){s.error("av1C marker problem");return}if(this.version=e&127,this.version!==1){s.error("av1C version "+this.version+" not supported");return}if(e=t.readUint8(),this.seq_profile=e>>5&7,this.seq_level_idx_0=e&31,e=t.readUint8(),this.seq_tier_0=e>>7&1,this.high_bitdepth=e>>6&1,this.twelve_bit=e>>5&1,this.monochrome=e>>4&1,this.chroma_subsampling_x=e>>3&1,this.chroma_subsampling_y=e>>2&1,this.chroma_sample_position=e&3,e=t.readUint8(),this.reserved_1=e>>5&7,this.reserved_1!==0){s.error("av1C reserved_1 parsing problem");return}if(this.initial_presentation_delay_present=e>>4&1,this.initial_presentation_delay_present===1)this.initial_presentation_delay_minus_one=e&15;else if(this.reserved_2=e&15,this.reserved_2!==0){s.error("av1C reserved_2 parsing problem");return}var n=this.size-this.hdr_size-4;this.configOBUs=t.readUint8Array(n)});function b(t){var e="<table class='inner-table'>";e+="<thead><tr><th>length</th><th>nalu_data</th></tr></thead>",e+="<tbody>";for(var n=0;n<t.length;n++){var o=t[n];e+="<tr>",e+="<td>"+o.length+"</td>",e+="<td>",e+=o.nalu.reduce(function(f,c){return f+c.toString(16).padStart(2,"0")},"0x"),e+="</td></tr>"}return e+="</tbody></table>",e}a.createBoxCtor("avcC","AVCConfigurationBox",function(t){var e,n;for(this.configurationVersion=t.readUint8(),this.AVCProfileIndication=t.readUint8(),this.profile_compatibility=t.readUint8(),this.AVCLevelIndication=t.readUint8(),this.lengthSizeMinusOne=t.readUint8()&3,this.nb_SPS_nalus=t.readUint8()&31,n=this.size-this.hdr_size-6,this.SPS=[],this.SPS.toString=function(){return b(this)},e=0;e<this.nb_SPS_nalus;e++)this.SPS[e]={},this.SPS[e].length=t.readUint16(),this.SPS[e].nalu=t.readUint8Array(this.SPS[e].length),n-=2+this.SPS[e].length;for(this.nb_PPS_nalus=t.readUint8(),n--,this.PPS=[],this.PPS.toString=function(){return b(this)},e=0;e<this.nb_PPS_nalus;e++)this.PPS[e]={},this.PPS[e].length=t.readUint16(),this.PPS[e].nalu=t.readUint8Array(this.PPS[e].length),n-=2+this.PPS[e].length;n>0&&(this.ext=t.readUint8Array(n))}),a.createBoxCtor("btrt","BitRateBox",function(t){this.bufferSizeDB=t.readUint32(),this.maxBitrate=t.readUint32(),this.avgBitrate=t.readUint32()}),a.createFullBoxCtor("ccst","CodingConstraintsBox",function(t){var e=t.readUint8();this.all_ref_pics_intra=(e&128)==128,this.intra_pred_used=(e&64)==64,this.max_ref_per_pic=(e&63)>>2,t.readUint24()}),a.createBoxCtor("cdef","ComponentDefinitionBox",function(t){var e;for(this.channel_count=t.readUint16(),this.channel_indexes=[],this.channel_types=[],this.channel_associations=[],e=0;e<this.channel_count;e++)this.channel_indexes.push(t.readUint16()),this.channel_types.push(t.readUint16()),this.channel_associations.push(t.readUint16())}),a.createBoxCtor("clap","CleanApertureBox",function(t){this.cleanApertureWidthN=t.readUint32(),this.cleanApertureWidthD=t.readUint32(),this.cleanApertureHeightN=t.readUint32(),this.cleanApertureHeightD=t.readUint32(),this.horizOffN=t.readUint32(),this.horizOffD=t.readUint32(),this.vertOffN=t.readUint32(),this.vertOffD=t.readUint32()}),a.createBoxCtor("clli","ContentLightLevelBox",function(t){this.max_content_light_level=t.readUint16(),this.max_pic_average_light_level=t.readUint16()}),a.createFullBoxCtor("cmex","CameraExtrinsicMatrixProperty",function(t){this.flags&1&&(this.pos_x=t.readInt32()),this.flags&2&&(this.pos_y=t.readInt32()),this.flags&4&&(this.pos_z=t.readInt32()),this.flags&8&&(this.version==0?this.flags&16?(this.quat_x=t.readInt32(),this.quat_y=t.readInt32(),this.quat_z=t.readInt32()):(this.quat_x=t.readInt16(),this.quat_y=t.readInt16(),this.quat_z=t.readInt16()):this.version==1),this.flags&32&&(this.id=t.readUint32())}),a.createFullBoxCtor("cmin","CameraIntrinsicMatrixProperty",function(t){this.focal_length_x=t.readInt32(),this.principal_point_x=t.readInt32(),this.principal_point_y=t.readInt32(),this.flags&1&&(this.focal_length_y=t.readInt32(),this.skew_factor=t.readInt32())}),a.createBoxCtor("cmpd","ComponentDefinitionBox",function(t){for(this.component_count=t.readUint32(),this.component_types=[],this.component_type_urls=[],i=0;i<this.component_count;i++){var e=t.readUint16();this.component_types.push(e),e>=32768&&this.component_type_urls.push(t.readCString())}}),a.createFullBoxCtor("co64","ChunkLargeOffsetBox",function(t){var e,n;if(e=t.readUint32(),this.chunk_offsets=[],this.version===0)for(n=0;n<e;n++)this.chunk_offsets.push(t.readUint64())}),a.createFullBoxCtor("CoLL","ContentLightLevelBox",function(t){this.maxCLL=t.readUint16(),this.maxFALL=t.readUint16()}),a.createBoxCtor("colr","ColourInformationBox",function(t){if(this.colour_type=t.readString(4),this.colour_type==="nclx"){this.colour_primaries=t.readUint16(),this.transfer_characteristics=t.readUint16(),this.matrix_coefficients=t.readUint16();var e=t.readUint8();this.full_range_flag=e>>7}else this.colour_type==="rICC"?this.ICC_profile=t.readUint8Array(this.size-4):this.colour_type==="prof"&&(this.ICC_profile=t.readUint8Array(this.size-4))}),a.createFullBoxCtor("cprt","CopyrightBox",function(t){this.parseLanguage(t),this.notice=t.readCString()}),a.createFullBoxCtor("cslg","CompositionToDecodeBox",function(t){this.version===0&&(this.compositionToDTSShift=t.readInt32(),this.leastDecodeToDisplayDelta=t.readInt32(),this.greatestDecodeToDisplayDelta=t.readInt32(),this.compositionStartTime=t.readInt32(),this.compositionEndTime=t.readInt32())}),a.createFullBoxCtor("ctts","CompositionOffsetBox",function(t){var e,n;if(e=t.readUint32(),this.sample_counts=[],this.sample_offsets=[],this.version===0)for(n=0;n<e;n++){this.sample_counts.push(t.readUint32());var o=t.readInt32();o<0&&s.warn("BoxParser","ctts box uses negative values without using version 1"),this.sample_offsets.push(o)}else if(this.version==1)for(n=0;n<e;n++)this.sample_counts.push(t.readUint32()),this.sample_offsets.push(t.readInt32())}),a.createBoxCtor("dac3","AC3SpecificBox",function(t){var e=t.readUint8(),n=t.readUint8(),o=t.readUint8();this.fscod=e>>6,this.bsid=e>>1&31,this.bsmod=(e&1)<<2|n>>6&3,this.acmod=n>>3&7,this.lfeon=n>>2&1,this.bit_rate_code=n&3|o>>5&7}),a.createBoxCtor("dec3","EC3SpecificBox",function(t){var e=t.readUint16();this.data_rate=e>>3,this.num_ind_sub=e&7,this.ind_subs=[];for(var n=0;n<this.num_ind_sub+1;n++){var o={};this.ind_subs.push(o);var f=t.readUint8(),c=t.readUint8(),v=t.readUint8();o.fscod=f>>6,o.bsid=f>>1&31,o.bsmod=(f&1)<<4|c>>4&15,o.acmod=c>>1&7,o.lfeon=c&1,o.num_dep_sub=v>>1&15,o.num_dep_sub>0&&(o.chan_loc=(v&1)<<8|t.readUint8())}}),a.createFullBoxCtor("dfLa","FLACSpecificBox",function(t){var e=127,n=128,o=[],f=["STREAMINFO","PADDING","APPLICATION","SEEKTABLE","VORBIS_COMMENT","CUESHEET","PICTURE","RESERVED"];do{var c=t.readUint8(),v=Math.min(c&e,f.length-1);if(v?t.readUint8Array(t.readUint24()):(t.readUint8Array(13),this.samplerate=t.readUint32()>>12,t.readUint8Array(20)),o.push(f[v]),c&n)break}while(!0);this.numMetadataBlocks=o.length+" ("+o.join(", ")+")"}),a.createBoxCtor("dimm","hintimmediateBytesSent",function(t){this.bytessent=t.readUint64()}),a.createBoxCtor("dmax","hintlongestpacket",function(t){this.time=t.readUint32()}),a.createBoxCtor("dmed","hintmediaBytesSent",function(t){this.bytessent=t.readUint64()}),a.createBoxCtor("dOps","OpusSpecificBox",function(t){if(this.Version=t.readUint8(),this.OutputChannelCount=t.readUint8(),this.PreSkip=t.readUint16(),this.InputSampleRate=t.readUint32(),this.OutputGain=t.readInt16(),this.ChannelMappingFamily=t.readUint8(),this.ChannelMappingFamily!==0){this.StreamCount=t.readUint8(),this.CoupledCount=t.readUint8(),this.ChannelMapping=[];for(var e=0;e<this.OutputChannelCount;e++)this.ChannelMapping[e]=t.readUint8()}}),a.createFullBoxCtor("dref","DataReferenceBox",function(t){var e,n;this.entries=[];for(var o=t.readUint32(),f=0;f<o;f++)if(e=a.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),e.code===a.OK)n=e.box,this.entries.push(n);else return}),a.createBoxCtor("drep","hintrepeatedBytesSent",function(t){this.bytessent=t.readUint64()}),a.createFullBoxCtor("elng","ExtendedLanguageBox",function(t){this.extended_language=t.readString(this.size-this.hdr_size)}),a.createFullBoxCtor("elst","EditListBox",function(t){this.entries=[];for(var e=t.readUint32(),n=0;n<e;n++){var o={};this.entries.push(o),this.version===1?(o.segment_duration=t.readUint64(),o.media_time=t.readInt64()):(o.segment_duration=t.readUint32(),o.media_time=t.readInt32()),o.media_rate_integer=t.readInt16(),o.media_rate_fraction=t.readInt16()}}),a.createFullBoxCtor("emsg","EventMessageBox",function(t){this.version==1?(this.timescale=t.readUint32(),this.presentation_time=t.readUint64(),this.event_duration=t.readUint32(),this.id=t.readUint32(),this.scheme_id_uri=t.readCString(),this.value=t.readCString()):(this.scheme_id_uri=t.readCString(),this.value=t.readCString(),this.timescale=t.readUint32(),this.presentation_time_delta=t.readUint32(),this.event_duration=t.readUint32(),this.id=t.readUint32());var e=this.size-this.hdr_size-(4*4+(this.scheme_id_uri.length+1)+(this.value.length+1));this.version==1&&(e-=4),this.message_data=t.readUint8Array(e)}),a.createEntityToGroupCtor=function(t,e){a[t+"Box"]=function(n){a.FullBox.call(this,t,n)},a[t+"Box"].prototype=new a.FullBox,a[t+"Box"].prototype.parse=function(n){if(this.parseFullHeader(n),e)e.call(this,n);else for(this.group_id=n.readUint32(),this.num_entities_in_group=n.readUint32(),this.entity_ids=[],i=0;i<this.num_entities_in_group;i++){var o=n.readUint32();this.entity_ids.push(o)}}},a.createEntityToGroupCtor("aebr"),a.createEntityToGroupCtor("afbr"),a.createEntityToGroupCtor("albc"),a.createEntityToGroupCtor("altr"),a.createEntityToGroupCtor("brst"),a.createEntityToGroupCtor("dobr"),a.createEntityToGroupCtor("eqiv"),a.createEntityToGroupCtor("favc"),a.createEntityToGroupCtor("fobr"),a.createEntityToGroupCtor("iaug"),a.createEntityToGroupCtor("pano"),a.createEntityToGroupCtor("slid"),a.createEntityToGroupCtor("ster"),a.createEntityToGroupCtor("tsyn"),a.createEntityToGroupCtor("wbbr"),a.createEntityToGroupCtor("prgr"),a.createEntityToGroupCtor("pymd",function(t){this.group_id=t.readUint32(),this.num_entities_in_group=t.readUint32(),this.entity_ids=[];for(var e=0;e<this.num_entities_in_group;e++){var n=t.readUint32();this.entity_ids.push(n)}for(this.tile_size_x=t.readUint16(),this.tile_size_y=t.readUint16(),this.layer_binning=[],this.tiles_in_layer_column_minus1=[],this.tiles_in_layer_row_minus1=[],e=0;e<this.num_entities_in_group;e++)this.layer_binning[e]=t.readUint16(),this.tiles_in_layer_row_minus1[e]=t.readUint16(),this.tiles_in_layer_column_minus1[e]=t.readUint16()}),a.createFullBoxCtor("esds","ElementaryStreamDescriptorBox",function(t){var e=t.readUint8Array(this.size-this.hdr_size);if(typeof m<"u"){var n=new m;this.esd=n.parseOneDescriptor(new h(e.buffer,0,h.BIG_ENDIAN))}}),a.createBoxCtor("fiel","FieldHandlingBox",function(t){this.fieldCount=t.readUint8(),this.fieldOrdering=t.readUint8()}),a.createBoxCtor("frma","OriginalFormatBox",function(t){this.data_format=t.readString(4)}),a.createBoxCtor("ftyp","FileTypeBox",function(t){var e=this.size-this.hdr_size;this.major_brand=t.readString(4),this.minor_version=t.readUint32(),e-=8,this.compatible_brands=[];for(var n=0;e>=4;)this.compatible_brands[n]=t.readString(4),e-=4,n++}),a.createFullBoxCtor("hdlr","HandlerBox",function(t){this.version===0&&(t.readUint32(),this.handler=t.readString(4),t.readUint32Array(3),this.name=t.readString(this.size-this.hdr_size-20),this.name[this.name.length-1]==="\0"&&(this.name=this.name.slice(0,-1)))}),a.createBoxCtor("hvcC","HEVCConfigurationBox",function(t){var e,n,o,f;this.configurationVersion=t.readUint8(),f=t.readUint8(),this.general_profile_space=f>>6,this.general_tier_flag=(f&32)>>5,this.general_profile_idc=f&31,this.general_profile_compatibility=t.readUint32(),this.general_constraint_indicator=t.readUint8Array(6),this.general_level_idc=t.readUint8(),this.min_spatial_segmentation_idc=t.readUint16()&4095,this.parallelismType=t.readUint8()&3,this.chroma_format_idc=t.readUint8()&3,this.bit_depth_luma_minus8=t.readUint8()&7,this.bit_depth_chroma_minus8=t.readUint8()&7,this.avgFrameRate=t.readUint16(),f=t.readUint8(),this.constantFrameRate=f>>6,this.numTemporalLayers=(f&13)>>3,this.temporalIdNested=(f&4)>>2,this.lengthSizeMinusOne=f&3,this.nalu_arrays=[],this.nalu_arrays.toString=function(){var S="<table class='inner-table'>";S+="<thead><tr><th>completeness</th><th>nalu_type</th><th>nalu_data</th></tr></thead>",S+="<tbody>";for(var E=0;E<this.length;E++){var A=this[E];S+="<tr>",S+="<td rowspan='"+A.length+"'>"+A.completeness+"</td>",S+="<td rowspan='"+A.length+"'>"+A.nalu_type+"</td>";for(var M=0;M<A.length;M++){var z=A[M];M!==0&&(S+="<tr>"),S+="<td>",S+=z.data.reduce(function(K,L){return K+L.toString(16).padStart(2,"0")},"0x"),S+="</td></tr>"}}return S+="</tbody></table>",S};var c=t.readUint8();for(e=0;e<c;e++){var v=[];this.nalu_arrays.push(v),f=t.readUint8(),v.completeness=(f&128)>>7,v.nalu_type=f&63;var g=t.readUint16();for(n=0;n<g;n++){var x={};v.push(x),o=t.readUint16(),x.data=t.readUint8Array(o)}}}),a.createFullBoxCtor("iinf","ItemInfoBox",function(t){var e;this.version===0?this.entry_count=t.readUint16():this.entry_count=t.readUint32(),this.item_infos=[];for(var n=0;n<this.entry_count;n++)if(e=a.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),e.code===a.OK)e.box.type!=="infe"&&s.error("BoxParser","Expected 'infe' box, got "+e.box.type),this.item_infos[n]=e.box;else return}),a.createFullBoxCtor("iloc","ItemLocationBox",function(t){var e;e=t.readUint8(),this.offset_size=e>>4&15,this.length_size=e&15,e=t.readUint8(),this.base_offset_size=e>>4&15,this.version===1||this.version===2?this.index_size=e&15:this.index_size=0,this.items=[];var n=0;if(this.version<2)n=t.readUint16();else if(this.version===2)n=t.readUint32();else throw"version of iloc box not supported";for(var o=0;o<n;o++){var f={};if(this.items.push(f),this.version<2)f.item_ID=t.readUint16();else if(this.version===2)f.item_ID=t.readUint32();else throw"version of iloc box not supported";switch(this.version===1||this.version===2?f.construction_method=t.readUint16()&15:f.construction_method=0,f.data_reference_index=t.readUint16(),this.base_offset_size){case 0:f.base_offset=0;break;case 4:f.base_offset=t.readUint32();break;case 8:f.base_offset=t.readUint64();break;default:throw"Error reading base offset size"}var c=t.readUint16();f.extents=[];for(var v=0;v<c;v++){var g={};if(f.extents.push(g),this.version===1||this.version===2)switch(this.index_size){case 0:g.extent_index=0;break;case 4:g.extent_index=t.readUint32();break;case 8:g.extent_index=t.readUint64();break;default:throw"Error reading extent index"}switch(this.offset_size){case 0:g.extent_offset=0;break;case 4:g.extent_offset=t.readUint32();break;case 8:g.extent_offset=t.readUint64();break;default:throw"Error reading extent index"}switch(this.length_size){case 0:g.extent_length=0;break;case 4:g.extent_length=t.readUint32();break;case 8:g.extent_length=t.readUint64();break;default:throw"Error reading extent index"}}}}),a.createBoxCtor("imir","ImageMirror",function(t){var e=t.readUint8();this.reserved=e>>7,this.axis=e&1}),a.createFullBoxCtor("infe","ItemInfoEntry",function(t){if((this.version===0||this.version===1)&&(this.item_ID=t.readUint16(),this.item_protection_index=t.readUint16(),this.item_name=t.readCString(),this.content_type=t.readCString(),this.content_encoding=t.readCString()),this.version===1){this.extension_type=t.readString(4),s.warn("BoxParser","Cannot parse extension type"),t.seek(this.start+this.size);return}this.version>=2&&(this.version===2?this.item_ID=t.readUint16():this.version===3&&(this.item_ID=t.readUint32()),this.item_protection_index=t.readUint16(),this.item_type=t.readString(4),this.item_name=t.readCString(),this.item_type==="mime"?(this.content_type=t.readCString(),this.content_encoding=t.readCString()):this.item_type==="uri "&&(this.item_uri_type=t.readCString()))}),a.createFullBoxCtor("ipma","ItemPropertyAssociationBox",function(t){var e,n;for(entry_count=t.readUint32(),this.associations=[],e=0;e<entry_count;e++){var o={};this.associations.push(o),this.version<1?o.id=t.readUint16():o.id=t.readUint32();var f=t.readUint8();for(o.props=[],n=0;n<f;n++){var c=t.readUint8(),v={};o.props.push(v),v.essential=(c&128)>>7===1,this.flags&1?v.property_index=(c&127)<<8|t.readUint8():v.property_index=c&127}}}),a.createFullBoxCtor("iref","ItemReferenceBox",function(t){var e,n;for(this.references=[];t.getPosition()<this.start+this.size;)if(e=a.parseOneBox(t,!0,this.size-(t.getPosition()-this.start)),e.code===a.OK)this.version===0?n=new a.SingleItemTypeReferenceBox(e.type,e.size,e.hdr_size,e.start):n=new a.SingleItemTypeReferenceBoxLarge(e.type,e.size,e.hdr_size,e.start),n.write===a.Box.prototype.write&&n.type!=="mdat"&&(s.warn("BoxParser",n.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),n.parseDataAndRewind(t)),n.parse(t),this.references.push(n);else return}),a.createBoxCtor("irot","ImageRotation",function(t){this.angle=t.readUint8()&3}),a.createFullBoxCtor("ispe","ImageSpatialExtentsProperty",function(t){this.image_width=t.readUint32(),this.image_height=t.readUint32()}),a.createFullBoxCtor("kind","KindBox",function(t){this.schemeURI=t.readCString(),this.value=t.readCString()}),a.createFullBoxCtor("leva","LevelAssignmentBox",function(t){var e=t.readUint8();this.levels=[];for(var n=0;n<e;n++){var o={};this.levels[n]=o,o.track_ID=t.readUint32();var f=t.readUint8();switch(o.padding_flag=f>>7,o.assignment_type=f&127,o.assignment_type){case 0:o.grouping_type=t.readString(4);break;case 1:o.grouping_type=t.readString(4),o.grouping_type_parameter=t.readUint32();break;case 2:break;case 3:break;case 4:o.sub_track_id=t.readUint32();break;default:s.warn("BoxParser","Unknown leva assignement type")}}}),a.createBoxCtor("lhvC","LHEVCConfigurationBox",function(t){var e,n,o;this.configurationVersion=t.readUint8(),this.min_spatial_segmentation_idc=t.readUint16()&4095,this.parallelismType=t.readUint8()&3,o=t.readUint8(),this.numTemporalLayers=(o&13)>>3,this.temporalIdNested=(o&4)>>2,this.lengthSizeMinusOne=o&3,this.nalu_arrays=[],this.nalu_arrays.toString=function(){var S="<table class='inner-table'>";S+="<thead><tr><th>completeness</th><th>nalu_type</th><th>nalu_data</th></tr></thead>",S+="<tbody>";for(var E=0;E<this.length;E++){var A=this[E];S+="<tr>",S+="<td rowspan='"+A.length+"'>"+A.completeness+"</td>",S+="<td rowspan='"+A.length+"'>"+A.nalu_type+"</td>";for(var M=0;M<A.length;M++){var z=A[M];M!==0&&(S+="<tr>"),S+="<td>",S+=z.data.reduce(function(K,L){return K+L.toString(16).padStart(2,"0")},"0x"),S+="</td></tr>"}}return S+="</tbody></table>",S};var f=t.readUint8();for(e=0;e<f;e++){var c=[];this.nalu_arrays.push(c),o=t.readUint8(),c.completeness=(o&128)>>7,c.nalu_type=o&63;var v=t.readUint16();for(n=0;n<v;n++){var g={};c.push(g);var x=t.readUint16();g.data=t.readUint8Array(x)}}}),a.createBoxCtor("lsel","LayerSelectorProperty",function(t){this.layer_id=t.readUint16()}),a.createBoxCtor("maxr","hintmaxrate",function(t){this.period=t.readUint32(),this.bytes=t.readUint32()});function w(t,e){this.x=t,this.y=e}w.prototype.toString=function(){return"("+this.x+","+this.y+")"},a.createBoxCtor("mdcv","MasteringDisplayColourVolumeBox",function(t){this.display_primaries=[],this.display_primaries[0]=new w(t.readUint16(),t.readUint16()),this.display_primaries[1]=new w(t.readUint16(),t.readUint16()),this.display_primaries[2]=new w(t.readUint16(),t.readUint16()),this.white_point=new w(t.readUint16(),t.readUint16()),this.max_display_mastering_luminance=t.readUint32(),this.min_display_mastering_luminance=t.readUint32()}),a.createFullBoxCtor("mdhd","MediaHeaderBox",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.parseLanguage(t),t.readUint16()}),a.createFullBoxCtor("mehd","MovieExtendsHeaderBox",function(t){this.flags&1&&(s.warn("BoxParser","mehd box incorrectly uses flags set to 1, converting version to 1"),this.version=1),this.version==1?this.fragment_duration=t.readUint64():this.fragment_duration=t.readUint32()}),a.createFullBoxCtor("meta","MetaBox",function(t){this.boxes=[],a.ContainerBox.prototype.parse.call(this,t)}),a.createFullBoxCtor("mfhd","MovieFragmentHeaderBox",function(t){this.sequence_number=t.readUint32()}),a.createFullBoxCtor("mfro","MovieFragmentRandomAccessOffsetBox",function(t){this._size=t.readUint32()}),a.createFullBoxCtor("mskC","MaskConfigurationProperty",function(t){this.bits_per_pixel=t.readUint8()}),a.createFullBoxCtor("mvhd","MovieHeaderBox",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.rate=t.readUint32(),this.volume=t.readUint16()>>8,t.readUint16(),t.readUint32Array(2),this.matrix=t.readUint32Array(9),t.readUint32Array(6),this.next_track_id=t.readUint32()}),a.createBoxCtor("npck","hintPacketsSent",function(t){this.packetssent=t.readUint32()}),a.createBoxCtor("nump","hintPacketsSent",function(t){this.packetssent=t.readUint64()}),a.createFullBoxCtor("padb","PaddingBitsBox",function(t){var e=t.readUint32();this.padbits=[];for(var n=0;n<Math.floor((e+1)/2);n++)this.padbits=t.readUint8()}),a.createBoxCtor("pasp","PixelAspectRatioBox",function(t){this.hSpacing=t.readUint32(),this.vSpacing=t.readUint32()}),a.createBoxCtor("payl","CuePayloadBox",function(t){this.text=t.readString(this.size-this.hdr_size)}),a.createBoxCtor("payt","hintpayloadID",function(t){this.payloadID=t.readUint32();var e=t.readUint8();this.rtpmap_string=t.readString(e)}),a.createFullBoxCtor("pdin","ProgressiveDownloadInfoBox",function(t){var e=(this.size-this.hdr_size)/8;this.rate=[],this.initial_delay=[];for(var n=0;n<e;n++)this.rate[n]=t.readUint32(),this.initial_delay[n]=t.readUint32()}),a.createFullBoxCtor("pitm","PrimaryItemBox",function(t){this.version===0?this.item_id=t.readUint16():this.item_id=t.readUint32()}),a.createFullBoxCtor("pixi","PixelInformationProperty",function(t){var e;for(this.num_channels=t.readUint8(),this.bits_per_channels=[],e=0;e<this.num_channels;e++)this.bits_per_channels[e]=t.readUint8()}),a.createBoxCtor("pmax","hintlargestpacket",function(t){this.bytes=t.readUint32()}),a.createFullBoxCtor("prdi","ProgressiveDerivedImageItemInformationProperty",function(t){if(this.step_count=t.readUint16(),this.item_count=[],this.flags&2)for(var e=0;e<this.step_count;e++)this.item_count[e]=t.readUint16()}),a.createFullBoxCtor("prft","ProducerReferenceTimeBox",function(t){this.ref_track_id=t.readUint32(),this.ntp_timestamp=t.readUint64(),this.version===0?this.media_time=t.readUint32():this.media_time=t.readUint64()}),a.createFullBoxCtor("pssh","ProtectionSystemSpecificHeaderBox",function(t){if(this.system_id=a.parseHex16(t),this.version>0){var e=t.readUint32();this.kid=[];for(var n=0;n<e;n++)this.kid[n]=a.parseHex16(t)}var o=t.readUint32();o>0&&(this.data=t.readUint8Array(o))}),a.createFullBoxCtor("clef","TrackCleanApertureDimensionsBox",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),a.createFullBoxCtor("enof","TrackEncodedPixelsDimensionsBox",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),a.createFullBoxCtor("prof","TrackProductionApertureDimensionsBox",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),a.createContainerBoxCtor("tapt","TrackApertureModeDimensionsBox",null,["clef","prof","enof"]),a.createBoxCtor("rtp ","rtpmoviehintinformation",function(t){this.descriptionformat=t.readString(4),this.sdptext=t.readString(this.size-this.hdr_size-4)}),a.createFullBoxCtor("saio","SampleAuxiliaryInformationOffsetsBox",function(t){this.flags&1&&(this.aux_info_type=t.readString(4),this.aux_info_type_parameter=t.readUint32());var e=t.readUint32();this.offset=[];for(var n=0;n<e;n++)this.version===0?this.offset[n]=t.readUint32():this.offset[n]=t.readUint64()}),a.createFullBoxCtor("saiz","SampleAuxiliaryInformationSizesBox",function(t){if(this.flags&1&&(this.aux_info_type=t.readString(4),this.aux_info_type_parameter=t.readUint32()),this.default_sample_info_size=t.readUint8(),this.sample_count=t.readUint32(),this.sample_info_size=[],this.default_sample_info_size===0)for(var e=0;e<this.sample_count;e++)this.sample_info_size[e]=t.readUint8()}),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_METADATA,"mett",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_METADATA,"metx",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.parseFooter(t)}),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_SUBTITLE,"sbtt",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_SUBTITLE,"stpp",function(t){this.parseHeader(t),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.auxiliary_mime_types=t.readCString(),this.parseFooter(t)}),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_SUBTITLE,"stxt",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_SUBTITLE,"tx3g",function(t){this.parseHeader(t),this.displayFlags=t.readUint32(),this.horizontal_justification=t.readInt8(),this.vertical_justification=t.readInt8(),this.bg_color_rgba=t.readUint8Array(4),this.box_record=t.readInt16Array(4),this.style_record=t.readUint8Array(12),this.parseFooter(t)}),a.createSampleEntryCtor(a.SAMPLE_ENTRY_TYPE_METADATA,"wvtt",function(t){this.parseHeader(t),this.parseFooter(t)}),a.createSampleGroupCtor("alst",function(t){var e,n=t.readUint16();for(this.first_output_sample=t.readUint16(),this.sample_offset=[],e=0;e<n;e++)this.sample_offset[e]=t.readUint32();var o=this.description_length-4-4*n;for(this.num_output_samples=[],this.num_total_samples=[],e=0;e<o/4;e++)this.num_output_samples[e]=t.readUint16(),this.num_total_samples[e]=t.readUint16()}),a.createSampleGroupCtor("avll",function(t){this.layerNumber=t.readUint8(),this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()}),a.createSampleGroupCtor("avss",function(t){this.subSequenceIdentifier=t.readUint16(),this.layerNumber=t.readUint8();var e=t.readUint8();this.durationFlag=e>>7,this.avgRateFlag=e>>6&1,this.durationFlag&&(this.duration=t.readUint32()),this.avgRateFlag&&(this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()),this.dependency=[];for(var n=t.readUint8(),o=0;o<n;o++){var f={};this.dependency.push(f),f.subSeqDirectionFlag=t.readUint8(),f.layerNumber=t.readUint8(),f.subSequenceIdentifier=t.readUint16()}}),a.createSampleGroupCtor("dtrt",function(t){s.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),a.createSampleGroupCtor("mvif",function(t){s.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),a.createSampleGroupCtor("prol",function(t){this.roll_distance=t.readInt16()}),a.createSampleGroupCtor("rap ",function(t){var e=t.readUint8();this.num_leading_samples_known=e>>7,this.num_leading_samples=e&127}),a.createSampleGroupCtor("rash",function(t){if(this.operation_point_count=t.readUint16(),this.description_length!==2+(this.operation_point_count===1?2:this.operation_point_count*6)+9)s.warn("BoxParser","Mismatch in "+this.grouping_type+" sample group length"),this.data=t.readUint8Array(this.description_length-2);else{if(this.operation_point_count===1)this.target_rate_share=t.readUint16();else{this.target_rate_share=[],this.available_bitrate=[];for(var e=0;e<this.operation_point_count;e++)this.available_bitrate[e]=t.readUint32(),this.target_rate_share[e]=t.readUint16()}this.maximum_bitrate=t.readUint32(),this.minimum_bitrate=t.readUint32(),this.discard_priority=t.readUint8()}}),a.createSampleGroupCtor("roll",function(t){this.roll_distance=t.readInt16()}),a.SampleGroupEntry.prototype.parse=function(t){s.warn("BoxParser","Unknown Sample Group type: "+this.grouping_type),this.data=t.readUint8Array(this.description_length)},a.createSampleGroupCtor("scif",function(t){s.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),a.createSampleGroupCtor("scnm",function(t){s.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),a.createSampleGroupCtor("seig",function(t){this.reserved=t.readUint8();var e=t.readUint8();this.crypt_byte_block=e>>4,this.skip_byte_block=e&15,this.isProtected=t.readUint8(),this.Per_Sample_IV_Size=t.readUint8(),this.KID=a.parseHex16(t),this.constant_IV_size=0,this.constant_IV=0,this.isProtected===1&&this.Per_Sample_IV_Size===0&&(this.constant_IV_size=t.readUint8(),this.constant_IV=t.readUint8Array(this.constant_IV_size))}),a.createSampleGroupCtor("stsa",function(t){s.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),a.createSampleGroupCtor("sync",function(t){var e=t.readUint8();this.NAL_unit_type=e&63}),a.createSampleGroupCtor("tele",function(t){var e=t.readUint8();this.level_independently_decodable=e>>7}),a.createSampleGroupCtor("tsas",function(t){s.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),a.createSampleGroupCtor("tscl",function(t){s.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),a.createSampleGroupCtor("vipr",function(t){s.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),a.createFullBoxCtor("sbgp","SampleToGroupBox",function(t){this.grouping_type=t.readString(4),this.version===1?this.grouping_type_parameter=t.readUint32():this.grouping_type_parameter=0,this.entries=[];for(var e=t.readUint32(),n=0;n<e;n++){var o={};this.entries.push(o),o.sample_count=t.readInt32(),o.group_description_index=t.readInt32()}});function B(t,e){this.bad_pixel_row=t,this.bad_pixel_column=e}B.prototype.toString=function(){return"[row: "+this.bad_pixel_row+", column: "+this.bad_pixel_column+"]"},a.createFullBoxCtor("sbpm","SensorBadPixelsMapBox",function(t){var e;for(this.component_count=t.readUint16(),this.component_index=[],e=0;e<this.component_count;e++)this.component_index.push(t.readUint16());var n=t.readUint8();for(this.correction_applied=(n&128)==128,this.num_bad_rows=t.readUint32(),this.num_bad_cols=t.readUint32(),this.num_bad_pixels=t.readUint32(),this.bad_rows=[],this.bad_columns=[],this.bad_pixels=[],e=0;e<this.num_bad_rows;e++)this.bad_rows.push(t.readUint32());for(e=0;e<this.num_bad_cols;e++)this.bad_columns.push(t.readUint32());for(e=0;e<this.num_bad_pixels;e++){var o=t.readUint32(),f=t.readUint32();this.bad_pixels.push(new B(o,f))}}),a.createFullBoxCtor("schm","SchemeTypeBox",function(t){this.scheme_type=t.readString(4),this.scheme_version=t.readUint32(),this.flags&1&&(this.scheme_uri=t.readString(this.size-this.hdr_size-8))}),a.createBoxCtor("sdp ","rtptracksdphintinformation",function(t){this.sdptext=t.readString(this.size-this.hdr_size)}),a.createFullBoxCtor("sdtp","SampleDependencyTypeBox",function(t){var e,n=this.size-this.hdr_size;this.is_leading=[],this.sample_depends_on=[],this.sample_is_depended_on=[],this.sample_has_redundancy=[];for(var o=0;o<n;o++)e=t.readUint8(),this.is_leading[o]=e>>6,this.sample_depends_on[o]=e>>4&3,this.sample_is_depended_on[o]=e>>2&3,this.sample_has_redundancy[o]=e&3}),a.createFullBoxCtor("senc","SampleEncryptionBox"),a.createFullBoxCtor("sgpd","SampleGroupDescriptionBox",function(t){this.grouping_type=t.readString(4),s.debug("BoxParser","Found Sample Groups of type "+this.grouping_type),this.version===1?this.default_length=t.readUint32():this.default_length=0,this.version>=2&&(this.default_group_description_index=t.readUint32()),this.entries=[];for(var e=t.readUint32(),n=0;n<e;n++){var o;a[this.grouping_type+"SampleGroupEntry"]?o=new a[this.grouping_type+"SampleGroupEntry"](this.grouping_type):o=new a.SampleGroupEntry(this.grouping_type),this.entries.push(o),this.version===1?this.default_length===0?o.description_length=t.readUint32():o.description_length=this.default_length:o.description_length=this.default_length,o.write===a.SampleGroupEntry.prototype.write&&(s.info("BoxParser","SampleGroup for type "+this.grouping_type+" writing not yet implemented, keeping unparsed data in memory for later write"),o.data=t.readUint8Array(o.description_length),t.position-=o.description_length),o.parse(t)}}),a.createFullBoxCtor("sidx","CompressedSegmentIndexBox",function(t){this.reference_ID=t.readUint32(),this.timescale=t.readUint32(),this.version===0?(this.earliest_presentation_time=t.readUint32(),this.first_offset=t.readUint32()):(this.earliest_presentation_time=t.readUint64(),this.first_offset=t.readUint64()),t.readUint16(),this.references=[];for(var e=t.readUint16(),n=0;n<e;n++){var o={};this.references.push(o);var f=t.readUint32();o.reference_type=f>>31&1,o.referenced_size=f&2147483647,o.subsegment_duration=t.readUint32(),f=t.readUint32(),o.starts_with_SAP=f>>31&1,o.SAP_type=f>>28&7,o.SAP_delta_time=f&268435455}}),a.SingleItemTypeReferenceBox=function(t,e,n,o){a.Box.call(this,t,e),this.hdr_size=n,this.start=o},a.SingleItemTypeReferenceBox.prototype=new a.Box,a.SingleItemTypeReferenceBox.prototype.parse=function(t){this.from_item_ID=t.readUint16();var e=t.readUint16();this.references=[];for(var n=0;n<e;n++)this.references[n]={},this.references[n].to_item_ID=t.readUint16()},a.SingleItemTypeReferenceBoxLarge=function(t,e,n,o){a.Box.call(this,t,e),this.hdr_size=n,this.start=o},a.SingleItemTypeReferenceBoxLarge.prototype=new a.Box,a.SingleItemTypeReferenceBoxLarge.prototype.parse=function(t){this.from_item_ID=t.readUint32();var e=t.readUint16();this.references=[];for(var n=0;n<e;n++)this.references[n]={},this.references[n].to_item_ID=t.readUint32()},a.createFullBoxCtor("SmDm","SMPTE2086MasteringDisplayMetadataBox",function(t){this.primaryRChromaticity_x=t.readUint16(),this.primaryRChromaticity_y=t.readUint16(),this.primaryGChromaticity_x=t.readUint16(),this.primaryGChromaticity_y=t.readUint16(),this.primaryBChromaticity_x=t.readUint16(),this.primaryBChromaticity_y=t.readUint16(),this.whitePointChromaticity_x=t.readUint16(),this.whitePointChromaticity_y=t.readUint16(),this.luminanceMax=t.readUint32(),this.luminanceMin=t.readUint32()}),a.createFullBoxCtor("smhd","SoundMediaHeaderBox",function(t){this.balance=t.readUint16(),t.readUint16()}),a.createFullBoxCtor("ssix","CompressedSubsegmentIndexBox",function(t){this.subsegments=[];for(var e=t.readUint32(),n=0;n<e;n++){var o={};this.subsegments.push(o),o.ranges=[];for(var f=t.readUint32(),c=0;c<f;c++){var v={};o.ranges.push(v),v.level=t.readUint8(),v.range_size=t.readUint24()}}}),a.createFullBoxCtor("stco","ChunkOffsetBox",function(t){var e;if(e=t.readUint32(),this.chunk_offsets=[],this.version===0)for(var n=0;n<e;n++)this.chunk_offsets.push(t.readUint32())}),a.createFullBoxCtor("stdp","DegradationPriorityBox",function(t){var e=(this.size-this.hdr_size)/2;this.priority=[];for(var n=0;n<e;n++)this.priority[n]=t.readUint16()}),a.createFullBoxCtor("sthd","SubtitleMediaHeaderBox"),a.createFullBoxCtor("stri","SubTrackInformationBox",function(t){this.switch_group=t.readUint16(),this.alternate_group=t.readUint16(),this.sub_track_id=t.readUint32();var e=(this.size-this.hdr_size-8)/4;this.attribute_list=[];for(var n=0;n<e;n++)this.attribute_list[n]=t.readUint32()}),a.createFullBoxCtor("stsc","SampleToChunkBox",function(t){var e,n;if(e=t.readUint32(),this.first_chunk=[],this.samples_per_chunk=[],this.sample_description_index=[],this.version===0)for(n=0;n<e;n++)this.first_chunk.push(t.readUint32()),this.samples_per_chunk.push(t.readUint32()),this.sample_description_index.push(t.readUint32())}),a.createFullBoxCtor("stsd","SampleDescriptionBox",function(t){var e,n,o,f;for(this.entries=[],o=t.readUint32(),e=1;e<=o;e++)if(n=a.parseOneBox(t,!0,this.size-(t.getPosition()-this.start)),n.code===a.OK)a[n.type+"SampleEntry"]?(f=new a[n.type+"SampleEntry"](n.size),f.hdr_size=n.hdr_size,f.start=n.start):(s.warn("BoxParser","Unknown sample entry type: "+n.type),f=new a.SampleEntry(n.type,n.size,n.hdr_size,n.start)),f.write===a.SampleEntry.prototype.write&&(s.info("BoxParser","SampleEntry "+f.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),f.parseDataAndRewind(t)),f.parse(t),this.entries.push(f);else return}),a.createFullBoxCtor("stsg","SubTrackSampleGroupBox",function(t){this.grouping_type=t.readUint32();var e=t.readUint16();this.group_description_index=[];for(var n=0;n<e;n++)this.group_description_index[n]=t.readUint32()}),a.createFullBoxCtor("stsh","ShadowSyncSampleBox",function(t){var e,n;if(e=t.readUint32(),this.shadowed_sample_numbers=[],this.sync_sample_numbers=[],this.version===0)for(n=0;n<e;n++)this.shadowed_sample_numbers.push(t.readUint32()),this.sync_sample_numbers.push(t.readUint32())}),a.createFullBoxCtor("stss","SyncSampleBox",function(t){var e,n;if(n=t.readUint32(),this.version===0)for(this.sample_numbers=[],e=0;e<n;e++)this.sample_numbers.push(t.readUint32())}),a.createFullBoxCtor("stsz","SampleSizeBox",function(t){var e;if(this.sample_sizes=[],this.version===0)for(this.sample_size=t.readUint32(),this.sample_count=t.readUint32(),e=0;e<this.sample_count;e++)this.sample_size===0?this.sample_sizes.push(t.readUint32()):this.sample_sizes[e]=this.sample_size}),a.createFullBoxCtor("stts","TimeToSampleBox",function(t){var e,n,o;if(e=t.readUint32(),this.sample_counts=[],this.sample_deltas=[],this.version===0)for(n=0;n<e;n++)this.sample_counts.push(t.readUint32()),o=t.readInt32(),o<0&&(s.warn("BoxParser","File uses negative stts sample delta, using value 1 instead, sync may be lost!"),o=1),this.sample_deltas.push(o)}),a.createFullBoxCtor("stvi","StereoVideoBox",function(t){var e=t.readUint32();this.single_view_allowed=e&3,this.stereo_scheme=t.readUint32();var n=t.readUint32();this.stereo_indication_type=t.readString(n);var o,f;for(this.boxes=[];t.getPosition()<this.start+this.size;)if(o=a.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),o.code===a.OK)f=o.box,this.boxes.push(f),this[f.type]=f;else return}),a.createBoxCtor("styp","SegmentTypeBox",function(t){a.ftypBox.prototype.parse.call(this,t)}),a.createFullBoxCtor("stz2","CompactSampleSizeBox",function(t){var e,n;if(this.sample_sizes=[],this.version===0)if(this.reserved=t.readUint24(),this.field_size=t.readUint8(),n=t.readUint32(),this.field_size===4)for(e=0;e<n;e+=2){var o=t.readUint8();this.sample_sizes[e]=o>>4&15,this.sample_sizes[e+1]=o&15}else if(this.field_size===8)for(e=0;e<n;e++)this.sample_sizes[e]=t.readUint8();else if(this.field_size===16)for(e=0;e<n;e++)this.sample_sizes[e]=t.readUint16();else s.error("BoxParser","Error in length field in stz2 box")}),a.createFullBoxCtor("subs","SubSampleInformationBox",function(t){var e,n,o,f;for(o=t.readUint32(),this.entries=[],e=0;e<o;e++){var c={};if(this.entries[e]=c,c.sample_delta=t.readUint32(),c.subsamples=[],f=t.readUint16(),f>0)for(n=0;n<f;n++){var v={};c.subsamples.push(v),this.version==1?v.size=t.readUint32():v.size=t.readUint16(),v.priority=t.readUint8(),v.discardable=t.readUint8(),v.codec_specific_parameters=t.readUint32()}}}),a.createFullBoxCtor("tenc","TrackEncryptionBox",function(t){if(t.readUint8(),this.version===0)t.readUint8();else{var e=t.readUint8();this.default_crypt_byte_block=e>>4&15,this.default_skip_byte_block=e&15}this.default_isProtected=t.readUint8(),this.default_Per_Sample_IV_Size=t.readUint8(),this.default_KID=a.parseHex16(t),this.default_isProtected===1&&this.default_Per_Sample_IV_Size===0&&(this.default_constant_IV_size=t.readUint8(),this.default_constant_IV=t.readUint8Array(this.default_constant_IV_size))}),a.createFullBoxCtor("tfdt","TrackFragmentBaseMediaDecodeTimeBox",function(t){this.version==1?this.baseMediaDecodeTime=t.readUint64():this.baseMediaDecodeTime=t.readUint32()}),a.createFullBoxCtor("tfhd","TrackFragmentHeaderBox",function(t){var e=0;this.track_id=t.readUint32(),this.size-this.hdr_size>e&&this.flags&a.TFHD_FLAG_BASE_DATA_OFFSET?(this.base_data_offset=t.readUint64(),e+=8):this.base_data_offset=0,this.size-this.hdr_size>e&&this.flags&a.TFHD_FLAG_SAMPLE_DESC?(this.default_sample_description_index=t.readUint32(),e+=4):this.default_sample_description_index=0,this.size-this.hdr_size>e&&this.flags&a.TFHD_FLAG_SAMPLE_DUR?(this.default_sample_duration=t.readUint32(),e+=4):this.default_sample_duration=0,this.size-this.hdr_size>e&&this.flags&a.TFHD_FLAG_SAMPLE_SIZE?(this.default_sample_size=t.readUint32(),e+=4):this.default_sample_size=0,this.size-this.hdr_size>e&&this.flags&a.TFHD_FLAG_SAMPLE_FLAGS?(this.default_sample_flags=t.readUint32(),e+=4):this.default_sample_flags=0}),a.createFullBoxCtor("tfra","TrackFragmentRandomAccessBox",function(t){this.track_ID=t.readUint32(),t.readUint24();var e=t.readUint8();this.length_size_of_traf_num=e>>4&3,this.length_size_of_trun_num=e>>2&3,this.length_size_of_sample_num=e&3,this.entries=[];for(var n=t.readUint32(),o=0;o<n;o++)this.version===1?(this.time=t.readUint64(),this.moof_offset=t.readUint64()):(this.time=t.readUint32(),this.moof_offset=t.readUint32()),this.traf_number=t["readUint"+8*(this.length_size_of_traf_num+1)](),this.trun_number=t["readUint"+8*(this.length_size_of_trun_num+1)](),this.sample_number=t["readUint"+8*(this.length_size_of_sample_num+1)]()}),a.createFullBoxCtor("tkhd","TrackHeaderBox",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint32()),t.readUint32Array(2),this.layer=t.readInt16(),this.alternate_group=t.readInt16(),this.volume=t.readInt16()>>8,t.readUint16(),this.matrix=t.readInt32Array(9),this.width=t.readUint32(),this.height=t.readUint32()}),a.createBoxCtor("tmax","hintmaxrelativetime",function(t){this.time=t.readUint32()}),a.createBoxCtor("tmin","hintminrelativetime",function(t){this.time=t.readUint32()}),a.createBoxCtor("totl","hintBytesSent",function(t){this.bytessent=t.readUint32()}),a.createBoxCtor("tpay","hintBytesSent",function(t){this.bytessent=t.readUint32()}),a.createBoxCtor("tpyl","hintBytesSent",function(t){this.bytessent=t.readUint64()}),a.TrackGroupTypeBox.prototype.parse=function(t){this.parseFullHeader(t),this.track_group_id=t.readUint32()},a.createTrackGroupCtor("msrc"),a.TrackReferenceTypeBox=function(t,e,n,o){a.Box.call(this,t,e),this.hdr_size=n,this.start=o},a.TrackReferenceTypeBox.prototype=new a.Box,a.TrackReferenceTypeBox.prototype.parse=function(t){this.track_ids=t.readUint32Array((this.size-this.hdr_size)/4)},a.trefBox.prototype.parse=function(t){for(var e,n;t.getPosition()<this.start+this.size;)if(e=a.parseOneBox(t,!0,this.size-(t.getPosition()-this.start)),e.code===a.OK)n=new a.TrackReferenceTypeBox(e.type,e.size,e.hdr_size,e.start),n.write===a.Box.prototype.write&&n.type!=="mdat"&&(s.info("BoxParser","TrackReference "+n.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),n.parseDataAndRewind(t)),n.parse(t),this.boxes.push(n);else return},a.createFullBoxCtor("trep","TrackExtensionPropertiesBox",function(t){for(this.track_ID=t.readUint32(),this.boxes=[];t.getPosition()<this.start+this.size;)if(ret=a.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),ret.code===a.OK)box=ret.box,this.boxes.push(box);else return}),a.createFullBoxCtor("trex","TrackExtendsBox",function(t){this.track_id=t.readUint32(),this.default_sample_description_index=t.readUint32(),this.default_sample_duration=t.readUint32(),this.default_sample_size=t.readUint32(),this.default_sample_flags=t.readUint32()}),a.createBoxCtor("trpy","hintBytesSent",function(t){this.bytessent=t.readUint64()}),a.createFullBoxCtor("trun","TrackRunBox",function(t){var e=0;if(this.sample_count=t.readUint32(),e+=4,this.size-this.hdr_size>e&&this.flags&a.TRUN_FLAGS_DATA_OFFSET?(this.data_offset=t.readInt32(),e+=4):this.data_offset=0,this.size-this.hdr_size>e&&this.flags&a.TRUN_FLAGS_FIRST_FLAG?(this.first_sample_flags=t.readUint32(),e+=4):this.first_sample_flags=0,this.sample_duration=[],this.sample_size=[],this.sample_flags=[],this.sample_composition_time_offset=[],this.size-this.hdr_size>e)for(var n=0;n<this.sample_count;n++)this.flags&a.TRUN_FLAGS_DURATION&&(this.sample_duration[n]=t.readUint32()),this.flags&a.TRUN_FLAGS_SIZE&&(this.sample_size[n]=t.readUint32()),this.flags&a.TRUN_FLAGS_FLAGS&&(this.sample_flags[n]=t.readUint32()),this.flags&a.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?this.sample_composition_time_offset[n]=t.readUint32():this.sample_composition_time_offset[n]=t.readInt32())}),a.createFullBoxCtor("tsel","TrackSelectionBox",function(t){this.switch_group=t.readUint32();var e=(this.size-this.hdr_size-4)/4;this.attribute_list=[];for(var n=0;n<e;n++)this.attribute_list[n]=t.readUint32()}),a.createFullBoxCtor("txtC","TextConfigBox",function(t){this.config=t.readCString()}),a.createBoxCtor("tyco","TypeCombinationBox",function(t){var e=(this.size-this.hdr_size)/4;this.compatible_brands=[];for(var n=0;n<e;n++)this.compatible_brands[n]=t.readString(4)}),a.createFullBoxCtor("udes","UserDescriptionProperty",function(t){this.lang=t.readCString(),this.name=t.readCString(),this.description=t.readCString(),this.tags=t.readCString()}),a.createFullBoxCtor("uncC","UncompressedFrameConfigBox",function(t){var e;if(this.profile=t.readString(4),this.version!=1){if(this.version==0){for(this.component_count=t.readUint32(),this.component_index=[],this.component_bit_depth_minus_one=[],this.component_format=[],this.component_align_size=[],e=0;e<this.component_count;e++)this.component_index.push(t.readUint16()),this.component_bit_depth_minus_one.push(t.readUint8()),this.component_format.push(t.readUint8()),this.component_align_size.push(t.readUint8());this.sampling_type=t.readUint8(),this.interleave_type=t.readUint8(),this.block_size=t.readUint8();var n=t.readUint8();this.component_little_endian=n>>7&1,this.block_pad_lsb=n>>6&1,this.block_little_endian=n>>5&1,this.block_reversed=n>>4&1,this.pad_unknown=n>>3&1,this.pixel_size=t.readUint32(),this.row_align_size=t.readUint32(),this.tile_align_size=t.readUint32(),this.num_tile_cols_minus_one=t.readUint32(),this.num_tile_rows_minus_one=t.readUint32()}}}),a.createFullBoxCtor("url ","DataEntryUrlBox",function(t){this.flags!==1&&(this.location=t.readCString())}),a.createFullBoxCtor("urn ","DataEntryUrnBox",function(t){this.name=t.readCString(),this.size-this.hdr_size-this.name.length-1>0&&(this.location=t.readCString())}),a.createUUIDBox("a5d40b30e81411ddba2f0800200c9a66","LiveServerManifestBox",!0,!1,function(t){this.LiveServerManifest=t.readString(this.size-this.hdr_size).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}),a.createUUIDBox("d08a4f1810f34a82b6c832d8aba183d3","PiffProtectionSystemSpecificHeaderBox",!0,!1,function(t){this.system_id=a.parseHex16(t);var e=t.readUint32();e>0&&(this.data=t.readUint8Array(e))}),a.createUUIDBox("a2394f525a9b4f14a2446c427c648df4","PiffSampleEncryptionBox",!0,!1),a.createUUIDBox("8974dbce7be74c5184f97148f9882554","PiffTrackEncryptionBox",!0,!1,function(t){this.default_AlgorithmID=t.readUint24(),this.default_IV_size=t.readUint8(),this.default_KID=a.parseHex16(t)}),a.createUUIDBox("d4807ef2ca3946958e5426cb9e46a79f","TfrfBox",!0,!1,function(t){this.fragment_count=t.readUint8(),this.entries=[];for(var e=0;e<this.fragment_count;e++){var n={},o=0,f=0;this.version===1?(o=t.readUint64(),f=t.readUint64()):(o=t.readUint32(),f=t.readUint32()),n.absolute_time=o,n.absolute_duration=f,this.entries.push(n)}}),a.createUUIDBox("6d1d9b0542d544e680e2141daff757b2","TfxdBox",!0,!1,function(t){this.version===1?(this.absolute_time=t.readUint64(),this.duration=t.readUint64()):(this.absolute_time=t.readUint32(),this.duration=t.readUint32())}),a.createFullBoxCtor("vmhd","VideoMediaHeaderBox",function(t){this.graphicsmode=t.readUint16(),this.opcolor=t.readUint16Array(3)}),a.createFullBoxCtor("vpcC","VPCodecConfigurationRecord",function(t){var e;this.version===1?(this.profile=t.readUint8(),this.level=t.readUint8(),e=t.readUint8(),this.bitDepth=e>>4,this.chromaSubsampling=e>>1&7,this.videoFullRangeFlag=e&1,this.colourPrimaries=t.readUint8(),this.transferCharacteristics=t.readUint8(),this.matrixCoefficients=t.readUint8(),this.codecIntializationDataSize=t.readUint16(),this.codecIntializationData=t.readUint8Array(this.codecIntializationDataSize)):(this.profile=t.readUint8(),this.level=t.readUint8(),e=t.readUint8(),this.bitDepth=e>>4&15,this.colorSpace=e&15,e=t.readUint8(),this.chromaSubsampling=e>>4&15,this.transferFunction=e>>1&7,this.videoFullRangeFlag=e&1,this.codecIntializationDataSize=t.readUint16(),this.codecIntializationData=t.readUint8Array(this.codecIntializationDataSize))}),a.createBoxCtor("vttC","WebVTTConfigurationBox",function(t){this.text=t.readString(this.size-this.hdr_size)}),a.createFullBoxCtor("vvcC","VvcConfigurationBox",function(t){var e,n,o={held_bits:void 0,num_held_bits:0,stream_read_1_bytes:function(z){this.held_bits=z.readUint8(),this.num_held_bits=8},stream_read_2_bytes:function(z){this.held_bits=z.readUint16(),this.num_held_bits=16},extract_bits:function(z){var K=this.held_bits>>this.num_held_bits-z&(1<<z)-1;return this.num_held_bits-=z,K}};if(o.stream_read_1_bytes(t),o.extract_bits(5),this.lengthSizeMinusOne=o.extract_bits(2),this.ptl_present_flag=o.extract_bits(1),this.ptl_present_flag){o.stream_read_2_bytes(t),this.ols_idx=o.extract_bits(9),this.num_sublayers=o.extract_bits(3),this.constant_frame_rate=o.extract_bits(2),this.chroma_format_idc=o.extract_bits(2),o.stream_read_1_bytes(t),this.bit_depth_minus8=o.extract_bits(3),o.extract_bits(5);{if(o.stream_read_2_bytes(t),o.extract_bits(2),this.num_bytes_constraint_info=o.extract_bits(6),this.general_profile_idc=o.extract_bits(7),this.general_tier_flag=o.extract_bits(1),this.general_level_idc=t.readUint8(),o.stream_read_1_bytes(t),this.ptl_frame_only_constraint_flag=o.extract_bits(1),this.ptl_multilayer_enabled_flag=o.extract_bits(1),this.general_constraint_info=new Uint8Array(this.num_bytes_constraint_info),this.num_bytes_constraint_info){for(e=0;e<this.num_bytes_constraint_info-1;e++){var f=o.extract_bits(6);o.stream_read_1_bytes(t);var c=o.extract_bits(2);this.general_constraint_info[e]=f<<2|c}this.general_constraint_info[this.num_bytes_constraint_info-1]=o.extract_bits(6)}else o.extract_bits(6);if(this.num_sublayers>1){for(o.stream_read_1_bytes(t),this.ptl_sublayer_present_mask=0,n=this.num_sublayers-2;n>=0;--n){var v=o.extract_bits(1);this.ptl_sublayer_present_mask|=v<<n}for(n=this.num_sublayers;n<=8&&this.num_sublayers>1;++n)o.extract_bits(1);for(this.sublayer_level_idc=[],n=this.num_sublayers-2;n>=0;--n)this.ptl_sublayer_present_mask&1<<n&&(this.sublayer_level_idc[n]=t.readUint8())}if(this.ptl_num_sub_profiles=t.readUint8(),this.general_sub_profile_idc=[],this.ptl_num_sub_profiles)for(e=0;e<this.ptl_num_sub_profiles;e++)this.general_sub_profile_idc.push(t.readUint32())}this.max_picture_width=t.readUint16(),this.max_picture_height=t.readUint16(),this.avg_frame_rate=t.readUint16()}var g=12,x=13;this.nalu_arrays=[];var S=t.readUint8();for(e=0;e<S;e++){var E=[];this.nalu_arrays.push(E),o.stream_read_1_bytes(t),E.completeness=o.extract_bits(1),o.extract_bits(2),E.nalu_type=o.extract_bits(5);var A=1;for(E.nalu_type!=x&&E.nalu_type!=g&&(A=t.readUint16()),n=0;n<A;n++){var M=t.readUint16();E.push({data:t.readUint8Array(M),length:M})}}}),a.createFullBoxCtor("vvnC","VvcNALUConfigBox",function(t){var e=strm.readUint8();this.lengthSizeMinusOne=e&3}),a.SampleEntry.prototype.isVideo=function(){return!1},a.SampleEntry.prototype.isAudio=function(){return!1},a.SampleEntry.prototype.isSubtitle=function(){return!1},a.SampleEntry.prototype.isMetadata=function(){return!1},a.SampleEntry.prototype.isHint=function(){return!1},a.SampleEntry.prototype.getCodec=function(){return this.type.replace(".","")},a.SampleEntry.prototype.getWidth=function(){return""},a.SampleEntry.prototype.getHeight=function(){return""},a.SampleEntry.prototype.getChannelCount=function(){return""},a.SampleEntry.prototype.getSampleRate=function(){return""},a.SampleEntry.prototype.getSampleSize=function(){return""},a.VisualSampleEntry.prototype.isVideo=function(){return!0},a.VisualSampleEntry.prototype.getWidth=function(){return this.width},a.VisualSampleEntry.prototype.getHeight=function(){return this.height},a.AudioSampleEntry.prototype.isAudio=function(){return!0},a.AudioSampleEntry.prototype.getChannelCount=function(){return this.channel_count},a.AudioSampleEntry.prototype.getSampleRate=function(){return this.samplerate},a.AudioSampleEntry.prototype.getSampleSize=function(){return this.samplesize},a.SubtitleSampleEntry.prototype.isSubtitle=function(){return!0},a.MetadataSampleEntry.prototype.isMetadata=function(){return!0},a.decimalToHex=function(t,e){var n=Number(t).toString(16);for(e=typeof e>"u"||e===null?e=2:e;n.length<e;)n="0"+n;return n},a.avc1SampleEntry.prototype.getCodec=a.avc2SampleEntry.prototype.getCodec=a.avc3SampleEntry.prototype.getCodec=a.avc4SampleEntry.prototype.getCodec=function(){var t=a.SampleEntry.prototype.getCodec.call(this);return this.avcC?t+"."+a.decimalToHex(this.avcC.AVCProfileIndication)+a.decimalToHex(this.avcC.profile_compatibility)+a.decimalToHex(this.avcC.AVCLevelIndication):t},a.hev1SampleEntry.prototype.getCodec=a.hvc1SampleEntry.prototype.getCodec=function(){var t,e=a.SampleEntry.prototype.getCodec.call(this);if(this.hvcC){switch(e+=".",this.hvcC.general_profile_space){case 0:e+="";break;case 1:e+="A";break;case 2:e+="B";break;case 3:e+="C";break}e+=this.hvcC.general_profile_idc,e+=".";var n=this.hvcC.general_profile_compatibility,o=0;for(t=0;t<32&&(o|=n&1,t!=31);t++)o<<=1,n>>=1;e+=a.decimalToHex(o,0),e+=".",this.hvcC.general_tier_flag===0?e+="L":e+="H",e+=this.hvcC.general_level_idc;var f=!1,c="";for(t=5;t>=0;t--)(this.hvcC.general_constraint_indicator[t]||f)&&(c="."+a.decimalToHex(this.hvcC.general_constraint_indicator[t],0)+c,f=!0);e+=c}return e},a.vvc1SampleEntry.prototype.getCodec=a.vvi1SampleEntry.prototype.getCodec=function(){var t,e=a.SampleEntry.prototype.getCodec.call(this);if(this.vvcC){e+="."+this.vvcC.general_profile_idc,this.vvcC.general_tier_flag?e+=".H":e+=".L",e+=this.vvcC.general_level_idc;var n="";if(this.vvcC.general_constraint_info){var o=[],f=0;f|=this.vvcC.ptl_frame_only_constraint<<7,f|=this.vvcC.ptl_multilayer_enabled<<6;var c;for(t=0;t<this.vvcC.general_constraint_info.length;++t)f|=this.vvcC.general_constraint_info[t]>>2&63,o.push(f),f&&(c=t),f=this.vvcC.general_constraint_info[t]>>2&3;if(c===void 0)n=".CA";else{n=".C";var v="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",g=0,x=0;for(t=0;t<=c;++t)for(g=g<<8|o[t],x+=8;x>=5;){var S=g>>x-5&31;n+=v[S],x-=5,g&=(1<<x)-1}x&&(g<<=5-x,n+=v[g&31])}}e+=n}return e},a.mp4aSampleEntry.prototype.getCodec=function(){var t=a.SampleEntry.prototype.getCodec.call(this);if(this.esds&&this.esds.esd){var e=this.esds.esd.getOTI(),n=this.esds.esd.getAudioConfig();return t+"."+a.decimalToHex(e)+(n?"."+n:"")}else return t},a.stxtSampleEntry.prototype.getCodec=function(){var t=a.SampleEntry.prototype.getCodec.call(this);return this.mime_format?t+"."+this.mime_format:t},a.vp08SampleEntry.prototype.getCodec=a.vp09SampleEntry.prototype.getCodec=function(){var t=a.SampleEntry.prototype.getCodec.call(this),e=this.vpcC.level;e==0&&(e="00");var n=this.vpcC.bitDepth;return n==8&&(n="08"),t+".0"+this.vpcC.profile+"."+e+"."+n},a.av01SampleEntry.prototype.getCodec=function(){var t=a.SampleEntry.prototype.getCodec.call(this),e=this.av1C.seq_level_idx_0;e<10&&(e="0"+e);var n;return this.av1C.seq_profile===2&&this.av1C.high_bitdepth===1?n=this.av1C.twelve_bit===1?"12":"10":this.av1C.seq_profile<=2&&(n=this.av1C.high_bitdepth===1?"10":"08"),t+"."+this.av1C.seq_profile+"."+e+(this.av1C.seq_tier_0?"H":"M")+"."+n},a.Box.prototype.writeHeader=function(t,e){this.size+=8,this.size>d&&(this.size+=8),this.type==="uuid"&&(this.size+=16),s.debug("BoxWriter","Writing box "+this.type+" of size: "+this.size+" at position "+t.getPosition()+(e||"")),this.size>d?t.writeUint32(1):(this.sizePosition=t.getPosition(),t.writeUint32(this.size)),t.writeString(this.type,null,4),this.type==="uuid"&&t.writeUint8Array(this.uuid),this.size>d&&t.writeUint64(this.size)},a.FullBox.prototype.writeHeader=function(t){this.size+=4,a.Box.prototype.writeHeader.call(this,t," v="+this.version+" f="+this.flags),t.writeUint8(this.version),t.writeUint24(this.flags)},a.Box.prototype.write=function(t){this.type==="mdat"?this.data&&(this.size=this.data.length,this.writeHeader(t),t.writeUint8Array(this.data)):(this.size=this.data?this.data.length:0,this.writeHeader(t),this.data&&t.writeUint8Array(this.data))},a.ContainerBox.prototype.write=function(t){this.size=0,this.writeHeader(t);for(var e=0;e<this.boxes.length;e++)this.boxes[e]&&(this.boxes[e].write(t),this.size+=this.boxes[e].size);s.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},a.TrackReferenceTypeBox.prototype.write=function(t){this.size=this.track_ids.length*4,this.writeHeader(t),t.writeUint32Array(this.track_ids)},a.avcCBox.prototype.write=function(t){var e;for(this.size=7,e=0;e<this.SPS.length;e++)this.size+=2+this.SPS[e].length;for(e=0;e<this.PPS.length;e++)this.size+=2+this.PPS[e].length;for(this.ext&&(this.size+=this.ext.length),this.writeHeader(t),t.writeUint8(this.configurationVersion),t.writeUint8(this.AVCProfileIndication),t.writeUint8(this.profile_compatibility),t.writeUint8(this.AVCLevelIndication),t.writeUint8(this.lengthSizeMinusOne+252),t.writeUint8(this.SPS.length+224),e=0;e<this.SPS.length;e++)t.writeUint16(this.SPS[e].length),t.writeUint8Array(this.SPS[e].nalu);for(t.writeUint8(this.PPS.length),e=0;e<this.PPS.length;e++)t.writeUint16(this.PPS[e].length),t.writeUint8Array(this.PPS[e].nalu);this.ext&&t.writeUint8Array(this.ext)},a.co64Box.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),e=0;e<this.chunk_offsets.length;e++)t.writeUint64(this.chunk_offsets[e])},a.cslgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(t),t.writeInt32(this.compositionToDTSShift),t.writeInt32(this.leastDecodeToDisplayDelta),t.writeInt32(this.greatestDecodeToDisplayDelta),t.writeInt32(this.compositionStartTime),t.writeInt32(this.compositionEndTime)},a.cttsBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),e=0;e<this.sample_counts.length;e++)t.writeUint32(this.sample_counts[e]),this.version===1?t.writeInt32(this.sample_offsets[e]):t.writeUint32(this.sample_offsets[e])},a.drefBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++)this.entries[e].write(t),this.size+=this.entries[e].size;s.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},a.elngBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.extended_language.length,this.writeHeader(t),t.writeString(this.extended_language)},a.elstBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+12*this.entries.length,this.writeHeader(t),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++){var n=this.entries[e];t.writeUint32(n.segment_duration),t.writeInt32(n.media_time),t.writeInt16(n.media_rate_integer),t.writeInt16(n.media_rate_fraction)}},a.emsgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*4+this.message_data.length+(this.scheme_id_uri.length+1)+(this.value.length+1),this.writeHeader(t),t.writeCString(this.scheme_id_uri),t.writeCString(this.value),t.writeUint32(this.timescale),t.writeUint32(this.presentation_time_delta),t.writeUint32(this.event_duration),t.writeUint32(this.id),t.writeUint8Array(this.message_data)},a.ftypBox.prototype.write=function(t){this.size=8+4*this.compatible_brands.length,this.writeHeader(t),t.writeString(this.major_brand,null,4),t.writeUint32(this.minor_version);for(var e=0;e<this.compatible_brands.length;e++)t.writeString(this.compatible_brands[e],null,4)},a.hdlrBox.prototype.write=function(t){this.size=5*4+this.name.length+1,this.version=0,this.flags=0,this.writeHeader(t),t.writeUint32(0),t.writeString(this.handler,null,4),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeCString(this.name)},a.hvcCBox.prototype.write=function(t){var e,n;for(this.size=23,e=0;e<this.nalu_arrays.length;e++)for(this.size+=3,n=0;n<this.nalu_arrays[e].length;n++)this.size+=2+this.nalu_arrays[e][n].data.length;for(this.writeHeader(t),t.writeUint8(this.configurationVersion),t.writeUint8((this.general_profile_space<<6)+(this.general_tier_flag<<5)+this.general_profile_idc),t.writeUint32(this.general_profile_compatibility),t.writeUint8Array(this.general_constraint_indicator),t.writeUint8(this.general_level_idc),t.writeUint16(this.min_spatial_segmentation_idc+(15<<24)),t.writeUint8(this.parallelismType+252),t.writeUint8(this.chroma_format_idc+252),t.writeUint8(this.bit_depth_luma_minus8+248),t.writeUint8(this.bit_depth_chroma_minus8+248),t.writeUint16(this.avgFrameRate),t.writeUint8((this.constantFrameRate<<6)+(this.numTemporalLayers<<3)+(this.temporalIdNested<<2)+this.lengthSizeMinusOne),t.writeUint8(this.nalu_arrays.length),e=0;e<this.nalu_arrays.length;e++)for(t.writeUint8((this.nalu_arrays[e].completeness<<7)+this.nalu_arrays[e].nalu_type),t.writeUint16(this.nalu_arrays[e].length),n=0;n<this.nalu_arrays[e].length;n++)t.writeUint16(this.nalu_arrays[e][n].data.length),t.writeUint8Array(this.nalu_arrays[e][n].data)},a.kindBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.schemeURI.length+1+(this.value.length+1),this.writeHeader(t),t.writeCString(this.schemeURI),t.writeCString(this.value)},a.mdhdBox.prototype.write=function(t){this.size=4*4+2*2,this.flags=0,this.version=0,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint16(this.language),t.writeUint16(0)},a.mehdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.fragment_duration)},a.mfhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.sequence_number)},a.mvhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=23*4+2*2,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint32(this.rate),t.writeUint16(this.volume<<8),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32Array(this.matrix),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(this.next_track_id)},a.SampleEntry.prototype.writeHeader=function(t){this.size=8,a.Box.prototype.writeHeader.call(this,t),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint16(this.data_reference_index)},a.SampleEntry.prototype.writeFooter=function(t){for(var e=0;e<this.boxes.length;e++)this.boxes[e].write(t),this.size+=this.boxes[e].size;s.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},a.SampleEntry.prototype.write=function(t){this.writeHeader(t),t.writeUint8Array(this.data),this.size+=this.data.length,s.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},a.VisualSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=2*7+6*4+32,t.writeUint16(0),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.width),t.writeUint16(this.height),t.writeUint32(this.horizresolution),t.writeUint32(this.vertresolution),t.writeUint32(0),t.writeUint16(this.frame_count),t.writeUint8(Math.min(31,this.compressorname.length)),t.writeString(this.compressorname,null,31),t.writeUint16(this.depth),t.writeInt16(-1),this.writeFooter(t)},a.AudioSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=2*4+3*4,t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.channel_count),t.writeUint16(this.samplesize),t.writeUint16(0),t.writeUint16(0),t.writeUint32(this.samplerate<<16),this.writeFooter(t)},a.stppSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=this.namespace.length+1+this.schema_location.length+1+this.auxiliary_mime_types.length+1,t.writeCString(this.namespace),t.writeCString(this.schema_location),t.writeCString(this.auxiliary_mime_types),this.writeFooter(t)},a.SampleGroupEntry.prototype.write=function(t){t.writeUint8Array(this.data)},a.sbgpBox.prototype.write=function(t){this.version=1,this.flags=0,this.size=12+8*this.entries.length,this.writeHeader(t),t.writeString(this.grouping_type,null,4),t.writeUint32(this.grouping_type_parameter),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++){var n=this.entries[e];t.writeInt32(n.sample_count),t.writeInt32(n.group_description_index)}},a.sgpdBox.prototype.write=function(t){var e,n;for(this.flags=0,this.size=12,e=0;e<this.entries.length;e++)n=this.entries[e],this.version===1&&(this.default_length===0&&(this.size+=4),this.size+=n.data.length);for(this.writeHeader(t),t.writeString(this.grouping_type,null,4),this.version===1&&t.writeUint32(this.default_length),this.version>=2&&t.writeUint32(this.default_sample_description_index),t.writeUint32(this.entries.length),e=0;e<this.entries.length;e++)n=this.entries[e],this.version===1&&this.default_length===0&&t.writeUint32(n.description_length),n.write(t)},a.sidxBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*4+2+2+12*this.references.length,this.writeHeader(t),t.writeUint32(this.reference_ID),t.writeUint32(this.timescale),t.writeUint32(this.earliest_presentation_time),t.writeUint32(this.first_offset),t.writeUint16(0),t.writeUint16(this.references.length);for(var e=0;e<this.references.length;e++){var n=this.references[e];t.writeUint32(n.reference_type<<31|n.referenced_size),t.writeUint32(n.subsegment_duration),t.writeUint32(n.starts_with_SAP<<31|n.SAP_type<<28|n.SAP_delta_time)}},a.smhdBox.prototype.write=function(t){this.version=0,this.flags=1,this.size=4,this.writeHeader(t),t.writeUint16(this.balance),t.writeUint16(0)},a.stcoBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),t.writeUint32Array(this.chunk_offsets)},a.stscBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+12*this.first_chunk.length,this.writeHeader(t),t.writeUint32(this.first_chunk.length),e=0;e<this.first_chunk.length;e++)t.writeUint32(this.first_chunk[e]),t.writeUint32(this.samples_per_chunk[e]),t.writeUint32(this.sample_description_index[e])},a.stsdBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=0,this.writeHeader(t),t.writeUint32(this.entries.length),this.size+=4,e=0;e<this.entries.length;e++)this.entries[e].write(t),this.size+=this.entries[e].size;s.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},a.stshBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.shadowed_sample_numbers.length,this.writeHeader(t),t.writeUint32(this.shadowed_sample_numbers.length),e=0;e<this.shadowed_sample_numbers.length;e++)t.writeUint32(this.shadowed_sample_numbers[e]),t.writeUint32(this.sync_sample_numbers[e])},a.stssBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.sample_numbers.length,this.writeHeader(t),t.writeUint32(this.sample_numbers.length),t.writeUint32Array(this.sample_numbers)},a.stszBox.prototype.write=function(t){var e,n=!0;if(this.version=0,this.flags=0,this.sample_sizes.length>0)for(e=0;e+1<this.sample_sizes.length;)if(this.sample_sizes[e+1]!==this.sample_sizes[0]){n=!1;break}else e++;else n=!1;this.size=8,n||(this.size+=4*this.sample_sizes.length),this.writeHeader(t),n?t.writeUint32(this.sample_sizes[0]):t.writeUint32(0),t.writeUint32(this.sample_sizes.length),n||t.writeUint32Array(this.sample_sizes)},a.sttsBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),e=0;e<this.sample_counts.length;e++)t.writeUint32(this.sample_counts[e]),t.writeUint32(this.sample_deltas[e])},a.tfdtBox.prototype.write=function(t){var e=Math.pow(2,32)-1;this.version=this.baseMediaDecodeTime>e?1:0,this.flags=0,this.size=4,this.version===1&&(this.size+=4),this.writeHeader(t),this.version===1?t.writeUint64(this.baseMediaDecodeTime):t.writeUint32(this.baseMediaDecodeTime)},a.tfhdBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&a.TFHD_FLAG_BASE_DATA_OFFSET&&(this.size+=8),this.flags&a.TFHD_FLAG_SAMPLE_DESC&&(this.size+=4),this.flags&a.TFHD_FLAG_SAMPLE_DUR&&(this.size+=4),this.flags&a.TFHD_FLAG_SAMPLE_SIZE&&(this.size+=4),this.flags&a.TFHD_FLAG_SAMPLE_FLAGS&&(this.size+=4),this.writeHeader(t),t.writeUint32(this.track_id),this.flags&a.TFHD_FLAG_BASE_DATA_OFFSET&&t.writeUint64(this.base_data_offset),this.flags&a.TFHD_FLAG_SAMPLE_DESC&&t.writeUint32(this.default_sample_description_index),this.flags&a.TFHD_FLAG_SAMPLE_DUR&&t.writeUint32(this.default_sample_duration),this.flags&a.TFHD_FLAG_SAMPLE_SIZE&&t.writeUint32(this.default_sample_size),this.flags&a.TFHD_FLAG_SAMPLE_FLAGS&&t.writeUint32(this.default_sample_flags)},a.tkhdBox.prototype.write=function(t){this.version=0,this.size=4*18+2*4,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.track_id),t.writeUint32(0),t.writeUint32(this.duration),t.writeUint32(0),t.writeUint32(0),t.writeInt16(this.layer),t.writeInt16(this.alternate_group),t.writeInt16(this.volume<<8),t.writeUint16(0),t.writeInt32Array(this.matrix),t.writeUint32(this.width),t.writeUint32(this.height)},a.trexBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(t),t.writeUint32(this.track_id),t.writeUint32(this.default_sample_description_index),t.writeUint32(this.default_sample_duration),t.writeUint32(this.default_sample_size),t.writeUint32(this.default_sample_flags)},a.trunBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&a.TRUN_FLAGS_DATA_OFFSET&&(this.size+=4),this.flags&a.TRUN_FLAGS_FIRST_FLAG&&(this.size+=4),this.flags&a.TRUN_FLAGS_DURATION&&(this.size+=4*this.sample_duration.length),this.flags&a.TRUN_FLAGS_SIZE&&(this.size+=4*this.sample_size.length),this.flags&a.TRUN_FLAGS_FLAGS&&(this.size+=4*this.sample_flags.length),this.flags&a.TRUN_FLAGS_CTS_OFFSET&&(this.size+=4*this.sample_composition_time_offset.length),this.writeHeader(t),t.writeUint32(this.sample_count),this.flags&a.TRUN_FLAGS_DATA_OFFSET&&(this.data_offset_position=t.getPosition(),t.writeInt32(this.data_offset)),this.flags&a.TRUN_FLAGS_FIRST_FLAG&&t.writeUint32(this.first_sample_flags);for(var e=0;e<this.sample_count;e++)this.flags&a.TRUN_FLAGS_DURATION&&t.writeUint32(this.sample_duration[e]),this.flags&a.TRUN_FLAGS_SIZE&&t.writeUint32(this.sample_size[e]),this.flags&a.TRUN_FLAGS_FLAGS&&t.writeUint32(this.sample_flags[e]),this.flags&a.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?t.writeUint32(this.sample_composition_time_offset[e]):t.writeInt32(this.sample_composition_time_offset[e]))},a["url Box"].prototype.write=function(t){this.version=0,this.location?(this.flags=0,this.size=this.location.length+1):(this.flags=1,this.size=0),this.writeHeader(t),this.location&&t.writeCString(this.location)},a["urn Box"].prototype.write=function(t){this.version=0,this.flags=0,this.size=this.name.length+1+(this.location?this.location.length+1:0),this.writeHeader(t),t.writeCString(this.name),this.location&&t.writeCString(this.location)},a.vmhdBox.prototype.write=function(t){this.version=0,this.flags=1,this.size=8,this.writeHeader(t),t.writeUint16(this.graphicsmode),t.writeUint16Array(this.opcolor)},a.cttsBox.prototype.unpack=function(t){var e,n,o;for(o=0,e=0;e<this.sample_counts.length;e++)for(n=0;n<this.sample_counts[e];n++)t[o].pts=t[o].dts+this.sample_offsets[e],o++},a.sttsBox.prototype.unpack=function(t){var e,n,o;for(o=0,e=0;e<this.sample_counts.length;e++)for(n=0;n<this.sample_counts[e];n++)o===0?t[o].dts=0:t[o].dts=t[o-1].dts+this.sample_deltas[e],o++},a.stcoBox.prototype.unpack=function(t){var e;for(e=0;e<this.chunk_offsets.length;e++)t[e].offset=this.chunk_offsets[e]},a.stscBox.prototype.unpack=function(t){var e,n,o,f,c;for(f=0,c=0,e=0;e<this.first_chunk.length;e++)for(n=0;n<(e+1<this.first_chunk.length?this.first_chunk[e+1]:1/0);n++)for(c++,o=0;o<this.samples_per_chunk[e];o++){if(t[f])t[f].description_index=this.sample_description_index[e],t[f].chunk_index=c;else return;f++}},a.stszBox.prototype.unpack=function(t){var e;for(e=0;e<this.sample_sizes.length;e++)t[e].size=this.sample_sizes[e]},a.DIFF_BOXES_PROP_NAMES=["boxes","entries","references","subsamples","items","item_infos","extents","associations","subsegments","ranges","seekLists","seekPoints","esd","levels"],a.DIFF_PRIMITIVE_ARRAY_PROP_NAMES=["compatible_brands","matrix","opcolor","sample_counts","sample_deltas","first_chunk","samples_per_chunk","sample_sizes","chunk_offsets","sample_offsets","sample_description_index","sample_duration"],a.boxEqualFields=function(t,e){if(t&&!e)return!1;var n;for(n in t)if(!(a.DIFF_BOXES_PROP_NAMES.indexOf(n)>-1)){if(t[n]instanceof a.Box||e[n]instanceof a.Box)continue;if(typeof t[n]>"u"||typeof e[n]>"u")continue;if(typeof t[n]=="function"||typeof e[n]=="function")continue;if(t.subBoxNames&&t.subBoxNames.indexOf(n.slice(0,4))>-1||e.subBoxNames&&e.subBoxNames.indexOf(n.slice(0,4))>-1)continue;if(n==="data"||n==="start"||n==="size"||n==="creation_time"||n==="modification_time")continue;if(a.DIFF_PRIMITIVE_ARRAY_PROP_NAMES.indexOf(n)>-1)continue;if(t[n]!==e[n])return!1}return!0},a.boxEqual=function(t,e){if(!a.boxEqualFields(t,e))return!1;for(var n=0;n<a.DIFF_BOXES_PROP_NAMES.length;n++){var o=a.DIFF_BOXES_PROP_NAMES[n];if(t[o]&&e[o]&&!a.boxEqual(t[o],e[o]))return!1}return!0};var T=function(){};T.prototype.parseSample=function(t){var e,n,o=new l(t.buffer);for(e=[];!o.isEos();)n=a.parseOneBox(o,!1),n.code===a.OK&&n.box.type==="vttc"&&e.push(n.box);return e},T.prototype.getText=function(t,e,n){function o(S,E,A){return A=A||"0",S=S+"",S.length>=E?S:new Array(E-S.length+1).join(A)+S}function f(S){var E=Math.floor(S/3600),A=Math.floor((S-E*3600)/60),M=Math.floor(S-E*3600-A*60),z=Math.floor((S-E*3600-A*60-M)*1e3);return""+o(E,2)+":"+o(A,2)+":"+o(M,2)+"."+o(z,3)}for(var c=this.parseSample(n),v="",g=0;g<c.length;g++){var x=c[g];v+=f(t)+" --> "+f(e)+`\r
`,v+=x.payl.text}return v};var C=function(){};C.prototype.parseSample=function(t){var e={},n;e.resources=[];var o=new l(t.data.buffer);if(!t.subsamples||t.subsamples.length===0)e.documentString=o.readString(t.data.length);else if(e.documentString=o.readString(t.subsamples[0].size),t.subsamples.length>1)for(n=1;n<t.subsamples.length;n++)e.resources[n]=o.readUint8Array(t.subsamples[n].size);return typeof DOMParser<"u"&&(e.document=new DOMParser().parseFromString(e.documentString,"application/xml")),e};var P=function(){};P.prototype.parseSample=function(t){var e,n=new l(t.data.buffer);return e=n.readString(t.data.length),e},P.prototype.parseConfig=function(t){var e,n=new l(t.buffer);return n.readUint32(),e=n.readCString(),e},r.VTTin4Parser=T,r.XMLSubtitlein4Parser=C,r.Textin4Parser=P;var y=function(t){this.stream=t||new u,this.boxes=[],this.mdats=[],this.moofs=[],this.isProgressive=!1,this.moovStartFound=!1,this.onMoovStart=null,this.moovStartSent=!1,this.onReady=null,this.readySent=!1,this.onSegment=null,this.onSamples=null,this.onError=null,this.sampleListBuilt=!1,this.fragmentedTracks=[],this.extractedTracks=[],this.isFragmentationInitialized=!1,this.sampleProcessingStarted=!1,this.nextMoofNumber=0,this.itemListBuilt=!1,this.items=[],this.entity_groups=[],this.onSidx=null,this.sidxSent=!1};y.prototype.setSegmentOptions=function(t,e,n){var o=this.getTrackById(t);if(o){var f={};this.fragmentedTracks.push(f),f.id=t,f.user=e,f.trak=o,o.nextSample=0,f.segmentStream=null,f.nb_samples=1e3,f.rapAlignement=!0,n&&(n.nbSamples&&(f.nb_samples=n.nbSamples),n.rapAlignement&&(f.rapAlignement=n.rapAlignement))}},y.prototype.unsetSegmentOptions=function(t){for(var e=-1,n=0;n<this.fragmentedTracks.length;n++){var o=this.fragmentedTracks[n];o.id==t&&(e=n)}e>-1&&this.fragmentedTracks.splice(e,1)},y.prototype.setExtractionOptions=function(t,e,n){var o=this.getTrackById(t);if(o){var f={};this.extractedTracks.push(f),f.id=t,f.user=e,f.trak=o,o.nextSample=0,f.nb_samples=1e3,f.samples=[],n&&n.nbSamples&&(f.nb_samples=n.nbSamples)}},y.prototype.unsetExtractionOptions=function(t){for(var e=-1,n=0;n<this.extractedTracks.length;n++){var o=this.extractedTracks[n];o.id==t&&(e=n)}e>-1&&this.extractedTracks.splice(e,1)},y.prototype.parse=function(){var t,e,n=!1;if(!(this.restoreParsePosition&&!this.restoreParsePosition()))for(;;)if(this.hasIncompleteMdat&&this.hasIncompleteMdat()){if(this.processIncompleteMdat())continue;return}else if(this.saveParsePosition&&this.saveParsePosition(),t=a.parseOneBox(this.stream,n),t.code===a.ERR_NOT_ENOUGH_DATA)if(this.processIncompleteBox){if(this.processIncompleteBox(t))continue;return}else return;else{var o;switch(e=t.box,o=e.type!=="uuid"?e.type:e.uuid,this.boxes.push(e),o){case"mdat":this.mdats.push(e);break;case"moof":this.moofs.push(e);break;case"moov":this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0);default:this[o]!==void 0&&s.warn("ISOFile","Duplicate Box of type: "+o+", overriding previous occurrence"),this[o]=e;break}this.updateUsedBytes&&this.updateUsedBytes(e,t)}},y.prototype.checkBuffer=function(t){if(t==null)throw"Buffer must be defined and non empty";if(t.fileStart===void 0)throw"Buffer must have a fileStart property";return t.byteLength===0?(s.warn("ISOFile","Ignoring empty buffer (fileStart: "+t.fileStart+")"),this.stream.logBufferLevel(),!1):(s.info("ISOFile","Processing buffer (fileStart: "+t.fileStart+")"),t.usedBytes=0,this.stream.insertBuffer(t),this.stream.logBufferLevel(),this.stream.initialized()?!0:(s.warn("ISOFile","Not ready to start parsing"),!1))},y.prototype.appendBuffer=function(t,e){var n;if(this.checkBuffer(t))return this.parse(),this.moovStartFound&&!this.moovStartSent&&(this.moovStartSent=!0,this.onMoovStart&&this.onMoovStart()),this.moov?(this.sampleListBuilt||(this.buildSampleLists(),this.sampleListBuilt=!0),this.updateSampleLists(),this.onReady&&!this.readySent&&(this.readySent=!0,this.onReady(this.getInfo())),this.processSamples(e),this.nextSeekPosition?(n=this.nextSeekPosition,this.nextSeekPosition=void 0):n=this.nextParsePosition,this.stream.getEndFilePositionAfter&&(n=this.stream.getEndFilePositionAfter(n))):this.nextParsePosition?n=this.nextParsePosition:n=0,this.sidx&&this.onSidx&&!this.sidxSent&&(this.onSidx(this.sidx),this.sidxSent=!0),this.meta&&(this.flattenItemInfo&&!this.itemListBuilt&&(this.flattenItemInfo(),this.itemListBuilt=!0),this.processItems&&this.processItems(this.onItem)),this.stream.cleanBuffers&&(s.info("ISOFile","Done processing buffer (fileStart: "+t.fileStart+") - next buffer to fetch should have a fileStart position of "+n),this.stream.logBufferLevel(),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0),s.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize())),n},y.prototype.getInfo=function(){var t,e,n={},o,f,c,v,g=new Date("1904-01-01T00:00:00Z").getTime();if(this.moov)for(n.hasMoov=!0,n.duration=this.moov.mvhd.duration,n.timescale=this.moov.mvhd.timescale,n.isFragmented=this.moov.mvex!=null,n.isFragmented&&this.moov.mvex.mehd&&(n.fragment_duration=this.moov.mvex.mehd.fragment_duration),n.isProgressive=this.isProgressive,n.hasIOD=this.moov.iods!=null,n.brands=[],n.brands.push(this.ftyp.major_brand),n.brands=n.brands.concat(this.ftyp.compatible_brands),n.created=new Date(g+this.moov.mvhd.creation_time*1e3),n.modified=new Date(g+this.moov.mvhd.modification_time*1e3),n.tracks=[],n.audioTracks=[],n.videoTracks=[],n.subtitleTracks=[],n.metadataTracks=[],n.hintTracks=[],n.otherTracks=[],t=0;t<this.moov.traks.length;t++){if(o=this.moov.traks[t],v=o.mdia.minf.stbl.stsd.entries[0],f={},n.tracks.push(f),f.id=o.tkhd.track_id,f.name=o.mdia.hdlr.name,f.references=[],o.tref)for(e=0;e<o.tref.boxes.length;e++)c={},f.references.push(c),c.type=o.tref.boxes[e].type,c.track_ids=o.tref.boxes[e].track_ids;o.edts&&(f.edits=o.edts.elst.entries),f.created=new Date(g+o.tkhd.creation_time*1e3),f.modified=new Date(g+o.tkhd.modification_time*1e3),f.movie_duration=o.tkhd.duration,f.movie_timescale=n.timescale,f.layer=o.tkhd.layer,f.alternate_group=o.tkhd.alternate_group,f.volume=o.tkhd.volume,f.matrix=o.tkhd.matrix,f.track_width=o.tkhd.width/65536,f.track_height=o.tkhd.height/65536,f.timescale=o.mdia.mdhd.timescale,f.cts_shift=o.mdia.minf.stbl.cslg,f.duration=o.mdia.mdhd.duration,f.samples_duration=o.samples_duration,f.codec=v.getCodec(),f.kind=o.udta&&o.udta.kinds.length?o.udta.kinds[0]:{schemeURI:"",value:""},f.language=o.mdia.elng?o.mdia.elng.extended_language:o.mdia.mdhd.languageString,f.nb_samples=o.samples.length,f.size=o.samples_size,f.bitrate=f.size*8*f.timescale/f.samples_duration,v.isAudio()?(f.type="audio",n.audioTracks.push(f),f.audio={},f.audio.sample_rate=v.getSampleRate(),f.audio.channel_count=v.getChannelCount(),f.audio.sample_size=v.getSampleSize()):v.isVideo()?(f.type="video",n.videoTracks.push(f),f.video={},f.video.width=v.getWidth(),f.video.height=v.getHeight()):v.isSubtitle()?(f.type="subtitles",n.subtitleTracks.push(f)):v.isHint()?(f.type="metadata",n.hintTracks.push(f)):v.isMetadata()?(f.type="metadata",n.metadataTracks.push(f)):(f.type="metadata",n.otherTracks.push(f))}else n.hasMoov=!1;if(n.mime="",n.hasMoov&&n.tracks){for(n.videoTracks&&n.videoTracks.length>0?n.mime+='video/mp4; codecs="':n.audioTracks&&n.audioTracks.length>0?n.mime+='audio/mp4; codecs="':n.mime+='application/mp4; codecs="',t=0;t<n.tracks.length;t++)t!==0&&(n.mime+=","),n.mime+=n.tracks[t].codec;n.mime+='"; profiles="',n.mime+=this.ftyp.compatible_brands.join(),n.mime+='"'}return n},y.prototype.setNextSeekPositionFromSample=function(t){t&&(this.nextSeekPosition?this.nextSeekPosition=Math.min(t.offset+t.alreadyRead,this.nextSeekPosition):this.nextSeekPosition=t.offset+t.alreadyRead)},y.prototype.processSamples=function(t){var e,n;if(this.sampleProcessingStarted){if(this.isFragmentationInitialized&&this.onSegment!==null)for(e=0;e<this.fragmentedTracks.length;e++){var o=this.fragmentedTracks[e];for(n=o.trak;n.nextSample<n.samples.length&&this.sampleProcessingStarted;){s.debug("ISOFile","Creating media fragment on track #"+o.id+" for sample "+n.nextSample);var f=this.createFragment(o.id,n.nextSample,o.segmentStream);if(f)o.segmentStream=f,n.nextSample++;else break;if((n.nextSample%o.nb_samples===0||t||n.nextSample>=n.samples.length)&&(s.info("ISOFile","Sending fragmented data on track #"+o.id+" for samples ["+Math.max(0,n.nextSample-o.nb_samples)+","+(n.nextSample-1)+"]"),s.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize()),this.onSegment&&this.onSegment(o.id,o.user,o.segmentStream.buffer,n.nextSample,t||n.nextSample>=n.samples.length),o.segmentStream=null,o!==this.fragmentedTracks[e]))break}}if(this.onSamples!==null)for(e=0;e<this.extractedTracks.length;e++){var c=this.extractedTracks[e];for(n=c.trak;n.nextSample<n.samples.length&&this.sampleProcessingStarted;){s.debug("ISOFile","Exporting on track #"+c.id+" sample #"+n.nextSample);var v=this.getSample(n,n.nextSample);if(v)n.nextSample++,c.samples.push(v);else{this.setNextSeekPositionFromSample(n.samples[n.nextSample]);break}if((n.nextSample%c.nb_samples===0||n.nextSample>=n.samples.length)&&(s.debug("ISOFile","Sending samples on track #"+c.id+" for sample "+n.nextSample),this.onSamples&&this.onSamples(c.id,c.user,c.samples),c.samples=[],c!==this.extractedTracks[e]))break}}}},y.prototype.getBox=function(t){var e=this.getBoxes(t,!0);return e.length?e[0]:null},y.prototype.getBoxes=function(t,e){var n=[];return y._sweep.call(this,t,n,e),n},y._sweep=function(t,e,n){this.type&&this.type==t&&e.push(this);for(var o in this.boxes){if(e.length&&n)return;y._sweep.call(this.boxes[o],t,e,n)}},y.prototype.getTrackSamplesInfo=function(t){var e=this.getTrackById(t);if(e)return e.samples},y.prototype.getTrackSample=function(t,e){var n=this.getTrackById(t),o=this.getSample(n,e);return o},y.prototype.releaseUsedSamples=function(t,e){var n=0,o=this.getTrackById(t);o.lastValidSample||(o.lastValidSample=0);for(var f=o.lastValidSample;f<e;f++)n+=this.releaseSample(o,f);s.info("ISOFile","Track #"+t+" released samples up to "+e+" (released size: "+n+", remaining: "+this.samplesDataSize+")"),o.lastValidSample=e},y.prototype.start=function(){this.sampleProcessingStarted=!0,this.processSamples(!1)},y.prototype.stop=function(){this.sampleProcessingStarted=!1},y.prototype.flush=function(){s.info("ISOFile","Flushing remaining samples"),this.updateSampleLists(),this.processSamples(!0),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0)},y.prototype.seekTrack=function(t,e,n){var o,f,c=1/0,v=0,g=0,x;if(n.samples.length===0)return s.info("ISOFile","No sample in track, cannot seek! Using time "+s.getDurationString(0,1)+" and offset: 0"),{offset:0,time:0};for(o=0;o<n.samples.length;o++){if(f=n.samples[o],o===0)g=0,x=f.timescale;else if(f.cts>t*f.timescale){g=o-1;break}e&&f.is_sync&&(v=o)}for(e&&(g=v),t=n.samples[g].cts,n.nextSample=g;n.samples[g].alreadyRead===n.samples[g].size&&n.samples[g+1];)g++;return c=n.samples[g].offset+n.samples[g].alreadyRead,s.info("ISOFile","Seeking to "+(e?"RAP":"")+" sample #"+n.nextSample+" on track "+n.tkhd.track_id+", time "+s.getDurationString(t,x)+" and offset: "+c),{offset:c,time:t/x}},y.prototype.getTrackDuration=function(t){var e;return t.samples?(e=t.samples[t.samples.length-1],(e.cts+e.duration)/e.timescale):1/0},y.prototype.seek=function(t,e){var n=this.moov,o,f,c,v={offset:1/0,time:1/0};if(this.moov){for(c=0;c<n.traks.length;c++)o=n.traks[c],!(t>this.getTrackDuration(o))&&(f=this.seekTrack(t,e,o),f.offset<v.offset&&(v.offset=f.offset),f.time<v.time&&(v.time=f.time));return s.info("ISOFile","Seeking at time "+s.getDurationString(v.time,1)+" needs a buffer with a fileStart position of "+v.offset),v.offset===1/0?v={offset:this.nextParsePosition,time:0}:v.offset=this.stream.getEndFilePositionAfter(v.offset),s.info("ISOFile","Adjusted seek position (after checking data already in buffer): "+v.offset),v}else throw"Cannot seek: moov not received!"},y.prototype.equal=function(t){for(var e=0;e<this.boxes.length&&e<t.boxes.length;){var n=this.boxes[e],o=t.boxes[e];if(!a.boxEqual(n,o))return!1;e++}return!0},r.ISOFile=y,y.prototype.lastBoxStartPosition=0,y.prototype.parsingMdat=null,y.prototype.nextParsePosition=0,y.prototype.discardMdatData=!1,y.prototype.processIncompleteBox=function(t){var e,n,o;return t.type==="mdat"?(e=new a[t.type+"Box"](t.size),this.parsingMdat=e,this.boxes.push(e),this.mdats.push(e),e.start=t.start,e.hdr_size=t.hdr_size,this.stream.addUsedBytes(e.hdr_size),this.lastBoxStartPosition=e.start+e.size,o=this.stream.seek(e.start+e.size,!1,this.discardMdatData),o?(this.parsingMdat=null,!0):(this.moovStartFound?this.nextParsePosition=this.stream.findEndContiguousBuf():this.nextParsePosition=e.start+e.size,!1)):(t.type==="moov"&&(this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0)),n=this.stream.mergeNextBuffer?this.stream.mergeNextBuffer():!1,n?(this.nextParsePosition=this.stream.getEndPosition(),!0):(t.type?this.moovStartFound?this.nextParsePosition=this.stream.getEndPosition():this.nextParsePosition=this.stream.getPosition()+t.size:this.nextParsePosition=this.stream.getEndPosition(),!1))},y.prototype.hasIncompleteMdat=function(){return this.parsingMdat!==null},y.prototype.processIncompleteMdat=function(){var t,e;return t=this.parsingMdat,e=this.stream.seek(t.start+t.size,!1,this.discardMdatData),e?(s.debug("ISOFile","Found 'mdat' end in buffered data"),this.parsingMdat=null,!0):(this.nextParsePosition=this.stream.findEndContiguousBuf(),!1)},y.prototype.restoreParsePosition=function(){return this.stream.seek(this.lastBoxStartPosition,!0,this.discardMdatData)},y.prototype.saveParsePosition=function(){this.lastBoxStartPosition=this.stream.getPosition()},y.prototype.updateUsedBytes=function(t,e){this.stream.addUsedBytes&&(t.type==="mdat"?(this.stream.addUsedBytes(t.hdr_size),this.discardMdatData&&this.stream.addUsedBytes(t.size-t.hdr_size)):this.stream.addUsedBytes(t.size))},y.prototype.add=a.Box.prototype.add,y.prototype.addBox=a.Box.prototype.addBox,y.prototype.init=function(t){var e=t||{};this.add("ftyp").set("major_brand",e.brands&&e.brands[0]||"iso4").set("minor_version",0).set("compatible_brands",e.brands||["iso4"]);var n=this.add("moov");return n.add("mvhd").set("timescale",e.timescale||600).set("rate",e.rate||65536).set("creation_time",0).set("modification_time",0).set("duration",e.duration||0).set("volume",e.width?0:256).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("next_track_id",1),n.add("mvex"),this},y.prototype.addTrack=function(t){this.moov||this.init(t);var e=t||{};e.width=e.width||320,e.height=e.height||320,e.id=e.id||this.moov.mvhd.next_track_id,e.type=e.type||"avc1";var n=this.moov.add("trak");this.moov.mvhd.next_track_id=e.id+1,n.add("tkhd").set("flags",a.TKHD_FLAG_ENABLED|a.TKHD_FLAG_IN_MOVIE|a.TKHD_FLAG_IN_PREVIEW).set("creation_time",0).set("modification_time",0).set("track_id",e.id).set("duration",e.duration||0).set("layer",e.layer||0).set("alternate_group",0).set("volume",1).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("width",e.width<<16).set("height",e.height<<16);var o=n.add("mdia");o.add("mdhd").set("creation_time",0).set("modification_time",0).set("timescale",e.timescale||1).set("duration",e.media_duration||0).set("language",e.language||"und"),o.add("hdlr").set("handler",e.hdlr||"vide").set("name",e.name||"Track created with MP4Box.js"),o.add("elng").set("extended_language",e.language||"fr-FR");var f=o.add("minf");if(a[e.type+"SampleEntry"]!==void 0){var c=new a[e.type+"SampleEntry"];c.data_reference_index=1;var v="";for(var g in a.sampleEntryCodes)for(var x=a.sampleEntryCodes[g],S=0;S<x.length;S++)if(x.indexOf(e.type)>-1){v=g;break}switch(v){case"Visual":if(f.add("vmhd").set("graphicsmode",0).set("opcolor",[0,0,0]),c.set("width",e.width).set("height",e.height).set("horizresolution",72<<16).set("vertresolution",72<<16).set("frame_count",1).set("compressorname",e.type+" Compressor").set("depth",24),e.avcDecoderConfigRecord){var E=new a.avcCBox;E.parse(new l(e.avcDecoderConfigRecord)),c.addBox(E)}else if(e.hevcDecoderConfigRecord){var A=new a.hvcCBox;A.parse(new l(e.hevcDecoderConfigRecord)),c.addBox(A)}break;case"Audio":f.add("smhd").set("balance",e.balance||0),c.set("channel_count",e.channel_count||2).set("samplesize",e.samplesize||16).set("samplerate",e.samplerate||65536);break;case"Hint":f.add("hmhd");break;case"Subtitle":switch(f.add("sthd"),e.type){case"stpp":c.set("namespace",e.namespace||"nonamespace").set("schema_location",e.schema_location||"").set("auxiliary_mime_types",e.auxiliary_mime_types||"");break}break;case"Metadata":f.add("nmhd");break;case"System":f.add("nmhd");break;default:f.add("nmhd");break}e.description&&c.addBox(e.description),e.description_boxes&&e.description_boxes.forEach(function(z){c.addBox(z)}),f.add("dinf").add("dref").addEntry(new a["url Box"]().set("flags",1));var M=f.add("stbl");return M.add("stsd").addEntry(c),M.add("stts").set("sample_counts",[]).set("sample_deltas",[]),M.add("stsc").set("first_chunk",[]).set("samples_per_chunk",[]).set("sample_description_index",[]),M.add("stco").set("chunk_offsets",[]),M.add("stsz").set("sample_sizes",[]),this.moov.mvex.add("trex").set("track_id",e.id).set("default_sample_description_index",e.default_sample_description_index||1).set("default_sample_duration",e.default_sample_duration||0).set("default_sample_size",e.default_sample_size||0).set("default_sample_flags",e.default_sample_flags||0),this.buildTrakSampleLists(n),e.id}},a.Box.prototype.computeSize=function(t){var e=t||new h;e.endianness=h.BIG_ENDIAN,this.write(e)},y.prototype.addSample=function(t,e,n){var o=n||{},f={},c=this.getTrackById(t);if(c!==null){f.number=c.samples.length,f.track_id=c.tkhd.track_id,f.timescale=c.mdia.mdhd.timescale,f.description_index=o.sample_description_index?o.sample_description_index-1:0,f.description=c.mdia.minf.stbl.stsd.entries[f.description_index],f.data=e,f.size=e.byteLength,f.alreadyRead=f.size,f.duration=o.duration||1,f.cts=o.cts||0,f.dts=o.dts||0,f.is_sync=o.is_sync||!1,f.is_leading=o.is_leading||0,f.depends_on=o.depends_on||0,f.is_depended_on=o.is_depended_on||0,f.has_redundancy=o.has_redundancy||0,f.degradation_priority=o.degradation_priority||0,f.offset=0,f.subsamples=o.subsamples,c.samples.push(f),c.samples_size+=f.size,c.samples_duration+=f.duration,c.first_dts===void 0&&(c.first_dts=o.dts),this.processSamples();var v=this.createSingleSampleMoof(f);return this.addBox(v),v.computeSize(),v.trafs[0].truns[0].data_offset=v.size+8,this.add("mdat").data=new Uint8Array(e),f}},y.prototype.createSingleSampleMoof=function(t){var e=0;t.is_sync?e=1<<25:e=65536;var n=new a.moofBox;n.add("mfhd").set("sequence_number",this.nextMoofNumber),this.nextMoofNumber++;var o=n.add("traf"),f=this.getTrackById(t.track_id);return o.add("tfhd").set("track_id",t.track_id).set("flags",a.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),o.add("tfdt").set("baseMediaDecodeTime",t.dts-(f.first_dts||0)),o.add("trun").set("flags",a.TRUN_FLAGS_DATA_OFFSET|a.TRUN_FLAGS_DURATION|a.TRUN_FLAGS_SIZE|a.TRUN_FLAGS_FLAGS|a.TRUN_FLAGS_CTS_OFFSET).set("data_offset",0).set("first_sample_flags",0).set("sample_count",1).set("sample_duration",[t.duration]).set("sample_size",[t.size]).set("sample_flags",[e]).set("sample_composition_time_offset",[t.cts-t.dts]),n},y.prototype.lastMoofIndex=0,y.prototype.samplesDataSize=0,y.prototype.resetTables=function(){var t,e,n,o,f,c,v,g;for(this.initial_duration=this.moov.mvhd.duration,this.moov.mvhd.duration=0,t=0;t<this.moov.traks.length;t++){e=this.moov.traks[t],e.tkhd.duration=0,e.mdia.mdhd.duration=0,n=e.mdia.minf.stbl.stco||e.mdia.minf.stbl.co64,n.chunk_offsets=[],o=e.mdia.minf.stbl.stsc,o.first_chunk=[],o.samples_per_chunk=[],o.sample_description_index=[],f=e.mdia.minf.stbl.stsz||e.mdia.minf.stbl.stz2,f.sample_sizes=[],c=e.mdia.minf.stbl.stts,c.sample_counts=[],c.sample_deltas=[],v=e.mdia.minf.stbl.ctts,v&&(v.sample_counts=[],v.sample_offsets=[]),g=e.mdia.minf.stbl.stss;var x=e.mdia.minf.stbl.boxes.indexOf(g);x!=-1&&(e.mdia.minf.stbl.boxes[x]=null)}},y.initSampleGroups=function(t,e,n,o,f){var c,v,g,x;function S(E,A,M){this.grouping_type=E,this.grouping_type_parameter=A,this.sbgp=M,this.last_sample_in_run=-1,this.entry_index=-1}for(e&&(e.sample_groups_info=[]),t.sample_groups_info||(t.sample_groups_info=[]),v=0;v<n.length;v++){for(x=n[v].grouping_type+"/"+n[v].grouping_type_parameter,g=new S(n[v].grouping_type,n[v].grouping_type_parameter,n[v]),e&&(e.sample_groups_info[x]=g),t.sample_groups_info[x]||(t.sample_groups_info[x]=g),c=0;c<o.length;c++)o[c].grouping_type===n[v].grouping_type&&(g.description=o[c],g.description.used=!0);if(f)for(c=0;c<f.length;c++)f[c].grouping_type===n[v].grouping_type&&(g.fragment_description=f[c],g.fragment_description.used=!0,g.is_fragment=!0)}if(e){if(f)for(v=0;v<f.length;v++)!f[v].used&&f[v].version>=2&&(x=f[v].grouping_type+"/0",g=new S(f[v].grouping_type,0),g.is_fragment=!0,e.sample_groups_info[x]||(e.sample_groups_info[x]=g))}else for(v=0;v<o.length;v++)!o[v].used&&o[v].version>=2&&(x=o[v].grouping_type+"/0",g=new S(o[v].grouping_type,0),t.sample_groups_info[x]||(t.sample_groups_info[x]=g))},y.setSampleGroupProperties=function(t,e,n,o){var f,c;e.sample_groups=[];for(f in o)if(e.sample_groups[f]={},e.sample_groups[f].grouping_type=o[f].grouping_type,e.sample_groups[f].grouping_type_parameter=o[f].grouping_type_parameter,n>=o[f].last_sample_in_run&&(o[f].last_sample_in_run<0&&(o[f].last_sample_in_run=0),o[f].entry_index++,o[f].entry_index<=o[f].sbgp.entries.length-1&&(o[f].last_sample_in_run+=o[f].sbgp.entries[o[f].entry_index].sample_count)),o[f].entry_index<=o[f].sbgp.entries.length-1?e.sample_groups[f].group_description_index=o[f].sbgp.entries[o[f].entry_index].group_description_index:e.sample_groups[f].group_description_index=-1,e.sample_groups[f].group_description_index!==0){var v;o[f].fragment_description?v=o[f].fragment_description:v=o[f].description,e.sample_groups[f].group_description_index>0?(e.sample_groups[f].group_description_index>65535?c=(e.sample_groups[f].group_description_index>>16)-1:c=e.sample_groups[f].group_description_index-1,v&&c>=0&&(e.sample_groups[f].description=v.entries[c])):v&&v.version>=2&&v.default_group_description_index>0&&(e.sample_groups[f].description=v.entries[v.default_group_description_index-1])}},y.process_sdtp=function(t,e,n){e&&(t?(e.is_leading=t.is_leading[n],e.depends_on=t.sample_depends_on[n],e.is_depended_on=t.sample_is_depended_on[n],e.has_redundancy=t.sample_has_redundancy[n]):(e.is_leading=0,e.depends_on=0,e.is_depended_on=0,e.has_redundancy=0))},y.prototype.buildSampleLists=function(){var t,e;for(t=0;t<this.moov.traks.length;t++)e=this.moov.traks[t],this.buildTrakSampleLists(e)},y.prototype.buildTrakSampleLists=function(t){var e,n,o,f,c,v,g,x,S,E,A,M,z,K,L,Q,Ht,Rt,Ct,Ot,Y,xt,ct,jt;if(t.samples=[],t.samples_duration=0,t.samples_size=0,n=t.mdia.minf.stbl.stco||t.mdia.minf.stbl.co64,o=t.mdia.minf.stbl.stsc,f=t.mdia.minf.stbl.stsz||t.mdia.minf.stbl.stz2,c=t.mdia.minf.stbl.stts,v=t.mdia.minf.stbl.ctts,g=t.mdia.minf.stbl.stss,x=t.mdia.minf.stbl.stsd,S=t.mdia.minf.stbl.subs,M=t.mdia.minf.stbl.stdp,E=t.mdia.minf.stbl.sbgps,A=t.mdia.minf.stbl.sgpds,Rt=-1,Ct=-1,Ot=-1,Y=-1,xt=0,ct=0,jt=0,y.initSampleGroups(t,null,E,A),!(typeof f>"u")){for(e=0;e<f.sample_sizes.length;e++){var q={};q.number=e,q.track_id=t.tkhd.track_id,q.timescale=t.mdia.mdhd.timescale,q.alreadyRead=0,t.samples[e]=q,q.size=f.sample_sizes[e],t.samples_size+=q.size,e===0?(K=1,z=0,q.chunk_index=K,q.chunk_run_index=z,Ht=o.samples_per_chunk[z],Q=0,z+1<o.first_chunk.length?L=o.first_chunk[z+1]-1:L=1/0):e<Ht?(q.chunk_index=K,q.chunk_run_index=z):(K++,q.chunk_index=K,Q=0,K<=L||(z++,z+1<o.first_chunk.length?L=o.first_chunk[z+1]-1:L=1/0),q.chunk_run_index=z,Ht+=o.samples_per_chunk[z]),q.description_index=o.sample_description_index[q.chunk_run_index]-1,q.description=x.entries[q.description_index],q.offset=n.chunk_offsets[q.chunk_index-1]+Q,Q+=q.size,e>Rt&&(Ct++,Rt<0&&(Rt=0),Rt+=c.sample_counts[Ct]),e>0?(t.samples[e-1].duration=c.sample_deltas[Ct],t.samples_duration+=t.samples[e-1].duration,q.dts=t.samples[e-1].dts+t.samples[e-1].duration):q.dts=0,v?(e>=Ot&&(Y++,Ot<0&&(Ot=0),Ot+=v.sample_counts[Y]),q.cts=t.samples[e].dts+v.sample_offsets[Y]):q.cts=q.dts,g?(e==g.sample_numbers[xt]-1?(q.is_sync=!0,xt++):(q.is_sync=!1,q.degradation_priority=0),S&&S.entries[ct].sample_delta+jt==e+1&&(q.subsamples=S.entries[ct].subsamples,jt+=S.entries[ct].sample_delta,ct++)):q.is_sync=!0,y.process_sdtp(t.mdia.minf.stbl.sdtp,q,q.number),M?q.degradation_priority=M.priority[e]:q.degradation_priority=0,S&&S.entries[ct].sample_delta+jt==e&&(q.subsamples=S.entries[ct].subsamples,jt+=S.entries[ct].sample_delta),(E.length>0||A.length>0)&&y.setSampleGroupProperties(t,q,e,t.sample_groups_info)}e>0&&(t.samples[e-1].duration=Math.max(t.mdia.mdhd.duration-t.samples[e-1].dts,0),t.samples_duration+=t.samples[e-1].duration)}},y.prototype.updateSampleLists=function(){var t,e,n,o,f,c,v,g,x,S,E,A,M,z,K;if(this.moov!==void 0){for(;this.lastMoofIndex<this.moofs.length;)if(x=this.moofs[this.lastMoofIndex],this.lastMoofIndex++,x.type=="moof")for(S=x,t=0;t<S.trafs.length;t++){for(E=S.trafs[t],A=this.getTrackById(E.tfhd.track_id),M=this.getTrexById(E.tfhd.track_id),E.tfhd.flags&a.TFHD_FLAG_SAMPLE_DESC?o=E.tfhd.default_sample_description_index:o=M?M.default_sample_description_index:1,E.tfhd.flags&a.TFHD_FLAG_SAMPLE_DUR?f=E.tfhd.default_sample_duration:f=M?M.default_sample_duration:0,E.tfhd.flags&a.TFHD_FLAG_SAMPLE_SIZE?c=E.tfhd.default_sample_size:c=M?M.default_sample_size:0,E.tfhd.flags&a.TFHD_FLAG_SAMPLE_FLAGS?v=E.tfhd.default_sample_flags:v=M?M.default_sample_flags:0,E.sample_number=0,E.sbgps.length>0&&y.initSampleGroups(A,E,E.sbgps,A.mdia.minf.stbl.sgpds,E.sgpds),e=0;e<E.truns.length;e++){var L=E.truns[e];for(n=0;n<L.sample_count;n++){z={},z.moof_number=this.lastMoofIndex,z.number_in_traf=E.sample_number,E.sample_number++,z.number=A.samples.length,E.first_sample_index=A.samples.length,A.samples.push(z),z.track_id=A.tkhd.track_id,z.timescale=A.mdia.mdhd.timescale,z.description_index=o-1,z.description=A.mdia.minf.stbl.stsd.entries[z.description_index],z.size=c,L.flags&a.TRUN_FLAGS_SIZE&&(z.size=L.sample_size[n]),A.samples_size+=z.size,z.duration=f,L.flags&a.TRUN_FLAGS_DURATION&&(z.duration=L.sample_duration[n]),A.samples_duration+=z.duration,A.first_traf_merged||n>0?z.dts=A.samples[A.samples.length-2].dts+A.samples[A.samples.length-2].duration:(E.tfdt?z.dts=E.tfdt.baseMediaDecodeTime:z.dts=0,A.first_traf_merged=!0),z.cts=z.dts,L.flags&a.TRUN_FLAGS_CTS_OFFSET&&(z.cts=z.dts+L.sample_composition_time_offset[n]),K=v,L.flags&a.TRUN_FLAGS_FLAGS?K=L.sample_flags[n]:n===0&&L.flags&a.TRUN_FLAGS_FIRST_FLAG&&(K=L.first_sample_flags),z.is_sync=!(K>>16&1),z.is_leading=K>>26&3,z.depends_on=K>>24&3,z.is_depended_on=K>>22&3,z.has_redundancy=K>>20&3,z.degradation_priority=K&65535;var Q=!!(E.tfhd.flags&a.TFHD_FLAG_BASE_DATA_OFFSET),Ht=!!(E.tfhd.flags&a.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),Rt=!!(L.flags&a.TRUN_FLAGS_DATA_OFFSET),Ct=0;Q?Ct=E.tfhd.base_data_offset:Ht||e===0?Ct=S.start:Ct=g,e===0&&n===0?Rt?z.offset=Ct+L.data_offset:z.offset=Ct:z.offset=g,g=z.offset+z.size,(E.sbgps.length>0||E.sgpds.length>0||A.mdia.minf.stbl.sbgps.length>0||A.mdia.minf.stbl.sgpds.length>0)&&y.setSampleGroupProperties(A,z,z.number_in_traf,E.sample_groups_info)}}if(E.subs){A.has_fragment_subsamples=!0;var Ot=E.first_sample_index;for(e=0;e<E.subs.entries.length;e++)Ot+=E.subs.entries[e].sample_delta,z=A.samples[Ot-1],z.subsamples=E.subs.entries[e].subsamples}}}},y.prototype.getSample=function(t,e){var n,o=t.samples[e];if(!this.moov)return null;if(!o.data)o.data=new Uint8Array(o.size),o.alreadyRead=0,this.samplesDataSize+=o.size,s.debug("ISOFile","Allocating sample #"+e+" on track #"+t.tkhd.track_id+" of size "+o.size+" (total: "+this.samplesDataSize+")");else if(o.alreadyRead==o.size)return o;for(;;){var f=this.stream.findPosition(!0,o.offset+o.alreadyRead,!1);if(f>-1){n=this.stream.buffers[f];var c=n.byteLength-(o.offset+o.alreadyRead-n.fileStart);if(o.size-o.alreadyRead<=c)return s.debug("ISOFile","Getting sample #"+e+" data (alreadyRead: "+o.alreadyRead+" offset: "+(o.offset+o.alreadyRead-n.fileStart)+" read size: "+(o.size-o.alreadyRead)+" full size: "+o.size+")"),h.memcpy(o.data.buffer,o.alreadyRead,n,o.offset+o.alreadyRead-n.fileStart,o.size-o.alreadyRead),n.usedBytes+=o.size-o.alreadyRead,this.stream.logBufferLevel(),o.alreadyRead=o.size,o;if(c===0)return null;s.debug("ISOFile","Getting sample #"+e+" partial data (alreadyRead: "+o.alreadyRead+" offset: "+(o.offset+o.alreadyRead-n.fileStart)+" read size: "+c+" full size: "+o.size+")"),h.memcpy(o.data.buffer,o.alreadyRead,n,o.offset+o.alreadyRead-n.fileStart,c),o.alreadyRead+=c,n.usedBytes+=c,this.stream.logBufferLevel()}else return null}},y.prototype.releaseSample=function(t,e){var n=t.samples[e];return n.data?(this.samplesDataSize-=n.size,n.data=null,n.alreadyRead=0,n.size):0},y.prototype.getAllocatedSampleDataSize=function(){return this.samplesDataSize},y.prototype.getCodecs=function(){var t,e="";for(t=0;t<this.moov.traks.length;t++){var n=this.moov.traks[t];t>0&&(e+=","),e+=n.mdia.minf.stbl.stsd.entries[0].getCodec()}return e},y.prototype.getTrexById=function(t){var e;if(!this.moov||!this.moov.mvex)return null;for(e=0;e<this.moov.mvex.trexs.length;e++){var n=this.moov.mvex.trexs[e];if(n.track_id==t)return n}return null},y.prototype.getTrackById=function(t){if(this.moov===void 0)return null;for(var e=0;e<this.moov.traks.length;e++){var n=this.moov.traks[e];if(n.tkhd.track_id==t)return n}return null},y.prototype.itemsDataSize=0,y.prototype.flattenItemInfo=function(){var t=this.items,e=this.entity_groups,n,o,f,c=this.meta;if(c!=null&&c.hdlr!==void 0&&c.iinf!==void 0){for(n=0;n<c.iinf.item_infos.length;n++)f={},f.id=c.iinf.item_infos[n].item_ID,t[f.id]=f,f.ref_to=[],f.name=c.iinf.item_infos[n].item_name,c.iinf.item_infos[n].protection_index>0&&(f.protection=c.ipro.protections[c.iinf.item_infos[n].protection_index-1]),c.iinf.item_infos[n].item_type?f.type=c.iinf.item_infos[n].item_type:f.type="mime",f.content_type=c.iinf.item_infos[n].content_type,f.content_encoding=c.iinf.item_infos[n].content_encoding,f.item_uri_type=c.iinf.item_infos[n].item_uri_type;if(c.grpl)for(n=0;n<c.grpl.boxes.length;n++)entity_group={},entity_group.id=c.grpl.boxes[n].group_id,entity_group.entity_ids=c.grpl.boxes[n].entity_ids,entity_group.type=c.grpl.boxes[n].type,e[entity_group.id]=entity_group;if(c.iloc)for(n=0;n<c.iloc.items.length;n++){var v=c.iloc.items[n];switch(f=t[v.item_ID],v.data_reference_index!==0&&(s.warn("Item storage with reference to other files: not supported"),f.source=c.dinf.boxes[v.data_reference_index-1]),v.construction_method){case 0:break;case 1:break;case 2:s.warn("Item storage with construction_method : not supported");break}for(f.extents=[],f.size=0,o=0;o<v.extents.length;o++)f.extents[o]={},f.extents[o].offset=v.extents[o].extent_offset+v.base_offset,v.construction_method==1&&(f.extents[o].offset+=c.idat.start+c.idat.hdr_size),f.extents[o].length=v.extents[o].extent_length,f.extents[o].alreadyRead=0,f.size+=f.extents[o].length}if(c.pitm&&(t[c.pitm.item_id].primary=!0),c.iref)for(n=0;n<c.iref.references.length;n++){var g=c.iref.references[n];for(o=0;o<g.references.length;o++)t[g.from_item_ID].ref_to.push({type:g.type,id:g.references[o]})}if(c.iprp)for(var x=0;x<c.iprp.ipmas.length;x++){var S=c.iprp.ipmas[x];for(n=0;n<S.associations.length;n++){var E=S.associations[n];if(f=t[E.id],f||(f=e[E.id]),f)for(f.properties===void 0&&(f.properties={},f.properties.boxes=[]),o=0;o<E.props.length;o++){var A=E.props[o];if(A.property_index>0&&A.property_index-1<c.iprp.ipco.boxes.length){var M=c.iprp.ipco.boxes[A.property_index-1];f.properties[M.type]=M,f.properties.boxes.push(M)}}}}}},y.prototype.getItem=function(t){var e,n;if(!this.meta)return null;if(n=this.items[t],!n.data&&n.size)n.data=new Uint8Array(n.size),n.alreadyRead=0,this.itemsDataSize+=n.size,s.debug("ISOFile","Allocating item #"+t+" of size "+n.size+" (total: "+this.itemsDataSize+")");else if(n.alreadyRead===n.size)return n;for(var o=0;o<n.extents.length;o++){var f=n.extents[o];if(f.alreadyRead!==f.length){var c=this.stream.findPosition(!0,f.offset+f.alreadyRead,!1);if(c>-1){e=this.stream.buffers[c];var v=e.byteLength-(f.offset+f.alreadyRead-e.fileStart);if(f.length-f.alreadyRead<=v)s.debug("ISOFile","Getting item #"+t+" extent #"+o+" data (alreadyRead: "+f.alreadyRead+" offset: "+(f.offset+f.alreadyRead-e.fileStart)+" read size: "+(f.length-f.alreadyRead)+" full extent size: "+f.length+" full item size: "+n.size+")"),h.memcpy(n.data.buffer,n.alreadyRead,e,f.offset+f.alreadyRead-e.fileStart,f.length-f.alreadyRead),e.usedBytes+=f.length-f.alreadyRead,this.stream.logBufferLevel(),n.alreadyRead+=f.length-f.alreadyRead,f.alreadyRead=f.length;else return s.debug("ISOFile","Getting item #"+t+" extent #"+o+" partial data (alreadyRead: "+f.alreadyRead+" offset: "+(f.offset+f.alreadyRead-e.fileStart)+" read size: "+v+" full extent size: "+f.length+" full item size: "+n.size+")"),h.memcpy(n.data.buffer,n.alreadyRead,e,f.offset+f.alreadyRead-e.fileStart,v),f.alreadyRead+=v,n.alreadyRead+=v,e.usedBytes+=v,this.stream.logBufferLevel(),null}else return null}}return n.alreadyRead===n.size?n:null},y.prototype.releaseItem=function(t){var e=this.items[t];if(e.data){this.itemsDataSize-=e.size,e.data=null,e.alreadyRead=0;for(var n=0;n<e.extents.length;n++){var o=e.extents[n];o.alreadyRead=0}return e.size}else return 0},y.prototype.processItems=function(t){for(var e in this.items){var n=this.items[e];this.getItem(n.id),t&&!n.sent&&(t(n),n.sent=!0,n.data=null)}},y.prototype.hasItem=function(t){for(var e in this.items){var n=this.items[e];if(n.name===t)return n.id}return-1},y.prototype.getMetaHandler=function(){return this.meta?this.meta.hdlr.handler:null},y.prototype.getPrimaryItem=function(){return!this.meta||!this.meta.pitm?null:this.getItem(this.meta.pitm.item_id)},y.prototype.itemToFragmentedTrackFile=function(t){var e=t||{},n=null;if(e.itemId?n=this.getItem(e.itemId):n=this.getPrimaryItem(),n==null)return null;var o=new y;o.discardMdatData=!1;var f={type:n.type,description_boxes:n.properties.boxes};n.properties.ispe&&(f.width=n.properties.ispe.image_width,f.height=n.properties.ispe.image_height);var c=o.addTrack(f);return c?(o.addSample(c,n.data),o):null},y.prototype.write=function(t){for(var e=0;e<this.boxes.length;e++)this.boxes[e].write(t)},y.prototype.createFragment=function(t,e,n){var o=this.getTrackById(t),f=this.getSample(o,e);if(f==null)return this.setNextSeekPositionFromSample(o.samples[e]),null;var c=n||new h;c.endianness=h.BIG_ENDIAN;var v=this.createSingleSampleMoof(f);v.write(c),v.trafs[0].truns[0].data_offset=v.size+8,s.debug("MP4Box","Adjusting data_offset with new value "+v.trafs[0].truns[0].data_offset),c.adjustUint32(v.trafs[0].truns[0].data_offset_position,v.trafs[0].truns[0].data_offset);var g=new a.mdatBox;return g.data=f.data,g.write(c),c},y.writeInitializationSegment=function(t,e,n,o){var f;s.debug("ISOFile","Generating initialization segment");var c=new h;c.endianness=h.BIG_ENDIAN,t.write(c);var v=e.add("mvex");for(n&&v.add("mehd").set("fragment_duration",n),f=0;f<e.traks.length;f++)v.add("trex").set("track_id",e.traks[f].tkhd.track_id).set("default_sample_description_index",1).set("default_sample_duration",o).set("default_sample_size",0).set("default_sample_flags",65536);return e.write(c),c.buffer},y.prototype.save=function(t){var e=new h;e.endianness=h.BIG_ENDIAN,this.write(e),e.save(t)},y.prototype.getBuffer=function(){var t=new h;return t.endianness=h.BIG_ENDIAN,this.write(t),t.buffer},y.prototype.initializeSegmentation=function(){var t,e,n,o;for(this.onSegment===null&&s.warn("MP4Box","No segmentation callback set!"),this.isFragmentationInitialized||(this.isFragmentationInitialized=!0,this.nextMoofNumber=0,this.resetTables()),e=[],t=0;t<this.fragmentedTracks.length;t++){var f=new a.moovBox;f.mvhd=this.moov.mvhd,f.boxes.push(f.mvhd),n=this.getTrackById(this.fragmentedTracks[t].id),f.boxes.push(n),f.traks.push(n),o={},o.id=n.tkhd.track_id,o.user=this.fragmentedTracks[t].user,o.buffer=y.writeInitializationSegment(this.ftyp,f,this.moov.mvex&&this.moov.mvex.mehd?this.moov.mvex.mehd.fragment_duration:void 0,this.moov.traks[t].samples.length>0?this.moov.traks[t].samples[0].duration:0),e.push(o)}return e},a.Box.prototype.printHeader=function(t){this.size+=8,this.size>d&&(this.size+=8),this.type==="uuid"&&(this.size+=16),t.log(t.indent+"size:"+this.size),t.log(t.indent+"type:"+this.type)},a.FullBox.prototype.printHeader=function(t){this.size+=4,a.Box.prototype.printHeader.call(this,t),t.log(t.indent+"version:"+this.version),t.log(t.indent+"flags:"+this.flags)},a.Box.prototype.print=function(t){this.printHeader(t)},a.ContainerBox.prototype.print=function(t){this.printHeader(t);for(var e=0;e<this.boxes.length;e++)if(this.boxes[e]){var n=t.indent;t.indent+=" ",this.boxes[e].print(t),t.indent=n}},y.prototype.print=function(t){t.indent="";for(var e=0;e<this.boxes.length;e++)this.boxes[e]&&this.boxes[e].print(t)},a.mvhdBox.prototype.print=function(t){a.FullBox.prototype.printHeader.call(this,t),t.log(t.indent+"creation_time: "+this.creation_time),t.log(t.indent+"modification_time: "+this.modification_time),t.log(t.indent+"timescale: "+this.timescale),t.log(t.indent+"duration: "+this.duration),t.log(t.indent+"rate: "+this.rate),t.log(t.indent+"volume: "+(this.volume>>8)),t.log(t.indent+"matrix: "+this.matrix.join(", ")),t.log(t.indent+"next_track_id: "+this.next_track_id)},a.tkhdBox.prototype.print=function(t){a.FullBox.prototype.printHeader.call(this,t),t.log(t.indent+"creation_time: "+this.creation_time),t.log(t.indent+"modification_time: "+this.modification_time),t.log(t.indent+"track_id: "+this.track_id),t.log(t.indent+"duration: "+this.duration),t.log(t.indent+"volume: "+(this.volume>>8)),t.log(t.indent+"matrix: "+this.matrix.join(", ")),t.log(t.indent+"layer: "+this.layer),t.log(t.indent+"alternate_group: "+this.alternate_group),t.log(t.indent+"width: "+this.width),t.log(t.indent+"height: "+this.height)};var N={};N.createFile=function(t,e){var n=t!==void 0?t:!0,o=new y(e);return o.discardMdatData=!n,o},r.createFile=N.createFile})(Rl);const Yi=Xd(Rl),ho=10;async function Zd(r,s,l,h,d){return new Promise((u,m)=>{const a=Yi.createFile();let b=null,w=null,B=!1,T=null,C=0;a.onReady=e=>{const n=e.videoTracks?.[0];let o=null;if(n){b=n.id,C=n.nb_samples??0;let c=null;if(n.bitrate)c=n.bitrate;else if(n.movie_duration&&e.size){const x=n.movie_duration/n.movie_timescale;c=Math.round(e.size*8/x)}o={width:n.video.width,height:n.video.height,codec:n.codec,framerate:n.movie_duration&&n.nb_samples?n.nb_samples*n.movie_timescale/n.movie_duration:null,bitrate:c};const v=a.getTrackById(b).mdia.minf.stbl.stsd.entries[0],g=Jd(v);s.configure({codec:n.codec,codedWidth:n.video.width,codedHeight:n.video.height,description:g}),a.setExtractionOptions(b,"video",{nbSamples:100})}const f=e.audioTracks?.[0];if(f&&l){B=!0,w=f.id;let c=null;f.bitrate?c=f.bitrate:f.audio.sample_rate&&f.audio.channel_count&&(c=128e3),T={sampleRate:f.audio.sample_rate,numberOfChannels:f.audio.channel_count,bitrate:c},l.configure({codec:f.codec,sampleRate:f.audio.sample_rate,numberOfChannels:f.audio.channel_count}),a.setExtractionOptions(w,"audio",{nbSamples:100})}h({hasAudio:B,audioFormat:T,videoFormat:o,totalFrames:C}),a.start()},a.onSamples=(e,n,o)=>{if(e===b)for(const f of o){const c=new EncodedVideoChunk({type:f.is_sync?"key":"delta",timestamp:Math.round(1e6*f.cts/f.timescale),duration:Math.round(1e6*f.duration/f.timescale),data:f.data});s.decode(c)}else if(e===w)for(const f of o){const c=new EncodedAudioChunk({type:"key",timestamp:Math.round(1e6*f.cts/f.timescale),duration:Math.round(1e6*f.duration/f.timescale),data:f.data});l.decode(c)}};const P=1024*1024*5;let y=0;const N=new FileReader;N.onload=e=>{const n=e.target.result;n.fileStart=y,a.appendBuffer(n),y+=n.byteLength;const o=Math.min(ho,y/r.size*ho);d(o),y<r.size?t():(a.flush(),u({hasAudio:B}))},N.onerror=()=>{m(new Error("Failed to read file"))};function t(){const e=r.slice(y,y+P);N.readAsArrayBuffer(e)}t()})}function Jd(r){if(r.avcC){const s=new Yi.DataStream(void 0,0,Yi.DataStream.BIG_ENDIAN);return r.avcC.write(s),new Uint8Array(s.buffer.slice(8))}else if(r.hvcC){const s=new Yi.DataStream(void 0,0,Yi.DataStream.BIG_ENDIAN);return r.hvcC.write(s),new Uint8Array(s.buffer.slice(8))}return null}const Qd=[96e3,128e3,16e4,192e3];function Ol(r){return Qd.reduce((s,l)=>Math.abs(l-r)<Math.abs(s-r)?l:s)}const Ls=10,tu=100-Ls;async function eu(r,s,l){const h=s.video.container||(s.video.codec.startsWith("vp")||s.video.codec.startsWith("av01")?"webm":"mp4"),d=h==="webm"?".webm":h==="mov"?".mov":".mp4",u=h==="webm"?"video/webm":"video/mp4",a=await(await window.showSaveFilePicker({suggestedName:`output${d}`,types:[{description:"Video File",accept:{[u]:[d]}}]})).createWritable();let b=null,w=null,B=null,T=0,C=0;const P=performance.now(),y=100;let N=0,t=0,e=!1,n;const o=new Promise(S=>{n=S});let f=null;const c=()=>{e&&N===0&&t===0&&(f&&clearTimeout(f),f=setTimeout(()=>{N===0&&t===0&&n()},y))},v=S=>{const{hasAudio:E,audioFormat:A,videoFormat:M,totalFrames:z}=S;C=z??0,l(void 0,void 0,S),s.video.rotation&&s.video.rotation!==0&&console.warn("Video rotation is not yet implemented and will be ignored."),(s.video.flipHorizontal||s.video.flipVertical)&&console.warn("Video flipping is not yet implemented and will be ignored.");let K=s.video.framerate;s.video.framerateMode==="original"&&M?.framerate&&(K=M.framerate,console.log(`Using original framerate: ${K.toFixed(2)} fps`));let L=s.video.width,Q=s.video.height;if(M){const Y=M.width,xt=M.height,ct=Y/xt;if(L&&!Q)Q=Math.round(L/ct);else if(!L&&Q)L=Math.round(Q*ct);else if(L&&Q){const jt=L/Q;Math.abs(jt-ct)>.01&&(jt>ct?L=Math.round(Q*ct):Q=Math.round(L/ct))}else!L&&!Q&&(L=Y,Q=xt);if(L>Y||Q>xt){const jt=Math.min(Y/L,xt/Q);L=Math.round(L*jt),Q=Math.round(Q*jt)}L=Math.round(L/2)*2,Q=Math.round(Q/2)*2}const Ht=s.video.container||(s.video.codec.startsWith("vp")||s.video.codec.startsWith("av01")?"webm":"mp4"),Rt=(Y,xt)=>xt==="video"?Y.startsWith("avc")||Y.startsWith("h264")?"avc":Y.startsWith("hev")||Y.startsWith("hvc")||Y.startsWith("h265")?"hevc":Y.startsWith("vp09")||Y.startsWith("vp9")?"V_VP9":Y.startsWith("vp08")||Y.startsWith("vp8")?"V_VP8":Y.startsWith("av01")?"V_AV1":"avc":Y.startsWith("mp4a")||Y.toLowerCase().includes("aac")?"aac":Y.toLowerCase()==="opus"?"A_OPUS":"aac",Ct=Rt(s.video.codec,"video"),Ot=s.audio?Rt(s.audio.codec,"audio"):null;if(Ht==="webm"){const Y={target:new vl(a),video:{codec:Ct,width:L,height:Q},firstTimestampBehavior:"offset"};E&&s.audio&&A&&(Y.audio={codec:Ot,sampleRate:A.sampleRate,numberOfChannels:A.numberOfChannels}),b=new Kd(Y)}else{const Y={target:new il(a),video:{codec:Ct,width:L,height:Q},fastStart:!1,firstTimestampBehavior:"offset"};E&&s.audio&&A&&(Y.audio={codec:Ot,sampleRate:A.sampleRate,numberOfChannels:A.numberOfChannels}),b=new Md(Y)}if(w=new VideoEncoder({output:(Y,xt)=>{N++;try{b.addVideoChunk(Y,xt)}finally{N--,c()}},error:Y=>console.error("VideoEncoder error",Y)}),w.configure({codec:s.video.codec??"avc1.640028",width:L,height:Q,bitrate:s.video.bitrate,framerate:K,latencyMode:"quality"}),E&&s.audio&&A){B=new AudioEncoder({output:(xt,ct)=>{t++;try{b.addAudioChunk(xt,ct)}finally{t--,c()}},error:xt=>console.error("AudioEncoder error",xt)});let Y=s.audio.bitrate;s.audio.codec.startsWith("mp4a.40.2")&&(Y=Ol(Y)),B.configure({codec:s.audio.codec??"mp4a.40.2",sampleRate:A.sampleRate,numberOfChannels:A.numberOfChannels,bitrate:Y})}},g=new VideoDecoder({output:S=>{if(T++,w&&w.state==="configured")try{w.encode(S)}catch(K){console.error("VideoEncoder encode error:",K)}S.close();const E=performance.now()-P,A=T/(E/1e3);let M=Ls;C>0&&(M=Ls+T/C*tu);let z=0;if(C>0&&T>0&&T<C){const K=T/C;z=E/K-E}l(M,{fps:A,elapsedMs:E,etaMs:z})},error:S=>console.error("VideoDecoder error",S)}),x=new AudioDecoder({output:S=>{if(B&&B.state==="configured")try{B.encode(S)}catch(E){console.error("AudioEncoder encode error:",E)}S.close()},error:S=>console.error("AudioDecoder error",S)});await Zd(r,g,x,v,S=>l(S));try{await w.flush()}catch(S){console.error("VideoEncoder flush error:",S)}if(B)try{await B.flush()}catch(S){console.error("AudioEncoder flush error:",S)}e=!0,c(),await o,l(100),b.finalize(),await a.close()}const iu="video-encoder-presets",fo=[{name:" (MP4)",config_json:{container:"mp4",codec:"avc1.640028",audioCodec:"mp4a.40.2",preserveOriginal:!0,bitrate:5e6,framerate:30,audio_bitrate:128e3}},{name:" (WebM)",config_json:{container:"webm",codec:"vp09.00.31.08",audioCodec:"opus",preserveOriginal:!0,bitrate:4e6,framerate:30,audio_bitrate:128e3}},{name:"4K60",config_json:{container:"mp4",codec:"avc1.640028",audioCodec:"mp4a.40.2",width:3840,height:2160,bitrate:2e7,framerate:60,audio_bitrate:192e3}},{name:"4K30",config_json:{container:"mp4",codec:"avc1.640028",audioCodec:"mp4a.40.2",width:3840,height:2160,bitrate:15e6,framerate:30,audio_bitrate:192e3}},{name:"1440p60",config_json:{container:"mp4",codec:"avc1.640028",audioCodec:"mp4a.40.2",width:2560,height:1440,bitrate:12e6,framerate:60,audio_bitrate:16e4}},{name:"1440p30",config_json:{container:"mp4",codec:"avc1.640028",audioCodec:"mp4a.40.2",width:2560,height:1440,bitrate:8e6,framerate:30,audio_bitrate:16e4}},{name:"1080p60",config_json:{container:"mp4",codec:"avc1.640028",audioCodec:"mp4a.40.2",width:1920,height:1080,bitrate:8e6,framerate:60,audio_bitrate:128e3}},{name:"1080p30",config_json:{container:"mp4",codec:"avc1.640028",audioCodec:"mp4a.40.2",width:1920,height:1080,bitrate:5e6,framerate:30,audio_bitrate:128e3}},{name:"720p60",config_json:{container:"mp4",codec:"avc1.42001f",audioCodec:"mp4a.40.2",width:1280,height:720,bitrate:5e6,framerate:60,audio_bitrate:128e3}},{name:"720p30",config_json:{container:"mp4",codec:"avc1.42001f",audioCodec:"mp4a.40.2",width:1280,height:720,bitrate:3e6,framerate:30,audio_bitrate:128e3}},{name:"480p30",config_json:{container:"mp4",codec:"avc1.42001e",audioCodec:"mp4a.40.2",width:854,height:480,bitrate:15e5,framerate:30,audio_bitrate:96e3}}];function ru(){try{const r=localStorage.getItem(iu);if(!r)return fo;const s=JSON.parse(r);if(Array.isArray(s)&&s.length>0)return s}catch{}return fo}var nu=bt('<p style="color: #666; font-size: 12px; margin-top: 8px;" class="svelte-1n46o8q"> <!> <!></p>'),su=bt('<div class="panel svelte-1n46o8q"><p class="svelte-1n46o8q"> </p> <!></div>'),au=bt("<option> </option>"),ou=bt('<p style="color: #666; font-size: 12px; margin-left: 112px; margin-top: -8px;" class="svelte-1n46o8q"> <!></p>'),lu=bt('<div class="row svelte-1n46o8q"><label class="svelte-1n46o8q"> (Kbps):</label> <input type="number" min="100" max="50000" step="100" class="svelte-1n46o8q"/></div> <div class="row svelte-1n46o8q"><label class="svelte-1n46o8q"> (Kbps):</label> <input type="number" min="32" max="320" step="8" class="svelte-1n46o8q"/></div>',1),hu=bt('<p style="color: #f44336; font-size: 12px; margin-top: -8px;" class="svelte-1n46o8q"> </p>'),fu=bt('<div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <select class="svelte-1n46o8q"><option> </option><option> </option><option> </option><option> </option><option>480p (854480)</option><option>360p (640360)</option></select></div> <!>',1),du=bt('<div class="row svelte-1n46o8q"><label class="svelte-1n46o8q"> (px):</label> <input type="number" min="64" max="7680" step="2" class="svelte-1n46o8q"/></div> <div class="row svelte-1n46o8q"><label class="svelte-1n46o8q"> (px):</label> <input type="number" min="64" max="4320" step="2" class="svelte-1n46o8q"/></div>',1),uu=bt('<div class="row svelte-1n46o8q"><label class="svelte-1n46o8q"> (px):</label> <input type="number" min="64" max="7680" step="2" class="svelte-1n46o8q"/> <p style="color: #999; font-size: 12px;" class="svelte-1n46o8q"></p></div>'),cu=bt('<div class="row svelte-1n46o8q"><label class="svelte-1n46o8q"> (px):</label> <input type="number" min="64" max="4320" step="2" class="svelte-1n46o8q"/> <p style="color: #999; font-size: 12px;" class="svelte-1n46o8q"></p></div>'),pu=bt('<p style="color: #f44336; font-size: 12px; margin-top: -8px;" class="svelte-1n46o8q"> </p>'),_u=bt('<div class="row svelte-1n46o8q"><label class="svelte-1n46o8q"> (fps):</label> <input type="number" min="1" step="1" class="svelte-1n46o8q"/></div> <!>',1),vu=bt('<div class="panel svelte-1n46o8q"><h3 class="section-title svelte-1n46o8q"></h3> <div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <select class="svelte-1n46o8q"><option>AAC-LC</option><option>AAC-HE</option><option>Opus</option></select></div> <div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <select class="svelte-1n46o8q"><option>MP4</option><option>MOV</option><option>WebM</option></select></div> <div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <select class="svelte-1n46o8q"><option></option><option></option><option>()</option><option></option><option></option></select></div> <!> <div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <select class="svelte-1n46o8q"><option></option><option></option></select></div> <!></div> <div class="panel svelte-1n46o8q"><h3 class="section-title svelte-1n46o8q"></h3> <p style="color: #ff9800; background: #fff3e0; padding: 8px; border-radius: 4px; font-size: 12px; margin-bottom: 16px;" class="svelte-1n46o8q"> </p> <div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <select class="svelte-1n46o8q"><option>0</option><option>90</option><option>180</option><option>270</option></select></div> <div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <div class="checkbox-group svelte-1n46o8q"><label class="checkbox-label svelte-1n46o8q"><input type="checkbox" class="svelte-1n46o8q"/> <span></span></label> <label class="checkbox-label svelte-1n46o8q"><input type="checkbox" class="svelte-1n46o8q"/> <span></span></label></div></div></div>',1),gu=bt('<p class="svelte-1n46o8q"> </p>'),mu=bt('<div class="panel svelte-1n46o8q"><div class="progress svelte-1n46o8q"><div class="svelte-1n46o8q"></div></div> <p class="svelte-1n46o8q"> </p> <p class="svelte-1n46o8q"> </p> <!></div>'),yu=bt('<div class="error-log-item svelte-1n46o8q"> </div>'),wu=bt('<div class="error-logs-content svelte-1n46o8q"></div>'),bu=bt('<div class="error-logs svelte-1n46o8q"><button class="error-logs-toggle svelte-1n46o8q"> </button> <!></div>'),xu=bt('<div class="panel svelte-1n46o8q"><p style="color: #2e7d32; background: #e8f5e9; padding: 12px; border-radius: 4px;" class="svelte-1n46o8q"> </p></div>'),Su=bt('<div class="panel preset-toggle svelte-1n46o8q"><div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <select class="svelte-1n46o8q"></select></div> <div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <select style="flex: 1;" class="svelte-1n46o8q"><optgroup label="H.264 (AVC)"><option>H.264 High</option> <option>H.264 Main</option> <option>H.264 Baseline</option></optgroup><optgroup label="H.265 (HEVC)"><option>H.265 Main</option> <option>H.265 Main (hvc1)</option></optgroup><optgroup label="VP9"><option>VP9 Profile 0</option> <option>VP9 Profile 0 L4.1</option></optgroup><optgroup label="AV1"><option>AV1 Main L3.1</option> <option>AV1 Main L3.0</option></optgroup></select></div> <div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <select class="svelte-1n46o8q"><option> ()</option><option> (80%)</option><option> (60%) - </option><option> (40%)</option><option> (25%)</option><option></option></select></div> <!> <!> <div class="row svelte-1n46o8q"><button type="button" style="width: 100%; padding: 10px; background: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer;" class="svelte-1n46o8q"> </button></div></div> <!> <div class="panel svelte-1n46o8q"><button class="svelte-1n46o8q"></button></div> <!> <!> <!>',1),Uu=bt('<div class="panel svelte-1n46o8q"><p style="color: #999;" class="svelte-1n46o8q">...</p></div>'),Eu=bt('<div class="container svelte-1n46o8q"><h1 class="svelte-1n46o8q"></h1> <div class="dropzone svelte-1n46o8q"><input type="file" id="fileInput" accept="video/mp4" class="svelte-1n46o8q"/> <p class="svelte-1n46o8q">MP4&  </p></div> <!> <!></div>');function Cu(r,s){yo(s,!1);let l=j(null),h=j([]),d=j(0),u=j(!1),m=j(0),a=j(0),b=j(0),w=j(0),B=j(!1),T=j(""),C=j([]),P=j(!1),y=j(0),N=j(0),t=j(0),e=j(0),n=j(0),o=j(!1),f=j("mp4"),c=j("avc1.640028"),v=j("mp4a.40.2"),g=j("preset"),x=j("1080p"),S=j(1920),E=j(1080),A=j(1920),M=j(1080),z=j("manual"),K=j(30),L=j(""),Q=j(5e3),Ht=j(128),Rt=j(0),Ct=j(!1),Ot=j(!1),Y=j(0),xt=j(0);const ct={"2160p":{width:3840,height:2160},"1440p":{width:2560,height:1440},"1080p":{width:1920,height:1080},"720p":{width:1280,height:720},"480p":{width:854,height:480},"360p":{width:640,height:360}},jt=async W=>{const dt=W.target;if(k(l,dt.files?.[0]??null),k(o,!1),k(y,0),k(N,0),k(t,0),k(e,0),k(n,0),p(l))try{const wt=await p(l).arrayBuffer(),$=Yi.createFile();$.onReady=lt=>{const st=lt.videoTracks?.[0];if(st){if(k(y,st.video.width),k(N,st.video.height),k(t,st.movie_duration&&st.nb_samples?st.nb_samples*st.movie_timescale/st.movie_duration:30),st.bitrate)k(e,st.bitrate);else if(st.movie_duration&&lt.size){const re=st.movie_duration/st.movie_timescale;k(e,Math.round(lt.size*8/re))}}const vt=lt.audioTracks?.[0];vt&&(vt.bitrate?k(n,vt.bitrate):k(n,128e3)),k(o,!0)},$.onError=lt=>{console.error("MP4Box analysis error:",lt)},wt.fileStart=0,$.appendBuffer(wt),$.flush()}catch(wt){console.error("Failed to analyze file:",wt)}};function q(W){const dt=p(W?e:n);if(!dt||dt===0)return W?5e6:128e3;let wt=1;switch(p(L)){case"":wt=1;break;case"":wt=.8;break;case"":wt=.6;break;case"":wt=.4;break;case"":wt=.25;break;case"":return W?p(Q)*1e3:p(Ht)*1e3}let $=dt*wt;if(W){if(p(c).startsWith("vp09")?$*=.7:p(c).startsWith("av01")&&($*=.6),p(g)!=="original"){let st=p(y),vt=p(N);if(p(g)==="preset"){const Pt=ct[p(x)];st=Pt.width,vt=Pt.height}else p(g)==="manual"?(st=p(S),vt=p(E)):p(g)==="width-only"?(st=p(A),vt=Math.round(p(A)/p(y)*p(N))):p(g)==="height-only"&&(st=Math.round(p(M)/p(N)*p(y)),vt=p(M));const re=p(y)*p(N),Kt=st*vt/re;$*=Kt}const lt=5e7;$>lt&&($=lt)}else{let lt=p(v);p(f)==="mp4"&&(p(L)===""||p(L)===""?(p(v).startsWith("mp4a.40.2")||p(v).startsWith("mp4a.40.5"))&&(lt="mp4a.40.5"):(p(L)===""||p(L)===""||p(L)==="")&&(p(v).startsWith("mp4a.40.2")||p(v).startsWith("mp4a.40.5"))&&(lt="mp4a.40.2")),lt==="opus"?($<32e3&&($=32e3),$>256e3&&($=256e3)):lt.startsWith("mp4a.40.2")?($<96e3&&($=96e3),$>192e3&&($=192e3),$=Ol($)):lt.startsWith("mp4a.40.5")&&($<32e3&&($=32e3),$>128e3&&($=128e3))}return Math.round($)}function ya(){const W=p(h)[p(d)]?.config_json??p(h)[p(d)];if(W){if(k(f,W.container??"mp4"),k(c,W.codec??"avc1.640028"),k(v,W.audioCodec??"mp4a.40.2"),W.preserveOriginal?k(L,""):k(L,""),k(Q,(W.bitrate??5e6)/1e3),k(Ht,(W.audio_bitrate??128e3)/1e3),k(K,W.framerate??30),W.preserveOriginal)k(g,"original"),k(z,"original");else if(W.width&&W.height){k(g,"preset"),k(S,W.width),k(E,W.height),k(z,"manual");const dt=Object.entries(ct).find(([wt,$])=>$.width===W.width&&$.height===W.height);dt&&k(x,dt[0])}}}function Nl(){k(u,!p(u)),p(u)||ya()}async function Hl(){if(!p(l))return;k(T,""),k(C,[]),k(B,!0);let W,dt;if(p(g)==="original")W=void 0,dt=void 0;else if(p(g)==="preset"){const $t=ct[p(x)];W=$t.width,dt=$t.height}else p(g)==="manual"?(W=p(S),dt=p(E)):p(g)==="width-only"?(W=p(A),dt=void 0):p(g)==="height-only"&&(W=void 0,dt=p(M));const wt=q(!0),$=q(!1),lt={video:{codec:p(c),container:p(f),width:W,height:dt,bitrate:wt,framerate:p(K),framerateMode:p(z),rotation:p(Rt),flipHorizontal:p(Ct),flipVertical:p(Ot)},audio:{codec:p(v),sampleRate:44100,numberOfChannels:2,bitrate:$}},st=performance.now();await eu(p(l),lt,($t,Kt,Pt)=>{$t!==void 0&&k(m,$t),Kt&&(k(a,Kt.fps),k(b,Kt.elapsedMs),k(w,Kt.etaMs??0)),Pt&&Pt.videoFormat&&!p(o)&&(k(y,Pt.videoFormat.width||0),k(N,Pt.videoFormat.height||0),k(t,Pt.videoFormat.framerate||0),k(e,Pt.videoFormat.bitrate||0),Pt.audioFormat&&k(n,Pt.audioFormat.bitrate||0),k(o,!0))});const vt=performance.now(),re={process_time_ms:Math.round(vt-st),source_size_byte:p(l).size,avg_fps:p(a)};k(T,` (: ${re.process_time_ms}ms, FPS: ${re.avg_fps.toFixed(1)})`),k(B,!1)}Hf(()=>{k(h,ru());const W=console.error;return console.error=function(...dt){W.apply(console,dt);const wt=new Date().toLocaleTimeString("ja-JP"),$=dt.map(lt=>typeof lt=="object"?JSON.stringify(lt):String(lt)).join(" ");k(C,[...p(C),`[${wt}] ${$}`])},()=>{console.error=W}}),an(()=>p(c),()=>{p(c).startsWith("vp09")||p(c).startsWith("vp08")||p(c).startsWith("av01")?k(f,"webm"):(p(c).startsWith("avc1")||p(c).startsWith("hev1")||p(c).startsWith("hvc1"))&&k(f,"mp4")}),an(()=>(p(f),p(v),p(L)),()=>{p(f)==="mp4"&&!p(v).startsWith("mp4a")&&k(v,"mp4a.40.2"),p(f)==="mp4"?p(L)===""||p(L)===""?p(v).startsWith("mp4a.40.2")&&k(v,"mp4a.40.5"):(p(L)===""||p(L)===""||p(L)==="")&&p(v).startsWith("mp4a.40.5")&&k(v,"mp4a.40.2"):p(f)==="webm"&&p(v).startsWith("mp4a")&&k(v,"opus")}),an(()=>(p(C),p(B)),()=>{p(C).length>0&&p(B)&&k(P,!0)}),an(()=>(p(L),p(Q),p(Ht),p(c),p(v),p(g),p(x),p(S),p(E),p(A),p(M),p(e),p(n),p(y),p(N),p(o)),()=>{p(L),p(Q),p(Ht),p(c),p(v),p(g),p(x),p(S),p(E),p(A),p(M),p(e),p(n),p(y),p(N),p(o),k(Y,q(!0)),k(xt,q(!1))}),ff(),Nf();var wa=Eu(),Hn=I(O(wa),2),Gl=O(Hn),ba=I(Hn,2);{var Vl=W=>{var dt=su(),wt=O(dt),$=O(wt),lt=I(wt,2);{var st=vt=>{var re=nu(),$t=O(re),Kt=I($t);{var Pt=ne=>{var He=on();_t(ni=>Bt(He,`| : ${ni??""}Mbps`),[()=>(p(e),ht(()=>(p(e)/1e6).toFixed(1)))]),it(ne,He)};mt(Kt,ne=>{p(e)>0&&ne(Pt)})}var tn=I(Kt,2);{var lr=ne=>{var He=on();_t(ni=>Bt(He,`| : ${ni??""}Kbps`),[()=>(p(n),ht(()=>(p(n)/1e3).toFixed(0)))]),it(ne,He)};mt(tn,ne=>{p(n)>0&&ne(lr)})}_t(ne=>Bt($t,`: ${p(y)??""}${p(N)??""} @ ${ne??""}fps `),[()=>(p(t),ht(()=>p(t).toFixed(1)))]),it(vt,re)};mt(lt,vt=>{p(o)&&vt(st)})}_t(vt=>Bt($,`: ${p(l),ht(()=>p(l).name)??""} (${vt??""} MB)`),[()=>(p(l),ht(()=>(p(l).size/1024/1024).toFixed(2)))]),it(W,dt)};mt(ba,W=>{p(l)&&W(Vl)})}var Wl=I(ba,2);{var Yl=W=>{var dt=Su(),wt=ce(dt),$=O(wt),lt=I(O($),2);_t(()=>{p(d),Te(()=>{p(h)})}),ro(lt,5,()=>p(h),eo,(et,St,Ut)=>{var At=au(),Xt=O(At);At.value=At.__value=Ut,_t(()=>Bt(Xt,(p(St),ht(()=>p(St).name)))),it(et,At)});var st=I($,2),vt=I(O(st),2);_t(()=>{p(c),Te(()=>{})});var re=O(vt),$t=O(re);$t.value=$t.__value="avc1.640028";var Kt=I($t,2);Kt.value=Kt.__value="avc1.4d001f";var Pt=I(Kt,2);Pt.value=Pt.__value="avc1.42001f";var tn=I(re),lr=O(tn);lr.value=lr.__value="hev1.1.6.L93.B0";var ne=I(lr,2);ne.value=ne.__value="hvc1.1.6.L93.B0";var He=I(tn),ni=O(He);ni.value=ni.__value="vp09.00.31.08";var xa=I(ni,2);xa.value=xa.__value="vp09.00.41.08";var jl=I(He),Gn=O(jl);Gn.value=Gn.__value="av01.0.05M.08";var Sa=I(Gn,2);Sa.value=Sa.__value="av01.0.04M.08";var Ua=I(st,2),Ea=I(O(Ua),2);_t(()=>{p(L),Te(()=>{})});var Vn=O(Ea);Vn.value=Vn.__value="";var Wn=I(Vn);Wn.value=Wn.__value="";var Yn=I(Wn);Yn.value=Yn.__value="";var qn=I(Yn);qn.value=qn.__value="";var jn=I(qn);jn.value=jn.__value="";var Ca=I(jn);Ca.value=Ca.__value="";var Ba=I(Ua,2);{var $l=et=>{var St=ou(),Ut=O(St),At=I(Ut);{var Xt=gt=>{var Gt=on("(VP9)");it(gt,Gt)},fe=gt=>{var Gt=fr(),Ge=ce(Gt);{var Ve=Lt=>{var se=on("(AV1)");it(Lt,se)};mt(Ge,Lt=>{p(c),ht(()=>p(c).startsWith("av01"))&&Lt(Ve)},!0)}it(gt,Gt)};mt(At,gt=>{p(c),ht(()=>p(c).startsWith("vp09"))?gt(Xt):gt(fe,!1)})}_t((gt,Gt)=>Bt(Ut,`:  ${gt??""}Mbps /  ${Gt??""}Kbps `),[()=>(p(Y),ht(()=>(p(Y)/1e6).toFixed(1))),()=>(p(xt),ht(()=>(p(xt)/1e3).toFixed(0)))]),it(et,St)};mt(Ba,et=>{p(o)&&p(L)!==""&&et($l)})}var Aa=I(Ba,2);{var Kl=et=>{var St=lu(),Ut=ce(St),At=I(O(Ut),2),Xt=I(Ut,2),fe=I(O(Xt),2);fi(At,()=>p(Q),gt=>k(Q,gt)),fi(fe,()=>p(Ht),gt=>k(Ht,gt)),it(et,St)};mt(Aa,et=>{p(L)===""&&et(Kl)})}var Xl=I(Aa,2),Ta=O(Xl),Zl=O(Ta),ka=I(wt,2);{var Jl=et=>{var St=vu(),Ut=ce(St),At=I(O(Ut),2),Xt=I(O(At),2);_t(()=>{p(v),Te(()=>{})});var fe=O(Xt);fe.value=fe.__value="mp4a.40.2";var gt=I(fe);gt.value=gt.__value="mp4a.40.5";var Gt=I(gt);Gt.value=Gt.__value="opus";var Ge=I(At,2),Ve=I(O(Ge),2);_t(()=>{p(f),Te(()=>{})});var Lt=O(Ve);Lt.value=Lt.__value="mp4";var se=I(Lt);se.value=se.__value="mov";var Fi=I(se);Fi.value=Fi.__value="webm";var en=I(Ge,2),La=I(O(en),2);_t(()=>{p(g),Te(()=>{})});var $n=O(La);$n.value=$n.__value="original";var Kn=I($n);Kn.value=Kn.__value="preset";var Xn=I(Kn);Xn.value=Xn.__value="manual";var Zn=I(Xn);Zn.value=Zn.__value="width-only";var Ma=I(Zn);Ma.value=Ma.__value="height-only";var Da=I(en,2);{var rh=pt=>{var We=fu(),si=ce(We),ai=I(O(si),2);_t(()=>{p(x),Te(()=>{p(o),p(y),p(N)})});var Be=O(ai),ge=O(Be);Be.value=Be.__value="2160p";var Tt=I(Be),Ae=O(Tt);Tt.value=Tt.__value="1440p";var de=I(Tt),oi=O(de);de.value=de.__value="1080p";var Vt=I(de),ue=O(Vt);Vt.value=Vt.__value="720p";var li=I(Vt);li.value=li.__value="480p";var Pi=I(li);Pi.value=Pi.__value="360p";var hr=I(si,2);{var rn=hi=>{var nn=fr(),ch=ce(nn);{var ph=is=>{var _h=hu();it(is,_h)};mt(ch,is=>{p(x),p(y),p(N),ht(()=>ct[p(x)].width>p(y)||ct[p(x)].height>p(N))&&is(ph)})}it(hi,nn)};mt(hr,hi=>{p(o),p(x),ht(()=>p(o)&&ct[p(x)])&&hi(rn)})}_t(()=>{Be.disabled=p(o)&&(p(y)<3840||p(N)<2160),Bt(ge,`4K (38402160) ${p(o)&&(p(y)<3840||p(N)<2160)?"()":""}`),Tt.disabled=p(o)&&(p(y)<2560||p(N)<1440),Bt(Ae,`1440p (25601440) ${p(o)&&(p(y)<2560||p(N)<1440)?"()":""}`),de.disabled=p(o)&&(p(y)<1920||p(N)<1080),Bt(oi,`1080p (19201080) ${p(o)&&(p(y)<1920||p(N)<1080)?"()":""}`),Vt.disabled=p(o)&&(p(y)<1280||p(N)<720),Bt(ue,`720p (1280720) ${p(o)&&(p(y)<1280||p(N)<720)?"()":""}`)}),ke(ai,()=>p(x),hi=>k(x,hi)),it(pt,We)},nh=pt=>{var We=fr(),si=ce(We);{var ai=ge=>{var Tt=du(),Ae=ce(Tt),de=I(O(Ae),2),oi=I(Ae,2),Vt=I(O(oi),2);fi(de,()=>p(S),ue=>k(S,ue)),fi(Vt,()=>p(E),ue=>k(E,ue)),it(ge,Tt)},Be=ge=>{var Tt=fr(),Ae=ce(Tt);{var de=Vt=>{var ue=uu(),li=I(O(ue),2);fi(li,()=>p(A),Pi=>k(A,Pi)),it(Vt,ue)},oi=Vt=>{var ue=fr(),li=ce(ue);{var Pi=hr=>{var rn=cu(),hi=I(O(rn),2);fi(hi,()=>p(M),nn=>k(M,nn)),it(hr,rn)};mt(li,hr=>{p(g)==="height-only"&&hr(Pi)},!0)}it(Vt,ue)};mt(Ae,Vt=>{p(g)==="width-only"?Vt(de):Vt(oi,!1)},!0)}it(ge,Tt)};mt(si,ge=>{p(g)==="manual"?ge(ai):ge(Be,!1)},!0)}it(pt,We)};mt(Da,pt=>{p(g)==="preset"?pt(rh):pt(nh,!1)})}var Ra=I(Da,2),Oa=I(O(Ra),2);_t(()=>{p(z),Te(()=>{})});var Jn=O(Oa);Jn.value=Jn.__value="original";var Na=I(Jn);Na.value=Na.__value="manual";var sh=I(Ra,2);{var ah=pt=>{var We=_u(),si=ce(We),ai=I(O(si),2),Be=I(si,2);{var ge=Tt=>{var Ae=pu(),de=O(Ae);_t(oi=>Bt(de,` (${oi??""}fps)`),[()=>(p(t),ht(()=>p(t).toFixed(1)))]),it(Tt,Ae)};mt(Be,Tt=>{p(o)&&p(t)>0&&p(K)>p(t)&&Tt(ge)})}_t(()=>Df(ai,"max",p(o)&&p(t)>0?p(t):120)),fi(ai,()=>p(K),Tt=>k(K,Tt)),it(pt,We)};mt(sh,pt=>{p(z)==="manual"&&pt(ah)})}var oh=I(Ut,2),Ha=I(O(oh),4),Ga=I(O(Ha),2);_t(()=>{p(Rt),Te(()=>{})});var Qn=O(Ga);Qn.value=Qn.__value=0;var ts=I(Qn);ts.value=ts.__value=90;var es=I(ts);es.value=es.__value=180;var Va=I(es);Va.value=Va.__value=270;var lh=I(Ha,2),hh=I(O(lh),2),Wa=O(hh),fh=O(Wa),dh=I(Wa,2),uh=O(dh);ke(Xt,()=>p(v),pt=>k(v,pt)),ke(Ve,()=>p(f),pt=>k(f,pt)),ke(La,()=>p(g),pt=>k(g,pt)),ke(Oa,()=>p(z),pt=>k(z,pt)),ke(Ga,()=>p(Rt),pt=>k(Rt,pt)),so(fh,()=>p(Ct),pt=>k(Ct,pt)),so(uh,()=>p(Ot),pt=>k(Ot,pt)),it(et,St)};mt(ka,et=>{p(u)&&et(Jl)})}var Ia=I(ka,2),za=O(Ia),Fa=I(Ia,2);{var Ql=et=>{var St=mu(),Ut=O(St),At=O(Ut),Xt=I(Ut,2),fe=O(Xt),gt=I(Xt,2),Gt=O(gt),Ge=I(gt,2);{var Ve=Lt=>{var se=gu(),Fi=O(se);_t(en=>Bt(Fi,`: ${en??""}s`),[()=>(p(w),ht(()=>(p(w)/1e3).toFixed(1)))]),it(Lt,se)};mt(Ge,Lt=>{p(w)>0&&p(m)<100&&Lt(Ve)})}_t((Lt,se,Fi)=>{Ff(At,`width:${p(m)??""}%`),Bt(fe,`: ${Lt??""}%`),Bt(Gt,`FPS: ${se??""} | : ${Fi??""}s`)},[()=>(p(m),ht(()=>Math.round(p(m)))),()=>(p(a),ht(()=>p(a)>0?p(a).toFixed(1):"-")),()=>(p(b),ht(()=>(p(b)/1e3).toFixed(1)))]),it(et,St)};mt(Fa,et=>{p(B)&&et(Ql)})}var Pa=I(Fa,2);{var th=et=>{var St=bu(),Ut=O(St),At=O(Ut),Xt=I(Ut,2);{var fe=gt=>{var Gt=wu();ro(Gt,5,()=>p(C),eo,(Ge,Ve)=>{var Lt=yu(),se=O(Lt);_t(()=>Bt(se,p(Ve))),it(Ge,Lt)}),it(gt,Gt)};mt(Xt,gt=>{p(P)&&gt(fe)})}_t(()=>Bt(At,(p(P),p(C),ht(()=>p(P)?"":` (${p(C).length})`)))),Li("click",Ut,()=>k(P,!p(P))),it(et,St)};mt(Pa,et=>{p(C),ht(()=>p(C).length>0)&&et(th)})}var eh=I(Pa,2);{var ih=et=>{var St=xu(),Ut=O(St),At=O(Ut);_t(()=>Bt(At,p(T))),it(et,St)};mt(eh,et=>{p(T)&&et(ih)})}_t(()=>{Bt(Zl,p(u)?"":""),za.disabled=!p(l)||p(B)}),ke(lt,()=>p(d),et=>k(d,et)),Li("change",lt,ya),ke(vt,()=>p(c),et=>k(c,et)),ke(Ea,()=>p(L),et=>k(L,et)),Li("click",Ta,Nl),Li("click",za,Hl),it(W,dt)},ql=W=>{var dt=Uu();it(W,dt)};mt(Wl,W=>{p(h),ht(()=>p(h).length>0)?W(Yl):W(ql,!1)})}Li("change",Gl,jt),Li("click",Hn,()=>document.getElementById("fileInput")?.click()),it(r,wa),wo()}Ef(Cu,{target:document.getElementById("app")});
