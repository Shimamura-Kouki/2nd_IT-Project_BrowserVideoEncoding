(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))f(d);new MutationObserver(d=>{for(const p of d)if(p.type==="childList")for(const v of p.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&f(v)}).observe(document,{childList:!0,subtree:!0});function h(d){const p={};return d.integrity&&(p.integrity=d.integrity),d.referrerPolicy&&(p.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?p.credentials="include":d.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function f(d){if(d.ep)return;d.ep=!0;const p=h(d);fetch(d.href,p)}})();const xn=!1;var Rn=Array.isArray,ma=Array.prototype.indexOf,Xi=Array.from,xa=Object.defineProperty,pi=Object.getOwnPropertyDescriptor,ba=Object.getOwnPropertyDescriptors,Sa=Object.prototype,wa=Array.prototype,Zr=Object.getPrototypeOf,kr=Object.isExtensible;function Ua(r){return r()}function bn(r){for(var a=0;a<r.length;a++)r[a]()}function $r(){var r,a,h=new Promise((f,d)=>{r=f,a=d});return{promise:h,resolve:r,reject:a}}const st=2,Ni=4,Ai=8,Jr=1<<24,Jt=16,Qt=32,Me=64,On=128,Ct=512,ot=1024,ut=2048,te=4096,bt=8192,ue=16384,Nn=32768,Ze=65536,Lr=1<<17,Qr=1<<18,Qe=1<<19,ts=1<<20,de=1<<25,Fe=32768,Sn=1<<21,Gn=1<<22,pe=1<<23,Ce=Symbol("$state"),Xe=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Ea(r){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Ba(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Ca(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Aa(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Ta(r){throw new Error("https://svelte.dev/e/effect_orphan")}function Ia(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function za(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Fa(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Pa(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function ka(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const La=1,Da=2,Ma=16,Ra=1,Oa=2,nt=Symbol();function Na(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Ga(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function es(r){return r===this.v}function Ha(r,a){return r!=r?a==a:r!==a||r!==null&&typeof r=="object"||typeof r=="function"}function is(r){return!Ha(r,this.v)}let Ti=!1,Va=!1;function Ya(){Ti=!0}let J=null;function $e(r){J=r}function ns(r,a=!1,h){J={p:J,i:!1,c:null,e:null,s:r,x:null,l:Ti&&!a?{s:null,u:null,$:[]}:null}}function rs(r){var a=J,h=a.e;if(h!==null){a.e=null;for(var f of h)Ss(f)}return a.i=!0,J=a.p,{}}function Ii(){return!Ti||J!==null&&J.l===null}let Ee=[];function ss(){var r=Ee;Ee=[],bn(r)}function Zi(r){if(Ee.length===0&&!_i){var a=Ee;queueMicrotask(()=>{a===Ee&&ss()})}Ee.push(r)}function qa(){for(;Ee.length>0;)ss()}function as(r){var a=W;if(a===null)return H.f|=pe,r;if(a.f&Nn)Je(r,a);else{if(!(a.f&On))throw r;a.b.error(r)}}function Je(r,a){for(;a!==null;){if(a.f&On)try{a.b.error(r);return}catch(h){r=h}a=a.parent}throw r}const ja=-7169;function tt(r,a){r.f=r.f&ja|a}function Hn(r){r.f&Ct||r.deps===null?tt(r,ot):tt(r,te)}function os(r){if(r!==null)for(const a of r)!(a.f&st)||!(a.f&Fe)||(a.f^=Fe,os(a.deps))}function ls(r,a,h){r.f&ut?a.add(r):r.f&te&&h.add(r),os(r.deps),tt(r,ot)}const Li=new Set;let V=null,ci=null,zt=null,Et=[],$i=null,wn=!1,_i=!1;class Nt{committed=!1;current=new Map;previous=new Map;#e=new Set;#a=new Set;#t=0;#r=0;#s=null;#n=new Set;#i=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#r>0}process(a){Et=[],ci=null,this.apply();var h=[],f=[];for(const d of a)this.#o(d,h,f);this.is_fork||this.#h(),this.is_deferred()?(this.#l(f),this.#l(h)):(ci=this,V=null,Dr(f),Dr(h),ci=null,this.#s?.resolve()),zt=null}#o(a,h,f){a.f^=ot;for(var d=a.first,p=null;d!==null;){var v=d.f,s=(v&(Qt|Me))!==0,m=s&&(v&ot)!==0,y=m||(v&bt)!==0||this.skipped_effects.has(d);if(!y&&d.fn!==null){s?d.f^=ot:p!==null&&v&(Ni|Ai|Jr)?p.b.defer_effect(d):v&Ni?h.push(d):Fi(d)&&(v&Jt&&this.#n.add(d),Ui(d));var E=d.first;if(E!==null){d=E;continue}}var A=d.parent;for(d=d.next;d===null&&A!==null;)A===p&&(p=null),d=A.next,A=A.parent}}#l(a){for(var h=0;h<a.length;h+=1)ls(a[h],this.#n,this.#i)}capture(a,h){h!==nt&&!this.previous.has(a)&&this.previous.set(a,h),a.f&pe||(this.current.set(a,a.v),zt?.set(a,a.v))}activate(){V=this,this.apply()}deactivate(){V===this&&(V=null,zt=null)}flush(){if(this.activate(),Et.length>0){if(hs(),V!==null&&V!==this)return}else this.#t===0&&this.process([]);this.deactivate()}discard(){for(const a of this.#a)a(this);this.#a.clear()}#h(){if(this.#r===0){for(const a of this.#e)a();this.#e.clear()}this.#t===0&&this.#f()}#f(){if(Li.size>1){this.previous.clear();var a=zt,h=!0;for(const d of Li){if(d===this){h=!1;continue}const p=[];for(const[s,m]of this.current){if(d.current.has(s))if(h&&m!==d.current.get(s))d.current.set(s,m);else continue;p.push(s)}if(p.length===0)continue;const v=[...d.current.keys()].filter(s=>!this.current.has(s));if(v.length>0){var f=Et;Et=[];const s=new Set,m=new Map;for(const y of p)fs(y,v,s,m);if(Et.length>0){V=d,d.apply();for(const y of Et)d.#o(y,[],[]);d.deactivate()}Et=f}}V=null,zt=a}this.committed=!0,Li.delete(this)}increment(a){this.#t+=1,a&&(this.#r+=1)}decrement(a){this.#t-=1,a&&(this.#r-=1),this.revive()}revive(){for(const a of this.#n)this.#i.delete(a),tt(a,ut),Zt(a);for(const a of this.#i)tt(a,te),Zt(a);this.flush()}oncommit(a){this.#e.add(a)}ondiscard(a){this.#a.add(a)}settled(){return(this.#s??=$r()).promise}static ensure(){if(V===null){const a=V=new Nt;Li.add(V),_i||Nt.enqueue(()=>{V===a&&a.flush()})}return V}static enqueue(a){Zi(a)}apply(){}}function Wa(r){var a=_i;_i=!0;try{for(var h;;){if(qa(),Et.length===0&&(V?.flush(),Et.length===0))return $i=null,h;hs()}}finally{_i=a}}function hs(){var r=Te;wn=!0;var a=null;try{var h=0;for(Vi(!0);Et.length>0;){var f=Nt.ensure();if(h++>1e3){var d,p;Ka()}f.process(Et),ce.clear()}}finally{wn=!1,Vi(r),$i=null}}function Ka(){try{Ia()}catch(r){Je(r,$i)}}let Kt=null;function Dr(r){var a=r.length;if(a!==0){for(var h=0;h<a;){var f=r[h++];if(!(f.f&(ue|bt))&&Fi(f)&&(Kt=new Set,Ui(f),f.deps===null&&f.first===null&&f.nodes===null&&(f.teardown===null&&f.ac===null?Es(f):f.fn=null),Kt?.size>0)){ce.clear();for(const d of Kt){if(d.f&(ue|bt))continue;const p=[d];let v=d.parent;for(;v!==null;)Kt.has(v)&&(Kt.delete(v),p.push(v)),v=v.parent;for(let s=p.length-1;s>=0;s--){const m=p[s];m.f&(ue|bt)||Ui(m)}}Kt.clear()}}Kt=null}}function fs(r,a,h,f){if(!h.has(r)&&(h.add(r),r.reactions!==null))for(const d of r.reactions){const p=d.f;p&st?fs(d,a,h,f):p&(Gn|Jt)&&!(p&ut)&&ds(d,a,f)&&(tt(d,ut),Zt(d))}}function ds(r,a,h){const f=h.get(r);if(f!==void 0)return f;if(r.deps!==null)for(const d of r.deps){if(a.includes(d))return!0;if(d.f&st&&ds(d,a,h))return h.set(d,!0),!0}return h.set(r,!1),!1}function Zt(r){for(var a=$i=r;a.parent!==null;){a=a.parent;var h=a.f;if(wn&&a===W&&h&Jt&&!(h&Qr))return;if(h&(Me|Qt)){if(!(h&ot))return;a.f^=ot}}Et.push(a)}function Xa(r){let a=0,h=Pe(0),f;return()=>{jn()&&(U(h),Kn(()=>(a===0&&(f=ti(()=>r(()=>vi(h)))),a+=1,()=>{Zi(()=>{a-=1,a===0&&(f?.(),f=void 0,vi(h))})})))}}var Za=Ze|Qe|On;function $a(r,a,h){new Ja(r,a,h)}class Ja{parent;is_pending=!1;#e;#a=null;#t;#r;#s;#n=null;#i=null;#o=null;#l=null;#h=null;#f=0;#d=0;#p=!1;#c=new Set;#_=new Set;#u=null;#x=Xa(()=>(this.#u=Pe(this.#f),()=>{this.#u=null}));constructor(a,h,f){this.#e=a,this.#t=h,this.#r=f,this.parent=W.b,this.is_pending=!!this.#t.pending,this.#s=Xn(()=>{W.b=this;{var d=this.#y();try{this.#n=Bt(()=>f(d))}catch(p){this.error(p)}this.#d>0?this.#g():this.is_pending=!1}return()=>{this.#h?.remove()}},Za)}#b(){try{this.#n=Bt(()=>this.#r(this.#e))}catch(a){this.error(a)}}#S(){const a=this.#t.pending;a&&(this.#i=Bt(()=>a(this.#e)),Nt.enqueue(()=>{var h=this.#y();this.#n=this.#v(()=>(Nt.ensure(),Bt(()=>this.#r(h)))),this.#d>0?this.#g():(Ae(this.#i,()=>{this.#i=null}),this.is_pending=!1)}))}#y(){var a=this.#e;return this.is_pending&&(this.#h=_e(),this.#e.before(this.#h),a=this.#h),a}defer_effect(a){ls(a,this.#c,this.#_)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#t.pending}#v(a){var h=W,f=H,d=J;Gt(this.#s),vt(this.#s),$e(this.#s.ctx);try{return a()}catch(p){return as(p),null}finally{Gt(h),vt(f),$e(d)}}#g(){const a=this.#t.pending;this.#n!==null&&(this.#l=document.createDocumentFragment(),this.#l.append(this.#h),As(this.#n,this.#l)),this.#i===null&&(this.#i=Bt(()=>a(this.#e)))}#m(a){if(!this.has_pending_snippet()){this.parent&&this.parent.#m(a);return}if(this.#d+=a,this.#d===0){this.is_pending=!1;for(const h of this.#c)tt(h,ut),Zt(h);for(const h of this.#_)tt(h,te),Zt(h);this.#c.clear(),this.#_.clear(),this.#i&&Ae(this.#i,()=>{this.#i=null}),this.#l&&(this.#e.before(this.#l),this.#l=null)}}update_pending_count(a){this.#m(a),this.#f+=a,this.#u&&ke(this.#u,this.#f)}get_effect_pending(){return this.#x(),U(this.#u)}error(a){var h=this.#t.onerror;let f=this.#t.failed;if(this.#p||!h&&!f)throw a;this.#n&&(gt(this.#n),this.#n=null),this.#i&&(gt(this.#i),this.#i=null),this.#o&&(gt(this.#o),this.#o=null);var d=!1,p=!1;const v=()=>{if(d){Ga();return}d=!0,p&&ka(),Nt.ensure(),this.#f=0,this.#o!==null&&Ae(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#n=this.#v(()=>(this.#p=!1,Bt(()=>this.#r(this.#e)))),this.#d>0?this.#g():this.is_pending=!1};var s=H;try{vt(null),p=!0,h?.(a,v),p=!1}catch(m){Je(m,this.#s&&this.#s.parent)}finally{vt(s)}f&&Zi(()=>{this.#o=this.#v(()=>{Nt.ensure(),this.#p=!0;try{return Bt(()=>{f(this.#e,()=>a,()=>v)})}catch(m){return Je(m,this.#s.parent),null}finally{this.#p=!1}})})}}function Qa(r,a,h,f){const d=Ii()?Vn:us;if(h.length===0&&r.length===0){f(a.map(d));return}var p=V,v=W,s=to();function m(){Promise.all(h.map(y=>eo(y))).then(y=>{s();try{f([...a.map(d),...y])}catch(E){v.f&ue||Je(E,v)}p?.deactivate(),Gi()}).catch(y=>{Je(y,v)})}r.length>0?Promise.all(r).then(()=>{s();try{return m()}finally{p?.deactivate(),Gi()}}):m()}function to(){var r=W,a=H,h=J,f=V;return function(p=!0){Gt(r),vt(a),$e(h),p&&f?.activate()}}function Gi(){Gt(null),vt(null),$e(null)}function Vn(r){var a=st|ut,h=H!==null&&H.f&st?H:null;return W!==null&&(W.f|=Qe),{ctx:J,deps:null,effects:null,equals:es,f:a,fn:r,reactions:null,rv:0,v:nt,wv:0,parent:h??W,ac:null}}function eo(r,a,h){let f=W;f===null&&Ba();var d=f.b,p=void 0,v=Pe(nt),s=!H,m=new Map;return po(()=>{var y=$r();p=y.promise;try{Promise.resolve(r()).then(y.resolve,y.reject).then(()=>{E===V&&E.committed&&E.deactivate(),Gi()})}catch(I){y.reject(I),Gi()}var E=V;if(s){var A=d.is_rendered();d.update_pending_count(1),E.increment(A),m.get(E)?.reject(Xe),m.delete(E),m.set(E,y)}const T=(I,g=void 0)=>{if(E.activate(),g)g!==Xe&&(v.f|=pe,ke(v,g));else{v.f&pe&&(v.f^=pe),ke(v,I);for(const[M,t]of m){if(m.delete(M),M===E)break;t.reject(Xe)}}s&&(d.update_pending_count(-1),E.decrement(A))};y.promise.then(T,I=>T(null,I||"unknown"))}),Wn(()=>{for(const y of m.values())y.reject(Xe)}),new Promise(y=>{function E(A){function T(){A===p?y(v):E(p)}A.then(T,T)}E(p)})}function us(r){const a=Vn(r);return a.equals=is,a}function ps(r){var a=r.effects;if(a!==null){r.effects=null;for(var h=0;h<a.length;h+=1)gt(a[h])}}function io(r){for(var a=r.parent;a!==null;){if(!(a.f&st))return a.f&ue?null:a;a=a.parent}return null}function Yn(r){var a,h=W;Gt(io(r));try{r.f&=~Fe,ps(r),a=Fs(r)}finally{Gt(h)}return a}function cs(r){var a=Yn(r);if(!r.equals(a)&&(r.wv=Is(),(!V?.is_fork||r.deps===null)&&(r.v=a,r.deps===null))){tt(r,ot);return}Le||(zt!==null?(jn()||V?.is_fork)&&zt.set(r,a):Hn(r))}let Un=new Set;const ce=new Map;let _s=!1;function Pe(r,a){var h={f:0,v:r,reactions:null,equals:es,rv:0,wv:0};return h}function oe(r,a){const h=Pe(r);return go(h),h}function X(r,a=!1,h=!0){const f=Pe(r);return a||(f.equals=is),Ti&&h&&J!==null&&J.l!==null&&(J.l.s??=[]).push(f),f}function D(r,a,h=!1){H!==null&&(!Ft||H.f&Lr)&&Ii()&&H.f&(st|Jt|Gn|Lr)&&!Xt?.includes(r)&&Pa();let f=h?ai(a):a;return ke(r,f)}function ke(r,a){if(!r.equals(a)){var h=r.v;Le?ce.set(r,a):ce.set(r,h),r.v=a;var f=Nt.ensure();if(f.capture(r,h),r.f&st){const d=r;r.f&ut&&Yn(d),Hn(d)}r.wv=Is(),vs(r,ut),Ii()&&W!==null&&W.f&ot&&!(W.f&(Qt|Me))&&(wt===null?yo([r]):wt.push(r)),!f.is_fork&&Un.size>0&&!_s&&no()}return a}function no(){_s=!1;var r=Te;Vi(!0);const a=Array.from(Un);try{for(const h of a)h.f&ot&&tt(h,te),Fi(h)&&Ui(h)}finally{Vi(r)}Un.clear()}function vi(r){D(r,r.v+1)}function vs(r,a){var h=r.reactions;if(h!==null)for(var f=Ii(),d=h.length,p=0;p<d;p++){var v=h[p],s=v.f;if(!(!f&&v===W)){var m=(s&ut)===0;if(m&&tt(v,a),s&st){var y=v;zt?.delete(y),s&Fe||(s&Ct&&(v.f|=Fe),vs(y,te))}else m&&(s&Jt&&Kt!==null&&Kt.add(v),Zt(v))}}}function ai(r){if(typeof r!="object"||r===null||Ce in r)return r;const a=Zr(r);if(a!==Sa&&a!==wa)return r;var h=new Map,f=Rn(r),d=oe(0),p=Ie,v=s=>{if(Ie===p)return s();var m=H,y=Ie;vt(null),Gr(p);var E=s();return vt(m),Gr(y),E};return f&&h.set("length",oe(r.length)),new Proxy(r,{defineProperty(s,m,y){(!("value"in y)||y.configurable===!1||y.enumerable===!1||y.writable===!1)&&za();var E=h.get(m);return E===void 0?E=v(()=>{var A=oe(y.value);return h.set(m,A),A}):D(E,y.value,!0),!0},deleteProperty(s,m){var y=h.get(m);if(y===void 0){if(m in s){const E=v(()=>oe(nt));h.set(m,E),vi(d)}}else D(y,nt),vi(d);return!0},get(s,m,y){if(m===Ce)return r;var E=h.get(m),A=m in s;if(E===void 0&&(!A||pi(s,m)?.writable)&&(E=v(()=>{var I=ai(A?s[m]:nt),g=oe(I);return g}),h.set(m,E)),E!==void 0){var T=U(E);return T===nt?void 0:T}return Reflect.get(s,m,y)},getOwnPropertyDescriptor(s,m){var y=Reflect.getOwnPropertyDescriptor(s,m);if(y&&"value"in y){var E=h.get(m);E&&(y.value=U(E))}else if(y===void 0){var A=h.get(m),T=A?.v;if(A!==void 0&&T!==nt)return{enumerable:!0,configurable:!0,value:T,writable:!0}}return y},has(s,m){if(m===Ce)return!0;var y=h.get(m),E=y!==void 0&&y.v!==nt||Reflect.has(s,m);if(y!==void 0||W!==null&&(!E||pi(s,m)?.writable)){y===void 0&&(y=v(()=>{var T=E?ai(s[m]):nt,I=oe(T);return I}),h.set(m,y));var A=U(y);if(A===nt)return!1}return E},set(s,m,y,E){var A=h.get(m),T=m in s;if(f&&m==="length")for(var I=y;I<A.v;I+=1){var g=h.get(I+"");g!==void 0?D(g,nt):I in s&&(g=v(()=>oe(nt)),h.set(I+"",g))}if(A===void 0)(!T||pi(s,m)?.writable)&&(A=v(()=>oe(void 0)),D(A,ai(y)),h.set(m,A));else{T=A.v!==nt;var M=v(()=>ai(y));D(A,M)}var t=Reflect.getOwnPropertyDescriptor(s,m);if(t?.set&&t.set.call(E,y),!T){if(f&&typeof m=="string"){var e=h.get("length"),n=Number(m);Number.isInteger(n)&&n>=e.v&&D(e,n+1)}vi(d)}return!0},ownKeys(s){U(d);var m=Reflect.ownKeys(s).filter(A=>{var T=h.get(A);return T===void 0||T.v!==nt});for(var[y,E]of h)E.v!==nt&&!(y in s)&&m.push(y);return m},setPrototypeOf(){Fa()}})}function Mr(r){try{if(r!==null&&typeof r=="object"&&Ce in r)return r[Ce]}catch{}return r}function ro(r,a){return Object.is(Mr(r),Mr(a))}var Rr,gs,ys,ms;function so(){if(Rr===void 0){Rr=window,gs=/Firefox/.test(navigator.userAgent);var r=Element.prototype,a=Node.prototype,h=Text.prototype;ys=pi(a,"firstChild").get,ms=pi(a,"nextSibling").get,kr(r)&&(r.__click=void 0,r.__className=void 0,r.__attributes=null,r.__style=void 0,r.__e=void 0),kr(h)&&(h.__t=void 0)}}function _e(r=""){return document.createTextNode(r)}function Hi(r){return ys.call(r)}function zi(r){return ms.call(r)}function k(r,a){return Hi(r)}function Ye(r,a=!1){{var h=Hi(r);return h instanceof Comment&&h.data===""?zi(h):h}}function z(r,a=1,h=!1){let f=r;for(;a--;)f=zi(f);return f}function ao(r){r.textContent=""}function xs(){return!1}let Or=!1;function oo(){Or||(Or=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{if(!r.defaultPrevented)for(const a of r.target.elements)a.__on_r?.()})},{capture:!0}))}function Ji(r){var a=H,h=W;vt(null),Gt(null);try{return r()}finally{vt(a),Gt(h)}}function qn(r,a,h,f=h){r.addEventListener(a,()=>Ji(h));const d=r.__on_r;d?r.__on_r=()=>{d(),f(!0)}:r.__on_r=()=>f(!0),oo()}function bs(r){W===null&&(H===null&&Ta(),Aa()),Le&&Ca()}function lo(r,a){var h=a.last;h===null?a.last=a.first=r:(h.next=r,r.prev=h,a.last=r)}function Ht(r,a,h){var f=W;f!==null&&f.f&bt&&(r|=bt);var d={ctx:J,deps:null,nodes:null,f:r|ut|Ct,first:null,fn:a,last:null,next:null,parent:f,b:f&&f.b,prev:null,teardown:null,wv:0,ac:null};if(h)try{Ui(d),d.f|=Nn}catch(s){throw gt(d),s}else a!==null&&Zt(d);var p=d;if(h&&p.deps===null&&p.teardown===null&&p.nodes===null&&p.first===p.last&&!(p.f&Qe)&&(p=p.first,r&Jt&&r&Ze&&p!==null&&(p.f|=Ze)),p!==null&&(p.parent=f,f!==null&&lo(p,f),H!==null&&H.f&st&&!(r&Me))){var v=H;(v.effects??=[]).push(p)}return d}function jn(){return H!==null&&!Ft}function Wn(r){const a=Ht(Ai,null,!1);return tt(a,ot),a.teardown=r,a}function En(r){bs();var a=W.f,h=!H&&(a&Qt)!==0&&(a&Nn)===0;if(h){var f=J;(f.e??=[]).push(r)}else return Ss(r)}function Ss(r){return Ht(Ni|ts,r,!1)}function ho(r){return bs(),Ht(Ai|ts,r,!0)}function fo(r){Nt.ensure();const a=Ht(Me|Qe,r,!0);return(h={})=>new Promise(f=>{h.outro?Ae(a,()=>{gt(a),f(void 0)}):(gt(a),f(void 0))})}function uo(r){return Ht(Ni,r,!1)}function po(r){return Ht(Gn|Qe,r,!0)}function Kn(r,a=0){return Ht(Ai|a,r,!0)}function dt(r,a=[],h=[],f=[]){Qa(f,a,h,d=>{Ht(Ai,()=>r(...d.map(U)),!0)})}function Xn(r,a=0){var h=Ht(Jt|a,r,!0);return h}function Bt(r){return Ht(Qt|Qe,r,!0)}function ws(r){var a=r.teardown;if(a!==null){const h=Le,f=H;Nr(!0),vt(null);try{a.call(null)}finally{Nr(h),vt(f)}}}function Us(r,a=!1){var h=r.first;for(r.first=r.last=null;h!==null;){const d=h.ac;d!==null&&Ji(()=>{d.abort(Xe)});var f=h.next;h.f&Me?h.parent=null:gt(h,a),h=f}}function co(r){for(var a=r.first;a!==null;){var h=a.next;a.f&Qt||gt(a),a=h}}function gt(r,a=!0){var h=!1;(a||r.f&Qr)&&r.nodes!==null&&r.nodes.end!==null&&(_o(r.nodes.start,r.nodes.end),h=!0),Us(r,a&&!h),Yi(r,0),tt(r,ue);var f=r.nodes&&r.nodes.t;if(f!==null)for(const p of f)p.stop();ws(r);var d=r.parent;d!==null&&d.first!==null&&Es(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes=r.ac=null}function _o(r,a){for(;r!==null;){var h=r===a?null:zi(r);r.remove(),r=h}}function Es(r){var a=r.parent,h=r.prev,f=r.next;h!==null&&(h.next=f),f!==null&&(f.prev=h),a!==null&&(a.first===r&&(a.first=f),a.last===r&&(a.last=h))}function Ae(r,a,h=!0){var f=[];Bs(r,f,!0);var d=()=>{h&&gt(r),a&&a()},p=f.length;if(p>0){var v=()=>--p||d();for(var s of f)s.out(v)}else d()}function Bs(r,a,h){if(!(r.f&bt)){r.f^=bt;var f=r.nodes&&r.nodes.t;if(f!==null)for(const s of f)(s.is_global||h)&&a.push(s);for(var d=r.first;d!==null;){var p=d.next,v=(d.f&Ze)!==0||(d.f&Qt)!==0&&(r.f&Jt)!==0;Bs(d,a,v?h:!1),d=p}}}function Zn(r){Cs(r,!0)}function Cs(r,a){if(r.f&bt){r.f^=bt,r.f&ot||(tt(r,ut),Zt(r));for(var h=r.first;h!==null;){var f=h.next,d=(h.f&Ze)!==0||(h.f&Qt)!==0;Cs(h,d?a:!1),h=f}var p=r.nodes&&r.nodes.t;if(p!==null)for(const v of p)(v.is_global||a)&&v.in()}}function As(r,a){if(r.nodes)for(var h=r.nodes.start,f=r.nodes.end;h!==null;){var d=h===f?null:zi(h);a.append(h),h=d}}let We=null;function vo(r){var a=We;try{if(We=new Set,ti(r),a!==null)for(var h of We)a.add(h);return We}finally{We=a}}function jt(r){for(var a of vo(r))ke(a,a.v)}let Te=!1;function Vi(r){Te=r}let Le=!1;function Nr(r){Le=r}let H=null,Ft=!1;function vt(r){H=r}let W=null;function Gt(r){W=r}let Xt=null;function go(r){H!==null&&(Xt===null?Xt=[r]:Xt.push(r))}let _t=null,yt=0,wt=null;function yo(r){wt=r}let Ts=1,Be=0,Ie=Be;function Gr(r){Ie=r}function Is(){return++Ts}function Fi(r){var a=r.f;if(a&ut)return!0;if(a&st&&(r.f&=~Fe),a&te){for(var h=r.deps,f=h.length,d=0;d<f;d++){var p=h[d];if(Fi(p)&&cs(p),p.wv>r.wv)return!0}a&Ct&&zt===null&&tt(r,ot)}return!1}function zs(r,a,h=!0){var f=r.reactions;if(f!==null&&!Xt?.includes(r))for(var d=0;d<f.length;d++){var p=f[d];p.f&st?zs(p,a,!1):a===p&&(h?tt(p,ut):p.f&ot&&tt(p,te),Zt(p))}}function Fs(r){var a=_t,h=yt,f=wt,d=H,p=Xt,v=J,s=Ft,m=Ie,y=r.f;_t=null,yt=0,wt=null,H=y&(Qt|Me)?null:r,Xt=null,$e(r.ctx),Ft=!1,Ie=++Be,r.ac!==null&&(Ji(()=>{r.ac.abort(Xe)}),r.ac=null);try{r.f|=Sn;var E=r.fn,A=E(),T=r.deps;if(_t!==null){var I;if(Yi(r,yt),T!==null&&yt>0)for(T.length=yt+_t.length,I=0;I<_t.length;I++)T[yt+I]=_t[I];else r.deps=T=_t;if(jn()&&r.f&Ct)for(I=yt;I<T.length;I++)(T[I].reactions??=[]).push(r)}else T!==null&&yt<T.length&&(Yi(r,yt),T.length=yt);if(Ii()&&wt!==null&&!Ft&&T!==null&&!(r.f&(st|te|ut)))for(I=0;I<wt.length;I++)zs(wt[I],r);if(d!==null&&d!==r){if(Be++,d.deps!==null)for(let g=0;g<h;g+=1)d.deps[g].rv=Be;if(a!==null)for(const g of a)g.rv=Be;wt!==null&&(f===null?f=wt:f.push(...wt))}return r.f&pe&&(r.f^=pe),A}catch(g){return as(g)}finally{r.f^=Sn,_t=a,yt=h,wt=f,H=d,Xt=p,$e(v),Ft=s,Ie=m}}function mo(r,a){let h=a.reactions;if(h!==null){var f=ma.call(h,r);if(f!==-1){var d=h.length-1;d===0?h=a.reactions=null:(h[f]=h[d],h.pop())}}if(h===null&&a.f&st&&(_t===null||!_t.includes(a))){var p=a;p.f&Ct&&(p.f^=Ct,p.f&=~Fe),Hn(p),ps(p),Yi(p,0)}}function Yi(r,a){var h=r.deps;if(h!==null)for(var f=a;f<h.length;f++)mo(r,h[f])}function Ui(r){var a=r.f;if(!(a&ue)){tt(r,ot);var h=W,f=Te;W=r,Te=!0;try{a&(Jt|Jr)?co(r):Us(r),ws(r);var d=Fs(r);r.teardown=typeof d=="function"?d:null,r.wv=Ts;var p;xn&&Va&&r.f&ut&&r.deps}finally{Te=f,W=h}}}async function xo(){await Promise.resolve(),Wa()}function U(r){var a=r.f,h=(a&st)!==0;if(We?.add(r),H!==null&&!Ft){var f=W!==null&&(W.f&ue)!==0;if(!f&&!Xt?.includes(r)){var d=H.deps;if(H.f&Sn)r.rv<Be&&(r.rv=Be,_t===null&&d!==null&&d[yt]===r?yt++:_t===null?_t=[r]:_t.push(r));else{(H.deps??=[]).push(r);var p=r.reactions;p===null?r.reactions=[H]:p.includes(H)||p.push(H)}}}if(Le&&ce.has(r))return ce.get(r);if(h){var v=r;if(Le){var s=v.v;return(!(v.f&ot)&&v.reactions!==null||ks(v))&&(s=Yn(v)),ce.set(v,s),s}var m=(v.f&Ct)===0&&!Ft&&H!==null&&(Te||(H.f&Ct)!==0),y=v.deps===null;Fi(v)&&(m&&(v.f|=Ct),cs(v)),m&&!y&&Ps(v)}if(zt?.has(r))return zt.get(r);if(r.f&pe)throw r.v;return r.v}function Ps(r){if(r.deps!==null){r.f|=Ct;for(const a of r.deps)(a.reactions??=[]).push(r),a.f&st&&!(a.f&Ct)&&Ps(a)}}function ks(r){if(r.v===nt)return!0;if(r.deps===null)return!1;for(const a of r.deps)if(ce.has(a)||a.f&st&&ks(a))return!0;return!1}function ti(r){var a=Ft;try{return Ft=!0,r()}finally{Ft=a}}function bo(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if(Ce in r)Bn(r);else if(!Array.isArray(r))for(let a in r){const h=r[a];typeof h=="object"&&h&&Ce in h&&Bn(h)}}}function Bn(r,a=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!a.has(r)){a.add(r),r instanceof Date&&r.getTime();for(let f in r)try{Bn(r[f],a)}catch{}const h=Zr(r);if(h!==Object.prototype&&h!==Array.prototype&&h!==Map.prototype&&h!==Set.prototype&&h!==Date.prototype){const f=ba(h);for(let d in f){const p=f[d].get;if(p)try{p.call(r)}catch{}}}}}const So=["touchstart","touchmove"];function wo(r){return So.includes(r)}const Uo=new Set,Hr=new Set;function Eo(r,a,h,f={}){function d(p){if(f.capture||oi.call(a,p),!p.cancelBubble)return Ji(()=>h?.call(this,p))}return r.startsWith("pointer")||r.startsWith("touch")||r==="wheel"?Zi(()=>{a.addEventListener(r,d,f)}):a.addEventListener(r,d,f),d}function si(r,a,h,f,d){var p={capture:f,passive:d},v=Eo(r,a,h,p);(a===document.body||a===window||a===document||a instanceof HTMLMediaElement)&&Wn(()=>{a.removeEventListener(r,v,p)})}let Vr=null;function oi(r){var a=this,h=a.ownerDocument,f=r.type,d=r.composedPath?.()||[],p=d[0]||r.target;Vr=r;var v=0,s=Vr===r&&r.__root;if(s){var m=d.indexOf(s);if(m!==-1&&(a===document||a===window)){r.__root=a;return}var y=d.indexOf(a);if(y===-1)return;m<=y&&(v=m)}if(p=d[v]||r.target,p!==a){xa(r,"currentTarget",{configurable:!0,get(){return p||h}});var E=H,A=W;vt(null),Gt(null);try{for(var T,I=[];p!==null;){var g=p.assignedSlot||p.parentNode||p.host||null;try{var M=p["__"+f];M!=null&&(!p.disabled||r.target===p)&&M.call(p,r)}catch(t){T?I.push(t):T=t}if(r.cancelBubble||g===a||g===null)break;p=g}if(T){for(let t of I)queueMicrotask(()=>{throw t});throw T}}finally{r.__root=a,delete r.currentTarget,vt(E),Gt(A)}}}function Bo(r){var a=document.createElement("template");return a.innerHTML=r.replaceAll("<!>","<!---->"),a.content}function Cn(r,a){var h=W;h.nodes===null&&(h.nodes={start:r,end:a,a:null,t:null})}function pt(r,a){var h=(a&Ra)!==0,f=(a&Oa)!==0,d,p=!r.startsWith("<!>");return()=>{d===void 0&&(d=Bo(p?r:"<!>"+r),h||(d=Hi(d)));var v=f||gs?document.importNode(d,!0):d.cloneNode(!0);if(h){var s=Hi(v),m=v.lastChild;Cn(s,m)}else Cn(v,v);return v}}function _n(){var r=document.createDocumentFragment(),a=document.createComment(""),h=_e();return r.append(a,h),Cn(a,h),r}function Q(r,a){r!==null&&r.before(a)}function qe(r,a){var h=a==null?"":typeof a=="object"?a+"":a;h!==(r.__t??=r.nodeValue)&&(r.__t=h,r.nodeValue=h+"")}function Co(r,a){return Ao(r,a)}const je=new Map;function Ao(r,{target:a,anchor:h,props:f={},events:d,context:p,intro:v=!0}){so();var s=new Set,m=A=>{for(var T=0;T<A.length;T++){var I=A[T];if(!s.has(I)){s.add(I);var g=wo(I);a.addEventListener(I,oi,{passive:g});var M=je.get(I);M===void 0?(document.addEventListener(I,oi,{passive:g}),je.set(I,1)):je.set(I,M+1)}}};m(Xi(Uo)),Hr.add(m);var y=void 0,E=fo(()=>{var A=h??a.appendChild(_e());return $a(A,{pending:()=>{}},T=>{if(p){ns({});var I=J;I.c=p}d&&(f.$$events=d),y=r(T,f)||{},p&&rs()}),()=>{for(var T of s){a.removeEventListener(T,oi);var I=je.get(T);--I===0?(document.removeEventListener(T,oi),je.delete(T)):je.set(T,I)}Hr.delete(m),A!==h&&A.parentNode?.removeChild(A)}});return To.set(y,E),y}let To=new WeakMap;class Io{anchor;#e=new Map;#a=new Map;#t=new Map;#r=new Set;#s=!0;constructor(a,h=!0){this.anchor=a,this.#s=h}#n=()=>{var a=V;if(this.#e.has(a)){var h=this.#e.get(a),f=this.#a.get(h);if(f)Zn(f),this.#r.delete(h);else{var d=this.#t.get(h);d&&(this.#a.set(h,d.effect),this.#t.delete(h),d.fragment.lastChild.remove(),this.anchor.before(d.fragment),f=d.effect)}for(const[p,v]of this.#e){if(this.#e.delete(p),p===a)break;const s=this.#t.get(v);s&&(gt(s.effect),this.#t.delete(v))}for(const[p,v]of this.#a){if(p===h||this.#r.has(p))continue;const s=()=>{if(Array.from(this.#e.values()).includes(p)){var y=document.createDocumentFragment();As(v,y),y.append(_e()),this.#t.set(p,{effect:v,fragment:y})}else gt(v);this.#r.delete(p),this.#a.delete(p)};this.#s||!f?(this.#r.add(p),Ae(v,s,!1)):s()}}};#i=a=>{this.#e.delete(a);const h=Array.from(this.#e.values());for(const[f,d]of this.#t)h.includes(f)||(gt(d.effect),this.#t.delete(f))};ensure(a,h){var f=V,d=xs();if(h&&!this.#a.has(a)&&!this.#t.has(a))if(d){var p=document.createDocumentFragment(),v=_e();p.append(v),this.#t.set(a,{effect:Bt(()=>h(v)),fragment:p})}else this.#a.set(a,Bt(()=>h(this.anchor)));if(this.#e.set(f,a),d){for(const[s,m]of this.#a)s===a?f.skipped_effects.delete(m):f.skipped_effects.add(m);for(const[s,m]of this.#t)s===a?f.skipped_effects.delete(m.effect):f.skipped_effects.add(m.effect);f.oncommit(this.#n),f.ondiscard(this.#i)}else this.#n()}}function St(r,a,h=!1){var f=new Io(r),d=h?Ze:0;function p(v,s){f.ensure(v,s)}Xn(()=>{var v=!1;a((s,m=!0)=>{v=!0,p(m,s)}),v||p(!1,null)},d)}function zo(r,a){return a}function Fo(r,a,h){for(var f=[],d=a.length,p,v=a.length,s=0;s<d;s++){let A=a[s];Ae(A,()=>{if(p){if(p.pending.delete(A),p.done.add(A),p.pending.size===0){var T=r.outrogroups;An(Xi(p.done)),T.delete(p),T.size===0&&(r.outrogroups=null)}}else v-=1},!1)}if(v===0){var m=f.length===0&&h!==null;if(m){var y=h,E=y.parentNode;ao(E),E.append(y),r.items.clear()}An(a,!m)}else p={pending:new Set(a),done:new Set},(r.outrogroups??=new Set).add(p)}function An(r,a=!0){for(var h=0;h<r.length;h++)gt(r[h],a)}var Yr;function Po(r,a,h,f,d,p=null){var v=r,s=new Map;{var m=r;v=m.appendChild(_e())}var y=null,E=us(()=>{var t=h();return Rn(t)?t:t==null?[]:Xi(t)}),A,T=!0;function I(){M.fallback=y,ko(M,A,v,a,f),y!==null&&(A.length===0?y.f&de?(y.f^=de,li(y,null,v)):Zn(y):Ae(y,()=>{y=null}))}var g=Xn(()=>{A=U(E);for(var t=A.length,e=new Set,n=V,o=xs(),l=0;l<t;l+=1){var u=A[l],c=f(u,l),_=T?null:s.get(c);_?(_.v&&ke(_.v,u),_.i&&ke(_.i,l),o&&n.skipped_effects.delete(_.e)):(_=Lo(s,T?v:Yr??=_e(),u,c,l,d,a,h),T||(_.e.f|=de),s.set(c,_)),e.add(c)}if(t===0&&p&&!y&&(T?y=Bt(()=>p(v)):(y=Bt(()=>p(Yr??=_e())),y.f|=de)),!T)if(o){for(const[x,S]of s)e.has(x)||n.skipped_effects.add(S.e);n.oncommit(I),n.ondiscard(()=>{})}else I();U(E)}),M={effect:g,items:s,outrogroups:null,fallback:y};T=!1}function ko(r,a,h,f,d){var p=a.length,v=r.items,s=r.effect.first,m,y=null,E=[],A=[],T,I,g,M;for(M=0;M<p;M+=1){if(T=a[M],I=d(T,M),g=v.get(I).e,r.outrogroups!==null)for(const x of r.outrogroups)x.pending.delete(g),x.done.delete(g);if(g.f&de)if(g.f^=de,g===s)li(g,null,h);else{var t=y?y.next:s;g===r.effect.last&&(r.effect.last=g.prev),g.prev&&(g.prev.next=g.next),g.next&&(g.next.prev=g.prev),le(r,y,g),le(r,g,t),li(g,t,h),y=g,E=[],A=[],s=y.next;continue}if(g.f&bt&&Zn(g),g!==s){if(m!==void 0&&m.has(g)){if(E.length<A.length){var e=A[0],n;y=e.prev;var o=E[0],l=E[E.length-1];for(n=0;n<E.length;n+=1)li(E[n],e,h);for(n=0;n<A.length;n+=1)m.delete(A[n]);le(r,o.prev,l.next),le(r,y,o),le(r,l,e),s=e,y=l,M-=1,E=[],A=[]}else m.delete(g),li(g,s,h),le(r,g.prev,g.next),le(r,g,y===null?r.effect.first:y.next),le(r,y,g),y=g;continue}for(E=[],A=[];s!==null&&s!==g;)(m??=new Set).add(s),A.push(s),s=s.next;if(s===null)continue}g.f&de||E.push(g),y=g,s=g.next}if(r.outrogroups!==null){for(const x of r.outrogroups)x.pending.size===0&&(An(Xi(x.done)),r.outrogroups?.delete(x));r.outrogroups.size===0&&(r.outrogroups=null)}if(s!==null||m!==void 0){var u=[];if(m!==void 0)for(g of m)g.f&bt||u.push(g);for(;s!==null;)!(s.f&bt)&&s!==r.fallback&&u.push(s),s=s.next;var c=u.length;if(c>0){var _=p===0?h:null;Fo(r,u,_)}}}function Lo(r,a,h,f,d,p,v,s){var m=v&La?v&Ma?Pe(h):X(h,!1,!1):null,y=v&Da?Pe(d):null;return{v:m,i:y,e:Bt(()=>(p(a,m??h,y??d,s),()=>{r.delete(f)}))}}function li(r,a,h){if(r.nodes)for(var f=r.nodes.start,d=r.nodes.end,p=a&&!(a.f&de)?a.nodes.start:h;f!==null;){var v=zi(f);if(p.before(f),f===d)return;f=v}}function le(r,a,h){a===null?r.effect.first=h:a.next=h,h===null?r.effect.last=a:h.prev=a}function Do(r,a){return r==null?null:String(r)}function Mo(r,a,h,f){var d=r.__style;if(d!==a){var p=Do(a);p==null?r.removeAttribute("style"):r.style.cssText=p,r.__style=a}return f}function Ls(r,a,h=!1){if(r.multiple){if(a==null)return;if(!Rn(a))return Na();for(var f of r.options)f.selected=a.includes(gi(f));return}for(f of r.options){var d=gi(f);if(ro(d,a)){f.selected=!0;return}}(!h||a!==void 0)&&(r.selectedIndex=-1)}function Ro(r){var a=new MutationObserver(()=>{Ls(r,r.__value)});a.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Wn(()=>{a.disconnect()})}function Wt(r,a,h=a){var f=new WeakSet,d=!0;qn(r,"change",p=>{var v=p?"[selected]":":checked",s;if(r.multiple)s=[].map.call(r.querySelectorAll(v),gi);else{var m=r.querySelector(v)??r.querySelector("option:not([disabled])");s=m&&gi(m)}h(s),V!==null&&f.add(V)}),uo(()=>{var p=a();if(r===document.activeElement){var v=ci??V;if(f.has(v))return}if(Ls(r,p,d),d&&p===void 0){var s=r.querySelector(":checked");s!==null&&(p=gi(s),h(p))}r.__value=p,d=!1}),Ro(r)}function gi(r){return"__value"in r?r.__value:r.value}function Se(r,a,h=a){var f=new WeakSet;qn(r,"input",async d=>{var p=d?r.defaultValue:r.value;if(p=vn(r)?gn(p):p,h(p),V!==null&&f.add(V),await xo(),p!==(p=a())){var v=r.selectionStart,s=r.selectionEnd,m=r.value.length;if(r.value=p??"",s!==null){var y=r.value.length;v===s&&s===m&&y>m?(r.selectionStart=y,r.selectionEnd=y):(r.selectionStart=v,r.selectionEnd=Math.min(s,y))}}}),ti(a)==null&&r.value&&(h(vn(r)?gn(r.value):r.value),V!==null&&f.add(V)),Kn(()=>{var d=a();if(r===document.activeElement){var p=ci??V;if(f.has(p))return}vn(r)&&d===gn(r.value)||r.type==="date"&&!d&&!r.value||d!==r.value&&(r.value=d??"")})}function qr(r,a,h=a){qn(r,"change",f=>{var d=f?r.defaultChecked:r.checked;h(d)}),ti(a)==null&&h(r.checked),Kn(()=>{var f=a();r.checked=!!f})}function vn(r){var a=r.type;return a==="number"||a==="range"}function gn(r){return r===""?null:+r}function Oo(r=!1){const a=J,h=a.l.u;if(!h)return;let f=()=>bo(a.s);if(r){let d=0,p={};const v=Vn(()=>{let s=!1;const m=a.s;for(const y in m)m[y]!==p[y]&&(p[y]=m[y],s=!0);return s&&d++,d});f=()=>U(v)}h.b.length&&ho(()=>{jr(a,f),bn(h.b)}),En(()=>{const d=ti(()=>h.m.map(Ua));return()=>{for(const p of d)typeof p=="function"&&p()}}),h.a.length&&En(()=>{jr(a,f),bn(h.a)})}function jr(r,a){if(r.l.s)for(const h of r.l.s)U(h);a()}function No(r){J===null&&Ea(),Ti&&J.l!==null?Go(J).m.push(r):En(()=>{const a=ti(r);if(typeof a=="function")return a})}function Go(r){var a=r.l;return a.u??={a:[],b:[],m:[]}}const Ho="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Ho);Ya();var $n=(r,a,h)=>{if(!a.has(r))throw TypeError("Cannot "+h)},b=(r,a,h)=>($n(r,a,"read from private field"),h?h.call(r):a.get(r)),N=(r,a,h)=>{if(a.has(r))throw TypeError("Cannot add the same private member more than once");a instanceof WeakSet?a.add(r):a.set(r,h)},rt=(r,a,h,f)=>($n(r,a,"write to private field"),a.set(r,h),h),$=(r,a,h)=>($n(r,a,"access private method"),h),q=new Uint8Array(8),$t=new DataView(q.buffer),Ut=r=>[(r%256+256)%256],Z=r=>($t.setUint16(0,r,!1),[q[0],q[1]]),Vo=r=>($t.setInt16(0,r,!1),[q[0],q[1]]),Ds=r=>($t.setUint32(0,r,!1),[q[1],q[2],q[3]]),L=r=>($t.setUint32(0,r,!1),[q[0],q[1],q[2],q[3]]),Yo=r=>($t.setUint32(0,Math.floor(r/2**32),!1),$t.setUint32(4,r,!1),[q[0],q[1],q[2],q[3],q[4],q[5],q[6],q[7]]),Jn=r=>($t.setInt16(0,2**8*r,!1),[q[0],q[1]]),Ot=r=>($t.setInt32(0,2**16*r,!1),[q[0],q[1],q[2],q[3]]),yn=r=>($t.setInt32(0,2**30*r,!1),[q[0],q[1],q[2],q[3]]),Rt=(r,a=!1)=>{let h=Array(r.length).fill(null).map((f,d)=>r.charCodeAt(d));return a&&h.push(0),h},De=r=>r&&r[r.length-1],Ei=(r,a,h=!0)=>{let f=r*a;return h?Math.round(f):f},Ms=r=>{let a=r*(Math.PI/180),h=Math.cos(a),f=Math.sin(a);return[h,f,0,-f,h,0,0,0,1]},qo=Ms(0),Rs=r=>[Ot(r[0]),Ot(r[1]),yn(r[2]),Ot(r[3]),Ot(r[4]),yn(r[5]),Ot(r[6]),Ot(r[7]),yn(r[8])],yi=r=>!r||typeof r!="object"?r:Array.isArray(r)?r.map(yi):Object.fromEntries(Object.entries(r).map(([a,h])=>[a,yi(h)])),lt=(r,a,h)=>({type:r,contents:a&&new Uint8Array(a.flat(10)),children:h}),ht=(r,a,h,f,d)=>lt(r,[Ut(a),Ds(h),f??[]],d),jo=r=>r?lt("ftyp",[Rt("isom"),L(0),Rt("iso4"),Rt("hvc1")]):lt("ftyp",[Rt("isom"),L(0),Rt("isom"),Rt("avc1"),Rt("mp41")]),Wr=r=>({type:"mdat",largeSize:r}),Wo=r=>({type:"free",size:r}),mn=(r,a)=>lt("moov",null,[Ko(a,r),...r.map(h=>Xo(h,a))]),Ko=(r,a)=>{let h=Ei(Math.max(0,...a.filter(d=>d.samples.length>0).map(d=>De(d.samples).timestamp+De(d.samples).duration)),zn),f=Math.max(...a.map(d=>d.id))+1;return ht("mvhd",0,0,[L(r),L(r),L(zn),L(h),Ot(1),Jn(1),Array(10).fill(0),Rs(qo),Array(24).fill(0),L(f)])},Xo=(r,a)=>lt("trak",null,[Zo(r,a),$o(r,a)]),Zo=(r,a)=>{let h=De(r.samples),f=Ei(h?h.timestamp+h.duration:0,zn);return ht("tkhd",0,3,[L(a),L(a),L(r.id),L(0),L(f),Array(8).fill(0),Z(0),Z(0),Jn(r.info.type==="audio"?1:0),Z(0),Rs(Ms(r.info.type==="video"?r.info.rotation:0)),Ot(r.info.type==="video"?r.info.width:0),Ot(r.info.type==="video"?r.info.height:0)])},$o=(r,a)=>lt("mdia",null,[Jo(r,a),Qo(r.info.type==="video"?"vide":"soun"),tl(r)]),Jo=(r,a)=>{let h=De(r.samples),f=Ei(h?h.timestamp+h.duration:0,r.timescale);return ht("mdhd",0,0,[L(a),L(a),L(r.timescale),L(f),Z(21956),Z(0)])},Qo=r=>ht("hdlr",0,0,[Rt("mhlr"),Rt(r),L(0),L(0),L(0),Rt("mp4-muxer-hdlr")]),tl=r=>lt("minf",null,[r.info.type==="video"?el():il(),nl(),al(r)]),el=()=>ht("vmhd",0,1,[Z(0),Z(0),Z(0),Z(0)]),il=()=>ht("smhd",0,0,[Z(0),Z(0)]),nl=()=>lt("dinf",null,[rl()]),rl=()=>ht("dref",0,0,[L(1)],[sl()]),sl=()=>ht("url ",0,1),al=r=>lt("stbl",null,[ol(r),vl(r),gl(r),yl(r),ml(r),xl(r)]),ol=r=>ht("stsd",0,0,[L(1)],[r.info.type==="video"?ll(bl[r.info.codec],r):pl(wl[r.info.codec],r)]),ll=(r,a)=>lt(r,[Array(6).fill(0),Z(1),Z(0),Z(0),Array(12).fill(0),Z(a.info.width),Z(a.info.height),L(4718592),L(4718592),L(0),Z(1),Array(32).fill(0),Z(24),Vo(65535)],[Sl[a.info.codec](a)]),hl=r=>r.codecPrivate&&lt("avcC",[...r.codecPrivate]),fl=r=>r.codecPrivate&&lt("hvcC",[...r.codecPrivate]),dl=r=>r.codecPrivate&&lt("vpcC",[...r.codecPrivate]),ul=r=>r.codecPrivate&&lt("av1C",[...r.codecPrivate]),pl=(r,a)=>lt(r,[Array(6).fill(0),Z(1),Z(0),Z(0),L(0),Z(a.info.numberOfChannels),Z(16),Z(0),Z(0),Ot(a.info.sampleRate)],[Ul[a.info.codec](a)]),cl=r=>ht("esds",0,0,[L(58753152),Ut(32+r.codecPrivate.byteLength),Z(1),Ut(0),L(75530368),Ut(18+r.codecPrivate.byteLength),Ut(64),Ut(21),Ds(0),L(130071),L(130071),L(92307584),Ut(r.codecPrivate.byteLength),...r.codecPrivate,L(109084800),Ut(1),Ut(2)]),_l=r=>lt("dOps",[Ut(0),Ut(r.info.numberOfChannels),Z(3840),L(r.info.sampleRate),Jn(0),Ut(0)]),vl=r=>ht("stts",0,0,[L(r.timeToSampleTable.length),r.timeToSampleTable.map(a=>[L(a.sampleCount),L(a.sampleDelta)])]),gl=r=>{if(r.samples.every(h=>h.type==="key"))return null;let a=[...r.samples.entries()].filter(([,h])=>h.type==="key");return ht("stss",0,0,[L(a.length),a.map(([h])=>L(h+1))])},yl=r=>ht("stsc",0,0,[L(r.compactlyCodedChunkTable.length),r.compactlyCodedChunkTable.map(a=>[L(a.firstChunk),L(a.samplesPerChunk),L(1)])]),ml=r=>ht("stsz",0,0,[L(0),L(r.samples.length),r.samples.map(a=>L(a.size))]),xl=r=>r.finalizedChunks.length>0&&De(r.finalizedChunks).offset>=2**32?ht("co64",0,0,[L(r.finalizedChunks.length),r.finalizedChunks.map(a=>Yo(a.offset))]):ht("stco",0,0,[L(r.finalizedChunks.length),r.finalizedChunks.map(a=>L(a.offset))]),bl={avc:"avc1",hevc:"hvc1",vp9:"vp09",av1:"av01"},Sl={avc:hl,hevc:fl,vp9:dl,av1:ul},wl={aac:"mp4a",opus:"Opus"},Ul={aac:cl,opus:_l},El=class{constructor(){this.buffer=null}},Os=class{constructor(r,a,h){this.onData=r,this.onDone=a,this.options=h}},Ns=class{constructor(r,a){this.stream=r,this.options=a}},we,Ke,Qn=class{constructor(){this.pos=0,N(this,we,new Uint8Array(8)),N(this,Ke,new DataView(b(this,we).buffer)),this.offsets=new WeakMap}seek(r){this.pos=r}writeU32(r){b(this,Ke).setUint32(0,r,!1),this.write(b(this,we).subarray(0,4))}writeU64(r){b(this,Ke).setUint32(0,Math.floor(r/2**32),!1),b(this,Ke).setUint32(4,r,!1),this.write(b(this,we).subarray(0,8))}writeAscii(r){for(let a=0;a<r.length;a++)b(this,Ke).setUint8(a%8,r.charCodeAt(a)),a%8===7&&this.write(b(this,we));r.length%8!==0&&this.write(b(this,we).subarray(0,r.length%8))}writeBox(r){if(this.offsets.set(r,this.pos),r.contents&&!r.children)this.writeBoxHeader(r,r.size??r.contents.byteLength+8),this.write(r.contents);else{let a=this.pos;if(this.writeBoxHeader(r,0),r.contents&&this.write(r.contents),r.children)for(let d of r.children)d&&this.writeBox(d);let h=this.pos,f=r.size??h-a;this.seek(a),this.writeBoxHeader(r,f),this.seek(h)}}writeBoxHeader(r,a){this.writeU32(r.largeSize?1:a),this.writeAscii(r.type),r.largeSize&&this.writeU64(a)}measureBoxHeader(r){return 8+(r.largeSize?8:0)}patchBox(r){let a=this.pos;this.seek(this.offsets.get(r)),this.writeBox(r),this.seek(a)}measureBox(r){if(r.contents&&!r.children)return this.measureBoxHeader(r)+r.contents.byteLength;{let a=this.measureBoxHeader(r);if(r.contents&&(a+=r.contents.byteLength),r.children)for(let h of r.children)h&&(a+=this.measureBox(h));return a}}};we=new WeakMap;Ke=new WeakMap;var Di,ze,Bi,hi,Mi,Tn,Bl=class extends Qn{constructor(r){super(),N(this,Mi),N(this,Di,void 0),N(this,ze,new ArrayBuffer(2**16)),N(this,Bi,new Uint8Array(b(this,ze))),N(this,hi,0),rt(this,Di,r)}write(r){$(this,Mi,Tn).call(this,this.pos+r.byteLength),b(this,Bi).set(r,this.pos),this.pos+=r.byteLength,rt(this,hi,Math.max(b(this,hi),this.pos))}finalize(){$(this,Mi,Tn).call(this,this.pos),b(this,Di).buffer=b(this,ze).slice(0,Math.max(b(this,hi),this.pos))}};Di=new WeakMap;ze=new WeakMap;Bi=new WeakMap;hi=new WeakMap;Mi=new WeakSet;Tn=function(r){let a=b(this,ze).byteLength;for(;a<r;)a*=2;if(a===b(this,ze).byteLength)return;let h=new ArrayBuffer(a),f=new Uint8Array(h);f.set(b(this,Bi),0),rt(this,ze,h),rt(this,Bi,f)};var fi,Ue,Gs=class extends Qn{constructor(r){super(),N(this,fi,void 0),N(this,Ue,[]),rt(this,fi,r)}write(r){b(this,Ue).push({data:r.slice(),start:this.pos}),this.pos+=r.byteLength}flush(){if(b(this,Ue).length===0)return;let r=[],a=[...b(this,Ue)].sort((h,f)=>h.start-f.start);r.push({start:a[0].start,size:a[0].data.byteLength});for(let h=1;h<a.length;h++){let f=r[r.length-1],d=a[h];d.start<=f.start+f.size?f.size=Math.max(f.size,d.start+d.data.byteLength-f.start):r.push({start:d.start,size:d.data.byteLength})}for(let h of r){h.data=new Uint8Array(h.size);for(let f of b(this,Ue))h.start<=f.start&&f.start<h.start+h.size&&h.data.set(f.data,f.start-h.start);b(this,fi).onData(h.data,h.start)}b(this,Ue).length=0}finalize(){b(this,fi).onDone?.()}};fi=new WeakMap;Ue=new WeakMap;var Cl=2**24,Al=2,mi,Pt,xt,qi,In,tr,Hs,er,Vs,xi,ji,Ys=class extends Qn{constructor(r){if(super(),N(this,qi),N(this,tr),N(this,er),N(this,xi),N(this,mi,void 0),N(this,Pt,void 0),N(this,xt,[]),rt(this,mi,r),rt(this,Pt,r.options?.chunkSize??Cl),!Number.isInteger(b(this,Pt))||b(this,Pt)<2**10)throw new Error("Invalid StreamTarget options: chunkSize must be an integer not smaller than 1024.")}write(r){$(this,qi,In).call(this,r,this.pos),$(this,xi,ji).call(this),this.pos+=r.byteLength}finalize(){$(this,xi,ji).call(this,!0),b(this,mi).onDone?.()}};mi=new WeakMap;Pt=new WeakMap;xt=new WeakMap;qi=new WeakSet;In=function(r,a){let h=b(this,xt).findIndex(s=>s.start<=a&&a<s.start+b(this,Pt));h===-1&&(h=$(this,er,Vs).call(this,a));let f=b(this,xt)[h],d=a-f.start,p=r.subarray(0,Math.min(b(this,Pt)-d,r.byteLength));f.data.set(p,d);let v={start:d,end:d+p.byteLength};if($(this,tr,Hs).call(this,f,v),f.written[0].start===0&&f.written[0].end===b(this,Pt)&&(f.shouldFlush=!0),b(this,xt).length>Al){for(let s=0;s<b(this,xt).length-1;s++)b(this,xt)[s].shouldFlush=!0;$(this,xi,ji).call(this)}p.byteLength<r.byteLength&&$(this,qi,In).call(this,r.subarray(p.byteLength),a+p.byteLength)};tr=new WeakSet;Hs=function(r,a){let h=0,f=r.written.length-1,d=-1;for(;h<=f;){let p=Math.floor(h+(f-h+1)/2);r.written[p].start<=a.start?(h=p+1,d=p):f=p-1}for(r.written.splice(d+1,0,a),(d===-1||r.written[d].end<a.start)&&d++;d<r.written.length-1&&r.written[d].end>=r.written[d+1].start;)r.written[d].end=Math.max(r.written[d].end,r.written[d+1].end),r.written.splice(d+1,1)};er=new WeakSet;Vs=function(r){let h={start:Math.floor(r/b(this,Pt))*b(this,Pt),data:new Uint8Array(b(this,Pt)),written:[],shouldFlush:!1};return b(this,xt).push(h),b(this,xt).sort((f,d)=>f.start-d.start),b(this,xt).indexOf(h)};xi=new WeakSet;ji=function(r=!1){for(let a=0;a<b(this,xt).length;a++){let h=b(this,xt)[a];if(!(!h.shouldFlush&&!r)){for(let f of h.written)b(this,mi).onData(h.data.subarray(f.start,f.end),h.start+f.start);b(this,xt).splice(a--,1)}}};var Tl=class extends Ys{constructor(r){super(new Os((a,h)=>r.stream.write({type:"write",data:a,position:h}),void 0,{chunkSize:r.options?.chunkSize}))}},zn=1e3,Il=["avc","hevc","vp9","av1"],zl=["aac","opus"],Fl=2082844800,Pl=.5,kl=["strict","offset"],G,j,Wi,mt,he,fe,di,bi,Si,Fn,qs,Pn,js,ir,Ws,kn,Ks,nr,Xs,Ri,Ln,rr,Zs,wi,Ki,Ci,Qi,Oi,Dn,Ll=class{constructor(r){if(N(this,Fn),N(this,Pn),N(this,ir),N(this,kn),N(this,nr),N(this,Ri),N(this,rr),N(this,wi),N(this,Ci),N(this,Oi),N(this,G,void 0),N(this,j,void 0),N(this,Wi,void 0),N(this,mt,void 0),N(this,he,null),N(this,fe,null),N(this,di,Math.floor(Date.now()/1e3)+Fl),N(this,bi,[]),N(this,Si,!1),$(this,Fn,qs).call(this,r),r.video=yi(r.video),r.audio=yi(r.audio),r.fastStart=yi(r.fastStart),this.target=r.target,rt(this,G,{firstTimestampBehavior:"strict",...r}),r.target instanceof El)rt(this,j,new Bl(r.target));else if(r.target instanceof Os)rt(this,j,r.target.options?.chunked?new Ys(r.target):new Gs(r.target));else if(r.target instanceof Ns)rt(this,j,new Tl(r.target));else throw new Error(`Invalid target: ${r.target}`);$(this,Pn,js).call(this),$(this,kn,Ks).call(this)}addVideoChunk(r,a,h){let f=new Uint8Array(r.byteLength);r.copyTo(f),this.addVideoChunkRaw(f,r.type,h??r.timestamp,r.duration,a)}addVideoChunkRaw(r,a,h,f,d){if($(this,Oi,Dn).call(this),!b(this,G).video)throw new Error("No video track declared.");if(typeof b(this,G).fastStart=="object"&&b(this,he).samples.length===b(this,G).fastStart.expectedVideoChunks)throw new Error(`Cannot add more video chunks than specified in 'fastStart' (${b(this,G).fastStart.expectedVideoChunks}).`);$(this,Ri,Ln).call(this,b(this,he),r,a,h,f,d)}addAudioChunk(r,a,h){let f=new Uint8Array(r.byteLength);r.copyTo(f),this.addAudioChunkRaw(f,r.type,h??r.timestamp,r.duration,a)}addAudioChunkRaw(r,a,h,f,d){if($(this,Oi,Dn).call(this),!b(this,G).audio)throw new Error("No audio track declared.");if(typeof b(this,G).fastStart=="object"&&b(this,fe).samples.length===b(this,G).fastStart.expectedAudioChunks)throw new Error(`Cannot add more audio chunks than specified in 'fastStart' (${b(this,G).fastStart.expectedAudioChunks}).`);$(this,Ri,Ln).call(this,b(this,fe),r,a,h,f,d)}finalize(){if(b(this,Si))throw new Error("Cannot finalize a muxer more than once.");b(this,he)&&$(this,wi,Ki).call(this,b(this,he)),b(this,fe)&&$(this,wi,Ki).call(this,b(this,fe));let r=[b(this,he),b(this,fe)].filter(Boolean);if(b(this,G).fastStart==="in-memory"){let a;for(let f=0;f<2;f++){let d=mn(r,b(this,di)),p=b(this,j).measureBox(d);a=b(this,j).measureBox(b(this,mt));let v=b(this,j).pos+p+a;for(let s of b(this,bi)){s.offset=v;for(let m of s.sampleData)v+=m.byteLength,a+=m.byteLength}if(v<2**32)break;a>=2**32&&(b(this,mt).largeSize=!0)}let h=mn(r,b(this,di));b(this,j).writeBox(h),b(this,mt).size=a,b(this,j).writeBox(b(this,mt));for(let f of b(this,bi)){for(let d of f.sampleData)b(this,j).write(d);f.sampleData=null}}else{let a=b(this,j).offsets.get(b(this,mt)),h=b(this,j).pos-a;b(this,mt).size=h,b(this,mt).largeSize=h>=2**32,b(this,j).patchBox(b(this,mt));let f=mn(r,b(this,di));if(typeof b(this,G).fastStart=="object"){b(this,j).seek(b(this,Wi)),b(this,j).writeBox(f);let d=a-b(this,j).pos;b(this,j).writeBox(Wo(d))}else b(this,j).writeBox(f)}$(this,Ci,Qi).call(this),b(this,j).finalize(),rt(this,Si,!0)}};G=new WeakMap;j=new WeakMap;Wi=new WeakMap;mt=new WeakMap;he=new WeakMap;fe=new WeakMap;di=new WeakMap;bi=new WeakMap;Si=new WeakMap;Fn=new WeakSet;qs=function(r){if(r.video){if(!Il.includes(r.video.codec))throw new Error(`Unsupported video codec: ${r.video.codec}`);if(r.video.rotation!==void 0&&![0,90,180,270].includes(r.video.rotation))throw new Error(`Invalid video rotation: ${r.video.rotation}. Has to be 0, 90, 180 or 270.`)}if(r.audio&&!zl.includes(r.audio.codec))throw new Error(`Unsupported audio codec: ${r.audio.codec}`);if(r.firstTimestampBehavior&&!kl.includes(r.firstTimestampBehavior))throw new Error(`Invalid first timestamp behavior: ${r.firstTimestampBehavior}`);if(typeof r.fastStart=="object"){if(r.video&&r.fastStart.expectedVideoChunks===void 0)throw new Error("'fastStart' is an object but is missing property 'expectedVideoChunks'.");if(r.audio&&r.fastStart.expectedAudioChunks===void 0)throw new Error("'fastStart' is an object but is missing property 'expectedAudioChunks'.")}else if(![!1,"in-memory"].includes(r.fastStart))throw new Error("'fastStart' option must be false, 'in-memory' or an object.")};Pn=new WeakSet;js=function(){let r=b(this,G).video?.codec==="hevc";if(b(this,j).writeBox(jo(r)),rt(this,Wi,b(this,j).pos),b(this,G).fastStart==="in-memory")rt(this,mt,Wr(!1));else{if(typeof b(this,G).fastStart=="object"){let a=$(this,ir,Ws).call(this);b(this,j).seek(b(this,j).pos+a)}rt(this,mt,Wr(!0)),b(this,j).writeBox(b(this,mt))}$(this,Ci,Qi).call(this)};ir=new WeakSet;Ws=function(){if(typeof b(this,G).fastStart!="object")return;let r=0,a=[b(this,G).fastStart.expectedVideoChunks,b(this,G).fastStart.expectedAudioChunks];for(let h of a)h&&(r+=8*Math.ceil(2/3*h),r+=4*h,r+=12*Math.ceil(2/3*h),r+=4*h,r+=8*h);return r+=4096,r};kn=new WeakSet;Ks=function(){if(b(this,G).video&&rt(this,he,{id:1,info:{type:"video",codec:b(this,G).video.codec,width:b(this,G).video.width,height:b(this,G).video.height,rotation:b(this,G).video.rotation??0},timescale:720,codecPrivate:new Uint8Array(0),samples:[],finalizedChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]}),b(this,G).audio){let r=$(this,nr,Xs).call(this,2,b(this,G).audio.sampleRate,b(this,G).audio.numberOfChannels);rt(this,fe,{id:b(this,G).video?2:1,info:{type:"audio",codec:b(this,G).audio.codec,numberOfChannels:b(this,G).audio.numberOfChannels,sampleRate:b(this,G).audio.sampleRate},timescale:b(this,G).audio.sampleRate,codecPrivate:r,samples:[],finalizedChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]})}};nr=new WeakSet;Xs=function(r,a,h){let d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350].indexOf(a),p=h,v="";v+=r.toString(2).padStart(5,"0"),v+=d.toString(2).padStart(4,"0"),d===15&&(v+=a.toString(2).padStart(24,"0")),v+=p.toString(2).padStart(4,"0");let s=Math.ceil(v.length/8)*8;v=v.padEnd(s,"0");let m=new Uint8Array(v.length/8);for(let y=0;y<v.length;y+=8)m[y/8]=parseInt(v.slice(y,y+8),2);return m};Ri=new WeakSet;Ln=function(r,a,h,f,d,p){let v=f/1e6,s=d/1e6;if(r.firstTimestamp===void 0&&(r.firstTimestamp=v),v=$(this,rr,Zs).call(this,v,r),r.lastTimestamp=v,(!r.currentChunk||v-r.currentChunk.startTimestamp>=Pl)&&(r.currentChunk&&$(this,wi,Ki).call(this,r),r.currentChunk={startTimestamp:v,sampleData:[],sampleCount:0}),r.currentChunk.sampleData.push(a),r.currentChunk.sampleCount++,p?.decoderConfig?.description&&(r.codecPrivate=new Uint8Array(p.decoderConfig.description)),r.samples.push({timestamp:v,duration:s,size:a.byteLength,type:h}),r.lastTimescaleUnits!==null){let m=Ei(v,r.timescale,!1),y=Math.round(m-r.lastTimescaleUnits);r.lastTimescaleUnits+=y;let E=De(r.timeToSampleTable);E.sampleCount===1?(E.sampleDelta=y,E.sampleCount++):E.sampleDelta===y?E.sampleCount++:(E.sampleCount--,r.timeToSampleTable.push({sampleCount:2,sampleDelta:y}))}else r.lastTimescaleUnits=0,r.timeToSampleTable.push({sampleCount:1,sampleDelta:Ei(s,r.timescale)})};rr=new WeakSet;Zs=function(r,a){if(b(this,G).firstTimestampBehavior==="strict"&&a.lastTimestamp===-1&&r!==0)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received ${r}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
`);if(b(this,G).firstTimestampBehavior==="offset"&&(r-=a.firstTimestamp),r<a.lastTimestamp)throw new Error(`Timestamps must be monotonically increasing (went from ${a.lastTimestamp*1e6} to ${r*1e6}).`);return r};wi=new WeakSet;Ki=function(r){if(r.currentChunk){if((r.compactlyCodedChunkTable.length===0||De(r.compactlyCodedChunkTable).samplesPerChunk!==r.currentChunk.sampleCount)&&r.compactlyCodedChunkTable.push({firstChunk:r.finalizedChunks.length+1,samplesPerChunk:r.currentChunk.sampleCount}),r.finalizedChunks.push(r.currentChunk),b(this,bi).push(r.currentChunk),b(this,G).fastStart==="in-memory"){r.currentChunk.offset=0;return}r.currentChunk.offset=b(this,j).pos;for(let a of r.currentChunk.sampleData)b(this,j).write(a);r.currentChunk.sampleData=null,$(this,Ci,Qi).call(this)}};Ci=new WeakSet;Qi=function(){b(this,j)instanceof Gs&&b(this,j).flush()};Oi=new WeakSet;Dn=function(){if(b(this,Si))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};function Dl(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var $s={};(function(r){var a=function(){var t=new Date,e=4,n=3,o=2,l=1,u=e,c={setLogLevel:function(_){_==this.debug?u=l:_==this.info?u=o:_==this.warn?u=n:(_==this.error,u=e)},debug:function(_,x){console.debug===void 0&&(console.debug=console.log),l>=u&&console.debug("["+a.getDurationString(new Date-t,1e3)+"]","["+_+"]",x)},log:function(_,x){this.debug(_.msg)},info:function(_,x){o>=u&&console.info("["+a.getDurationString(new Date-t,1e3)+"]","["+_+"]",x)},warn:function(_,x){n>=u&&console.warn("["+a.getDurationString(new Date-t,1e3)+"]","["+_+"]",x)},error:function(_,x){e>=u&&console.error("["+a.getDurationString(new Date-t,1e3)+"]","["+_+"]",x)}};return c}();a.getDurationString=function(t,e){var n;function o(S,w){for(var C=""+S,F=C.split(".");F[0].length<w;)F[0]="0"+F[0];return F.join(".")}t<0?(n=!0,t=-t):n=!1;var l=e||1,u=t/l,c=Math.floor(u/3600);u-=c*3600;var _=Math.floor(u/60);u-=_*60;var x=u*1e3;return u=Math.floor(u),x-=u*1e3,x=Math.floor(x),(n?"-":"")+c+":"+o(_,2)+":"+o(u,2)+"."+o(x,3)},a.printRanges=function(t){var e=t.length;if(e>0){for(var n="",o=0;o<e;o++)o>0&&(n+=","),n+="["+a.getDurationString(t.start(o))+","+a.getDurationString(t.end(o))+"]";return n}else return"(empty)"},r.Log=a;var h=function(t){if(t instanceof ArrayBuffer)this.buffer=t,this.dataview=new DataView(t);else throw"Needs an array buffer";this.position=0};h.prototype.getPosition=function(){return this.position},h.prototype.getEndPosition=function(){return this.buffer.byteLength},h.prototype.getLength=function(){return this.buffer.byteLength},h.prototype.seek=function(t){var e=Math.max(0,Math.min(this.buffer.byteLength,t));return this.position=isNaN(e)||!isFinite(e)?0:e,!0},h.prototype.isEos=function(){return this.getPosition()>=this.getEndPosition()},h.prototype.readAnyInt=function(t,e){var n=0;if(this.position+t<=this.buffer.byteLength){switch(t){case 1:e?n=this.dataview.getInt8(this.position):n=this.dataview.getUint8(this.position);break;case 2:e?n=this.dataview.getInt16(this.position):n=this.dataview.getUint16(this.position);break;case 3:if(e)throw"No method for reading signed 24 bits values";n=this.dataview.getUint8(this.position)<<16,n|=this.dataview.getUint8(this.position+1)<<8,n|=this.dataview.getUint8(this.position+2);break;case 4:e?n=this.dataview.getInt32(this.position):n=this.dataview.getUint32(this.position);break;case 8:if(e)throw"No method for reading signed 64 bits values";n=this.dataview.getUint32(this.position)<<32,n|=this.dataview.getUint32(this.position+4);break;default:throw"readInt method not implemented for size: "+t}return this.position+=t,n}else throw"Not enough bytes in buffer"},h.prototype.readUint8=function(){return this.readAnyInt(1,!1)},h.prototype.readUint16=function(){return this.readAnyInt(2,!1)},h.prototype.readUint24=function(){return this.readAnyInt(3,!1)},h.prototype.readUint32=function(){return this.readAnyInt(4,!1)},h.prototype.readUint64=function(){return this.readAnyInt(8,!1)},h.prototype.readString=function(t){if(this.position+t<=this.buffer.byteLength){for(var e="",n=0;n<t;n++)e+=String.fromCharCode(this.readUint8());return e}else throw"Not enough bytes in buffer"},h.prototype.readCString=function(){for(var t=[];;){var e=this.readUint8();if(e!==0)t.push(e);else break}return String.fromCharCode.apply(null,t)},h.prototype.readInt8=function(){return this.readAnyInt(1,!0)},h.prototype.readInt16=function(){return this.readAnyInt(2,!0)},h.prototype.readInt32=function(){return this.readAnyInt(4,!0)},h.prototype.readInt64=function(){return this.readAnyInt(8,!1)},h.prototype.readUint8Array=function(t){for(var e=new Uint8Array(t),n=0;n<t;n++)e[n]=this.readUint8();return e},h.prototype.readInt16Array=function(t){for(var e=new Int16Array(t),n=0;n<t;n++)e[n]=this.readInt16();return e},h.prototype.readUint16Array=function(t){for(var e=new Int16Array(t),n=0;n<t;n++)e[n]=this.readUint16();return e},h.prototype.readUint32Array=function(t){for(var e=new Uint32Array(t),n=0;n<t;n++)e[n]=this.readUint32();return e},h.prototype.readInt32Array=function(t){for(var e=new Int32Array(t),n=0;n<t;n++)e[n]=this.readInt32();return e},r.MP4BoxStream=h;var f=function(t,e,n){this._byteOffset=e||0,t instanceof ArrayBuffer?this.buffer=t:typeof t=="object"?(this.dataView=t,e&&(this._byteOffset+=e)):this.buffer=new ArrayBuffer(t||0),this.position=0,this.endianness=n??f.LITTLE_ENDIAN};f.prototype={},f.prototype.getPosition=function(){return this.position},f.prototype._realloc=function(t){if(this._dynamicSize){var e=this._byteOffset+this.position+t,n=this._buffer.byteLength;if(e<=n){e>this._byteLength&&(this._byteLength=e);return}for(n<1&&(n=1);e>n;)n*=2;var o=new ArrayBuffer(n),l=new Uint8Array(this._buffer),u=new Uint8Array(o,0,l.length);u.set(l),this.buffer=o,this._byteLength=e}},f.prototype._trimAlloc=function(){if(this._byteLength!=this._buffer.byteLength){var t=new ArrayBuffer(this._byteLength),e=new Uint8Array(t),n=new Uint8Array(this._buffer,0,e.length);e.set(n),this.buffer=t}},f.BIG_ENDIAN=!1,f.LITTLE_ENDIAN=!0,f.prototype._byteLength=0,Object.defineProperty(f.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(f.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(t){this._buffer=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(f.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(t){this._byteOffset=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(f.prototype,"dataView",{get:function(){return this._dataView},set:function(t){this._byteOffset=t.byteOffset,this._buffer=t.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+t.byteLength}}),f.prototype.seek=function(t){var e=Math.max(0,Math.min(this.byteLength,t));this.position=isNaN(e)||!isFinite(e)?0:e},f.prototype.isEof=function(){return this.position>=this._byteLength},f.prototype.mapUint8Array=function(t){this._realloc(t*1);var e=new Uint8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=t*1,e},f.prototype.readInt32Array=function(t,e){t=t??this.byteLength-this.position/4;var n=new Int32Array(t);return f.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,t*n.BYTES_PER_ELEMENT),f.arrayToNative(n,e??this.endianness),this.position+=n.byteLength,n},f.prototype.readInt16Array=function(t,e){t=t??this.byteLength-this.position/2;var n=new Int16Array(t);return f.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,t*n.BYTES_PER_ELEMENT),f.arrayToNative(n,e??this.endianness),this.position+=n.byteLength,n},f.prototype.readInt8Array=function(t){t=t??this.byteLength-this.position;var e=new Int8Array(t);return f.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e},f.prototype.readUint32Array=function(t,e){t=t??this.byteLength-this.position/4;var n=new Uint32Array(t);return f.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,t*n.BYTES_PER_ELEMENT),f.arrayToNative(n,e??this.endianness),this.position+=n.byteLength,n},f.prototype.readUint16Array=function(t,e){t=t??this.byteLength-this.position/2;var n=new Uint16Array(t);return f.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,t*n.BYTES_PER_ELEMENT),f.arrayToNative(n,e??this.endianness),this.position+=n.byteLength,n},f.prototype.readUint8Array=function(t){t=t??this.byteLength-this.position;var e=new Uint8Array(t);return f.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e},f.prototype.readFloat64Array=function(t,e){t=t??this.byteLength-this.position/8;var n=new Float64Array(t);return f.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,t*n.BYTES_PER_ELEMENT),f.arrayToNative(n,e??this.endianness),this.position+=n.byteLength,n},f.prototype.readFloat32Array=function(t,e){t=t??this.byteLength-this.position/4;var n=new Float32Array(t);return f.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,t*n.BYTES_PER_ELEMENT),f.arrayToNative(n,e??this.endianness),this.position+=n.byteLength,n},f.prototype.readInt32=function(t){var e=this._dataView.getInt32(this.position,t??this.endianness);return this.position+=4,e},f.prototype.readInt16=function(t){var e=this._dataView.getInt16(this.position,t??this.endianness);return this.position+=2,e},f.prototype.readInt8=function(){var t=this._dataView.getInt8(this.position);return this.position+=1,t},f.prototype.readUint32=function(t){var e=this._dataView.getUint32(this.position,t??this.endianness);return this.position+=4,e},f.prototype.readUint16=function(t){var e=this._dataView.getUint16(this.position,t??this.endianness);return this.position+=2,e},f.prototype.readUint8=function(){var t=this._dataView.getUint8(this.position);return this.position+=1,t},f.prototype.readFloat32=function(t){var e=this._dataView.getFloat32(this.position,t??this.endianness);return this.position+=4,e},f.prototype.readFloat64=function(t){var e=this._dataView.getFloat64(this.position,t??this.endianness);return this.position+=8,e},f.endianness=new Int8Array(new Int16Array([1]).buffer)[0]>0,f.memcpy=function(t,e,n,o,l){var u=new Uint8Array(t,e,l),c=new Uint8Array(n,o,l);u.set(c)},f.arrayToNative=function(t,e){return e==this.endianness?t:this.flipArrayEndianness(t)},f.nativeToEndian=function(t,e){return this.endianness==e?t:this.flipArrayEndianness(t)},f.flipArrayEndianness=function(t){for(var e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),n=0;n<t.byteLength;n+=t.BYTES_PER_ELEMENT)for(var o=n+t.BYTES_PER_ELEMENT-1,l=n;o>l;o--,l++){var u=e[l];e[l]=e[o],e[o]=u}return t},f.prototype.failurePosition=0,String.fromCharCodeUint8=function(t){for(var e=[],n=0;n<t.length;n++)e[n]=t[n];return String.fromCharCode.apply(null,e)},f.prototype.readString=function(t,e){return e==null||e=="ASCII"?String.fromCharCodeUint8.apply(null,[this.mapUint8Array(t??this.byteLength-this.position)]):new TextDecoder(e).decode(this.mapUint8Array(t))},f.prototype.readCString=function(t){var e=this.byteLength-this.position,n=new Uint8Array(this._buffer,this._byteOffset+this.position),o=e;t!=null&&(o=Math.min(t,e));for(var l=0;l<o&&n[l]!==0;l++);var u=String.fromCharCodeUint8.apply(null,[this.mapUint8Array(l)]);return t!=null?this.position+=o-l:l!=e&&(this.position+=1),u};var d=Math.pow(2,32);f.prototype.readInt64=function(){return this.readInt32()*d+this.readUint32()},f.prototype.readUint64=function(){return this.readUint32()*d+this.readUint32()},f.prototype.readInt64=function(){return this.readUint32()*d+this.readUint32()},f.prototype.readUint24=function(){return(this.readUint8()<<16)+(this.readUint8()<<8)+this.readUint8()},r.DataStream=f,f.prototype.save=function(t){var e=new Blob([this.buffer]);if(window.URL&&URL.createObjectURL){var n=window.URL.createObjectURL(e),o=document.createElement("a");document.body.appendChild(o),o.setAttribute("href",n),o.setAttribute("download",t),o.setAttribute("target","_self"),o.click(),window.URL.revokeObjectURL(n)}else throw"DataStream.save: Can't create object URL."},f.prototype._dynamicSize=!0,Object.defineProperty(f.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(t){t||this._trimAlloc(),this._dynamicSize=t}}),f.prototype.shift=function(t){var e=new ArrayBuffer(this._byteLength-t),n=new Uint8Array(e),o=new Uint8Array(this._buffer,t,n.length);n.set(o),this.buffer=e,this.position-=t},f.prototype.writeInt32Array=function(t,e){if(this._realloc(t.length*4),t instanceof Int32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt32Array(t.length,e);else for(var n=0;n<t.length;n++)this.writeInt32(t[n],e)},f.prototype.writeInt16Array=function(t,e){if(this._realloc(t.length*2),t instanceof Int16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt16Array(t.length,e);else for(var n=0;n<t.length;n++)this.writeInt16(t[n],e)},f.prototype.writeInt8Array=function(t){if(this._realloc(t.length*1),t instanceof Int8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt8Array(t.length);else for(var e=0;e<t.length;e++)this.writeInt8(t[e])},f.prototype.writeUint32Array=function(t,e){if(this._realloc(t.length*4),t instanceof Uint32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint32Array(t.length,e);else for(var n=0;n<t.length;n++)this.writeUint32(t[n],e)},f.prototype.writeUint16Array=function(t,e){if(this._realloc(t.length*2),t instanceof Uint16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint16Array(t.length,e);else for(var n=0;n<t.length;n++)this.writeUint16(t[n],e)},f.prototype.writeUint8Array=function(t){if(this._realloc(t.length*1),t instanceof Uint8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint8Array(t.length);else for(var e=0;e<t.length;e++)this.writeUint8(t[e])},f.prototype.writeFloat64Array=function(t,e){if(this._realloc(t.length*8),t instanceof Float64Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat64Array(t.length,e);else for(var n=0;n<t.length;n++)this.writeFloat64(t[n],e)},f.prototype.writeFloat32Array=function(t,e){if(this._realloc(t.length*4),t instanceof Float32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)f.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat32Array(t.length,e);else for(var n=0;n<t.length;n++)this.writeFloat32(t[n],e)},f.prototype.writeInt32=function(t,e){this._realloc(4),this._dataView.setInt32(this.position,t,e??this.endianness),this.position+=4},f.prototype.writeInt16=function(t,e){this._realloc(2),this._dataView.setInt16(this.position,t,e??this.endianness),this.position+=2},f.prototype.writeInt8=function(t){this._realloc(1),this._dataView.setInt8(this.position,t),this.position+=1},f.prototype.writeUint32=function(t,e){this._realloc(4),this._dataView.setUint32(this.position,t,e??this.endianness),this.position+=4},f.prototype.writeUint16=function(t,e){this._realloc(2),this._dataView.setUint16(this.position,t,e??this.endianness),this.position+=2},f.prototype.writeUint8=function(t){this._realloc(1),this._dataView.setUint8(this.position,t),this.position+=1},f.prototype.writeFloat32=function(t,e){this._realloc(4),this._dataView.setFloat32(this.position,t,e??this.endianness),this.position+=4},f.prototype.writeFloat64=function(t,e){this._realloc(8),this._dataView.setFloat64(this.position,t,e??this.endianness),this.position+=8},f.prototype.writeUCS2String=function(t,e,n){n==null&&(n=t.length);for(var o=0;o<t.length&&o<n;o++)this.writeUint16(t.charCodeAt(o),e);for(;o<n;o++)this.writeUint16(0)},f.prototype.writeString=function(t,e,n){var o=0;if(e==null||e=="ASCII")if(n!=null){var l=Math.min(t.length,n);for(o=0;o<l;o++)this.writeUint8(t.charCodeAt(o));for(;o<n;o++)this.writeUint8(0)}else for(o=0;o<t.length;o++)this.writeUint8(t.charCodeAt(o));else this.writeUint8Array(new TextEncoder(e).encode(t.substring(0,n)))},f.prototype.writeCString=function(t,e){var n=0;if(e!=null){var o=Math.min(t.length,e);for(n=0;n<o;n++)this.writeUint8(t.charCodeAt(n));for(;n<e;n++)this.writeUint8(0)}else{for(n=0;n<t.length;n++)this.writeUint8(t.charCodeAt(n));this.writeUint8(0)}},f.prototype.writeStruct=function(t,e){for(var n=0;n<t.length;n+=2){var o=t[n+1];this.writeType(o,e[t[n]],e)}},f.prototype.writeType=function(t,e,n){var o;if(typeof t=="function")return t(this,e);if(typeof t=="object"&&!(t instanceof Array))return t.set(this,e,n);var l=null,u="ASCII",c=this.position;switch(typeof t=="string"&&/:/.test(t)&&(o=t.split(":"),t=o[0],l=parseInt(o[1])),typeof t=="string"&&/,/.test(t)&&(o=t.split(","),t=o[0],u=parseInt(o[1])),t){case"uint8":this.writeUint8(e);break;case"int8":this.writeInt8(e);break;case"uint16":this.writeUint16(e,this.endianness);break;case"int16":this.writeInt16(e,this.endianness);break;case"uint32":this.writeUint32(e,this.endianness);break;case"int32":this.writeInt32(e,this.endianness);break;case"float32":this.writeFloat32(e,this.endianness);break;case"float64":this.writeFloat64(e,this.endianness);break;case"uint16be":this.writeUint16(e,f.BIG_ENDIAN);break;case"int16be":this.writeInt16(e,f.BIG_ENDIAN);break;case"uint32be":this.writeUint32(e,f.BIG_ENDIAN);break;case"int32be":this.writeInt32(e,f.BIG_ENDIAN);break;case"float32be":this.writeFloat32(e,f.BIG_ENDIAN);break;case"float64be":this.writeFloat64(e,f.BIG_ENDIAN);break;case"uint16le":this.writeUint16(e,f.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(e,f.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(e,f.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(e,f.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(e,f.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(e,f.LITTLE_ENDIAN);break;case"cstring":this.writeCString(e,l);break;case"string":this.writeString(e,u,l);break;case"u16string":this.writeUCS2String(e,this.endianness,l);break;case"u16stringle":this.writeUCS2String(e,f.LITTLE_ENDIAN,l);break;case"u16stringbe":this.writeUCS2String(e,f.BIG_ENDIAN,l);break;default:if(t.length==3){for(var _=t[1],x=0;x<e.length;x++)this.writeType(_,e[x]);break}else{this.writeStruct(t,e);break}}l!=null&&(this.position=c,this._realloc(l),this.position=c+l)},f.prototype.writeUint64=function(t){var e=Math.floor(t/d);this.writeUint32(e),this.writeUint32(t&4294967295)},f.prototype.writeUint24=function(t){this.writeUint8((t&16711680)>>16),this.writeUint8((t&65280)>>8),this.writeUint8(t&255)},f.prototype.adjustUint32=function(t,e){var n=this.position;this.seek(t),this.writeUint32(e),this.seek(n)},f.prototype.mapInt32Array=function(t,e){this._realloc(t*4);var n=new Int32Array(this._buffer,this.byteOffset+this.position,t);return f.arrayToNative(n,e??this.endianness),this.position+=t*4,n},f.prototype.mapInt16Array=function(t,e){this._realloc(t*2);var n=new Int16Array(this._buffer,this.byteOffset+this.position,t);return f.arrayToNative(n,e??this.endianness),this.position+=t*2,n},f.prototype.mapInt8Array=function(t){this._realloc(t*1);var e=new Int8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=t*1,e},f.prototype.mapUint32Array=function(t,e){this._realloc(t*4);var n=new Uint32Array(this._buffer,this.byteOffset+this.position,t);return f.arrayToNative(n,e??this.endianness),this.position+=t*4,n},f.prototype.mapUint16Array=function(t,e){this._realloc(t*2);var n=new Uint16Array(this._buffer,this.byteOffset+this.position,t);return f.arrayToNative(n,e??this.endianness),this.position+=t*2,n},f.prototype.mapFloat64Array=function(t,e){this._realloc(t*8);var n=new Float64Array(this._buffer,this.byteOffset+this.position,t);return f.arrayToNative(n,e??this.endianness),this.position+=t*8,n},f.prototype.mapFloat32Array=function(t,e){this._realloc(t*4);var n=new Float32Array(this._buffer,this.byteOffset+this.position,t);return f.arrayToNative(n,e??this.endianness),this.position+=t*4,n};var p=function(t){this.buffers=[],this.bufferIndex=-1,t&&(this.insertBuffer(t),this.bufferIndex=0)};p.prototype=new f(new ArrayBuffer,0,f.BIG_ENDIAN),p.prototype.initialized=function(){var t;return this.bufferIndex>-1?!0:this.buffers.length>0?(t=this.buffers[0],t.fileStart===0?(this.buffer=t,this.bufferIndex=0,a.debug("MultiBufferStream","Stream ready for parsing"),!0):(a.warn("MultiBufferStream","The first buffer should have a fileStart of 0"),this.logBufferLevel(),!1)):(a.warn("MultiBufferStream","No buffer to start parsing from"),this.logBufferLevel(),!1)},ArrayBuffer.concat=function(t,e){a.debug("ArrayBuffer","Trying to create a new buffer of size: "+(t.byteLength+e.byteLength));var n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n.buffer},p.prototype.reduceBuffer=function(t,e,n){var o;return o=new Uint8Array(n),o.set(new Uint8Array(t,e,n)),o.buffer.fileStart=t.fileStart+e,o.buffer.usedBytes=0,o.buffer},p.prototype.insertBuffer=function(t){for(var e=!0,n=0;n<this.buffers.length;n++){var o=this.buffers[n];if(t.fileStart<=o.fileStart){if(t.fileStart===o.fileStart)if(t.byteLength>o.byteLength){this.buffers.splice(n,1),n--;continue}else a.warn("MultiBufferStream","Buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+") already appended, ignoring");else t.fileStart+t.byteLength<=o.fileStart||(t=this.reduceBuffer(t,0,o.fileStart-t.fileStart)),a.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.splice(n,0,t),n===0&&(this.buffer=t);e=!1;break}else if(t.fileStart<o.fileStart+o.byteLength){var l=o.fileStart+o.byteLength-t.fileStart,u=t.byteLength-l;if(u>0)t=this.reduceBuffer(t,l,u);else{e=!1;break}}}e&&(a.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.push(t),n===0&&(this.buffer=t))},p.prototype.logBufferLevel=function(t){var e,n,o,l,u=[],c,_="";for(o=0,l=0,e=0;e<this.buffers.length;e++)n=this.buffers[e],e===0?(c={},u.push(c),c.start=n.fileStart,c.end=n.fileStart+n.byteLength,_+="["+c.start+"-"):c.end===n.fileStart?c.end=n.fileStart+n.byteLength:(c={},c.start=n.fileStart,_+=u[u.length-1].end-1+"], ["+c.start+"-",c.end=n.fileStart+n.byteLength,u.push(c)),o+=n.usedBytes,l+=n.byteLength;u.length>0&&(_+=c.end-1+"]");var x=t?a.info:a.debug;this.buffers.length===0?x("MultiBufferStream","No more buffer in memory"):x("MultiBufferStream",""+this.buffers.length+" stored buffer(s) ("+o+"/"+l+" bytes), continuous ranges: "+_)},p.prototype.cleanBuffers=function(){var t,e;for(t=0;t<this.buffers.length;t++)e=this.buffers[t],e.usedBytes===e.byteLength&&(a.debug("MultiBufferStream","Removing buffer #"+t),this.buffers.splice(t,1),t--)},p.prototype.mergeNextBuffer=function(){var t;if(this.bufferIndex+1<this.buffers.length)if(t=this.buffers[this.bufferIndex+1],t.fileStart===this.buffer.fileStart+this.buffer.byteLength){var e=this.buffer.byteLength,n=this.buffer.usedBytes,o=this.buffer.fileStart;return this.buffers[this.bufferIndex]=ArrayBuffer.concat(this.buffer,t),this.buffer=this.buffers[this.bufferIndex],this.buffers.splice(this.bufferIndex+1,1),this.buffer.usedBytes=n,this.buffer.fileStart=o,a.debug("ISOFile","Concatenating buffer for box parsing (length: "+e+"->"+this.buffer.byteLength+")"),!0}else return!1;else return!1},p.prototype.findPosition=function(t,e,n){var o,l=null,u=-1;for(t===!0?o=0:o=this.bufferIndex;o<this.buffers.length&&(l=this.buffers[o],l.fileStart<=e);){u=o,n&&(l.fileStart+l.byteLength<=e?l.usedBytes=l.byteLength:l.usedBytes=e-l.fileStart,this.logBufferLevel());o++}return u!==-1?(l=this.buffers[u],l.fileStart+l.byteLength>=e?(a.debug("MultiBufferStream","Found position in existing buffer #"+u),u):-1):-1},p.prototype.findEndContiguousBuf=function(t){var e,n,o,l=t!==void 0?t:this.bufferIndex;if(n=this.buffers[l],this.buffers.length>l+1)for(e=l+1;e<this.buffers.length&&(o=this.buffers[e],o.fileStart===n.fileStart+n.byteLength);e++)n=o;return n.fileStart+n.byteLength},p.prototype.getEndFilePositionAfter=function(t){var e=this.findPosition(!0,t,!1);return e!==-1?this.findEndContiguousBuf(e):t},p.prototype.addUsedBytes=function(t){this.buffer.usedBytes+=t,this.logBufferLevel()},p.prototype.setAllUsedBytes=function(){this.buffer.usedBytes=this.buffer.byteLength,this.logBufferLevel()},p.prototype.seek=function(t,e,n){var o;return o=this.findPosition(e,t,n),o!==-1?(this.buffer=this.buffers[o],this.bufferIndex=o,this.position=t-this.buffer.fileStart,a.debug("MultiBufferStream","Repositioning parser at buffer position: "+this.position),!0):(a.debug("MultiBufferStream","Position "+t+" not found in buffered data"),!1)},p.prototype.getPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.position},p.prototype.getLength=function(){return this.byteLength},p.prototype.getEndPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.byteLength},r.MultiBufferStream=p;var v=function(){var t=3,e=4,n=5,o=6,l=[];l[t]="ES_Descriptor",l[e]="DecoderConfigDescriptor",l[n]="DecoderSpecificInfo",l[o]="SLConfigDescriptor",this.getDescriptorName=function(_){return l[_]};var u=this,c={};return this.parseOneDescriptor=function(_){var x=0,S,w,C;for(S=_.readUint8(),C=_.readUint8();C&128;)x=(x<<7)+(C&127),C=_.readUint8();return x=(x<<7)+(C&127),a.debug("MPEG4DescriptorParser","Found "+(l[S]||"Descriptor "+S)+", size "+x+" at position "+_.getPosition()),l[S]?w=new c[l[S]](x):w=new c.Descriptor(x),w.parse(_),w},c.Descriptor=function(_,x){this.tag=_,this.size=x,this.descs=[]},c.Descriptor.prototype.parse=function(_){this.data=_.readUint8Array(this.size)},c.Descriptor.prototype.findDescriptor=function(_){for(var x=0;x<this.descs.length;x++)if(this.descs[x].tag==_)return this.descs[x];return null},c.Descriptor.prototype.parseRemainingDescriptors=function(_){for(var x=_.position;_.position<x+this.size;){var S=u.parseOneDescriptor(_);this.descs.push(S)}},c.ES_Descriptor=function(_){c.Descriptor.call(this,t,_)},c.ES_Descriptor.prototype=new c.Descriptor,c.ES_Descriptor.prototype.parse=function(_){if(this.ES_ID=_.readUint16(),this.flags=_.readUint8(),this.size-=3,this.flags&128?(this.dependsOn_ES_ID=_.readUint16(),this.size-=2):this.dependsOn_ES_ID=0,this.flags&64){var x=_.readUint8();this.URL=_.readString(x),this.size-=x+1}else this.URL="";this.flags&32?(this.OCR_ES_ID=_.readUint16(),this.size-=2):this.OCR_ES_ID=0,this.parseRemainingDescriptors(_)},c.ES_Descriptor.prototype.getOTI=function(_){var x=this.findDescriptor(e);return x?x.oti:0},c.ES_Descriptor.prototype.getAudioConfig=function(_){var x=this.findDescriptor(e);if(!x)return null;var S=x.findDescriptor(n);if(S&&S.data){var w=(S.data[0]&248)>>3;return w===31&&S.data.length>=2&&(w=32+((S.data[0]&7)<<3)+((S.data[1]&224)>>5)),w}else return null},c.DecoderConfigDescriptor=function(_){c.Descriptor.call(this,e,_)},c.DecoderConfigDescriptor.prototype=new c.Descriptor,c.DecoderConfigDescriptor.prototype.parse=function(_){this.oti=_.readUint8(),this.streamType=_.readUint8(),this.upStream=(this.streamType>>1&1)!==0,this.streamType=this.streamType>>>2,this.bufferSize=_.readUint24(),this.maxBitrate=_.readUint32(),this.avgBitrate=_.readUint32(),this.size-=13,this.parseRemainingDescriptors(_)},c.DecoderSpecificInfo=function(_){c.Descriptor.call(this,n,_)},c.DecoderSpecificInfo.prototype=new c.Descriptor,c.SLConfigDescriptor=function(_){c.Descriptor.call(this,o,_)},c.SLConfigDescriptor.prototype=new c.Descriptor,this};r.MPEG4DescriptorParser=v;var s={ERR_INVALID_DATA:-1,ERR_NOT_ENOUGH_DATA:0,OK:1,BASIC_BOXES:[{type:"mdat",name:"MediaDataBox"},{type:"idat",name:"ItemDataBox"},{type:"free",name:"FreeSpaceBox"},{type:"skip",name:"FreeSpaceBox"},{type:"meco",name:"AdditionalMetadataContainerBox"},{type:"strk",name:"SubTrackBox"}],FULL_BOXES:[{type:"hmhd",name:"HintMediaHeaderBox"},{type:"nmhd",name:"NullMediaHeaderBox"},{type:"iods",name:"ObjectDescriptorBox"},{type:"xml ",name:"XMLBox"},{type:"bxml",name:"BinaryXMLBox"},{type:"ipro",name:"ItemProtectionBox"},{type:"mere",name:"MetaboxRelationBox"}],CONTAINER_BOXES:[[{type:"moov",name:"CompressedMovieBox"},["trak","pssh"]],[{type:"trak",name:"TrackBox"}],[{type:"edts",name:"EditBox"}],[{type:"mdia",name:"MediaBox"}],[{type:"minf",name:"MediaInformationBox"}],[{type:"dinf",name:"DataInformationBox"}],[{type:"stbl",name:"SampleTableBox"},["sgpd","sbgp"]],[{type:"mvex",name:"MovieExtendsBox"},["trex"]],[{type:"moof",name:"CompressedMovieFragmentBox"},["traf"]],[{type:"traf",name:"TrackFragmentBox"},["trun","sgpd","sbgp"]],[{type:"vttc",name:"VTTCueBox"}],[{type:"tref",name:"TrackReferenceBox"}],[{type:"iref",name:"ItemReferenceBox"}],[{type:"mfra",name:"MovieFragmentRandomAccessBox"},["tfra"]],[{type:"meco",name:"AdditionalMetadataContainerBox"}],[{type:"hnti",name:"trackhintinformation"}],[{type:"hinf",name:"hintstatisticsbox"}],[{type:"strk",name:"SubTrackBox"}],[{type:"strd",name:"SubTrackDefinitionBox"}],[{type:"sinf",name:"ProtectionSchemeInfoBox"}],[{type:"rinf",name:"RestrictedSchemeInfoBox"}],[{type:"schi",name:"SchemeInformationBox"}],[{type:"trgr",name:"TrackGroupBox"}],[{type:"udta",name:"UserDataBox"},["kind"]],[{type:"iprp",name:"ItemPropertiesBox"},["ipma"]],[{type:"ipco",name:"ItemPropertyContainerBox"}],[{type:"grpl",name:"GroupsListBox"}],[{type:"j2kH",name:"J2KHeaderInfoBox"}],[{type:"etyp",name:"ExtendedTypeBox"},["tyco"]]],boxCodes:[],fullBoxCodes:[],containerBoxCodes:[],sampleEntryCodes:{},sampleGroupEntryCodes:[],trackGroupTypes:[],UUIDBoxes:{},UUIDs:[],initialize:function(){s.FullBox.prototype=new s.Box,s.ContainerBox.prototype=new s.Box,s.SampleEntry.prototype=new s.Box,s.TrackGroupTypeBox.prototype=new s.FullBox,s.BASIC_BOXES.forEach(function(t){s.createBoxCtor(t.type,t.name)}),s.FULL_BOXES.forEach(function(t){s.createFullBoxCtor(t.type,t.name)}),s.CONTAINER_BOXES.forEach(function(t){s.createContainerBoxCtor(t[0].type,t[0].name,null,t[1])})},Box:function(t,e,n,o){this.type=t,this.box_name=n,this.size=e,this.uuid=o},FullBox:function(t,e,n,o){s.Box.call(this,t,e,n,o),this.flags=0,this.version=0},ContainerBox:function(t,e,n,o){s.Box.call(this,t,e,n,o),this.boxes=[]},SampleEntry:function(t,e,n,o){s.ContainerBox.call(this,t,e),this.hdr_size=n,this.start=o},SampleGroupEntry:function(t){this.grouping_type=t},TrackGroupTypeBox:function(t,e){s.FullBox.call(this,t,e)},createBoxCtor:function(t,e,n){s.boxCodes.push(t),s[t+"Box"]=function(o){s.Box.call(this,t,o,e)},s[t+"Box"].prototype=new s.Box,n&&(s[t+"Box"].prototype.parse=n)},createFullBoxCtor:function(t,e,n){s[t+"Box"]=function(o){s.FullBox.call(this,t,o,e)},s[t+"Box"].prototype=new s.FullBox,s[t+"Box"].prototype.parse=function(o){this.parseFullHeader(o),n&&n.call(this,o)}},addSubBoxArrays:function(t){if(t){this.subBoxNames=t;for(var e=t.length,n=0;n<e;n++)this[t[n]+"s"]=[]}},createContainerBoxCtor:function(t,e,n,o){s[t+"Box"]=function(l){s.ContainerBox.call(this,t,l,e),s.addSubBoxArrays.call(this,o)},s[t+"Box"].prototype=new s.ContainerBox,n&&(s[t+"Box"].prototype.parse=n)},createMediaSampleEntryCtor:function(t,e,n){s.sampleEntryCodes[t]=[],s[t+"SampleEntry"]=function(o,l){s.SampleEntry.call(this,o,l),s.addSubBoxArrays.call(this,n)},s[t+"SampleEntry"].prototype=new s.SampleEntry,e&&(s[t+"SampleEntry"].prototype.parse=e)},createSampleEntryCtor:function(t,e,n,o){s.sampleEntryCodes[t].push(e),s[e+"SampleEntry"]=function(l){s[t+"SampleEntry"].call(this,e,l),s.addSubBoxArrays.call(this,o)},s[e+"SampleEntry"].prototype=new s[t+"SampleEntry"],n&&(s[e+"SampleEntry"].prototype.parse=n)},createEncryptedSampleEntryCtor:function(t,e,n){s.createSampleEntryCtor.call(this,t,e,n,["sinf"])},createSampleGroupCtor:function(t,e){s[t+"SampleGroupEntry"]=function(n){s.SampleGroupEntry.call(this,t,n)},s[t+"SampleGroupEntry"].prototype=new s.SampleGroupEntry,e&&(s[t+"SampleGroupEntry"].prototype.parse=e)},createTrackGroupCtor:function(t,e){s[t+"TrackGroupTypeBox"]=function(n){s.TrackGroupTypeBox.call(this,t,n)},s[t+"TrackGroupTypeBox"].prototype=new s.TrackGroupTypeBox,e&&(s[t+"TrackGroupTypeBox"].prototype.parse=e)},createUUIDBox:function(t,e,n,o,l){s.UUIDs.push(t),s.UUIDBoxes[t]=function(u){n?s.FullBox.call(this,"uuid",u,e,t):o?s.ContainerBox.call(this,"uuid",u,e,t):s.Box.call(this,"uuid",u,e,t)},s.UUIDBoxes[t].prototype=n?new s.FullBox:o?new s.ContainerBox:new s.Box,l&&(n?s.UUIDBoxes[t].prototype.parse=function(u){this.parseFullHeader(u),l&&l.call(this,u)}:s.UUIDBoxes[t].prototype.parse=l)}};s.initialize(),s.TKHD_FLAG_ENABLED=1,s.TKHD_FLAG_IN_MOVIE=2,s.TKHD_FLAG_IN_PREVIEW=4,s.TFHD_FLAG_BASE_DATA_OFFSET=1,s.TFHD_FLAG_SAMPLE_DESC=2,s.TFHD_FLAG_SAMPLE_DUR=8,s.TFHD_FLAG_SAMPLE_SIZE=16,s.TFHD_FLAG_SAMPLE_FLAGS=32,s.TFHD_FLAG_DUR_EMPTY=65536,s.TFHD_FLAG_DEFAULT_BASE_IS_MOOF=131072,s.TRUN_FLAGS_DATA_OFFSET=1,s.TRUN_FLAGS_FIRST_FLAG=4,s.TRUN_FLAGS_DURATION=256,s.TRUN_FLAGS_SIZE=512,s.TRUN_FLAGS_FLAGS=1024,s.TRUN_FLAGS_CTS_OFFSET=2048,s.Box.prototype.add=function(t){return this.addBox(new s[t+"Box"])},s.Box.prototype.addBox=function(t){return this.boxes.push(t),this[t.type+"s"]?this[t.type+"s"].push(t):this[t.type]=t,t},s.Box.prototype.set=function(t,e){return this[t]=e,this},s.Box.prototype.addEntry=function(t,e){var n=e||"entries";return this[n]||(this[n]=[]),this[n].push(t),this},r.BoxParser=s,s.parseUUID=function(t){return s.parseHex16(t)},s.parseHex16=function(t){for(var e="",n=0;n<16;n++){var o=t.readUint8().toString(16);e+=o.length===1?"0"+o:o}return e},s.parseOneBox=function(t,e,n){var o,l=t.getPosition(),u=0,c,_;if(t.getEndPosition()-l<8)return a.debug("BoxParser","Not enough data in stream to parse the type and size of the box"),{code:s.ERR_NOT_ENOUGH_DATA};if(n&&n<8)return a.debug("BoxParser","Not enough bytes left in the parent box to parse a new box"),{code:s.ERR_NOT_ENOUGH_DATA};var x=t.readUint32(),S=t.readString(4),w=S;if(a.debug("BoxParser","Found box of type '"+S+"' and size "+x+" at position "+l),u=8,S=="uuid"){if(t.getEndPosition()-t.getPosition()<16||n-u<16)return t.seek(l),a.debug("BoxParser","Not enough bytes left in the parent box to parse a UUID box"),{code:s.ERR_NOT_ENOUGH_DATA};_=s.parseUUID(t),u+=16,w=_}if(x==1){if(t.getEndPosition()-t.getPosition()<8||n&&n-u<8)return t.seek(l),a.warn("BoxParser",'Not enough data in stream to parse the extended size of the "'+S+'" box'),{code:s.ERR_NOT_ENOUGH_DATA};x=t.readUint64(),u+=8}else if(x===0){if(n)x=n;else if(S!=="mdat")return a.error("BoxParser","Unlimited box size not supported for type: '"+S+"'"),o=new s.Box(S,x),{code:s.OK,box:o,size:o.size}}return x!==0&&x<u?(a.error("BoxParser","Box of type "+S+" has an invalid size "+x+" (too small to be a box)"),{code:s.ERR_NOT_ENOUGH_DATA,type:S,size:x,hdr_size:u,start:l}):x!==0&&n&&x>n?(a.error("BoxParser","Box of type '"+S+"' has a size "+x+" greater than its container size "+n),{code:s.ERR_NOT_ENOUGH_DATA,type:S,size:x,hdr_size:u,start:l}):x!==0&&l+x>t.getEndPosition()?(t.seek(l),a.info("BoxParser","Not enough data in stream to parse the entire '"+S+"' box"),{code:s.ERR_NOT_ENOUGH_DATA,type:S,size:x,hdr_size:u,start:l}):e?{code:s.OK,type:S,size:x,hdr_size:u,start:l}:(s[S+"Box"]?o=new s[S+"Box"](x):S!=="uuid"?(a.warn("BoxParser","Unknown box type: '"+S+"'"),o=new s.Box(S,x),o.has_unparsed_data=!0):s.UUIDBoxes[_]?o=new s.UUIDBoxes[_](x):(a.warn("BoxParser","Unknown uuid type: '"+_+"'"),o=new s.Box(S,x),o.uuid=_,o.has_unparsed_data=!0),o.hdr_size=u,o.start=l,o.write===s.Box.prototype.write&&o.type!=="mdat"&&(a.info("BoxParser","'"+w+"' box writing not yet implemented, keeping unparsed data in memory for later write"),o.parseDataAndRewind(t)),o.parse(t),c=t.getPosition()-(o.start+o.size),c<0?(a.warn("BoxParser","Parsing of box '"+w+"' did not read the entire indicated box data size (missing "+-c+" bytes), seeking forward"),t.seek(o.start+o.size)):c>0&&(a.error("BoxParser","Parsing of box '"+w+"' read "+c+" more bytes than the indicated box data size, seeking backwards"),o.size!==0&&t.seek(o.start+o.size)),{code:s.OK,box:o,size:o.size})},s.Box.prototype.parse=function(t){this.type!="mdat"?this.data=t.readUint8Array(this.size-this.hdr_size):this.size===0?t.seek(t.getEndPosition()):t.seek(this.start+this.size)},s.Box.prototype.parseDataAndRewind=function(t){this.data=t.readUint8Array(this.size-this.hdr_size),t.position-=this.size-this.hdr_size},s.FullBox.prototype.parseDataAndRewind=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=4,t.position-=this.size-this.hdr_size},s.FullBox.prototype.parseFullHeader=function(t){this.version=t.readUint8(),this.flags=t.readUint24(),this.hdr_size+=4},s.FullBox.prototype.parse=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)},s.ContainerBox.prototype.parse=function(t){for(var e,n;t.getPosition()<this.start+this.size;)if(e=s.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),e.code===s.OK)if(n=e.box,this.boxes.push(n),this.subBoxNames&&this.subBoxNames.indexOf(n.type)!=-1)this[this.subBoxNames[this.subBoxNames.indexOf(n.type)]+"s"].push(n);else{var o=n.type!=="uuid"?n.type:n.uuid;this[o]?a.warn("Box of type "+o+" already stored in field of this type"):this[o]=n}else return},s.Box.prototype.parseLanguage=function(t){this.language=t.readUint16();var e=[];e[0]=this.language>>10&31,e[1]=this.language>>5&31,e[2]=this.language&31,this.languageString=String.fromCharCode(e[0]+96,e[1]+96,e[2]+96)},s.SAMPLE_ENTRY_TYPE_VISUAL="Visual",s.SAMPLE_ENTRY_TYPE_AUDIO="Audio",s.SAMPLE_ENTRY_TYPE_HINT="Hint",s.SAMPLE_ENTRY_TYPE_METADATA="Metadata",s.SAMPLE_ENTRY_TYPE_SUBTITLE="Subtitle",s.SAMPLE_ENTRY_TYPE_SYSTEM="System",s.SAMPLE_ENTRY_TYPE_TEXT="Text",s.SampleEntry.prototype.parseHeader=function(t){t.readUint8Array(6),this.data_reference_index=t.readUint16(),this.hdr_size+=8},s.SampleEntry.prototype.parse=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)},s.SampleEntry.prototype.parseDataAndRewind=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=8,t.position-=this.size-this.hdr_size},s.SampleEntry.prototype.parseFooter=function(t){s.ContainerBox.prototype.parse.call(this,t)},s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_HINT),s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_METADATA),s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE),s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SYSTEM),s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_TEXT),s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,function(t){var e;this.parseHeader(t),t.readUint16(),t.readUint16(),t.readUint32Array(3),this.width=t.readUint16(),this.height=t.readUint16(),this.horizresolution=t.readUint32(),this.vertresolution=t.readUint32(),t.readUint32(),this.frame_count=t.readUint16(),e=Math.min(31,t.readUint8()),this.compressorname=t.readString(e),e<31&&t.readString(31-e),this.depth=t.readUint16(),t.readUint16(),this.parseFooter(t)}),s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,function(t){this.parseHeader(t),t.readUint32Array(2),this.channel_count=t.readUint16(),this.samplesize=t.readUint16(),t.readUint16(),t.readUint16(),this.samplerate=t.readUint32()/65536,this.parseFooter(t)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"avc1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"avc2"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"avc3"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"avc4"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"av01"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"dav1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"hvc1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"hev1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"hvt1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"lhe1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"dvh1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"dvhe"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vvc1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vvi1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vvs1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vvcN"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vp08"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vp09"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"avs3"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"j2ki"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"mjp2"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"mjpg"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"uncv"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"mp4a"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"ac-3"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"ac-4"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"ec-3"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"Opus"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"mha1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"mha2"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"mhm1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"mhm2"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"fLaC"),s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"encv"),s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"enca"),s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE,"encu"),s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SYSTEM,"encs"),s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_TEXT,"enct"),s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_METADATA,"encm"),s.createBoxCtor("a1lx","AV1LayeredImageIndexingProperty",function(t){var e=t.readUint8()&1,n=((e&1)+1)*16;this.layer_size=[];for(var o=0;o<3;o++)n==16?this.layer_size[o]=t.readUint16():this.layer_size[o]=t.readUint32()}),s.createBoxCtor("a1op","OperatingPointSelectorProperty",function(t){this.op_index=t.readUint8()}),s.createFullBoxCtor("auxC","AuxiliaryTypeProperty",function(t){this.aux_type=t.readCString();var e=this.size-this.hdr_size-(this.aux_type.length+1);this.aux_subtype=t.readUint8Array(e)}),s.createBoxCtor("av1C","AV1CodecConfigurationBox",function(t){var e=t.readUint8();if((e>>7&1)!==1){a.error("av1C marker problem");return}if(this.version=e&127,this.version!==1){a.error("av1C version "+this.version+" not supported");return}if(e=t.readUint8(),this.seq_profile=e>>5&7,this.seq_level_idx_0=e&31,e=t.readUint8(),this.seq_tier_0=e>>7&1,this.high_bitdepth=e>>6&1,this.twelve_bit=e>>5&1,this.monochrome=e>>4&1,this.chroma_subsampling_x=e>>3&1,this.chroma_subsampling_y=e>>2&1,this.chroma_sample_position=e&3,e=t.readUint8(),this.reserved_1=e>>5&7,this.reserved_1!==0){a.error("av1C reserved_1 parsing problem");return}if(this.initial_presentation_delay_present=e>>4&1,this.initial_presentation_delay_present===1)this.initial_presentation_delay_minus_one=e&15;else if(this.reserved_2=e&15,this.reserved_2!==0){a.error("av1C reserved_2 parsing problem");return}var n=this.size-this.hdr_size-4;this.configOBUs=t.readUint8Array(n)});function m(t){var e="<table class='inner-table'>";e+="<thead><tr><th>length</th><th>nalu_data</th></tr></thead>",e+="<tbody>";for(var n=0;n<t.length;n++){var o=t[n];e+="<tr>",e+="<td>"+o.length+"</td>",e+="<td>",e+=o.nalu.reduce(function(l,u){return l+u.toString(16).padStart(2,"0")},"0x"),e+="</td></tr>"}return e+="</tbody></table>",e}s.createBoxCtor("avcC","AVCConfigurationBox",function(t){var e,n;for(this.configurationVersion=t.readUint8(),this.AVCProfileIndication=t.readUint8(),this.profile_compatibility=t.readUint8(),this.AVCLevelIndication=t.readUint8(),this.lengthSizeMinusOne=t.readUint8()&3,this.nb_SPS_nalus=t.readUint8()&31,n=this.size-this.hdr_size-6,this.SPS=[],this.SPS.toString=function(){return m(this)},e=0;e<this.nb_SPS_nalus;e++)this.SPS[e]={},this.SPS[e].length=t.readUint16(),this.SPS[e].nalu=t.readUint8Array(this.SPS[e].length),n-=2+this.SPS[e].length;for(this.nb_PPS_nalus=t.readUint8(),n--,this.PPS=[],this.PPS.toString=function(){return m(this)},e=0;e<this.nb_PPS_nalus;e++)this.PPS[e]={},this.PPS[e].length=t.readUint16(),this.PPS[e].nalu=t.readUint8Array(this.PPS[e].length),n-=2+this.PPS[e].length;n>0&&(this.ext=t.readUint8Array(n))}),s.createBoxCtor("btrt","BitRateBox",function(t){this.bufferSizeDB=t.readUint32(),this.maxBitrate=t.readUint32(),this.avgBitrate=t.readUint32()}),s.createFullBoxCtor("ccst","CodingConstraintsBox",function(t){var e=t.readUint8();this.all_ref_pics_intra=(e&128)==128,this.intra_pred_used=(e&64)==64,this.max_ref_per_pic=(e&63)>>2,t.readUint24()}),s.createBoxCtor("cdef","ComponentDefinitionBox",function(t){var e;for(this.channel_count=t.readUint16(),this.channel_indexes=[],this.channel_types=[],this.channel_associations=[],e=0;e<this.channel_count;e++)this.channel_indexes.push(t.readUint16()),this.channel_types.push(t.readUint16()),this.channel_associations.push(t.readUint16())}),s.createBoxCtor("clap","CleanApertureBox",function(t){this.cleanApertureWidthN=t.readUint32(),this.cleanApertureWidthD=t.readUint32(),this.cleanApertureHeightN=t.readUint32(),this.cleanApertureHeightD=t.readUint32(),this.horizOffN=t.readUint32(),this.horizOffD=t.readUint32(),this.vertOffN=t.readUint32(),this.vertOffD=t.readUint32()}),s.createBoxCtor("clli","ContentLightLevelBox",function(t){this.max_content_light_level=t.readUint16(),this.max_pic_average_light_level=t.readUint16()}),s.createFullBoxCtor("cmex","CameraExtrinsicMatrixProperty",function(t){this.flags&1&&(this.pos_x=t.readInt32()),this.flags&2&&(this.pos_y=t.readInt32()),this.flags&4&&(this.pos_z=t.readInt32()),this.flags&8&&(this.version==0?this.flags&16?(this.quat_x=t.readInt32(),this.quat_y=t.readInt32(),this.quat_z=t.readInt32()):(this.quat_x=t.readInt16(),this.quat_y=t.readInt16(),this.quat_z=t.readInt16()):this.version==1),this.flags&32&&(this.id=t.readUint32())}),s.createFullBoxCtor("cmin","CameraIntrinsicMatrixProperty",function(t){this.focal_length_x=t.readInt32(),this.principal_point_x=t.readInt32(),this.principal_point_y=t.readInt32(),this.flags&1&&(this.focal_length_y=t.readInt32(),this.skew_factor=t.readInt32())}),s.createBoxCtor("cmpd","ComponentDefinitionBox",function(t){for(this.component_count=t.readUint32(),this.component_types=[],this.component_type_urls=[],i=0;i<this.component_count;i++){var e=t.readUint16();this.component_types.push(e),e>=32768&&this.component_type_urls.push(t.readCString())}}),s.createFullBoxCtor("co64","ChunkLargeOffsetBox",function(t){var e,n;if(e=t.readUint32(),this.chunk_offsets=[],this.version===0)for(n=0;n<e;n++)this.chunk_offsets.push(t.readUint64())}),s.createFullBoxCtor("CoLL","ContentLightLevelBox",function(t){this.maxCLL=t.readUint16(),this.maxFALL=t.readUint16()}),s.createBoxCtor("colr","ColourInformationBox",function(t){if(this.colour_type=t.readString(4),this.colour_type==="nclx"){this.colour_primaries=t.readUint16(),this.transfer_characteristics=t.readUint16(),this.matrix_coefficients=t.readUint16();var e=t.readUint8();this.full_range_flag=e>>7}else this.colour_type==="rICC"?this.ICC_profile=t.readUint8Array(this.size-4):this.colour_type==="prof"&&(this.ICC_profile=t.readUint8Array(this.size-4))}),s.createFullBoxCtor("cprt","CopyrightBox",function(t){this.parseLanguage(t),this.notice=t.readCString()}),s.createFullBoxCtor("cslg","CompositionToDecodeBox",function(t){this.version===0&&(this.compositionToDTSShift=t.readInt32(),this.leastDecodeToDisplayDelta=t.readInt32(),this.greatestDecodeToDisplayDelta=t.readInt32(),this.compositionStartTime=t.readInt32(),this.compositionEndTime=t.readInt32())}),s.createFullBoxCtor("ctts","CompositionOffsetBox",function(t){var e,n;if(e=t.readUint32(),this.sample_counts=[],this.sample_offsets=[],this.version===0)for(n=0;n<e;n++){this.sample_counts.push(t.readUint32());var o=t.readInt32();o<0&&a.warn("BoxParser","ctts box uses negative values without using version 1"),this.sample_offsets.push(o)}else if(this.version==1)for(n=0;n<e;n++)this.sample_counts.push(t.readUint32()),this.sample_offsets.push(t.readInt32())}),s.createBoxCtor("dac3","AC3SpecificBox",function(t){var e=t.readUint8(),n=t.readUint8(),o=t.readUint8();this.fscod=e>>6,this.bsid=e>>1&31,this.bsmod=(e&1)<<2|n>>6&3,this.acmod=n>>3&7,this.lfeon=n>>2&1,this.bit_rate_code=n&3|o>>5&7}),s.createBoxCtor("dec3","EC3SpecificBox",function(t){var e=t.readUint16();this.data_rate=e>>3,this.num_ind_sub=e&7,this.ind_subs=[];for(var n=0;n<this.num_ind_sub+1;n++){var o={};this.ind_subs.push(o);var l=t.readUint8(),u=t.readUint8(),c=t.readUint8();o.fscod=l>>6,o.bsid=l>>1&31,o.bsmod=(l&1)<<4|u>>4&15,o.acmod=u>>1&7,o.lfeon=u&1,o.num_dep_sub=c>>1&15,o.num_dep_sub>0&&(o.chan_loc=(c&1)<<8|t.readUint8())}}),s.createFullBoxCtor("dfLa","FLACSpecificBox",function(t){var e=127,n=128,o=[],l=["STREAMINFO","PADDING","APPLICATION","SEEKTABLE","VORBIS_COMMENT","CUESHEET","PICTURE","RESERVED"];do{var u=t.readUint8(),c=Math.min(u&e,l.length-1);if(c?t.readUint8Array(t.readUint24()):(t.readUint8Array(13),this.samplerate=t.readUint32()>>12,t.readUint8Array(20)),o.push(l[c]),u&n)break}while(!0);this.numMetadataBlocks=o.length+" ("+o.join(", ")+")"}),s.createBoxCtor("dimm","hintimmediateBytesSent",function(t){this.bytessent=t.readUint64()}),s.createBoxCtor("dmax","hintlongestpacket",function(t){this.time=t.readUint32()}),s.createBoxCtor("dmed","hintmediaBytesSent",function(t){this.bytessent=t.readUint64()}),s.createBoxCtor("dOps","OpusSpecificBox",function(t){if(this.Version=t.readUint8(),this.OutputChannelCount=t.readUint8(),this.PreSkip=t.readUint16(),this.InputSampleRate=t.readUint32(),this.OutputGain=t.readInt16(),this.ChannelMappingFamily=t.readUint8(),this.ChannelMappingFamily!==0){this.StreamCount=t.readUint8(),this.CoupledCount=t.readUint8(),this.ChannelMapping=[];for(var e=0;e<this.OutputChannelCount;e++)this.ChannelMapping[e]=t.readUint8()}}),s.createFullBoxCtor("dref","DataReferenceBox",function(t){var e,n;this.entries=[];for(var o=t.readUint32(),l=0;l<o;l++)if(e=s.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),e.code===s.OK)n=e.box,this.entries.push(n);else return}),s.createBoxCtor("drep","hintrepeatedBytesSent",function(t){this.bytessent=t.readUint64()}),s.createFullBoxCtor("elng","ExtendedLanguageBox",function(t){this.extended_language=t.readString(this.size-this.hdr_size)}),s.createFullBoxCtor("elst","EditListBox",function(t){this.entries=[];for(var e=t.readUint32(),n=0;n<e;n++){var o={};this.entries.push(o),this.version===1?(o.segment_duration=t.readUint64(),o.media_time=t.readInt64()):(o.segment_duration=t.readUint32(),o.media_time=t.readInt32()),o.media_rate_integer=t.readInt16(),o.media_rate_fraction=t.readInt16()}}),s.createFullBoxCtor("emsg","EventMessageBox",function(t){this.version==1?(this.timescale=t.readUint32(),this.presentation_time=t.readUint64(),this.event_duration=t.readUint32(),this.id=t.readUint32(),this.scheme_id_uri=t.readCString(),this.value=t.readCString()):(this.scheme_id_uri=t.readCString(),this.value=t.readCString(),this.timescale=t.readUint32(),this.presentation_time_delta=t.readUint32(),this.event_duration=t.readUint32(),this.id=t.readUint32());var e=this.size-this.hdr_size-(4*4+(this.scheme_id_uri.length+1)+(this.value.length+1));this.version==1&&(e-=4),this.message_data=t.readUint8Array(e)}),s.createEntityToGroupCtor=function(t,e){s[t+"Box"]=function(n){s.FullBox.call(this,t,n)},s[t+"Box"].prototype=new s.FullBox,s[t+"Box"].prototype.parse=function(n){if(this.parseFullHeader(n),e)e.call(this,n);else for(this.group_id=n.readUint32(),this.num_entities_in_group=n.readUint32(),this.entity_ids=[],i=0;i<this.num_entities_in_group;i++){var o=n.readUint32();this.entity_ids.push(o)}}},s.createEntityToGroupCtor("aebr"),s.createEntityToGroupCtor("afbr"),s.createEntityToGroupCtor("albc"),s.createEntityToGroupCtor("altr"),s.createEntityToGroupCtor("brst"),s.createEntityToGroupCtor("dobr"),s.createEntityToGroupCtor("eqiv"),s.createEntityToGroupCtor("favc"),s.createEntityToGroupCtor("fobr"),s.createEntityToGroupCtor("iaug"),s.createEntityToGroupCtor("pano"),s.createEntityToGroupCtor("slid"),s.createEntityToGroupCtor("ster"),s.createEntityToGroupCtor("tsyn"),s.createEntityToGroupCtor("wbbr"),s.createEntityToGroupCtor("prgr"),s.createEntityToGroupCtor("pymd",function(t){this.group_id=t.readUint32(),this.num_entities_in_group=t.readUint32(),this.entity_ids=[];for(var e=0;e<this.num_entities_in_group;e++){var n=t.readUint32();this.entity_ids.push(n)}for(this.tile_size_x=t.readUint16(),this.tile_size_y=t.readUint16(),this.layer_binning=[],this.tiles_in_layer_column_minus1=[],this.tiles_in_layer_row_minus1=[],e=0;e<this.num_entities_in_group;e++)this.layer_binning[e]=t.readUint16(),this.tiles_in_layer_row_minus1[e]=t.readUint16(),this.tiles_in_layer_column_minus1[e]=t.readUint16()}),s.createFullBoxCtor("esds","ElementaryStreamDescriptorBox",function(t){var e=t.readUint8Array(this.size-this.hdr_size);if(typeof v<"u"){var n=new v;this.esd=n.parseOneDescriptor(new f(e.buffer,0,f.BIG_ENDIAN))}}),s.createBoxCtor("fiel","FieldHandlingBox",function(t){this.fieldCount=t.readUint8(),this.fieldOrdering=t.readUint8()}),s.createBoxCtor("frma","OriginalFormatBox",function(t){this.data_format=t.readString(4)}),s.createBoxCtor("ftyp","FileTypeBox",function(t){var e=this.size-this.hdr_size;this.major_brand=t.readString(4),this.minor_version=t.readUint32(),e-=8,this.compatible_brands=[];for(var n=0;e>=4;)this.compatible_brands[n]=t.readString(4),e-=4,n++}),s.createFullBoxCtor("hdlr","HandlerBox",function(t){this.version===0&&(t.readUint32(),this.handler=t.readString(4),t.readUint32Array(3),this.name=t.readString(this.size-this.hdr_size-20),this.name[this.name.length-1]==="\0"&&(this.name=this.name.slice(0,-1)))}),s.createBoxCtor("hvcC","HEVCConfigurationBox",function(t){var e,n,o,l;this.configurationVersion=t.readUint8(),l=t.readUint8(),this.general_profile_space=l>>6,this.general_tier_flag=(l&32)>>5,this.general_profile_idc=l&31,this.general_profile_compatibility=t.readUint32(),this.general_constraint_indicator=t.readUint8Array(6),this.general_level_idc=t.readUint8(),this.min_spatial_segmentation_idc=t.readUint16()&4095,this.parallelismType=t.readUint8()&3,this.chroma_format_idc=t.readUint8()&3,this.bit_depth_luma_minus8=t.readUint8()&7,this.bit_depth_chroma_minus8=t.readUint8()&7,this.avgFrameRate=t.readUint16(),l=t.readUint8(),this.constantFrameRate=l>>6,this.numTemporalLayers=(l&13)>>3,this.temporalIdNested=(l&4)>>2,this.lengthSizeMinusOne=l&3,this.nalu_arrays=[],this.nalu_arrays.toString=function(){var S="<table class='inner-table'>";S+="<thead><tr><th>completeness</th><th>nalu_type</th><th>nalu_data</th></tr></thead>",S+="<tbody>";for(var w=0;w<this.length;w++){var C=this[w];S+="<tr>",S+="<td rowspan='"+C.length+"'>"+C.completeness+"</td>",S+="<td rowspan='"+C.length+"'>"+C.nalu_type+"</td>";for(var F=0;F<C.length;F++){var B=C[F];F!==0&&(S+="<tr>"),S+="<td>",S+=B.data.reduce(function(K,O){return K+O.toString(16).padStart(2,"0")},"0x"),S+="</td></tr>"}}return S+="</tbody></table>",S};var u=t.readUint8();for(e=0;e<u;e++){var c=[];this.nalu_arrays.push(c),l=t.readUint8(),c.completeness=(l&128)>>7,c.nalu_type=l&63;var _=t.readUint16();for(n=0;n<_;n++){var x={};c.push(x),o=t.readUint16(),x.data=t.readUint8Array(o)}}}),s.createFullBoxCtor("iinf","ItemInfoBox",function(t){var e;this.version===0?this.entry_count=t.readUint16():this.entry_count=t.readUint32(),this.item_infos=[];for(var n=0;n<this.entry_count;n++)if(e=s.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),e.code===s.OK)e.box.type!=="infe"&&a.error("BoxParser","Expected 'infe' box, got "+e.box.type),this.item_infos[n]=e.box;else return}),s.createFullBoxCtor("iloc","ItemLocationBox",function(t){var e;e=t.readUint8(),this.offset_size=e>>4&15,this.length_size=e&15,e=t.readUint8(),this.base_offset_size=e>>4&15,this.version===1||this.version===2?this.index_size=e&15:this.index_size=0,this.items=[];var n=0;if(this.version<2)n=t.readUint16();else if(this.version===2)n=t.readUint32();else throw"version of iloc box not supported";for(var o=0;o<n;o++){var l={};if(this.items.push(l),this.version<2)l.item_ID=t.readUint16();else if(this.version===2)l.item_ID=t.readUint32();else throw"version of iloc box not supported";switch(this.version===1||this.version===2?l.construction_method=t.readUint16()&15:l.construction_method=0,l.data_reference_index=t.readUint16(),this.base_offset_size){case 0:l.base_offset=0;break;case 4:l.base_offset=t.readUint32();break;case 8:l.base_offset=t.readUint64();break;default:throw"Error reading base offset size"}var u=t.readUint16();l.extents=[];for(var c=0;c<u;c++){var _={};if(l.extents.push(_),this.version===1||this.version===2)switch(this.index_size){case 0:_.extent_index=0;break;case 4:_.extent_index=t.readUint32();break;case 8:_.extent_index=t.readUint64();break;default:throw"Error reading extent index"}switch(this.offset_size){case 0:_.extent_offset=0;break;case 4:_.extent_offset=t.readUint32();break;case 8:_.extent_offset=t.readUint64();break;default:throw"Error reading extent index"}switch(this.length_size){case 0:_.extent_length=0;break;case 4:_.extent_length=t.readUint32();break;case 8:_.extent_length=t.readUint64();break;default:throw"Error reading extent index"}}}}),s.createBoxCtor("imir","ImageMirror",function(t){var e=t.readUint8();this.reserved=e>>7,this.axis=e&1}),s.createFullBoxCtor("infe","ItemInfoEntry",function(t){if((this.version===0||this.version===1)&&(this.item_ID=t.readUint16(),this.item_protection_index=t.readUint16(),this.item_name=t.readCString(),this.content_type=t.readCString(),this.content_encoding=t.readCString()),this.version===1){this.extension_type=t.readString(4),a.warn("BoxParser","Cannot parse extension type"),t.seek(this.start+this.size);return}this.version>=2&&(this.version===2?this.item_ID=t.readUint16():this.version===3&&(this.item_ID=t.readUint32()),this.item_protection_index=t.readUint16(),this.item_type=t.readString(4),this.item_name=t.readCString(),this.item_type==="mime"?(this.content_type=t.readCString(),this.content_encoding=t.readCString()):this.item_type==="uri "&&(this.item_uri_type=t.readCString()))}),s.createFullBoxCtor("ipma","ItemPropertyAssociationBox",function(t){var e,n;for(entry_count=t.readUint32(),this.associations=[],e=0;e<entry_count;e++){var o={};this.associations.push(o),this.version<1?o.id=t.readUint16():o.id=t.readUint32();var l=t.readUint8();for(o.props=[],n=0;n<l;n++){var u=t.readUint8(),c={};o.props.push(c),c.essential=(u&128)>>7===1,this.flags&1?c.property_index=(u&127)<<8|t.readUint8():c.property_index=u&127}}}),s.createFullBoxCtor("iref","ItemReferenceBox",function(t){var e,n;for(this.references=[];t.getPosition()<this.start+this.size;)if(e=s.parseOneBox(t,!0,this.size-(t.getPosition()-this.start)),e.code===s.OK)this.version===0?n=new s.SingleItemTypeReferenceBox(e.type,e.size,e.hdr_size,e.start):n=new s.SingleItemTypeReferenceBoxLarge(e.type,e.size,e.hdr_size,e.start),n.write===s.Box.prototype.write&&n.type!=="mdat"&&(a.warn("BoxParser",n.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),n.parseDataAndRewind(t)),n.parse(t),this.references.push(n);else return}),s.createBoxCtor("irot","ImageRotation",function(t){this.angle=t.readUint8()&3}),s.createFullBoxCtor("ispe","ImageSpatialExtentsProperty",function(t){this.image_width=t.readUint32(),this.image_height=t.readUint32()}),s.createFullBoxCtor("kind","KindBox",function(t){this.schemeURI=t.readCString(),this.value=t.readCString()}),s.createFullBoxCtor("leva","LevelAssignmentBox",function(t){var e=t.readUint8();this.levels=[];for(var n=0;n<e;n++){var o={};this.levels[n]=o,o.track_ID=t.readUint32();var l=t.readUint8();switch(o.padding_flag=l>>7,o.assignment_type=l&127,o.assignment_type){case 0:o.grouping_type=t.readString(4);break;case 1:o.grouping_type=t.readString(4),o.grouping_type_parameter=t.readUint32();break;case 2:break;case 3:break;case 4:o.sub_track_id=t.readUint32();break;default:a.warn("BoxParser","Unknown leva assignement type")}}}),s.createBoxCtor("lhvC","LHEVCConfigurationBox",function(t){var e,n,o;this.configurationVersion=t.readUint8(),this.min_spatial_segmentation_idc=t.readUint16()&4095,this.parallelismType=t.readUint8()&3,o=t.readUint8(),this.numTemporalLayers=(o&13)>>3,this.temporalIdNested=(o&4)>>2,this.lengthSizeMinusOne=o&3,this.nalu_arrays=[],this.nalu_arrays.toString=function(){var S="<table class='inner-table'>";S+="<thead><tr><th>completeness</th><th>nalu_type</th><th>nalu_data</th></tr></thead>",S+="<tbody>";for(var w=0;w<this.length;w++){var C=this[w];S+="<tr>",S+="<td rowspan='"+C.length+"'>"+C.completeness+"</td>",S+="<td rowspan='"+C.length+"'>"+C.nalu_type+"</td>";for(var F=0;F<C.length;F++){var B=C[F];F!==0&&(S+="<tr>"),S+="<td>",S+=B.data.reduce(function(K,O){return K+O.toString(16).padStart(2,"0")},"0x"),S+="</td></tr>"}}return S+="</tbody></table>",S};var l=t.readUint8();for(e=0;e<l;e++){var u=[];this.nalu_arrays.push(u),o=t.readUint8(),u.completeness=(o&128)>>7,u.nalu_type=o&63;var c=t.readUint16();for(n=0;n<c;n++){var _={};u.push(_);var x=t.readUint16();_.data=t.readUint8Array(x)}}}),s.createBoxCtor("lsel","LayerSelectorProperty",function(t){this.layer_id=t.readUint16()}),s.createBoxCtor("maxr","hintmaxrate",function(t){this.period=t.readUint32(),this.bytes=t.readUint32()});function y(t,e){this.x=t,this.y=e}y.prototype.toString=function(){return"("+this.x+","+this.y+")"},s.createBoxCtor("mdcv","MasteringDisplayColourVolumeBox",function(t){this.display_primaries=[],this.display_primaries[0]=new y(t.readUint16(),t.readUint16()),this.display_primaries[1]=new y(t.readUint16(),t.readUint16()),this.display_primaries[2]=new y(t.readUint16(),t.readUint16()),this.white_point=new y(t.readUint16(),t.readUint16()),this.max_display_mastering_luminance=t.readUint32(),this.min_display_mastering_luminance=t.readUint32()}),s.createFullBoxCtor("mdhd","MediaHeaderBox",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.parseLanguage(t),t.readUint16()}),s.createFullBoxCtor("mehd","MovieExtendsHeaderBox",function(t){this.flags&1&&(a.warn("BoxParser","mehd box incorrectly uses flags set to 1, converting version to 1"),this.version=1),this.version==1?this.fragment_duration=t.readUint64():this.fragment_duration=t.readUint32()}),s.createFullBoxCtor("meta","MetaBox",function(t){this.boxes=[],s.ContainerBox.prototype.parse.call(this,t)}),s.createFullBoxCtor("mfhd","MovieFragmentHeaderBox",function(t){this.sequence_number=t.readUint32()}),s.createFullBoxCtor("mfro","MovieFragmentRandomAccessOffsetBox",function(t){this._size=t.readUint32()}),s.createFullBoxCtor("mskC","MaskConfigurationProperty",function(t){this.bits_per_pixel=t.readUint8()}),s.createFullBoxCtor("mvhd","MovieHeaderBox",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.rate=t.readUint32(),this.volume=t.readUint16()>>8,t.readUint16(),t.readUint32Array(2),this.matrix=t.readUint32Array(9),t.readUint32Array(6),this.next_track_id=t.readUint32()}),s.createBoxCtor("npck","hintPacketsSent",function(t){this.packetssent=t.readUint32()}),s.createBoxCtor("nump","hintPacketsSent",function(t){this.packetssent=t.readUint64()}),s.createFullBoxCtor("padb","PaddingBitsBox",function(t){var e=t.readUint32();this.padbits=[];for(var n=0;n<Math.floor((e+1)/2);n++)this.padbits=t.readUint8()}),s.createBoxCtor("pasp","PixelAspectRatioBox",function(t){this.hSpacing=t.readUint32(),this.vSpacing=t.readUint32()}),s.createBoxCtor("payl","CuePayloadBox",function(t){this.text=t.readString(this.size-this.hdr_size)}),s.createBoxCtor("payt","hintpayloadID",function(t){this.payloadID=t.readUint32();var e=t.readUint8();this.rtpmap_string=t.readString(e)}),s.createFullBoxCtor("pdin","ProgressiveDownloadInfoBox",function(t){var e=(this.size-this.hdr_size)/8;this.rate=[],this.initial_delay=[];for(var n=0;n<e;n++)this.rate[n]=t.readUint32(),this.initial_delay[n]=t.readUint32()}),s.createFullBoxCtor("pitm","PrimaryItemBox",function(t){this.version===0?this.item_id=t.readUint16():this.item_id=t.readUint32()}),s.createFullBoxCtor("pixi","PixelInformationProperty",function(t){var e;for(this.num_channels=t.readUint8(),this.bits_per_channels=[],e=0;e<this.num_channels;e++)this.bits_per_channels[e]=t.readUint8()}),s.createBoxCtor("pmax","hintlargestpacket",function(t){this.bytes=t.readUint32()}),s.createFullBoxCtor("prdi","ProgressiveDerivedImageItemInformationProperty",function(t){if(this.step_count=t.readUint16(),this.item_count=[],this.flags&2)for(var e=0;e<this.step_count;e++)this.item_count[e]=t.readUint16()}),s.createFullBoxCtor("prft","ProducerReferenceTimeBox",function(t){this.ref_track_id=t.readUint32(),this.ntp_timestamp=t.readUint64(),this.version===0?this.media_time=t.readUint32():this.media_time=t.readUint64()}),s.createFullBoxCtor("pssh","ProtectionSystemSpecificHeaderBox",function(t){if(this.system_id=s.parseHex16(t),this.version>0){var e=t.readUint32();this.kid=[];for(var n=0;n<e;n++)this.kid[n]=s.parseHex16(t)}var o=t.readUint32();o>0&&(this.data=t.readUint8Array(o))}),s.createFullBoxCtor("clef","TrackCleanApertureDimensionsBox",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),s.createFullBoxCtor("enof","TrackEncodedPixelsDimensionsBox",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),s.createFullBoxCtor("prof","TrackProductionApertureDimensionsBox",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),s.createContainerBoxCtor("tapt","TrackApertureModeDimensionsBox",null,["clef","prof","enof"]),s.createBoxCtor("rtp ","rtpmoviehintinformation",function(t){this.descriptionformat=t.readString(4),this.sdptext=t.readString(this.size-this.hdr_size-4)}),s.createFullBoxCtor("saio","SampleAuxiliaryInformationOffsetsBox",function(t){this.flags&1&&(this.aux_info_type=t.readString(4),this.aux_info_type_parameter=t.readUint32());var e=t.readUint32();this.offset=[];for(var n=0;n<e;n++)this.version===0?this.offset[n]=t.readUint32():this.offset[n]=t.readUint64()}),s.createFullBoxCtor("saiz","SampleAuxiliaryInformationSizesBox",function(t){if(this.flags&1&&(this.aux_info_type=t.readString(4),this.aux_info_type_parameter=t.readUint32()),this.default_sample_info_size=t.readUint8(),this.sample_count=t.readUint32(),this.sample_info_size=[],this.default_sample_info_size===0)for(var e=0;e<this.sample_count;e++)this.sample_info_size[e]=t.readUint8()}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_METADATA,"mett",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_METADATA,"metx",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.parseFooter(t)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE,"sbtt",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE,"stpp",function(t){this.parseHeader(t),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.auxiliary_mime_types=t.readCString(),this.parseFooter(t)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE,"stxt",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE,"tx3g",function(t){this.parseHeader(t),this.displayFlags=t.readUint32(),this.horizontal_justification=t.readInt8(),this.vertical_justification=t.readInt8(),this.bg_color_rgba=t.readUint8Array(4),this.box_record=t.readInt16Array(4),this.style_record=t.readUint8Array(12),this.parseFooter(t)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_METADATA,"wvtt",function(t){this.parseHeader(t),this.parseFooter(t)}),s.createSampleGroupCtor("alst",function(t){var e,n=t.readUint16();for(this.first_output_sample=t.readUint16(),this.sample_offset=[],e=0;e<n;e++)this.sample_offset[e]=t.readUint32();var o=this.description_length-4-4*n;for(this.num_output_samples=[],this.num_total_samples=[],e=0;e<o/4;e++)this.num_output_samples[e]=t.readUint16(),this.num_total_samples[e]=t.readUint16()}),s.createSampleGroupCtor("avll",function(t){this.layerNumber=t.readUint8(),this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()}),s.createSampleGroupCtor("avss",function(t){this.subSequenceIdentifier=t.readUint16(),this.layerNumber=t.readUint8();var e=t.readUint8();this.durationFlag=e>>7,this.avgRateFlag=e>>6&1,this.durationFlag&&(this.duration=t.readUint32()),this.avgRateFlag&&(this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()),this.dependency=[];for(var n=t.readUint8(),o=0;o<n;o++){var l={};this.dependency.push(l),l.subSeqDirectionFlag=t.readUint8(),l.layerNumber=t.readUint8(),l.subSequenceIdentifier=t.readUint16()}}),s.createSampleGroupCtor("dtrt",function(t){a.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("mvif",function(t){a.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("prol",function(t){this.roll_distance=t.readInt16()}),s.createSampleGroupCtor("rap ",function(t){var e=t.readUint8();this.num_leading_samples_known=e>>7,this.num_leading_samples=e&127}),s.createSampleGroupCtor("rash",function(t){if(this.operation_point_count=t.readUint16(),this.description_length!==2+(this.operation_point_count===1?2:this.operation_point_count*6)+9)a.warn("BoxParser","Mismatch in "+this.grouping_type+" sample group length"),this.data=t.readUint8Array(this.description_length-2);else{if(this.operation_point_count===1)this.target_rate_share=t.readUint16();else{this.target_rate_share=[],this.available_bitrate=[];for(var e=0;e<this.operation_point_count;e++)this.available_bitrate[e]=t.readUint32(),this.target_rate_share[e]=t.readUint16()}this.maximum_bitrate=t.readUint32(),this.minimum_bitrate=t.readUint32(),this.discard_priority=t.readUint8()}}),s.createSampleGroupCtor("roll",function(t){this.roll_distance=t.readInt16()}),s.SampleGroupEntry.prototype.parse=function(t){a.warn("BoxParser","Unknown Sample Group type: "+this.grouping_type),this.data=t.readUint8Array(this.description_length)},s.createSampleGroupCtor("scif",function(t){a.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("scnm",function(t){a.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("seig",function(t){this.reserved=t.readUint8();var e=t.readUint8();this.crypt_byte_block=e>>4,this.skip_byte_block=e&15,this.isProtected=t.readUint8(),this.Per_Sample_IV_Size=t.readUint8(),this.KID=s.parseHex16(t),this.constant_IV_size=0,this.constant_IV=0,this.isProtected===1&&this.Per_Sample_IV_Size===0&&(this.constant_IV_size=t.readUint8(),this.constant_IV=t.readUint8Array(this.constant_IV_size))}),s.createSampleGroupCtor("stsa",function(t){a.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("sync",function(t){var e=t.readUint8();this.NAL_unit_type=e&63}),s.createSampleGroupCtor("tele",function(t){var e=t.readUint8();this.level_independently_decodable=e>>7}),s.createSampleGroupCtor("tsas",function(t){a.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("tscl",function(t){a.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("vipr",function(t){a.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createFullBoxCtor("sbgp","SampleToGroupBox",function(t){this.grouping_type=t.readString(4),this.version===1?this.grouping_type_parameter=t.readUint32():this.grouping_type_parameter=0,this.entries=[];for(var e=t.readUint32(),n=0;n<e;n++){var o={};this.entries.push(o),o.sample_count=t.readInt32(),o.group_description_index=t.readInt32()}});function E(t,e){this.bad_pixel_row=t,this.bad_pixel_column=e}E.prototype.toString=function(){return"[row: "+this.bad_pixel_row+", column: "+this.bad_pixel_column+"]"},s.createFullBoxCtor("sbpm","SensorBadPixelsMapBox",function(t){var e;for(this.component_count=t.readUint16(),this.component_index=[],e=0;e<this.component_count;e++)this.component_index.push(t.readUint16());var n=t.readUint8();for(this.correction_applied=(n&128)==128,this.num_bad_rows=t.readUint32(),this.num_bad_cols=t.readUint32(),this.num_bad_pixels=t.readUint32(),this.bad_rows=[],this.bad_columns=[],this.bad_pixels=[],e=0;e<this.num_bad_rows;e++)this.bad_rows.push(t.readUint32());for(e=0;e<this.num_bad_cols;e++)this.bad_columns.push(t.readUint32());for(e=0;e<this.num_bad_pixels;e++){var o=t.readUint32(),l=t.readUint32();this.bad_pixels.push(new E(o,l))}}),s.createFullBoxCtor("schm","SchemeTypeBox",function(t){this.scheme_type=t.readString(4),this.scheme_version=t.readUint32(),this.flags&1&&(this.scheme_uri=t.readString(this.size-this.hdr_size-8))}),s.createBoxCtor("sdp ","rtptracksdphintinformation",function(t){this.sdptext=t.readString(this.size-this.hdr_size)}),s.createFullBoxCtor("sdtp","SampleDependencyTypeBox",function(t){var e,n=this.size-this.hdr_size;this.is_leading=[],this.sample_depends_on=[],this.sample_is_depended_on=[],this.sample_has_redundancy=[];for(var o=0;o<n;o++)e=t.readUint8(),this.is_leading[o]=e>>6,this.sample_depends_on[o]=e>>4&3,this.sample_is_depended_on[o]=e>>2&3,this.sample_has_redundancy[o]=e&3}),s.createFullBoxCtor("senc","SampleEncryptionBox"),s.createFullBoxCtor("sgpd","SampleGroupDescriptionBox",function(t){this.grouping_type=t.readString(4),a.debug("BoxParser","Found Sample Groups of type "+this.grouping_type),this.version===1?this.default_length=t.readUint32():this.default_length=0,this.version>=2&&(this.default_group_description_index=t.readUint32()),this.entries=[];for(var e=t.readUint32(),n=0;n<e;n++){var o;s[this.grouping_type+"SampleGroupEntry"]?o=new s[this.grouping_type+"SampleGroupEntry"](this.grouping_type):o=new s.SampleGroupEntry(this.grouping_type),this.entries.push(o),this.version===1?this.default_length===0?o.description_length=t.readUint32():o.description_length=this.default_length:o.description_length=this.default_length,o.write===s.SampleGroupEntry.prototype.write&&(a.info("BoxParser","SampleGroup for type "+this.grouping_type+" writing not yet implemented, keeping unparsed data in memory for later write"),o.data=t.readUint8Array(o.description_length),t.position-=o.description_length),o.parse(t)}}),s.createFullBoxCtor("sidx","CompressedSegmentIndexBox",function(t){this.reference_ID=t.readUint32(),this.timescale=t.readUint32(),this.version===0?(this.earliest_presentation_time=t.readUint32(),this.first_offset=t.readUint32()):(this.earliest_presentation_time=t.readUint64(),this.first_offset=t.readUint64()),t.readUint16(),this.references=[];for(var e=t.readUint16(),n=0;n<e;n++){var o={};this.references.push(o);var l=t.readUint32();o.reference_type=l>>31&1,o.referenced_size=l&2147483647,o.subsegment_duration=t.readUint32(),l=t.readUint32(),o.starts_with_SAP=l>>31&1,o.SAP_type=l>>28&7,o.SAP_delta_time=l&268435455}}),s.SingleItemTypeReferenceBox=function(t,e,n,o){s.Box.call(this,t,e),this.hdr_size=n,this.start=o},s.SingleItemTypeReferenceBox.prototype=new s.Box,s.SingleItemTypeReferenceBox.prototype.parse=function(t){this.from_item_ID=t.readUint16();var e=t.readUint16();this.references=[];for(var n=0;n<e;n++)this.references[n]={},this.references[n].to_item_ID=t.readUint16()},s.SingleItemTypeReferenceBoxLarge=function(t,e,n,o){s.Box.call(this,t,e),this.hdr_size=n,this.start=o},s.SingleItemTypeReferenceBoxLarge.prototype=new s.Box,s.SingleItemTypeReferenceBoxLarge.prototype.parse=function(t){this.from_item_ID=t.readUint32();var e=t.readUint16();this.references=[];for(var n=0;n<e;n++)this.references[n]={},this.references[n].to_item_ID=t.readUint32()},s.createFullBoxCtor("SmDm","SMPTE2086MasteringDisplayMetadataBox",function(t){this.primaryRChromaticity_x=t.readUint16(),this.primaryRChromaticity_y=t.readUint16(),this.primaryGChromaticity_x=t.readUint16(),this.primaryGChromaticity_y=t.readUint16(),this.primaryBChromaticity_x=t.readUint16(),this.primaryBChromaticity_y=t.readUint16(),this.whitePointChromaticity_x=t.readUint16(),this.whitePointChromaticity_y=t.readUint16(),this.luminanceMax=t.readUint32(),this.luminanceMin=t.readUint32()}),s.createFullBoxCtor("smhd","SoundMediaHeaderBox",function(t){this.balance=t.readUint16(),t.readUint16()}),s.createFullBoxCtor("ssix","CompressedSubsegmentIndexBox",function(t){this.subsegments=[];for(var e=t.readUint32(),n=0;n<e;n++){var o={};this.subsegments.push(o),o.ranges=[];for(var l=t.readUint32(),u=0;u<l;u++){var c={};o.ranges.push(c),c.level=t.readUint8(),c.range_size=t.readUint24()}}}),s.createFullBoxCtor("stco","ChunkOffsetBox",function(t){var e;if(e=t.readUint32(),this.chunk_offsets=[],this.version===0)for(var n=0;n<e;n++)this.chunk_offsets.push(t.readUint32())}),s.createFullBoxCtor("stdp","DegradationPriorityBox",function(t){var e=(this.size-this.hdr_size)/2;this.priority=[];for(var n=0;n<e;n++)this.priority[n]=t.readUint16()}),s.createFullBoxCtor("sthd","SubtitleMediaHeaderBox"),s.createFullBoxCtor("stri","SubTrackInformationBox",function(t){this.switch_group=t.readUint16(),this.alternate_group=t.readUint16(),this.sub_track_id=t.readUint32();var e=(this.size-this.hdr_size-8)/4;this.attribute_list=[];for(var n=0;n<e;n++)this.attribute_list[n]=t.readUint32()}),s.createFullBoxCtor("stsc","SampleToChunkBox",function(t){var e,n;if(e=t.readUint32(),this.first_chunk=[],this.samples_per_chunk=[],this.sample_description_index=[],this.version===0)for(n=0;n<e;n++)this.first_chunk.push(t.readUint32()),this.samples_per_chunk.push(t.readUint32()),this.sample_description_index.push(t.readUint32())}),s.createFullBoxCtor("stsd","SampleDescriptionBox",function(t){var e,n,o,l;for(this.entries=[],o=t.readUint32(),e=1;e<=o;e++)if(n=s.parseOneBox(t,!0,this.size-(t.getPosition()-this.start)),n.code===s.OK)s[n.type+"SampleEntry"]?(l=new s[n.type+"SampleEntry"](n.size),l.hdr_size=n.hdr_size,l.start=n.start):(a.warn("BoxParser","Unknown sample entry type: "+n.type),l=new s.SampleEntry(n.type,n.size,n.hdr_size,n.start)),l.write===s.SampleEntry.prototype.write&&(a.info("BoxParser","SampleEntry "+l.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),l.parseDataAndRewind(t)),l.parse(t),this.entries.push(l);else return}),s.createFullBoxCtor("stsg","SubTrackSampleGroupBox",function(t){this.grouping_type=t.readUint32();var e=t.readUint16();this.group_description_index=[];for(var n=0;n<e;n++)this.group_description_index[n]=t.readUint32()}),s.createFullBoxCtor("stsh","ShadowSyncSampleBox",function(t){var e,n;if(e=t.readUint32(),this.shadowed_sample_numbers=[],this.sync_sample_numbers=[],this.version===0)for(n=0;n<e;n++)this.shadowed_sample_numbers.push(t.readUint32()),this.sync_sample_numbers.push(t.readUint32())}),s.createFullBoxCtor("stss","SyncSampleBox",function(t){var e,n;if(n=t.readUint32(),this.version===0)for(this.sample_numbers=[],e=0;e<n;e++)this.sample_numbers.push(t.readUint32())}),s.createFullBoxCtor("stsz","SampleSizeBox",function(t){var e;if(this.sample_sizes=[],this.version===0)for(this.sample_size=t.readUint32(),this.sample_count=t.readUint32(),e=0;e<this.sample_count;e++)this.sample_size===0?this.sample_sizes.push(t.readUint32()):this.sample_sizes[e]=this.sample_size}),s.createFullBoxCtor("stts","TimeToSampleBox",function(t){var e,n,o;if(e=t.readUint32(),this.sample_counts=[],this.sample_deltas=[],this.version===0)for(n=0;n<e;n++)this.sample_counts.push(t.readUint32()),o=t.readInt32(),o<0&&(a.warn("BoxParser","File uses negative stts sample delta, using value 1 instead, sync may be lost!"),o=1),this.sample_deltas.push(o)}),s.createFullBoxCtor("stvi","StereoVideoBox",function(t){var e=t.readUint32();this.single_view_allowed=e&3,this.stereo_scheme=t.readUint32();var n=t.readUint32();this.stereo_indication_type=t.readString(n);var o,l;for(this.boxes=[];t.getPosition()<this.start+this.size;)if(o=s.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),o.code===s.OK)l=o.box,this.boxes.push(l),this[l.type]=l;else return}),s.createBoxCtor("styp","SegmentTypeBox",function(t){s.ftypBox.prototype.parse.call(this,t)}),s.createFullBoxCtor("stz2","CompactSampleSizeBox",function(t){var e,n;if(this.sample_sizes=[],this.version===0)if(this.reserved=t.readUint24(),this.field_size=t.readUint8(),n=t.readUint32(),this.field_size===4)for(e=0;e<n;e+=2){var o=t.readUint8();this.sample_sizes[e]=o>>4&15,this.sample_sizes[e+1]=o&15}else if(this.field_size===8)for(e=0;e<n;e++)this.sample_sizes[e]=t.readUint8();else if(this.field_size===16)for(e=0;e<n;e++)this.sample_sizes[e]=t.readUint16();else a.error("BoxParser","Error in length field in stz2 box")}),s.createFullBoxCtor("subs","SubSampleInformationBox",function(t){var e,n,o,l;for(o=t.readUint32(),this.entries=[],e=0;e<o;e++){var u={};if(this.entries[e]=u,u.sample_delta=t.readUint32(),u.subsamples=[],l=t.readUint16(),l>0)for(n=0;n<l;n++){var c={};u.subsamples.push(c),this.version==1?c.size=t.readUint32():c.size=t.readUint16(),c.priority=t.readUint8(),c.discardable=t.readUint8(),c.codec_specific_parameters=t.readUint32()}}}),s.createFullBoxCtor("tenc","TrackEncryptionBox",function(t){if(t.readUint8(),this.version===0)t.readUint8();else{var e=t.readUint8();this.default_crypt_byte_block=e>>4&15,this.default_skip_byte_block=e&15}this.default_isProtected=t.readUint8(),this.default_Per_Sample_IV_Size=t.readUint8(),this.default_KID=s.parseHex16(t),this.default_isProtected===1&&this.default_Per_Sample_IV_Size===0&&(this.default_constant_IV_size=t.readUint8(),this.default_constant_IV=t.readUint8Array(this.default_constant_IV_size))}),s.createFullBoxCtor("tfdt","TrackFragmentBaseMediaDecodeTimeBox",function(t){this.version==1?this.baseMediaDecodeTime=t.readUint64():this.baseMediaDecodeTime=t.readUint32()}),s.createFullBoxCtor("tfhd","TrackFragmentHeaderBox",function(t){var e=0;this.track_id=t.readUint32(),this.size-this.hdr_size>e&&this.flags&s.TFHD_FLAG_BASE_DATA_OFFSET?(this.base_data_offset=t.readUint64(),e+=8):this.base_data_offset=0,this.size-this.hdr_size>e&&this.flags&s.TFHD_FLAG_SAMPLE_DESC?(this.default_sample_description_index=t.readUint32(),e+=4):this.default_sample_description_index=0,this.size-this.hdr_size>e&&this.flags&s.TFHD_FLAG_SAMPLE_DUR?(this.default_sample_duration=t.readUint32(),e+=4):this.default_sample_duration=0,this.size-this.hdr_size>e&&this.flags&s.TFHD_FLAG_SAMPLE_SIZE?(this.default_sample_size=t.readUint32(),e+=4):this.default_sample_size=0,this.size-this.hdr_size>e&&this.flags&s.TFHD_FLAG_SAMPLE_FLAGS?(this.default_sample_flags=t.readUint32(),e+=4):this.default_sample_flags=0}),s.createFullBoxCtor("tfra","TrackFragmentRandomAccessBox",function(t){this.track_ID=t.readUint32(),t.readUint24();var e=t.readUint8();this.length_size_of_traf_num=e>>4&3,this.length_size_of_trun_num=e>>2&3,this.length_size_of_sample_num=e&3,this.entries=[];for(var n=t.readUint32(),o=0;o<n;o++)this.version===1?(this.time=t.readUint64(),this.moof_offset=t.readUint64()):(this.time=t.readUint32(),this.moof_offset=t.readUint32()),this.traf_number=t["readUint"+8*(this.length_size_of_traf_num+1)](),this.trun_number=t["readUint"+8*(this.length_size_of_trun_num+1)](),this.sample_number=t["readUint"+8*(this.length_size_of_sample_num+1)]()}),s.createFullBoxCtor("tkhd","TrackHeaderBox",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint32()),t.readUint32Array(2),this.layer=t.readInt16(),this.alternate_group=t.readInt16(),this.volume=t.readInt16()>>8,t.readUint16(),this.matrix=t.readInt32Array(9),this.width=t.readUint32(),this.height=t.readUint32()}),s.createBoxCtor("tmax","hintmaxrelativetime",function(t){this.time=t.readUint32()}),s.createBoxCtor("tmin","hintminrelativetime",function(t){this.time=t.readUint32()}),s.createBoxCtor("totl","hintBytesSent",function(t){this.bytessent=t.readUint32()}),s.createBoxCtor("tpay","hintBytesSent",function(t){this.bytessent=t.readUint32()}),s.createBoxCtor("tpyl","hintBytesSent",function(t){this.bytessent=t.readUint64()}),s.TrackGroupTypeBox.prototype.parse=function(t){this.parseFullHeader(t),this.track_group_id=t.readUint32()},s.createTrackGroupCtor("msrc"),s.TrackReferenceTypeBox=function(t,e,n,o){s.Box.call(this,t,e),this.hdr_size=n,this.start=o},s.TrackReferenceTypeBox.prototype=new s.Box,s.TrackReferenceTypeBox.prototype.parse=function(t){this.track_ids=t.readUint32Array((this.size-this.hdr_size)/4)},s.trefBox.prototype.parse=function(t){for(var e,n;t.getPosition()<this.start+this.size;)if(e=s.parseOneBox(t,!0,this.size-(t.getPosition()-this.start)),e.code===s.OK)n=new s.TrackReferenceTypeBox(e.type,e.size,e.hdr_size,e.start),n.write===s.Box.prototype.write&&n.type!=="mdat"&&(a.info("BoxParser","TrackReference "+n.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),n.parseDataAndRewind(t)),n.parse(t),this.boxes.push(n);else return},s.createFullBoxCtor("trep","TrackExtensionPropertiesBox",function(t){for(this.track_ID=t.readUint32(),this.boxes=[];t.getPosition()<this.start+this.size;)if(ret=s.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),ret.code===s.OK)box=ret.box,this.boxes.push(box);else return}),s.createFullBoxCtor("trex","TrackExtendsBox",function(t){this.track_id=t.readUint32(),this.default_sample_description_index=t.readUint32(),this.default_sample_duration=t.readUint32(),this.default_sample_size=t.readUint32(),this.default_sample_flags=t.readUint32()}),s.createBoxCtor("trpy","hintBytesSent",function(t){this.bytessent=t.readUint64()}),s.createFullBoxCtor("trun","TrackRunBox",function(t){var e=0;if(this.sample_count=t.readUint32(),e+=4,this.size-this.hdr_size>e&&this.flags&s.TRUN_FLAGS_DATA_OFFSET?(this.data_offset=t.readInt32(),e+=4):this.data_offset=0,this.size-this.hdr_size>e&&this.flags&s.TRUN_FLAGS_FIRST_FLAG?(this.first_sample_flags=t.readUint32(),e+=4):this.first_sample_flags=0,this.sample_duration=[],this.sample_size=[],this.sample_flags=[],this.sample_composition_time_offset=[],this.size-this.hdr_size>e)for(var n=0;n<this.sample_count;n++)this.flags&s.TRUN_FLAGS_DURATION&&(this.sample_duration[n]=t.readUint32()),this.flags&s.TRUN_FLAGS_SIZE&&(this.sample_size[n]=t.readUint32()),this.flags&s.TRUN_FLAGS_FLAGS&&(this.sample_flags[n]=t.readUint32()),this.flags&s.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?this.sample_composition_time_offset[n]=t.readUint32():this.sample_composition_time_offset[n]=t.readInt32())}),s.createFullBoxCtor("tsel","TrackSelectionBox",function(t){this.switch_group=t.readUint32();var e=(this.size-this.hdr_size-4)/4;this.attribute_list=[];for(var n=0;n<e;n++)this.attribute_list[n]=t.readUint32()}),s.createFullBoxCtor("txtC","TextConfigBox",function(t){this.config=t.readCString()}),s.createBoxCtor("tyco","TypeCombinationBox",function(t){var e=(this.size-this.hdr_size)/4;this.compatible_brands=[];for(var n=0;n<e;n++)this.compatible_brands[n]=t.readString(4)}),s.createFullBoxCtor("udes","UserDescriptionProperty",function(t){this.lang=t.readCString(),this.name=t.readCString(),this.description=t.readCString(),this.tags=t.readCString()}),s.createFullBoxCtor("uncC","UncompressedFrameConfigBox",function(t){var e;if(this.profile=t.readString(4),this.version!=1){if(this.version==0){for(this.component_count=t.readUint32(),this.component_index=[],this.component_bit_depth_minus_one=[],this.component_format=[],this.component_align_size=[],e=0;e<this.component_count;e++)this.component_index.push(t.readUint16()),this.component_bit_depth_minus_one.push(t.readUint8()),this.component_format.push(t.readUint8()),this.component_align_size.push(t.readUint8());this.sampling_type=t.readUint8(),this.interleave_type=t.readUint8(),this.block_size=t.readUint8();var n=t.readUint8();this.component_little_endian=n>>7&1,this.block_pad_lsb=n>>6&1,this.block_little_endian=n>>5&1,this.block_reversed=n>>4&1,this.pad_unknown=n>>3&1,this.pixel_size=t.readUint32(),this.row_align_size=t.readUint32(),this.tile_align_size=t.readUint32(),this.num_tile_cols_minus_one=t.readUint32(),this.num_tile_rows_minus_one=t.readUint32()}}}),s.createFullBoxCtor("url ","DataEntryUrlBox",function(t){this.flags!==1&&(this.location=t.readCString())}),s.createFullBoxCtor("urn ","DataEntryUrnBox",function(t){this.name=t.readCString(),this.size-this.hdr_size-this.name.length-1>0&&(this.location=t.readCString())}),s.createUUIDBox("a5d40b30e81411ddba2f0800200c9a66","LiveServerManifestBox",!0,!1,function(t){this.LiveServerManifest=t.readString(this.size-this.hdr_size).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}),s.createUUIDBox("d08a4f1810f34a82b6c832d8aba183d3","PiffProtectionSystemSpecificHeaderBox",!0,!1,function(t){this.system_id=s.parseHex16(t);var e=t.readUint32();e>0&&(this.data=t.readUint8Array(e))}),s.createUUIDBox("a2394f525a9b4f14a2446c427c648df4","PiffSampleEncryptionBox",!0,!1),s.createUUIDBox("8974dbce7be74c5184f97148f9882554","PiffTrackEncryptionBox",!0,!1,function(t){this.default_AlgorithmID=t.readUint24(),this.default_IV_size=t.readUint8(),this.default_KID=s.parseHex16(t)}),s.createUUIDBox("d4807ef2ca3946958e5426cb9e46a79f","TfrfBox",!0,!1,function(t){this.fragment_count=t.readUint8(),this.entries=[];for(var e=0;e<this.fragment_count;e++){var n={},o=0,l=0;this.version===1?(o=t.readUint64(),l=t.readUint64()):(o=t.readUint32(),l=t.readUint32()),n.absolute_time=o,n.absolute_duration=l,this.entries.push(n)}}),s.createUUIDBox("6d1d9b0542d544e680e2141daff757b2","TfxdBox",!0,!1,function(t){this.version===1?(this.absolute_time=t.readUint64(),this.duration=t.readUint64()):(this.absolute_time=t.readUint32(),this.duration=t.readUint32())}),s.createFullBoxCtor("vmhd","VideoMediaHeaderBox",function(t){this.graphicsmode=t.readUint16(),this.opcolor=t.readUint16Array(3)}),s.createFullBoxCtor("vpcC","VPCodecConfigurationRecord",function(t){var e;this.version===1?(this.profile=t.readUint8(),this.level=t.readUint8(),e=t.readUint8(),this.bitDepth=e>>4,this.chromaSubsampling=e>>1&7,this.videoFullRangeFlag=e&1,this.colourPrimaries=t.readUint8(),this.transferCharacteristics=t.readUint8(),this.matrixCoefficients=t.readUint8(),this.codecIntializationDataSize=t.readUint16(),this.codecIntializationData=t.readUint8Array(this.codecIntializationDataSize)):(this.profile=t.readUint8(),this.level=t.readUint8(),e=t.readUint8(),this.bitDepth=e>>4&15,this.colorSpace=e&15,e=t.readUint8(),this.chromaSubsampling=e>>4&15,this.transferFunction=e>>1&7,this.videoFullRangeFlag=e&1,this.codecIntializationDataSize=t.readUint16(),this.codecIntializationData=t.readUint8Array(this.codecIntializationDataSize))}),s.createBoxCtor("vttC","WebVTTConfigurationBox",function(t){this.text=t.readString(this.size-this.hdr_size)}),s.createFullBoxCtor("vvcC","VvcConfigurationBox",function(t){var e,n,o={held_bits:void 0,num_held_bits:0,stream_read_1_bytes:function(B){this.held_bits=B.readUint8(),this.num_held_bits=8},stream_read_2_bytes:function(B){this.held_bits=B.readUint16(),this.num_held_bits=16},extract_bits:function(B){var K=this.held_bits>>this.num_held_bits-B&(1<<B)-1;return this.num_held_bits-=B,K}};if(o.stream_read_1_bytes(t),o.extract_bits(5),this.lengthSizeMinusOne=o.extract_bits(2),this.ptl_present_flag=o.extract_bits(1),this.ptl_present_flag){o.stream_read_2_bytes(t),this.ols_idx=o.extract_bits(9),this.num_sublayers=o.extract_bits(3),this.constant_frame_rate=o.extract_bits(2),this.chroma_format_idc=o.extract_bits(2),o.stream_read_1_bytes(t),this.bit_depth_minus8=o.extract_bits(3),o.extract_bits(5);{if(o.stream_read_2_bytes(t),o.extract_bits(2),this.num_bytes_constraint_info=o.extract_bits(6),this.general_profile_idc=o.extract_bits(7),this.general_tier_flag=o.extract_bits(1),this.general_level_idc=t.readUint8(),o.stream_read_1_bytes(t),this.ptl_frame_only_constraint_flag=o.extract_bits(1),this.ptl_multilayer_enabled_flag=o.extract_bits(1),this.general_constraint_info=new Uint8Array(this.num_bytes_constraint_info),this.num_bytes_constraint_info){for(e=0;e<this.num_bytes_constraint_info-1;e++){var l=o.extract_bits(6);o.stream_read_1_bytes(t);var u=o.extract_bits(2);this.general_constraint_info[e]=l<<2|u}this.general_constraint_info[this.num_bytes_constraint_info-1]=o.extract_bits(6)}else o.extract_bits(6);if(this.num_sublayers>1){for(o.stream_read_1_bytes(t),this.ptl_sublayer_present_mask=0,n=this.num_sublayers-2;n>=0;--n){var c=o.extract_bits(1);this.ptl_sublayer_present_mask|=c<<n}for(n=this.num_sublayers;n<=8&&this.num_sublayers>1;++n)o.extract_bits(1);for(this.sublayer_level_idc=[],n=this.num_sublayers-2;n>=0;--n)this.ptl_sublayer_present_mask&1<<n&&(this.sublayer_level_idc[n]=t.readUint8())}if(this.ptl_num_sub_profiles=t.readUint8(),this.general_sub_profile_idc=[],this.ptl_num_sub_profiles)for(e=0;e<this.ptl_num_sub_profiles;e++)this.general_sub_profile_idc.push(t.readUint32())}this.max_picture_width=t.readUint16(),this.max_picture_height=t.readUint16(),this.avg_frame_rate=t.readUint16()}var _=12,x=13;this.nalu_arrays=[];var S=t.readUint8();for(e=0;e<S;e++){var w=[];this.nalu_arrays.push(w),o.stream_read_1_bytes(t),w.completeness=o.extract_bits(1),o.extract_bits(2),w.nalu_type=o.extract_bits(5);var C=1;for(w.nalu_type!=x&&w.nalu_type!=_&&(C=t.readUint16()),n=0;n<C;n++){var F=t.readUint16();w.push({data:t.readUint8Array(F),length:F})}}}),s.createFullBoxCtor("vvnC","VvcNALUConfigBox",function(t){var e=strm.readUint8();this.lengthSizeMinusOne=e&3}),s.SampleEntry.prototype.isVideo=function(){return!1},s.SampleEntry.prototype.isAudio=function(){return!1},s.SampleEntry.prototype.isSubtitle=function(){return!1},s.SampleEntry.prototype.isMetadata=function(){return!1},s.SampleEntry.prototype.isHint=function(){return!1},s.SampleEntry.prototype.getCodec=function(){return this.type.replace(".","")},s.SampleEntry.prototype.getWidth=function(){return""},s.SampleEntry.prototype.getHeight=function(){return""},s.SampleEntry.prototype.getChannelCount=function(){return""},s.SampleEntry.prototype.getSampleRate=function(){return""},s.SampleEntry.prototype.getSampleSize=function(){return""},s.VisualSampleEntry.prototype.isVideo=function(){return!0},s.VisualSampleEntry.prototype.getWidth=function(){return this.width},s.VisualSampleEntry.prototype.getHeight=function(){return this.height},s.AudioSampleEntry.prototype.isAudio=function(){return!0},s.AudioSampleEntry.prototype.getChannelCount=function(){return this.channel_count},s.AudioSampleEntry.prototype.getSampleRate=function(){return this.samplerate},s.AudioSampleEntry.prototype.getSampleSize=function(){return this.samplesize},s.SubtitleSampleEntry.prototype.isSubtitle=function(){return!0},s.MetadataSampleEntry.prototype.isMetadata=function(){return!0},s.decimalToHex=function(t,e){var n=Number(t).toString(16);for(e=typeof e>"u"||e===null?e=2:e;n.length<e;)n="0"+n;return n},s.avc1SampleEntry.prototype.getCodec=s.avc2SampleEntry.prototype.getCodec=s.avc3SampleEntry.prototype.getCodec=s.avc4SampleEntry.prototype.getCodec=function(){var t=s.SampleEntry.prototype.getCodec.call(this);return this.avcC?t+"."+s.decimalToHex(this.avcC.AVCProfileIndication)+s.decimalToHex(this.avcC.profile_compatibility)+s.decimalToHex(this.avcC.AVCLevelIndication):t},s.hev1SampleEntry.prototype.getCodec=s.hvc1SampleEntry.prototype.getCodec=function(){var t,e=s.SampleEntry.prototype.getCodec.call(this);if(this.hvcC){switch(e+=".",this.hvcC.general_profile_space){case 0:e+="";break;case 1:e+="A";break;case 2:e+="B";break;case 3:e+="C";break}e+=this.hvcC.general_profile_idc,e+=".";var n=this.hvcC.general_profile_compatibility,o=0;for(t=0;t<32&&(o|=n&1,t!=31);t++)o<<=1,n>>=1;e+=s.decimalToHex(o,0),e+=".",this.hvcC.general_tier_flag===0?e+="L":e+="H",e+=this.hvcC.general_level_idc;var l=!1,u="";for(t=5;t>=0;t--)(this.hvcC.general_constraint_indicator[t]||l)&&(u="."+s.decimalToHex(this.hvcC.general_constraint_indicator[t],0)+u,l=!0);e+=u}return e},s.vvc1SampleEntry.prototype.getCodec=s.vvi1SampleEntry.prototype.getCodec=function(){var t,e=s.SampleEntry.prototype.getCodec.call(this);if(this.vvcC){e+="."+this.vvcC.general_profile_idc,this.vvcC.general_tier_flag?e+=".H":e+=".L",e+=this.vvcC.general_level_idc;var n="";if(this.vvcC.general_constraint_info){var o=[],l=0;l|=this.vvcC.ptl_frame_only_constraint<<7,l|=this.vvcC.ptl_multilayer_enabled<<6;var u;for(t=0;t<this.vvcC.general_constraint_info.length;++t)l|=this.vvcC.general_constraint_info[t]>>2&63,o.push(l),l&&(u=t),l=this.vvcC.general_constraint_info[t]>>2&3;if(u===void 0)n=".CA";else{n=".C";var c="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",_=0,x=0;for(t=0;t<=u;++t)for(_=_<<8|o[t],x+=8;x>=5;){var S=_>>x-5&31;n+=c[S],x-=5,_&=(1<<x)-1}x&&(_<<=5-x,n+=c[_&31])}}e+=n}return e},s.mp4aSampleEntry.prototype.getCodec=function(){var t=s.SampleEntry.prototype.getCodec.call(this);if(this.esds&&this.esds.esd){var e=this.esds.esd.getOTI(),n=this.esds.esd.getAudioConfig();return t+"."+s.decimalToHex(e)+(n?"."+n:"")}else return t},s.stxtSampleEntry.prototype.getCodec=function(){var t=s.SampleEntry.prototype.getCodec.call(this);return this.mime_format?t+"."+this.mime_format:t},s.vp08SampleEntry.prototype.getCodec=s.vp09SampleEntry.prototype.getCodec=function(){var t=s.SampleEntry.prototype.getCodec.call(this),e=this.vpcC.level;e==0&&(e="00");var n=this.vpcC.bitDepth;return n==8&&(n="08"),t+".0"+this.vpcC.profile+"."+e+"."+n},s.av01SampleEntry.prototype.getCodec=function(){var t=s.SampleEntry.prototype.getCodec.call(this),e=this.av1C.seq_level_idx_0;e<10&&(e="0"+e);var n;return this.av1C.seq_profile===2&&this.av1C.high_bitdepth===1?n=this.av1C.twelve_bit===1?"12":"10":this.av1C.seq_profile<=2&&(n=this.av1C.high_bitdepth===1?"10":"08"),t+"."+this.av1C.seq_profile+"."+e+(this.av1C.seq_tier_0?"H":"M")+"."+n},s.Box.prototype.writeHeader=function(t,e){this.size+=8,this.size>d&&(this.size+=8),this.type==="uuid"&&(this.size+=16),a.debug("BoxWriter","Writing box "+this.type+" of size: "+this.size+" at position "+t.getPosition()+(e||"")),this.size>d?t.writeUint32(1):(this.sizePosition=t.getPosition(),t.writeUint32(this.size)),t.writeString(this.type,null,4),this.type==="uuid"&&t.writeUint8Array(this.uuid),this.size>d&&t.writeUint64(this.size)},s.FullBox.prototype.writeHeader=function(t){this.size+=4,s.Box.prototype.writeHeader.call(this,t," v="+this.version+" f="+this.flags),t.writeUint8(this.version),t.writeUint24(this.flags)},s.Box.prototype.write=function(t){this.type==="mdat"?this.data&&(this.size=this.data.length,this.writeHeader(t),t.writeUint8Array(this.data)):(this.size=this.data?this.data.length:0,this.writeHeader(t),this.data&&t.writeUint8Array(this.data))},s.ContainerBox.prototype.write=function(t){this.size=0,this.writeHeader(t);for(var e=0;e<this.boxes.length;e++)this.boxes[e]&&(this.boxes[e].write(t),this.size+=this.boxes[e].size);a.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},s.TrackReferenceTypeBox.prototype.write=function(t){this.size=this.track_ids.length*4,this.writeHeader(t),t.writeUint32Array(this.track_ids)},s.avcCBox.prototype.write=function(t){var e;for(this.size=7,e=0;e<this.SPS.length;e++)this.size+=2+this.SPS[e].length;for(e=0;e<this.PPS.length;e++)this.size+=2+this.PPS[e].length;for(this.ext&&(this.size+=this.ext.length),this.writeHeader(t),t.writeUint8(this.configurationVersion),t.writeUint8(this.AVCProfileIndication),t.writeUint8(this.profile_compatibility),t.writeUint8(this.AVCLevelIndication),t.writeUint8(this.lengthSizeMinusOne+252),t.writeUint8(this.SPS.length+224),e=0;e<this.SPS.length;e++)t.writeUint16(this.SPS[e].length),t.writeUint8Array(this.SPS[e].nalu);for(t.writeUint8(this.PPS.length),e=0;e<this.PPS.length;e++)t.writeUint16(this.PPS[e].length),t.writeUint8Array(this.PPS[e].nalu);this.ext&&t.writeUint8Array(this.ext)},s.co64Box.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),e=0;e<this.chunk_offsets.length;e++)t.writeUint64(this.chunk_offsets[e])},s.cslgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(t),t.writeInt32(this.compositionToDTSShift),t.writeInt32(this.leastDecodeToDisplayDelta),t.writeInt32(this.greatestDecodeToDisplayDelta),t.writeInt32(this.compositionStartTime),t.writeInt32(this.compositionEndTime)},s.cttsBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),e=0;e<this.sample_counts.length;e++)t.writeUint32(this.sample_counts[e]),this.version===1?t.writeInt32(this.sample_offsets[e]):t.writeUint32(this.sample_offsets[e])},s.drefBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++)this.entries[e].write(t),this.size+=this.entries[e].size;a.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},s.elngBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.extended_language.length,this.writeHeader(t),t.writeString(this.extended_language)},s.elstBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+12*this.entries.length,this.writeHeader(t),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++){var n=this.entries[e];t.writeUint32(n.segment_duration),t.writeInt32(n.media_time),t.writeInt16(n.media_rate_integer),t.writeInt16(n.media_rate_fraction)}},s.emsgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*4+this.message_data.length+(this.scheme_id_uri.length+1)+(this.value.length+1),this.writeHeader(t),t.writeCString(this.scheme_id_uri),t.writeCString(this.value),t.writeUint32(this.timescale),t.writeUint32(this.presentation_time_delta),t.writeUint32(this.event_duration),t.writeUint32(this.id),t.writeUint8Array(this.message_data)},s.ftypBox.prototype.write=function(t){this.size=8+4*this.compatible_brands.length,this.writeHeader(t),t.writeString(this.major_brand,null,4),t.writeUint32(this.minor_version);for(var e=0;e<this.compatible_brands.length;e++)t.writeString(this.compatible_brands[e],null,4)},s.hdlrBox.prototype.write=function(t){this.size=5*4+this.name.length+1,this.version=0,this.flags=0,this.writeHeader(t),t.writeUint32(0),t.writeString(this.handler,null,4),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeCString(this.name)},s.hvcCBox.prototype.write=function(t){var e,n;for(this.size=23,e=0;e<this.nalu_arrays.length;e++)for(this.size+=3,n=0;n<this.nalu_arrays[e].length;n++)this.size+=2+this.nalu_arrays[e][n].data.length;for(this.writeHeader(t),t.writeUint8(this.configurationVersion),t.writeUint8((this.general_profile_space<<6)+(this.general_tier_flag<<5)+this.general_profile_idc),t.writeUint32(this.general_profile_compatibility),t.writeUint8Array(this.general_constraint_indicator),t.writeUint8(this.general_level_idc),t.writeUint16(this.min_spatial_segmentation_idc+(15<<24)),t.writeUint8(this.parallelismType+252),t.writeUint8(this.chroma_format_idc+252),t.writeUint8(this.bit_depth_luma_minus8+248),t.writeUint8(this.bit_depth_chroma_minus8+248),t.writeUint16(this.avgFrameRate),t.writeUint8((this.constantFrameRate<<6)+(this.numTemporalLayers<<3)+(this.temporalIdNested<<2)+this.lengthSizeMinusOne),t.writeUint8(this.nalu_arrays.length),e=0;e<this.nalu_arrays.length;e++)for(t.writeUint8((this.nalu_arrays[e].completeness<<7)+this.nalu_arrays[e].nalu_type),t.writeUint16(this.nalu_arrays[e].length),n=0;n<this.nalu_arrays[e].length;n++)t.writeUint16(this.nalu_arrays[e][n].data.length),t.writeUint8Array(this.nalu_arrays[e][n].data)},s.kindBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.schemeURI.length+1+(this.value.length+1),this.writeHeader(t),t.writeCString(this.schemeURI),t.writeCString(this.value)},s.mdhdBox.prototype.write=function(t){this.size=4*4+2*2,this.flags=0,this.version=0,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint16(this.language),t.writeUint16(0)},s.mehdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.fragment_duration)},s.mfhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.sequence_number)},s.mvhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=23*4+2*2,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint32(this.rate),t.writeUint16(this.volume<<8),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32Array(this.matrix),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(this.next_track_id)},s.SampleEntry.prototype.writeHeader=function(t){this.size=8,s.Box.prototype.writeHeader.call(this,t),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint16(this.data_reference_index)},s.SampleEntry.prototype.writeFooter=function(t){for(var e=0;e<this.boxes.length;e++)this.boxes[e].write(t),this.size+=this.boxes[e].size;a.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},s.SampleEntry.prototype.write=function(t){this.writeHeader(t),t.writeUint8Array(this.data),this.size+=this.data.length,a.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},s.VisualSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=2*7+6*4+32,t.writeUint16(0),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.width),t.writeUint16(this.height),t.writeUint32(this.horizresolution),t.writeUint32(this.vertresolution),t.writeUint32(0),t.writeUint16(this.frame_count),t.writeUint8(Math.min(31,this.compressorname.length)),t.writeString(this.compressorname,null,31),t.writeUint16(this.depth),t.writeInt16(-1),this.writeFooter(t)},s.AudioSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=2*4+3*4,t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.channel_count),t.writeUint16(this.samplesize),t.writeUint16(0),t.writeUint16(0),t.writeUint32(this.samplerate<<16),this.writeFooter(t)},s.stppSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=this.namespace.length+1+this.schema_location.length+1+this.auxiliary_mime_types.length+1,t.writeCString(this.namespace),t.writeCString(this.schema_location),t.writeCString(this.auxiliary_mime_types),this.writeFooter(t)},s.SampleGroupEntry.prototype.write=function(t){t.writeUint8Array(this.data)},s.sbgpBox.prototype.write=function(t){this.version=1,this.flags=0,this.size=12+8*this.entries.length,this.writeHeader(t),t.writeString(this.grouping_type,null,4),t.writeUint32(this.grouping_type_parameter),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++){var n=this.entries[e];t.writeInt32(n.sample_count),t.writeInt32(n.group_description_index)}},s.sgpdBox.prototype.write=function(t){var e,n;for(this.flags=0,this.size=12,e=0;e<this.entries.length;e++)n=this.entries[e],this.version===1&&(this.default_length===0&&(this.size+=4),this.size+=n.data.length);for(this.writeHeader(t),t.writeString(this.grouping_type,null,4),this.version===1&&t.writeUint32(this.default_length),this.version>=2&&t.writeUint32(this.default_sample_description_index),t.writeUint32(this.entries.length),e=0;e<this.entries.length;e++)n=this.entries[e],this.version===1&&this.default_length===0&&t.writeUint32(n.description_length),n.write(t)},s.sidxBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*4+2+2+12*this.references.length,this.writeHeader(t),t.writeUint32(this.reference_ID),t.writeUint32(this.timescale),t.writeUint32(this.earliest_presentation_time),t.writeUint32(this.first_offset),t.writeUint16(0),t.writeUint16(this.references.length);for(var e=0;e<this.references.length;e++){var n=this.references[e];t.writeUint32(n.reference_type<<31|n.referenced_size),t.writeUint32(n.subsegment_duration),t.writeUint32(n.starts_with_SAP<<31|n.SAP_type<<28|n.SAP_delta_time)}},s.smhdBox.prototype.write=function(t){this.version=0,this.flags=1,this.size=4,this.writeHeader(t),t.writeUint16(this.balance),t.writeUint16(0)},s.stcoBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),t.writeUint32Array(this.chunk_offsets)},s.stscBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+12*this.first_chunk.length,this.writeHeader(t),t.writeUint32(this.first_chunk.length),e=0;e<this.first_chunk.length;e++)t.writeUint32(this.first_chunk[e]),t.writeUint32(this.samples_per_chunk[e]),t.writeUint32(this.sample_description_index[e])},s.stsdBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=0,this.writeHeader(t),t.writeUint32(this.entries.length),this.size+=4,e=0;e<this.entries.length;e++)this.entries[e].write(t),this.size+=this.entries[e].size;a.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},s.stshBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.shadowed_sample_numbers.length,this.writeHeader(t),t.writeUint32(this.shadowed_sample_numbers.length),e=0;e<this.shadowed_sample_numbers.length;e++)t.writeUint32(this.shadowed_sample_numbers[e]),t.writeUint32(this.sync_sample_numbers[e])},s.stssBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.sample_numbers.length,this.writeHeader(t),t.writeUint32(this.sample_numbers.length),t.writeUint32Array(this.sample_numbers)},s.stszBox.prototype.write=function(t){var e,n=!0;if(this.version=0,this.flags=0,this.sample_sizes.length>0)for(e=0;e+1<this.sample_sizes.length;)if(this.sample_sizes[e+1]!==this.sample_sizes[0]){n=!1;break}else e++;else n=!1;this.size=8,n||(this.size+=4*this.sample_sizes.length),this.writeHeader(t),n?t.writeUint32(this.sample_sizes[0]):t.writeUint32(0),t.writeUint32(this.sample_sizes.length),n||t.writeUint32Array(this.sample_sizes)},s.sttsBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),e=0;e<this.sample_counts.length;e++)t.writeUint32(this.sample_counts[e]),t.writeUint32(this.sample_deltas[e])},s.tfdtBox.prototype.write=function(t){var e=Math.pow(2,32)-1;this.version=this.baseMediaDecodeTime>e?1:0,this.flags=0,this.size=4,this.version===1&&(this.size+=4),this.writeHeader(t),this.version===1?t.writeUint64(this.baseMediaDecodeTime):t.writeUint32(this.baseMediaDecodeTime)},s.tfhdBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&s.TFHD_FLAG_BASE_DATA_OFFSET&&(this.size+=8),this.flags&s.TFHD_FLAG_SAMPLE_DESC&&(this.size+=4),this.flags&s.TFHD_FLAG_SAMPLE_DUR&&(this.size+=4),this.flags&s.TFHD_FLAG_SAMPLE_SIZE&&(this.size+=4),this.flags&s.TFHD_FLAG_SAMPLE_FLAGS&&(this.size+=4),this.writeHeader(t),t.writeUint32(this.track_id),this.flags&s.TFHD_FLAG_BASE_DATA_OFFSET&&t.writeUint64(this.base_data_offset),this.flags&s.TFHD_FLAG_SAMPLE_DESC&&t.writeUint32(this.default_sample_description_index),this.flags&s.TFHD_FLAG_SAMPLE_DUR&&t.writeUint32(this.default_sample_duration),this.flags&s.TFHD_FLAG_SAMPLE_SIZE&&t.writeUint32(this.default_sample_size),this.flags&s.TFHD_FLAG_SAMPLE_FLAGS&&t.writeUint32(this.default_sample_flags)},s.tkhdBox.prototype.write=function(t){this.version=0,this.size=4*18+2*4,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.track_id),t.writeUint32(0),t.writeUint32(this.duration),t.writeUint32(0),t.writeUint32(0),t.writeInt16(this.layer),t.writeInt16(this.alternate_group),t.writeInt16(this.volume<<8),t.writeUint16(0),t.writeInt32Array(this.matrix),t.writeUint32(this.width),t.writeUint32(this.height)},s.trexBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(t),t.writeUint32(this.track_id),t.writeUint32(this.default_sample_description_index),t.writeUint32(this.default_sample_duration),t.writeUint32(this.default_sample_size),t.writeUint32(this.default_sample_flags)},s.trunBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&s.TRUN_FLAGS_DATA_OFFSET&&(this.size+=4),this.flags&s.TRUN_FLAGS_FIRST_FLAG&&(this.size+=4),this.flags&s.TRUN_FLAGS_DURATION&&(this.size+=4*this.sample_duration.length),this.flags&s.TRUN_FLAGS_SIZE&&(this.size+=4*this.sample_size.length),this.flags&s.TRUN_FLAGS_FLAGS&&(this.size+=4*this.sample_flags.length),this.flags&s.TRUN_FLAGS_CTS_OFFSET&&(this.size+=4*this.sample_composition_time_offset.length),this.writeHeader(t),t.writeUint32(this.sample_count),this.flags&s.TRUN_FLAGS_DATA_OFFSET&&(this.data_offset_position=t.getPosition(),t.writeInt32(this.data_offset)),this.flags&s.TRUN_FLAGS_FIRST_FLAG&&t.writeUint32(this.first_sample_flags);for(var e=0;e<this.sample_count;e++)this.flags&s.TRUN_FLAGS_DURATION&&t.writeUint32(this.sample_duration[e]),this.flags&s.TRUN_FLAGS_SIZE&&t.writeUint32(this.sample_size[e]),this.flags&s.TRUN_FLAGS_FLAGS&&t.writeUint32(this.sample_flags[e]),this.flags&s.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?t.writeUint32(this.sample_composition_time_offset[e]):t.writeInt32(this.sample_composition_time_offset[e]))},s["url Box"].prototype.write=function(t){this.version=0,this.location?(this.flags=0,this.size=this.location.length+1):(this.flags=1,this.size=0),this.writeHeader(t),this.location&&t.writeCString(this.location)},s["urn Box"].prototype.write=function(t){this.version=0,this.flags=0,this.size=this.name.length+1+(this.location?this.location.length+1:0),this.writeHeader(t),t.writeCString(this.name),this.location&&t.writeCString(this.location)},s.vmhdBox.prototype.write=function(t){this.version=0,this.flags=1,this.size=8,this.writeHeader(t),t.writeUint16(this.graphicsmode),t.writeUint16Array(this.opcolor)},s.cttsBox.prototype.unpack=function(t){var e,n,o;for(o=0,e=0;e<this.sample_counts.length;e++)for(n=0;n<this.sample_counts[e];n++)t[o].pts=t[o].dts+this.sample_offsets[e],o++},s.sttsBox.prototype.unpack=function(t){var e,n,o;for(o=0,e=0;e<this.sample_counts.length;e++)for(n=0;n<this.sample_counts[e];n++)o===0?t[o].dts=0:t[o].dts=t[o-1].dts+this.sample_deltas[e],o++},s.stcoBox.prototype.unpack=function(t){var e;for(e=0;e<this.chunk_offsets.length;e++)t[e].offset=this.chunk_offsets[e]},s.stscBox.prototype.unpack=function(t){var e,n,o,l,u;for(l=0,u=0,e=0;e<this.first_chunk.length;e++)for(n=0;n<(e+1<this.first_chunk.length?this.first_chunk[e+1]:1/0);n++)for(u++,o=0;o<this.samples_per_chunk[e];o++){if(t[l])t[l].description_index=this.sample_description_index[e],t[l].chunk_index=u;else return;l++}},s.stszBox.prototype.unpack=function(t){var e;for(e=0;e<this.sample_sizes.length;e++)t[e].size=this.sample_sizes[e]},s.DIFF_BOXES_PROP_NAMES=["boxes","entries","references","subsamples","items","item_infos","extents","associations","subsegments","ranges","seekLists","seekPoints","esd","levels"],s.DIFF_PRIMITIVE_ARRAY_PROP_NAMES=["compatible_brands","matrix","opcolor","sample_counts","sample_deltas","first_chunk","samples_per_chunk","sample_sizes","chunk_offsets","sample_offsets","sample_description_index","sample_duration"],s.boxEqualFields=function(t,e){if(t&&!e)return!1;var n;for(n in t)if(!(s.DIFF_BOXES_PROP_NAMES.indexOf(n)>-1)){if(t[n]instanceof s.Box||e[n]instanceof s.Box)continue;if(typeof t[n]>"u"||typeof e[n]>"u")continue;if(typeof t[n]=="function"||typeof e[n]=="function")continue;if(t.subBoxNames&&t.subBoxNames.indexOf(n.slice(0,4))>-1||e.subBoxNames&&e.subBoxNames.indexOf(n.slice(0,4))>-1)continue;if(n==="data"||n==="start"||n==="size"||n==="creation_time"||n==="modification_time")continue;if(s.DIFF_PRIMITIVE_ARRAY_PROP_NAMES.indexOf(n)>-1)continue;if(t[n]!==e[n])return!1}return!0},s.boxEqual=function(t,e){if(!s.boxEqualFields(t,e))return!1;for(var n=0;n<s.DIFF_BOXES_PROP_NAMES.length;n++){var o=s.DIFF_BOXES_PROP_NAMES[n];if(t[o]&&e[o]&&!s.boxEqual(t[o],e[o]))return!1}return!0};var A=function(){};A.prototype.parseSample=function(t){var e,n,o=new h(t.buffer);for(e=[];!o.isEos();)n=s.parseOneBox(o,!1),n.code===s.OK&&n.box.type==="vttc"&&e.push(n.box);return e},A.prototype.getText=function(t,e,n){function o(S,w,C){return C=C||"0",S=S+"",S.length>=w?S:new Array(w-S.length+1).join(C)+S}function l(S){var w=Math.floor(S/3600),C=Math.floor((S-w*3600)/60),F=Math.floor(S-w*3600-C*60),B=Math.floor((S-w*3600-C*60-F)*1e3);return""+o(w,2)+":"+o(C,2)+":"+o(F,2)+"."+o(B,3)}for(var u=this.parseSample(n),c="",_=0;_<u.length;_++){var x=u[_];c+=l(t)+" --> "+l(e)+`\r
`,c+=x.payl.text}return c};var T=function(){};T.prototype.parseSample=function(t){var e={},n;e.resources=[];var o=new h(t.data.buffer);if(!t.subsamples||t.subsamples.length===0)e.documentString=o.readString(t.data.length);else if(e.documentString=o.readString(t.subsamples[0].size),t.subsamples.length>1)for(n=1;n<t.subsamples.length;n++)e.resources[n]=o.readUint8Array(t.subsamples[n].size);return typeof DOMParser<"u"&&(e.document=new DOMParser().parseFromString(e.documentString,"application/xml")),e};var I=function(){};I.prototype.parseSample=function(t){var e,n=new h(t.data.buffer);return e=n.readString(t.data.length),e},I.prototype.parseConfig=function(t){var e,n=new h(t.buffer);return n.readUint32(),e=n.readCString(),e},r.VTTin4Parser=A,r.XMLSubtitlein4Parser=T,r.Textin4Parser=I;var g=function(t){this.stream=t||new p,this.boxes=[],this.mdats=[],this.moofs=[],this.isProgressive=!1,this.moovStartFound=!1,this.onMoovStart=null,this.moovStartSent=!1,this.onReady=null,this.readySent=!1,this.onSegment=null,this.onSamples=null,this.onError=null,this.sampleListBuilt=!1,this.fragmentedTracks=[],this.extractedTracks=[],this.isFragmentationInitialized=!1,this.sampleProcessingStarted=!1,this.nextMoofNumber=0,this.itemListBuilt=!1,this.items=[],this.entity_groups=[],this.onSidx=null,this.sidxSent=!1};g.prototype.setSegmentOptions=function(t,e,n){var o=this.getTrackById(t);if(o){var l={};this.fragmentedTracks.push(l),l.id=t,l.user=e,l.trak=o,o.nextSample=0,l.segmentStream=null,l.nb_samples=1e3,l.rapAlignement=!0,n&&(n.nbSamples&&(l.nb_samples=n.nbSamples),n.rapAlignement&&(l.rapAlignement=n.rapAlignement))}},g.prototype.unsetSegmentOptions=function(t){for(var e=-1,n=0;n<this.fragmentedTracks.length;n++){var o=this.fragmentedTracks[n];o.id==t&&(e=n)}e>-1&&this.fragmentedTracks.splice(e,1)},g.prototype.setExtractionOptions=function(t,e,n){var o=this.getTrackById(t);if(o){var l={};this.extractedTracks.push(l),l.id=t,l.user=e,l.trak=o,o.nextSample=0,l.nb_samples=1e3,l.samples=[],n&&n.nbSamples&&(l.nb_samples=n.nbSamples)}},g.prototype.unsetExtractionOptions=function(t){for(var e=-1,n=0;n<this.extractedTracks.length;n++){var o=this.extractedTracks[n];o.id==t&&(e=n)}e>-1&&this.extractedTracks.splice(e,1)},g.prototype.parse=function(){var t,e,n=!1;if(!(this.restoreParsePosition&&!this.restoreParsePosition()))for(;;)if(this.hasIncompleteMdat&&this.hasIncompleteMdat()){if(this.processIncompleteMdat())continue;return}else if(this.saveParsePosition&&this.saveParsePosition(),t=s.parseOneBox(this.stream,n),t.code===s.ERR_NOT_ENOUGH_DATA)if(this.processIncompleteBox){if(this.processIncompleteBox(t))continue;return}else return;else{var o;switch(e=t.box,o=e.type!=="uuid"?e.type:e.uuid,this.boxes.push(e),o){case"mdat":this.mdats.push(e);break;case"moof":this.moofs.push(e);break;case"moov":this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0);default:this[o]!==void 0&&a.warn("ISOFile","Duplicate Box of type: "+o+", overriding previous occurrence"),this[o]=e;break}this.updateUsedBytes&&this.updateUsedBytes(e,t)}},g.prototype.checkBuffer=function(t){if(t==null)throw"Buffer must be defined and non empty";if(t.fileStart===void 0)throw"Buffer must have a fileStart property";return t.byteLength===0?(a.warn("ISOFile","Ignoring empty buffer (fileStart: "+t.fileStart+")"),this.stream.logBufferLevel(),!1):(a.info("ISOFile","Processing buffer (fileStart: "+t.fileStart+")"),t.usedBytes=0,this.stream.insertBuffer(t),this.stream.logBufferLevel(),this.stream.initialized()?!0:(a.warn("ISOFile","Not ready to start parsing"),!1))},g.prototype.appendBuffer=function(t,e){var n;if(this.checkBuffer(t))return this.parse(),this.moovStartFound&&!this.moovStartSent&&(this.moovStartSent=!0,this.onMoovStart&&this.onMoovStart()),this.moov?(this.sampleListBuilt||(this.buildSampleLists(),this.sampleListBuilt=!0),this.updateSampleLists(),this.onReady&&!this.readySent&&(this.readySent=!0,this.onReady(this.getInfo())),this.processSamples(e),this.nextSeekPosition?(n=this.nextSeekPosition,this.nextSeekPosition=void 0):n=this.nextParsePosition,this.stream.getEndFilePositionAfter&&(n=this.stream.getEndFilePositionAfter(n))):this.nextParsePosition?n=this.nextParsePosition:n=0,this.sidx&&this.onSidx&&!this.sidxSent&&(this.onSidx(this.sidx),this.sidxSent=!0),this.meta&&(this.flattenItemInfo&&!this.itemListBuilt&&(this.flattenItemInfo(),this.itemListBuilt=!0),this.processItems&&this.processItems(this.onItem)),this.stream.cleanBuffers&&(a.info("ISOFile","Done processing buffer (fileStart: "+t.fileStart+") - next buffer to fetch should have a fileStart position of "+n),this.stream.logBufferLevel(),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0),a.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize())),n},g.prototype.getInfo=function(){var t,e,n={},o,l,u,c,_=new Date("1904-01-01T00:00:00Z").getTime();if(this.moov)for(n.hasMoov=!0,n.duration=this.moov.mvhd.duration,n.timescale=this.moov.mvhd.timescale,n.isFragmented=this.moov.mvex!=null,n.isFragmented&&this.moov.mvex.mehd&&(n.fragment_duration=this.moov.mvex.mehd.fragment_duration),n.isProgressive=this.isProgressive,n.hasIOD=this.moov.iods!=null,n.brands=[],n.brands.push(this.ftyp.major_brand),n.brands=n.brands.concat(this.ftyp.compatible_brands),n.created=new Date(_+this.moov.mvhd.creation_time*1e3),n.modified=new Date(_+this.moov.mvhd.modification_time*1e3),n.tracks=[],n.audioTracks=[],n.videoTracks=[],n.subtitleTracks=[],n.metadataTracks=[],n.hintTracks=[],n.otherTracks=[],t=0;t<this.moov.traks.length;t++){if(o=this.moov.traks[t],c=o.mdia.minf.stbl.stsd.entries[0],l={},n.tracks.push(l),l.id=o.tkhd.track_id,l.name=o.mdia.hdlr.name,l.references=[],o.tref)for(e=0;e<o.tref.boxes.length;e++)u={},l.references.push(u),u.type=o.tref.boxes[e].type,u.track_ids=o.tref.boxes[e].track_ids;o.edts&&(l.edits=o.edts.elst.entries),l.created=new Date(_+o.tkhd.creation_time*1e3),l.modified=new Date(_+o.tkhd.modification_time*1e3),l.movie_duration=o.tkhd.duration,l.movie_timescale=n.timescale,l.layer=o.tkhd.layer,l.alternate_group=o.tkhd.alternate_group,l.volume=o.tkhd.volume,l.matrix=o.tkhd.matrix,l.track_width=o.tkhd.width/65536,l.track_height=o.tkhd.height/65536,l.timescale=o.mdia.mdhd.timescale,l.cts_shift=o.mdia.minf.stbl.cslg,l.duration=o.mdia.mdhd.duration,l.samples_duration=o.samples_duration,l.codec=c.getCodec(),l.kind=o.udta&&o.udta.kinds.length?o.udta.kinds[0]:{schemeURI:"",value:""},l.language=o.mdia.elng?o.mdia.elng.extended_language:o.mdia.mdhd.languageString,l.nb_samples=o.samples.length,l.size=o.samples_size,l.bitrate=l.size*8*l.timescale/l.samples_duration,c.isAudio()?(l.type="audio",n.audioTracks.push(l),l.audio={},l.audio.sample_rate=c.getSampleRate(),l.audio.channel_count=c.getChannelCount(),l.audio.sample_size=c.getSampleSize()):c.isVideo()?(l.type="video",n.videoTracks.push(l),l.video={},l.video.width=c.getWidth(),l.video.height=c.getHeight()):c.isSubtitle()?(l.type="subtitles",n.subtitleTracks.push(l)):c.isHint()?(l.type="metadata",n.hintTracks.push(l)):c.isMetadata()?(l.type="metadata",n.metadataTracks.push(l)):(l.type="metadata",n.otherTracks.push(l))}else n.hasMoov=!1;if(n.mime="",n.hasMoov&&n.tracks){for(n.videoTracks&&n.videoTracks.length>0?n.mime+='video/mp4; codecs="':n.audioTracks&&n.audioTracks.length>0?n.mime+='audio/mp4; codecs="':n.mime+='application/mp4; codecs="',t=0;t<n.tracks.length;t++)t!==0&&(n.mime+=","),n.mime+=n.tracks[t].codec;n.mime+='"; profiles="',n.mime+=this.ftyp.compatible_brands.join(),n.mime+='"'}return n},g.prototype.setNextSeekPositionFromSample=function(t){t&&(this.nextSeekPosition?this.nextSeekPosition=Math.min(t.offset+t.alreadyRead,this.nextSeekPosition):this.nextSeekPosition=t.offset+t.alreadyRead)},g.prototype.processSamples=function(t){var e,n;if(this.sampleProcessingStarted){if(this.isFragmentationInitialized&&this.onSegment!==null)for(e=0;e<this.fragmentedTracks.length;e++){var o=this.fragmentedTracks[e];for(n=o.trak;n.nextSample<n.samples.length&&this.sampleProcessingStarted;){a.debug("ISOFile","Creating media fragment on track #"+o.id+" for sample "+n.nextSample);var l=this.createFragment(o.id,n.nextSample,o.segmentStream);if(l)o.segmentStream=l,n.nextSample++;else break;if((n.nextSample%o.nb_samples===0||t||n.nextSample>=n.samples.length)&&(a.info("ISOFile","Sending fragmented data on track #"+o.id+" for samples ["+Math.max(0,n.nextSample-o.nb_samples)+","+(n.nextSample-1)+"]"),a.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize()),this.onSegment&&this.onSegment(o.id,o.user,o.segmentStream.buffer,n.nextSample,t||n.nextSample>=n.samples.length),o.segmentStream=null,o!==this.fragmentedTracks[e]))break}}if(this.onSamples!==null)for(e=0;e<this.extractedTracks.length;e++){var u=this.extractedTracks[e];for(n=u.trak;n.nextSample<n.samples.length&&this.sampleProcessingStarted;){a.debug("ISOFile","Exporting on track #"+u.id+" sample #"+n.nextSample);var c=this.getSample(n,n.nextSample);if(c)n.nextSample++,u.samples.push(c);else{this.setNextSeekPositionFromSample(n.samples[n.nextSample]);break}if((n.nextSample%u.nb_samples===0||n.nextSample>=n.samples.length)&&(a.debug("ISOFile","Sending samples on track #"+u.id+" for sample "+n.nextSample),this.onSamples&&this.onSamples(u.id,u.user,u.samples),u.samples=[],u!==this.extractedTracks[e]))break}}}},g.prototype.getBox=function(t){var e=this.getBoxes(t,!0);return e.length?e[0]:null},g.prototype.getBoxes=function(t,e){var n=[];return g._sweep.call(this,t,n,e),n},g._sweep=function(t,e,n){this.type&&this.type==t&&e.push(this);for(var o in this.boxes){if(e.length&&n)return;g._sweep.call(this.boxes[o],t,e,n)}},g.prototype.getTrackSamplesInfo=function(t){var e=this.getTrackById(t);if(e)return e.samples},g.prototype.getTrackSample=function(t,e){var n=this.getTrackById(t),o=this.getSample(n,e);return o},g.prototype.releaseUsedSamples=function(t,e){var n=0,o=this.getTrackById(t);o.lastValidSample||(o.lastValidSample=0);for(var l=o.lastValidSample;l<e;l++)n+=this.releaseSample(o,l);a.info("ISOFile","Track #"+t+" released samples up to "+e+" (released size: "+n+", remaining: "+this.samplesDataSize+")"),o.lastValidSample=e},g.prototype.start=function(){this.sampleProcessingStarted=!0,this.processSamples(!1)},g.prototype.stop=function(){this.sampleProcessingStarted=!1},g.prototype.flush=function(){a.info("ISOFile","Flushing remaining samples"),this.updateSampleLists(),this.processSamples(!0),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0)},g.prototype.seekTrack=function(t,e,n){var o,l,u=1/0,c=0,_=0,x;if(n.samples.length===0)return a.info("ISOFile","No sample in track, cannot seek! Using time "+a.getDurationString(0,1)+" and offset: 0"),{offset:0,time:0};for(o=0;o<n.samples.length;o++){if(l=n.samples[o],o===0)_=0,x=l.timescale;else if(l.cts>t*l.timescale){_=o-1;break}e&&l.is_sync&&(c=o)}for(e&&(_=c),t=n.samples[_].cts,n.nextSample=_;n.samples[_].alreadyRead===n.samples[_].size&&n.samples[_+1];)_++;return u=n.samples[_].offset+n.samples[_].alreadyRead,a.info("ISOFile","Seeking to "+(e?"RAP":"")+" sample #"+n.nextSample+" on track "+n.tkhd.track_id+", time "+a.getDurationString(t,x)+" and offset: "+u),{offset:u,time:t/x}},g.prototype.getTrackDuration=function(t){var e;return t.samples?(e=t.samples[t.samples.length-1],(e.cts+e.duration)/e.timescale):1/0},g.prototype.seek=function(t,e){var n=this.moov,o,l,u,c={offset:1/0,time:1/0};if(this.moov){for(u=0;u<n.traks.length;u++)o=n.traks[u],!(t>this.getTrackDuration(o))&&(l=this.seekTrack(t,e,o),l.offset<c.offset&&(c.offset=l.offset),l.time<c.time&&(c.time=l.time));return a.info("ISOFile","Seeking at time "+a.getDurationString(c.time,1)+" needs a buffer with a fileStart position of "+c.offset),c.offset===1/0?c={offset:this.nextParsePosition,time:0}:c.offset=this.stream.getEndFilePositionAfter(c.offset),a.info("ISOFile","Adjusted seek position (after checking data already in buffer): "+c.offset),c}else throw"Cannot seek: moov not received!"},g.prototype.equal=function(t){for(var e=0;e<this.boxes.length&&e<t.boxes.length;){var n=this.boxes[e],o=t.boxes[e];if(!s.boxEqual(n,o))return!1;e++}return!0},r.ISOFile=g,g.prototype.lastBoxStartPosition=0,g.prototype.parsingMdat=null,g.prototype.nextParsePosition=0,g.prototype.discardMdatData=!1,g.prototype.processIncompleteBox=function(t){var e,n,o;return t.type==="mdat"?(e=new s[t.type+"Box"](t.size),this.parsingMdat=e,this.boxes.push(e),this.mdats.push(e),e.start=t.start,e.hdr_size=t.hdr_size,this.stream.addUsedBytes(e.hdr_size),this.lastBoxStartPosition=e.start+e.size,o=this.stream.seek(e.start+e.size,!1,this.discardMdatData),o?(this.parsingMdat=null,!0):(this.moovStartFound?this.nextParsePosition=this.stream.findEndContiguousBuf():this.nextParsePosition=e.start+e.size,!1)):(t.type==="moov"&&(this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0)),n=this.stream.mergeNextBuffer?this.stream.mergeNextBuffer():!1,n?(this.nextParsePosition=this.stream.getEndPosition(),!0):(t.type?this.moovStartFound?this.nextParsePosition=this.stream.getEndPosition():this.nextParsePosition=this.stream.getPosition()+t.size:this.nextParsePosition=this.stream.getEndPosition(),!1))},g.prototype.hasIncompleteMdat=function(){return this.parsingMdat!==null},g.prototype.processIncompleteMdat=function(){var t,e;return t=this.parsingMdat,e=this.stream.seek(t.start+t.size,!1,this.discardMdatData),e?(a.debug("ISOFile","Found 'mdat' end in buffered data"),this.parsingMdat=null,!0):(this.nextParsePosition=this.stream.findEndContiguousBuf(),!1)},g.prototype.restoreParsePosition=function(){return this.stream.seek(this.lastBoxStartPosition,!0,this.discardMdatData)},g.prototype.saveParsePosition=function(){this.lastBoxStartPosition=this.stream.getPosition()},g.prototype.updateUsedBytes=function(t,e){this.stream.addUsedBytes&&(t.type==="mdat"?(this.stream.addUsedBytes(t.hdr_size),this.discardMdatData&&this.stream.addUsedBytes(t.size-t.hdr_size)):this.stream.addUsedBytes(t.size))},g.prototype.add=s.Box.prototype.add,g.prototype.addBox=s.Box.prototype.addBox,g.prototype.init=function(t){var e=t||{};this.add("ftyp").set("major_brand",e.brands&&e.brands[0]||"iso4").set("minor_version",0).set("compatible_brands",e.brands||["iso4"]);var n=this.add("moov");return n.add("mvhd").set("timescale",e.timescale||600).set("rate",e.rate||65536).set("creation_time",0).set("modification_time",0).set("duration",e.duration||0).set("volume",e.width?0:256).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("next_track_id",1),n.add("mvex"),this},g.prototype.addTrack=function(t){this.moov||this.init(t);var e=t||{};e.width=e.width||320,e.height=e.height||320,e.id=e.id||this.moov.mvhd.next_track_id,e.type=e.type||"avc1";var n=this.moov.add("trak");this.moov.mvhd.next_track_id=e.id+1,n.add("tkhd").set("flags",s.TKHD_FLAG_ENABLED|s.TKHD_FLAG_IN_MOVIE|s.TKHD_FLAG_IN_PREVIEW).set("creation_time",0).set("modification_time",0).set("track_id",e.id).set("duration",e.duration||0).set("layer",e.layer||0).set("alternate_group",0).set("volume",1).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("width",e.width<<16).set("height",e.height<<16);var o=n.add("mdia");o.add("mdhd").set("creation_time",0).set("modification_time",0).set("timescale",e.timescale||1).set("duration",e.media_duration||0).set("language",e.language||"und"),o.add("hdlr").set("handler",e.hdlr||"vide").set("name",e.name||"Track created with MP4Box.js"),o.add("elng").set("extended_language",e.language||"fr-FR");var l=o.add("minf");if(s[e.type+"SampleEntry"]!==void 0){var u=new s[e.type+"SampleEntry"];u.data_reference_index=1;var c="";for(var _ in s.sampleEntryCodes)for(var x=s.sampleEntryCodes[_],S=0;S<x.length;S++)if(x.indexOf(e.type)>-1){c=_;break}switch(c){case"Visual":if(l.add("vmhd").set("graphicsmode",0).set("opcolor",[0,0,0]),u.set("width",e.width).set("height",e.height).set("horizresolution",72<<16).set("vertresolution",72<<16).set("frame_count",1).set("compressorname",e.type+" Compressor").set("depth",24),e.avcDecoderConfigRecord){var w=new s.avcCBox;w.parse(new h(e.avcDecoderConfigRecord)),u.addBox(w)}else if(e.hevcDecoderConfigRecord){var C=new s.hvcCBox;C.parse(new h(e.hevcDecoderConfigRecord)),u.addBox(C)}break;case"Audio":l.add("smhd").set("balance",e.balance||0),u.set("channel_count",e.channel_count||2).set("samplesize",e.samplesize||16).set("samplerate",e.samplerate||65536);break;case"Hint":l.add("hmhd");break;case"Subtitle":switch(l.add("sthd"),e.type){case"stpp":u.set("namespace",e.namespace||"nonamespace").set("schema_location",e.schema_location||"").set("auxiliary_mime_types",e.auxiliary_mime_types||"");break}break;case"Metadata":l.add("nmhd");break;case"System":l.add("nmhd");break;default:l.add("nmhd");break}e.description&&u.addBox(e.description),e.description_boxes&&e.description_boxes.forEach(function(B){u.addBox(B)}),l.add("dinf").add("dref").addEntry(new s["url Box"]().set("flags",1));var F=l.add("stbl");return F.add("stsd").addEntry(u),F.add("stts").set("sample_counts",[]).set("sample_deltas",[]),F.add("stsc").set("first_chunk",[]).set("samples_per_chunk",[]).set("sample_description_index",[]),F.add("stco").set("chunk_offsets",[]),F.add("stsz").set("sample_sizes",[]),this.moov.mvex.add("trex").set("track_id",e.id).set("default_sample_description_index",e.default_sample_description_index||1).set("default_sample_duration",e.default_sample_duration||0).set("default_sample_size",e.default_sample_size||0).set("default_sample_flags",e.default_sample_flags||0),this.buildTrakSampleLists(n),e.id}},s.Box.prototype.computeSize=function(t){var e=t||new f;e.endianness=f.BIG_ENDIAN,this.write(e)},g.prototype.addSample=function(t,e,n){var o=n||{},l={},u=this.getTrackById(t);if(u!==null){l.number=u.samples.length,l.track_id=u.tkhd.track_id,l.timescale=u.mdia.mdhd.timescale,l.description_index=o.sample_description_index?o.sample_description_index-1:0,l.description=u.mdia.minf.stbl.stsd.entries[l.description_index],l.data=e,l.size=e.byteLength,l.alreadyRead=l.size,l.duration=o.duration||1,l.cts=o.cts||0,l.dts=o.dts||0,l.is_sync=o.is_sync||!1,l.is_leading=o.is_leading||0,l.depends_on=o.depends_on||0,l.is_depended_on=o.is_depended_on||0,l.has_redundancy=o.has_redundancy||0,l.degradation_priority=o.degradation_priority||0,l.offset=0,l.subsamples=o.subsamples,u.samples.push(l),u.samples_size+=l.size,u.samples_duration+=l.duration,u.first_dts===void 0&&(u.first_dts=o.dts),this.processSamples();var c=this.createSingleSampleMoof(l);return this.addBox(c),c.computeSize(),c.trafs[0].truns[0].data_offset=c.size+8,this.add("mdat").data=new Uint8Array(e),l}},g.prototype.createSingleSampleMoof=function(t){var e=0;t.is_sync?e=1<<25:e=65536;var n=new s.moofBox;n.add("mfhd").set("sequence_number",this.nextMoofNumber),this.nextMoofNumber++;var o=n.add("traf"),l=this.getTrackById(t.track_id);return o.add("tfhd").set("track_id",t.track_id).set("flags",s.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),o.add("tfdt").set("baseMediaDecodeTime",t.dts-(l.first_dts||0)),o.add("trun").set("flags",s.TRUN_FLAGS_DATA_OFFSET|s.TRUN_FLAGS_DURATION|s.TRUN_FLAGS_SIZE|s.TRUN_FLAGS_FLAGS|s.TRUN_FLAGS_CTS_OFFSET).set("data_offset",0).set("first_sample_flags",0).set("sample_count",1).set("sample_duration",[t.duration]).set("sample_size",[t.size]).set("sample_flags",[e]).set("sample_composition_time_offset",[t.cts-t.dts]),n},g.prototype.lastMoofIndex=0,g.prototype.samplesDataSize=0,g.prototype.resetTables=function(){var t,e,n,o,l,u,c,_;for(this.initial_duration=this.moov.mvhd.duration,this.moov.mvhd.duration=0,t=0;t<this.moov.traks.length;t++){e=this.moov.traks[t],e.tkhd.duration=0,e.mdia.mdhd.duration=0,n=e.mdia.minf.stbl.stco||e.mdia.minf.stbl.co64,n.chunk_offsets=[],o=e.mdia.minf.stbl.stsc,o.first_chunk=[],o.samples_per_chunk=[],o.sample_description_index=[],l=e.mdia.minf.stbl.stsz||e.mdia.minf.stbl.stz2,l.sample_sizes=[],u=e.mdia.minf.stbl.stts,u.sample_counts=[],u.sample_deltas=[],c=e.mdia.minf.stbl.ctts,c&&(c.sample_counts=[],c.sample_offsets=[]),_=e.mdia.minf.stbl.stss;var x=e.mdia.minf.stbl.boxes.indexOf(_);x!=-1&&(e.mdia.minf.stbl.boxes[x]=null)}},g.initSampleGroups=function(t,e,n,o,l){var u,c,_,x;function S(w,C,F){this.grouping_type=w,this.grouping_type_parameter=C,this.sbgp=F,this.last_sample_in_run=-1,this.entry_index=-1}for(e&&(e.sample_groups_info=[]),t.sample_groups_info||(t.sample_groups_info=[]),c=0;c<n.length;c++){for(x=n[c].grouping_type+"/"+n[c].grouping_type_parameter,_=new S(n[c].grouping_type,n[c].grouping_type_parameter,n[c]),e&&(e.sample_groups_info[x]=_),t.sample_groups_info[x]||(t.sample_groups_info[x]=_),u=0;u<o.length;u++)o[u].grouping_type===n[c].grouping_type&&(_.description=o[u],_.description.used=!0);if(l)for(u=0;u<l.length;u++)l[u].grouping_type===n[c].grouping_type&&(_.fragment_description=l[u],_.fragment_description.used=!0,_.is_fragment=!0)}if(e){if(l)for(c=0;c<l.length;c++)!l[c].used&&l[c].version>=2&&(x=l[c].grouping_type+"/0",_=new S(l[c].grouping_type,0),_.is_fragment=!0,e.sample_groups_info[x]||(e.sample_groups_info[x]=_))}else for(c=0;c<o.length;c++)!o[c].used&&o[c].version>=2&&(x=o[c].grouping_type+"/0",_=new S(o[c].grouping_type,0),t.sample_groups_info[x]||(t.sample_groups_info[x]=_))},g.setSampleGroupProperties=function(t,e,n,o){var l,u;e.sample_groups=[];for(l in o)if(e.sample_groups[l]={},e.sample_groups[l].grouping_type=o[l].grouping_type,e.sample_groups[l].grouping_type_parameter=o[l].grouping_type_parameter,n>=o[l].last_sample_in_run&&(o[l].last_sample_in_run<0&&(o[l].last_sample_in_run=0),o[l].entry_index++,o[l].entry_index<=o[l].sbgp.entries.length-1&&(o[l].last_sample_in_run+=o[l].sbgp.entries[o[l].entry_index].sample_count)),o[l].entry_index<=o[l].sbgp.entries.length-1?e.sample_groups[l].group_description_index=o[l].sbgp.entries[o[l].entry_index].group_description_index:e.sample_groups[l].group_description_index=-1,e.sample_groups[l].group_description_index!==0){var c;o[l].fragment_description?c=o[l].fragment_description:c=o[l].description,e.sample_groups[l].group_description_index>0?(e.sample_groups[l].group_description_index>65535?u=(e.sample_groups[l].group_description_index>>16)-1:u=e.sample_groups[l].group_description_index-1,c&&u>=0&&(e.sample_groups[l].description=c.entries[u])):c&&c.version>=2&&c.default_group_description_index>0&&(e.sample_groups[l].description=c.entries[c.default_group_description_index-1])}},g.process_sdtp=function(t,e,n){e&&(t?(e.is_leading=t.is_leading[n],e.depends_on=t.sample_depends_on[n],e.is_depended_on=t.sample_is_depended_on[n],e.has_redundancy=t.sample_has_redundancy[n]):(e.is_leading=0,e.depends_on=0,e.is_depended_on=0,e.has_redundancy=0))},g.prototype.buildSampleLists=function(){var t,e;for(t=0;t<this.moov.traks.length;t++)e=this.moov.traks[t],this.buildTrakSampleLists(e)},g.prototype.buildTrakSampleLists=function(t){var e,n,o,l,u,c,_,x,S,w,C,F,B,K,O,et,at,ft,ct,kt,Re,ei,Lt,R;if(t.samples=[],t.samples_duration=0,t.samples_size=0,n=t.mdia.minf.stbl.stco||t.mdia.minf.stbl.co64,o=t.mdia.minf.stbl.stsc,l=t.mdia.minf.stbl.stsz||t.mdia.minf.stbl.stz2,u=t.mdia.minf.stbl.stts,c=t.mdia.minf.stbl.ctts,_=t.mdia.minf.stbl.stss,x=t.mdia.minf.stbl.stsd,S=t.mdia.minf.stbl.subs,F=t.mdia.minf.stbl.stdp,w=t.mdia.minf.stbl.sbgps,C=t.mdia.minf.stbl.sgpds,ft=-1,ct=-1,kt=-1,Re=-1,ei=0,Lt=0,R=0,g.initSampleGroups(t,null,w,C),!(typeof l>"u")){for(e=0;e<l.sample_sizes.length;e++){var P={};P.number=e,P.track_id=t.tkhd.track_id,P.timescale=t.mdia.mdhd.timescale,P.alreadyRead=0,t.samples[e]=P,P.size=l.sample_sizes[e],t.samples_size+=P.size,e===0?(K=1,B=0,P.chunk_index=K,P.chunk_run_index=B,at=o.samples_per_chunk[B],et=0,B+1<o.first_chunk.length?O=o.first_chunk[B+1]-1:O=1/0):e<at?(P.chunk_index=K,P.chunk_run_index=B):(K++,P.chunk_index=K,et=0,K<=O||(B++,B+1<o.first_chunk.length?O=o.first_chunk[B+1]-1:O=1/0),P.chunk_run_index=B,at+=o.samples_per_chunk[B]),P.description_index=o.sample_description_index[P.chunk_run_index]-1,P.description=x.entries[P.description_index],P.offset=n.chunk_offsets[P.chunk_index-1]+et,et+=P.size,e>ft&&(ct++,ft<0&&(ft=0),ft+=u.sample_counts[ct]),e>0?(t.samples[e-1].duration=u.sample_deltas[ct],t.samples_duration+=t.samples[e-1].duration,P.dts=t.samples[e-1].dts+t.samples[e-1].duration):P.dts=0,c?(e>=kt&&(Re++,kt<0&&(kt=0),kt+=c.sample_counts[Re]),P.cts=t.samples[e].dts+c.sample_offsets[Re]):P.cts=P.dts,_?(e==_.sample_numbers[ei]-1?(P.is_sync=!0,ei++):(P.is_sync=!1,P.degradation_priority=0),S&&S.entries[Lt].sample_delta+R==e+1&&(P.subsamples=S.entries[Lt].subsamples,R+=S.entries[Lt].sample_delta,Lt++)):P.is_sync=!0,g.process_sdtp(t.mdia.minf.stbl.sdtp,P,P.number),F?P.degradation_priority=F.priority[e]:P.degradation_priority=0,S&&S.entries[Lt].sample_delta+R==e&&(P.subsamples=S.entries[Lt].subsamples,R+=S.entries[Lt].sample_delta),(w.length>0||C.length>0)&&g.setSampleGroupProperties(t,P,e,t.sample_groups_info)}e>0&&(t.samples[e-1].duration=Math.max(t.mdia.mdhd.duration-t.samples[e-1].dts,0),t.samples_duration+=t.samples[e-1].duration)}},g.prototype.updateSampleLists=function(){var t,e,n,o,l,u,c,_,x,S,w,C,F,B,K;if(this.moov!==void 0){for(;this.lastMoofIndex<this.moofs.length;)if(x=this.moofs[this.lastMoofIndex],this.lastMoofIndex++,x.type=="moof")for(S=x,t=0;t<S.trafs.length;t++){for(w=S.trafs[t],C=this.getTrackById(w.tfhd.track_id),F=this.getTrexById(w.tfhd.track_id),w.tfhd.flags&s.TFHD_FLAG_SAMPLE_DESC?o=w.tfhd.default_sample_description_index:o=F?F.default_sample_description_index:1,w.tfhd.flags&s.TFHD_FLAG_SAMPLE_DUR?l=w.tfhd.default_sample_duration:l=F?F.default_sample_duration:0,w.tfhd.flags&s.TFHD_FLAG_SAMPLE_SIZE?u=w.tfhd.default_sample_size:u=F?F.default_sample_size:0,w.tfhd.flags&s.TFHD_FLAG_SAMPLE_FLAGS?c=w.tfhd.default_sample_flags:c=F?F.default_sample_flags:0,w.sample_number=0,w.sbgps.length>0&&g.initSampleGroups(C,w,w.sbgps,C.mdia.minf.stbl.sgpds,w.sgpds),e=0;e<w.truns.length;e++){var O=w.truns[e];for(n=0;n<O.sample_count;n++){B={},B.moof_number=this.lastMoofIndex,B.number_in_traf=w.sample_number,w.sample_number++,B.number=C.samples.length,w.first_sample_index=C.samples.length,C.samples.push(B),B.track_id=C.tkhd.track_id,B.timescale=C.mdia.mdhd.timescale,B.description_index=o-1,B.description=C.mdia.minf.stbl.stsd.entries[B.description_index],B.size=u,O.flags&s.TRUN_FLAGS_SIZE&&(B.size=O.sample_size[n]),C.samples_size+=B.size,B.duration=l,O.flags&s.TRUN_FLAGS_DURATION&&(B.duration=O.sample_duration[n]),C.samples_duration+=B.duration,C.first_traf_merged||n>0?B.dts=C.samples[C.samples.length-2].dts+C.samples[C.samples.length-2].duration:(w.tfdt?B.dts=w.tfdt.baseMediaDecodeTime:B.dts=0,C.first_traf_merged=!0),B.cts=B.dts,O.flags&s.TRUN_FLAGS_CTS_OFFSET&&(B.cts=B.dts+O.sample_composition_time_offset[n]),K=c,O.flags&s.TRUN_FLAGS_FLAGS?K=O.sample_flags[n]:n===0&&O.flags&s.TRUN_FLAGS_FIRST_FLAG&&(K=O.first_sample_flags),B.is_sync=!(K>>16&1),B.is_leading=K>>26&3,B.depends_on=K>>24&3,B.is_depended_on=K>>22&3,B.has_redundancy=K>>20&3,B.degradation_priority=K&65535;var et=!!(w.tfhd.flags&s.TFHD_FLAG_BASE_DATA_OFFSET),at=!!(w.tfhd.flags&s.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),ft=!!(O.flags&s.TRUN_FLAGS_DATA_OFFSET),ct=0;et?ct=w.tfhd.base_data_offset:at||e===0?ct=S.start:ct=_,e===0&&n===0?ft?B.offset=ct+O.data_offset:B.offset=ct:B.offset=_,_=B.offset+B.size,(w.sbgps.length>0||w.sgpds.length>0||C.mdia.minf.stbl.sbgps.length>0||C.mdia.minf.stbl.sgpds.length>0)&&g.setSampleGroupProperties(C,B,B.number_in_traf,w.sample_groups_info)}}if(w.subs){C.has_fragment_subsamples=!0;var kt=w.first_sample_index;for(e=0;e<w.subs.entries.length;e++)kt+=w.subs.entries[e].sample_delta,B=C.samples[kt-1],B.subsamples=w.subs.entries[e].subsamples}}}},g.prototype.getSample=function(t,e){var n,o=t.samples[e];if(!this.moov)return null;if(!o.data)o.data=new Uint8Array(o.size),o.alreadyRead=0,this.samplesDataSize+=o.size,a.debug("ISOFile","Allocating sample #"+e+" on track #"+t.tkhd.track_id+" of size "+o.size+" (total: "+this.samplesDataSize+")");else if(o.alreadyRead==o.size)return o;for(;;){var l=this.stream.findPosition(!0,o.offset+o.alreadyRead,!1);if(l>-1){n=this.stream.buffers[l];var u=n.byteLength-(o.offset+o.alreadyRead-n.fileStart);if(o.size-o.alreadyRead<=u)return a.debug("ISOFile","Getting sample #"+e+" data (alreadyRead: "+o.alreadyRead+" offset: "+(o.offset+o.alreadyRead-n.fileStart)+" read size: "+(o.size-o.alreadyRead)+" full size: "+o.size+")"),f.memcpy(o.data.buffer,o.alreadyRead,n,o.offset+o.alreadyRead-n.fileStart,o.size-o.alreadyRead),n.usedBytes+=o.size-o.alreadyRead,this.stream.logBufferLevel(),o.alreadyRead=o.size,o;if(u===0)return null;a.debug("ISOFile","Getting sample #"+e+" partial data (alreadyRead: "+o.alreadyRead+" offset: "+(o.offset+o.alreadyRead-n.fileStart)+" read size: "+u+" full size: "+o.size+")"),f.memcpy(o.data.buffer,o.alreadyRead,n,o.offset+o.alreadyRead-n.fileStart,u),o.alreadyRead+=u,n.usedBytes+=u,this.stream.logBufferLevel()}else return null}},g.prototype.releaseSample=function(t,e){var n=t.samples[e];return n.data?(this.samplesDataSize-=n.size,n.data=null,n.alreadyRead=0,n.size):0},g.prototype.getAllocatedSampleDataSize=function(){return this.samplesDataSize},g.prototype.getCodecs=function(){var t,e="";for(t=0;t<this.moov.traks.length;t++){var n=this.moov.traks[t];t>0&&(e+=","),e+=n.mdia.minf.stbl.stsd.entries[0].getCodec()}return e},g.prototype.getTrexById=function(t){var e;if(!this.moov||!this.moov.mvex)return null;for(e=0;e<this.moov.mvex.trexs.length;e++){var n=this.moov.mvex.trexs[e];if(n.track_id==t)return n}return null},g.prototype.getTrackById=function(t){if(this.moov===void 0)return null;for(var e=0;e<this.moov.traks.length;e++){var n=this.moov.traks[e];if(n.tkhd.track_id==t)return n}return null},g.prototype.itemsDataSize=0,g.prototype.flattenItemInfo=function(){var t=this.items,e=this.entity_groups,n,o,l,u=this.meta;if(u!=null&&u.hdlr!==void 0&&u.iinf!==void 0){for(n=0;n<u.iinf.item_infos.length;n++)l={},l.id=u.iinf.item_infos[n].item_ID,t[l.id]=l,l.ref_to=[],l.name=u.iinf.item_infos[n].item_name,u.iinf.item_infos[n].protection_index>0&&(l.protection=u.ipro.protections[u.iinf.item_infos[n].protection_index-1]),u.iinf.item_infos[n].item_type?l.type=u.iinf.item_infos[n].item_type:l.type="mime",l.content_type=u.iinf.item_infos[n].content_type,l.content_encoding=u.iinf.item_infos[n].content_encoding,l.item_uri_type=u.iinf.item_infos[n].item_uri_type;if(u.grpl)for(n=0;n<u.grpl.boxes.length;n++)entity_group={},entity_group.id=u.grpl.boxes[n].group_id,entity_group.entity_ids=u.grpl.boxes[n].entity_ids,entity_group.type=u.grpl.boxes[n].type,e[entity_group.id]=entity_group;if(u.iloc)for(n=0;n<u.iloc.items.length;n++){var c=u.iloc.items[n];switch(l=t[c.item_ID],c.data_reference_index!==0&&(a.warn("Item storage with reference to other files: not supported"),l.source=u.dinf.boxes[c.data_reference_index-1]),c.construction_method){case 0:break;case 1:break;case 2:a.warn("Item storage with construction_method : not supported");break}for(l.extents=[],l.size=0,o=0;o<c.extents.length;o++)l.extents[o]={},l.extents[o].offset=c.extents[o].extent_offset+c.base_offset,c.construction_method==1&&(l.extents[o].offset+=u.idat.start+u.idat.hdr_size),l.extents[o].length=c.extents[o].extent_length,l.extents[o].alreadyRead=0,l.size+=l.extents[o].length}if(u.pitm&&(t[u.pitm.item_id].primary=!0),u.iref)for(n=0;n<u.iref.references.length;n++){var _=u.iref.references[n];for(o=0;o<_.references.length;o++)t[_.from_item_ID].ref_to.push({type:_.type,id:_.references[o]})}if(u.iprp)for(var x=0;x<u.iprp.ipmas.length;x++){var S=u.iprp.ipmas[x];for(n=0;n<S.associations.length;n++){var w=S.associations[n];if(l=t[w.id],l||(l=e[w.id]),l)for(l.properties===void 0&&(l.properties={},l.properties.boxes=[]),o=0;o<w.props.length;o++){var C=w.props[o];if(C.property_index>0&&C.property_index-1<u.iprp.ipco.boxes.length){var F=u.iprp.ipco.boxes[C.property_index-1];l.properties[F.type]=F,l.properties.boxes.push(F)}}}}}},g.prototype.getItem=function(t){var e,n;if(!this.meta)return null;if(n=this.items[t],!n.data&&n.size)n.data=new Uint8Array(n.size),n.alreadyRead=0,this.itemsDataSize+=n.size,a.debug("ISOFile","Allocating item #"+t+" of size "+n.size+" (total: "+this.itemsDataSize+")");else if(n.alreadyRead===n.size)return n;for(var o=0;o<n.extents.length;o++){var l=n.extents[o];if(l.alreadyRead!==l.length){var u=this.stream.findPosition(!0,l.offset+l.alreadyRead,!1);if(u>-1){e=this.stream.buffers[u];var c=e.byteLength-(l.offset+l.alreadyRead-e.fileStart);if(l.length-l.alreadyRead<=c)a.debug("ISOFile","Getting item #"+t+" extent #"+o+" data (alreadyRead: "+l.alreadyRead+" offset: "+(l.offset+l.alreadyRead-e.fileStart)+" read size: "+(l.length-l.alreadyRead)+" full extent size: "+l.length+" full item size: "+n.size+")"),f.memcpy(n.data.buffer,n.alreadyRead,e,l.offset+l.alreadyRead-e.fileStart,l.length-l.alreadyRead),e.usedBytes+=l.length-l.alreadyRead,this.stream.logBufferLevel(),n.alreadyRead+=l.length-l.alreadyRead,l.alreadyRead=l.length;else return a.debug("ISOFile","Getting item #"+t+" extent #"+o+" partial data (alreadyRead: "+l.alreadyRead+" offset: "+(l.offset+l.alreadyRead-e.fileStart)+" read size: "+c+" full extent size: "+l.length+" full item size: "+n.size+")"),f.memcpy(n.data.buffer,n.alreadyRead,e,l.offset+l.alreadyRead-e.fileStart,c),l.alreadyRead+=c,n.alreadyRead+=c,e.usedBytes+=c,this.stream.logBufferLevel(),null}else return null}}return n.alreadyRead===n.size?n:null},g.prototype.releaseItem=function(t){var e=this.items[t];if(e.data){this.itemsDataSize-=e.size,e.data=null,e.alreadyRead=0;for(var n=0;n<e.extents.length;n++){var o=e.extents[n];o.alreadyRead=0}return e.size}else return 0},g.prototype.processItems=function(t){for(var e in this.items){var n=this.items[e];this.getItem(n.id),t&&!n.sent&&(t(n),n.sent=!0,n.data=null)}},g.prototype.hasItem=function(t){for(var e in this.items){var n=this.items[e];if(n.name===t)return n.id}return-1},g.prototype.getMetaHandler=function(){return this.meta?this.meta.hdlr.handler:null},g.prototype.getPrimaryItem=function(){return!this.meta||!this.meta.pitm?null:this.getItem(this.meta.pitm.item_id)},g.prototype.itemToFragmentedTrackFile=function(t){var e=t||{},n=null;if(e.itemId?n=this.getItem(e.itemId):n=this.getPrimaryItem(),n==null)return null;var o=new g;o.discardMdatData=!1;var l={type:n.type,description_boxes:n.properties.boxes};n.properties.ispe&&(l.width=n.properties.ispe.image_width,l.height=n.properties.ispe.image_height);var u=o.addTrack(l);return u?(o.addSample(u,n.data),o):null},g.prototype.write=function(t){for(var e=0;e<this.boxes.length;e++)this.boxes[e].write(t)},g.prototype.createFragment=function(t,e,n){var o=this.getTrackById(t),l=this.getSample(o,e);if(l==null)return this.setNextSeekPositionFromSample(o.samples[e]),null;var u=n||new f;u.endianness=f.BIG_ENDIAN;var c=this.createSingleSampleMoof(l);c.write(u),c.trafs[0].truns[0].data_offset=c.size+8,a.debug("MP4Box","Adjusting data_offset with new value "+c.trafs[0].truns[0].data_offset),u.adjustUint32(c.trafs[0].truns[0].data_offset_position,c.trafs[0].truns[0].data_offset);var _=new s.mdatBox;return _.data=l.data,_.write(u),u},g.writeInitializationSegment=function(t,e,n,o){var l;a.debug("ISOFile","Generating initialization segment");var u=new f;u.endianness=f.BIG_ENDIAN,t.write(u);var c=e.add("mvex");for(n&&c.add("mehd").set("fragment_duration",n),l=0;l<e.traks.length;l++)c.add("trex").set("track_id",e.traks[l].tkhd.track_id).set("default_sample_description_index",1).set("default_sample_duration",o).set("default_sample_size",0).set("default_sample_flags",65536);return e.write(u),u.buffer},g.prototype.save=function(t){var e=new f;e.endianness=f.BIG_ENDIAN,this.write(e),e.save(t)},g.prototype.getBuffer=function(){var t=new f;return t.endianness=f.BIG_ENDIAN,this.write(t),t.buffer},g.prototype.initializeSegmentation=function(){var t,e,n,o;for(this.onSegment===null&&a.warn("MP4Box","No segmentation callback set!"),this.isFragmentationInitialized||(this.isFragmentationInitialized=!0,this.nextMoofNumber=0,this.resetTables()),e=[],t=0;t<this.fragmentedTracks.length;t++){var l=new s.moovBox;l.mvhd=this.moov.mvhd,l.boxes.push(l.mvhd),n=this.getTrackById(this.fragmentedTracks[t].id),l.boxes.push(n),l.traks.push(n),o={},o.id=n.tkhd.track_id,o.user=this.fragmentedTracks[t].user,o.buffer=g.writeInitializationSegment(this.ftyp,l,this.moov.mvex&&this.moov.mvex.mehd?this.moov.mvex.mehd.fragment_duration:void 0,this.moov.traks[t].samples.length>0?this.moov.traks[t].samples[0].duration:0),e.push(o)}return e},s.Box.prototype.printHeader=function(t){this.size+=8,this.size>d&&(this.size+=8),this.type==="uuid"&&(this.size+=16),t.log(t.indent+"size:"+this.size),t.log(t.indent+"type:"+this.type)},s.FullBox.prototype.printHeader=function(t){this.size+=4,s.Box.prototype.printHeader.call(this,t),t.log(t.indent+"version:"+this.version),t.log(t.indent+"flags:"+this.flags)},s.Box.prototype.print=function(t){this.printHeader(t)},s.ContainerBox.prototype.print=function(t){this.printHeader(t);for(var e=0;e<this.boxes.length;e++)if(this.boxes[e]){var n=t.indent;t.indent+=" ",this.boxes[e].print(t),t.indent=n}},g.prototype.print=function(t){t.indent="";for(var e=0;e<this.boxes.length;e++)this.boxes[e]&&this.boxes[e].print(t)},s.mvhdBox.prototype.print=function(t){s.FullBox.prototype.printHeader.call(this,t),t.log(t.indent+"creation_time: "+this.creation_time),t.log(t.indent+"modification_time: "+this.modification_time),t.log(t.indent+"timescale: "+this.timescale),t.log(t.indent+"duration: "+this.duration),t.log(t.indent+"rate: "+this.rate),t.log(t.indent+"volume: "+(this.volume>>8)),t.log(t.indent+"matrix: "+this.matrix.join(", ")),t.log(t.indent+"next_track_id: "+this.next_track_id)},s.tkhdBox.prototype.print=function(t){s.FullBox.prototype.printHeader.call(this,t),t.log(t.indent+"creation_time: "+this.creation_time),t.log(t.indent+"modification_time: "+this.modification_time),t.log(t.indent+"track_id: "+this.track_id),t.log(t.indent+"duration: "+this.duration),t.log(t.indent+"volume: "+(this.volume>>8)),t.log(t.indent+"matrix: "+this.matrix.join(", ")),t.log(t.indent+"layer: "+this.layer),t.log(t.indent+"alternate_group: "+this.alternate_group),t.log(t.indent+"width: "+this.width),t.log(t.indent+"height: "+this.height)};var M={};M.createFile=function(t,e){var n=t!==void 0?t:!0,o=new g(e);return o.discardMdatData=!n,o},r.createFile=M.createFile})($s);const ui=Dl($s),Kr=10;async function Ml(r,a,h,f,d){return new Promise((p,v)=>{const s=ui.createFile();let m=null,y=null,E=!1,A=null,T=0;s.onReady=e=>{const n=e.videoTracks?.[0];let o=null;if(n){m=n.id,T=n.nb_samples??0,o={width:n.video.width,height:n.video.height,codec:n.codec,framerate:n.movie_duration&&n.nb_samples?n.nb_samples*n.movie_timescale/n.movie_duration:null};const u=s.getTrackById(m).mdia.minf.stbl.stsd.entries[0],c=Rl(u);a.configure({codec:n.codec,codedWidth:n.video.width,codedHeight:n.video.height,description:c}),s.setExtractionOptions(m,"video",{nbSamples:100})}const l=e.audioTracks?.[0];l&&h&&(E=!0,y=l.id,A={sampleRate:l.audio.sample_rate,numberOfChannels:l.audio.channel_count},h.configure({codec:l.codec,sampleRate:l.audio.sample_rate,numberOfChannels:l.audio.channel_count}),s.setExtractionOptions(y,"audio",{nbSamples:100})),f({hasAudio:E,audioFormat:A,videoFormat:o,totalFrames:T}),s.start()},s.onSamples=(e,n,o)=>{if(e===m)for(const l of o){const u=new EncodedVideoChunk({type:l.is_sync?"key":"delta",timestamp:Math.round(1e6*l.cts/l.timescale),duration:Math.round(1e6*l.duration/l.timescale),data:l.data});a.decode(u)}else if(e===y)for(const l of o){const u=new EncodedAudioChunk({type:"key",timestamp:Math.round(1e6*l.cts/l.timescale),duration:Math.round(1e6*l.duration/l.timescale),data:l.data});h.decode(u)}};const I=1024*1024*5;let g=0;const M=new FileReader;M.onload=e=>{const n=e.target.result;n.fileStart=g,s.appendBuffer(n),g+=n.byteLength;const o=Math.min(Kr,g/r.size*Kr);d(o),g<r.size?t():(s.flush(),p({hasAudio:E}))},M.onerror=()=>{v(new Error("Failed to read file"))};function t(){const e=r.slice(g,g+I);M.readAsArrayBuffer(e)}t()})}function Rl(r){if(r.avcC){const a=new ui.DataStream(void 0,0,ui.DataStream.BIG_ENDIAN);return r.avcC.write(a),new Uint8Array(a.buffer.slice(8))}else if(r.hvcC){const a=new ui.DataStream(void 0,0,ui.DataStream.BIG_ENDIAN);return r.hvcC.write(a),new Uint8Array(a.buffer.slice(8))}return null}const Mn=10,Ol=100-Mn;async function Nl(r,a,h){const d=await(await window.showSaveFilePicker({suggestedName:"output.mp4",types:[{description:"Video File",accept:{"video/mp4":[".mp4"]}}]})).createWritable();let p=null,v=null,s=null,m=0,y=0;const E=performance.now(),A=100;let T=0,I=0,g=!1,M;const t=new Promise(c=>{M=c});let e=null;const n=()=>{g&&T===0&&I===0&&(e&&clearTimeout(e),e=setTimeout(()=>{T===0&&I===0&&M()},A))},o=c=>{const{hasAudio:_,audioFormat:x,videoFormat:S,totalFrames:w}=c;y=w??0,a.video.rotation&&a.video.rotation!==0&&console.warn("Video rotation is not yet implemented and will be ignored."),(a.video.flipHorizontal||a.video.flipVertical)&&console.warn("Video flipping is not yet implemented and will be ignored.");let C=a.video.framerate;a.video.framerateMode==="original"&&S?.framerate&&(C=S.framerate,console.log(`Using original framerate: ${C.toFixed(2)} fps`));let F=a.video.width,B=a.video.height;if(S){const O=S.width,et=S.height,at=O/et;if(F&&!B)B=Math.round(F/at);else if(!F&&B)F=Math.round(B*at);else if(F&&B){const ft=F/B;Math.abs(ft-at)>.01&&(ft>at?F=Math.round(B*at):B=Math.round(F/at))}if(F>O||B>et){const ft=Math.min(O/F,et/B);F=Math.round(F*ft),B=Math.round(B*ft)}F=Math.round(F/2)*2,B=Math.round(B/2)*2}const K={target:new Ns(d),video:{codec:"avc",width:F,height:B},fastStart:!1,firstTimestampBehavior:"offset"};_&&a.audio&&x&&(K.audio={codec:"aac",sampleRate:x.sampleRate,numberOfChannels:x.numberOfChannels}),p=new Ll(K),v=new VideoEncoder({output:(O,et)=>{T++;try{p.addVideoChunk(O,et)}finally{T--,n()}},error:O=>console.error("VideoEncoder error",O)}),v.configure({codec:a.video.codec??"avc1.640028",width:F,height:B,bitrate:a.video.bitrate,framerate:C,latencyMode:"quality"}),_&&a.audio&&x&&(s=new AudioEncoder({output:(O,et)=>{I++;try{p.addAudioChunk(O,et)}finally{I--,n()}},error:O=>console.error("AudioEncoder error",O)}),s.configure({codec:a.audio.codec??"mp4a.40.2",sampleRate:x.sampleRate,numberOfChannels:x.numberOfChannels,bitrate:a.audio.bitrate}))},l=new VideoDecoder({output:c=>{if(m++,v&&v.state==="configured")try{v.encode(c)}catch(C){console.error("VideoEncoder encode error:",C)}c.close();const _=performance.now()-E,x=m/(_/1e3);let S=Mn;y>0&&(S=Mn+m/y*Ol);let w=0;if(y>0&&m>0&&m<y){const C=m/y;w=_/C-_}h(S,{fps:x,elapsedMs:_,etaMs:w})},error:c=>console.error("VideoDecoder error",c)}),u=new AudioDecoder({output:c=>{if(s&&s.state==="configured")try{s.encode(c)}catch(_){console.error("AudioEncoder encode error:",_)}c.close()},error:c=>console.error("AudioDecoder error",c)});await Ml(r,l,u,o,c=>h(c));try{await v.flush()}catch(c){console.error("VideoEncoder flush error:",c)}if(s)try{await s.flush()}catch(c){console.error("AudioEncoder flush error:",c)}g=!0,n(),await t,h(100),p.finalize(),await d.close()}const Gl="video-encoder-presets",Xr=[{name:"4K60 (20Mbps) H.264",config_json:{container:"mp4",codec:"avc1.640028",audioCodec:"mp4a.40.2",width:3840,height:2160,bitrate:2e7,framerate:60,audio_bitrate:192e3}},{name:"4K30 (15Mbps) H.264",config_json:{container:"mp4",codec:"avc1.640028",audioCodec:"mp4a.40.2",width:3840,height:2160,bitrate:15e6,framerate:30,audio_bitrate:192e3}},{name:"1440p60 (12Mbps) H.264",config_json:{container:"mp4",codec:"avc1.640028",audioCodec:"mp4a.40.2",width:2560,height:1440,bitrate:12e6,framerate:60,audio_bitrate:16e4}},{name:"1440p30 (8Mbps) H.264",config_json:{container:"mp4",codec:"avc1.640028",audioCodec:"mp4a.40.2",width:2560,height:1440,bitrate:8e6,framerate:30,audio_bitrate:16e4}},{name:"1080p60 (8Mbps) H.264",config_json:{container:"mp4",codec:"avc1.640028",audioCodec:"mp4a.40.2",width:1920,height:1080,bitrate:8e6,framerate:60,audio_bitrate:128e3}},{name:"1080p30 (5Mbps) H.264",config_json:{container:"mp4",codec:"avc1.640028",audioCodec:"mp4a.40.2",width:1920,height:1080,bitrate:5e6,framerate:30,audio_bitrate:128e3}},{name:"720p60 (5Mbps) H.264",config_json:{container:"mp4",codec:"avc1.42001f",audioCodec:"mp4a.40.2",width:1280,height:720,bitrate:5e6,framerate:60,audio_bitrate:128e3}},{name:"720p30 (3Mbps) H.264",config_json:{container:"mp4",codec:"avc1.42001f",audioCodec:"mp4a.40.2",width:1280,height:720,bitrate:3e6,framerate:30,audio_bitrate:128e3}},{name:"480p30 (1.5Mbps) H.264",config_json:{container:"mp4",codec:"avc1.42001e",audioCodec:"mp4a.40.2",width:854,height:480,bitrate:15e5,framerate:30,audio_bitrate:96e3}},{name:"1080p30 (4Mbps) VP9",config_json:{container:"webm",codec:"vp09.00.31.08",audioCodec:"opus",width:1920,height:1080,bitrate:4e6,framerate:30,audio_bitrate:128e3}},{name:"720p30 (2Mbps) VP9",config_json:{container:"webm",codec:"vp09.00.31.08",audioCodec:"opus",width:1280,height:720,bitrate:2e6,framerate:30,audio_bitrate:96e3}},{name:"1080p30 (3Mbps) AV1",config_json:{container:"webm",codec:"av01.0.05M.08",audioCodec:"opus",width:1920,height:1080,bitrate:3e6,framerate:30,audio_bitrate:128e3}},{name:"720p30 (1.5Mbps) AV1",config_json:{container:"webm",codec:"av01.0.04M.08",audioCodec:"opus",width:1280,height:720,bitrate:15e5,framerate:30,audio_bitrate:96e3}}];function Hl(){try{const r=localStorage.getItem(Gl);if(!r)return Xr;const a=JSON.parse(r);if(Array.isArray(a)&&a.length>0)return a}catch{}return Xr}var Vl=pt('<div class="panel svelte-1n46o8q"><p class="svelte-1n46o8q"> </p></div>'),Yl=pt("<option> </option>"),ql=pt('<div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <select class="svelte-1n46o8q"></select></div>'),jl=pt('<div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <select class="svelte-1n46o8q"><option>4K (38402160)</option><option>1440p (25601440)</option><option>1080p (19201080)</option><option>720p (1280720)</option><option>480p (854480)</option><option>360p (640360)</option></select></div>'),Wl=pt('<div class="row svelte-1n46o8q"><label class="svelte-1n46o8q"> (px):</label> <input type="number" min="64" max="7680" step="2" class="svelte-1n46o8q"/></div> <div class="row svelte-1n46o8q"><label class="svelte-1n46o8q"> (px):</label> <input type="number" min="64" max="4320" step="2" class="svelte-1n46o8q"/></div>',1),Kl=pt('<div class="row svelte-1n46o8q"><label class="svelte-1n46o8q"> (px):</label> <input type="number" min="64" max="7680" step="2" class="svelte-1n46o8q"/> <p style="color: #999; font-size: 12px;" class="svelte-1n46o8q"></p></div>'),Xl=pt('<div class="row svelte-1n46o8q"><label class="svelte-1n46o8q"> (px):</label> <input type="number" min="64" max="4320" step="2" class="svelte-1n46o8q"/> <p style="color: #999; font-size: 12px;" class="svelte-1n46o8q"></p></div>'),Zl=pt('<div class="row svelte-1n46o8q"><label class="svelte-1n46o8q"> (fps):</label> <input type="number" min="1" max="120" step="1" class="svelte-1n46o8q"/></div>'),$l=pt('<div class="panel svelte-1n46o8q"><h3 class="section-title svelte-1n46o8q"></h3> <div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <select class="svelte-1n46o8q"><option>MP4</option><option>MOV</option><option>WebM</option></select></div> <div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <select class="svelte-1n46o8q"><optgroup label="H.264 (AVC)"><option>H.264 High Profile</option> <option>H.264 Main Profile</option> <option>H.264 Baseline Profile</option> <option>H.264 Baseline Level 3.0</option></optgroup><optgroup label="H.265 (HEVC)"><option>H.265 Main Profile</option> <option>H.265 Main (hvc1)</option></optgroup><optgroup label="VP9"><option>VP9 Profile 0</option> <option>VP9 Profile 0 Level 4.1</option></optgroup><optgroup label="AV1"><option>AV1 Main Profile Level 3.1</option> <option>AV1 Main Profile Level 3.0</option></optgroup></select></div> <div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <select class="svelte-1n46o8q"><optgroup label="AAC"><option>AAC-LC</option> <option>AAC-HE</option></optgroup><optgroup label="Opus (WebM)"><option>Opus</option></optgroup></select></div> <div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <select class="svelte-1n46o8q"><option></option><option>()</option><option></option><option></option></select></div> <!> <div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <select class="svelte-1n46o8q"><option></option><option></option></select></div> <!> <div class="row svelte-1n46o8q"><label class="svelte-1n46o8q"> (Kbps):</label> <input type="number" min="100" max="50000" step="100" class="svelte-1n46o8q"/></div> <div class="row svelte-1n46o8q"><label class="svelte-1n46o8q"> (Kbps):</label> <input type="number" min="32" max="320" step="8" class="svelte-1n46o8q"/></div></div> <div class="panel svelte-1n46o8q"><h3 class="section-title svelte-1n46o8q"></h3> <p style="color: #ff9800; background: #fff3e0; padding: 8px; border-radius: 4px; font-size: 12px; margin-bottom: 16px;" class="svelte-1n46o8q"> </p> <div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <select class="svelte-1n46o8q"><option>0</option><option>90</option><option>180</option><option>270</option></select></div> <div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <div class="checkbox-group svelte-1n46o8q"><label class="checkbox-label svelte-1n46o8q"><input type="checkbox" class="svelte-1n46o8q"/> <span></span></label> <label class="checkbox-label svelte-1n46o8q"><input type="checkbox" class="svelte-1n46o8q"/> <span></span></label></div></div></div>',1),Jl=pt('<p class="svelte-1n46o8q"> </p>'),Ql=pt('<div class="panel svelte-1n46o8q"><div class="progress svelte-1n46o8q"><div class="svelte-1n46o8q"></div></div> <p class="svelte-1n46o8q"> </p> <p class="svelte-1n46o8q"> </p> <!></div>'),th=pt('<div class="panel svelte-1n46o8q"><p style="color: #2e7d32; background: #e8f5e9; padding: 12px; border-radius: 4px;" class="svelte-1n46o8q"> </p></div>'),eh=pt('<div class="panel preset-toggle svelte-1n46o8q"><div class="row svelte-1n46o8q"><label class="svelte-1n46o8q">:</label> <select class="svelte-1n46o8q"><option></option><option></option></select></div> <!></div> <!> <div class="panel svelte-1n46o8q"><button class="svelte-1n46o8q"></button></div> <!> <!>',1),ih=pt('<div class="panel svelte-1n46o8q"><p style="color: #999;" class="svelte-1n46o8q">...</p></div>'),nh=pt('<div class="container svelte-1n46o8q"><h1 class="svelte-1n46o8q"></h1> <div class="dropzone svelte-1n46o8q"><input type="file" id="fileInput" accept="video/mp4" class="svelte-1n46o8q"/> <p class="svelte-1n46o8q">MP4&  </p></div> <!> <!></div>');function rh(r,a){ns(a,!1);let h=X(null),f=X([]),d=X(0),p=X(!0),v=X(0),s=X(0),m=X(0),y=X(0),E=X(!1),A=X(""),T=X("mp4"),I=X("avc1.640028"),g=X("mp4a.40.2"),M=X("preset"),t=X("1080p"),e=X(1920),n=X(1080),o=X(1920),l=X(1080),u=X("manual"),c=X(30),_=X(5e3),x=X(128),S=X(0),w=X(!1),C=X(!1);const F={"2160p":{width:3840,height:2160},"1440p":{width:2560,height:1440},"1080p":{width:1920,height:1080},"720p":{width:1280,height:720},"480p":{width:854,height:480},"360p":{width:640,height:360}},B=R=>{const P=R.target;D(h,P.files?.[0]??null)};function K(){const R=U(f)[U(d)]?.config_json??U(f)[U(d)];if(R&&(D(T,R.container??"mp4"),D(I,R.codec??"avc1.640028"),D(g,R.audioCodec??"mp4a.40.2"),D(_,(R.bitrate??5e6)/1e3),D(x,(R.audio_bitrate??128e3)/1e3),D(c,R.framerate??30),R.width&&R.height)){D(e,R.width),D(n,R.height);const P=Object.entries(F).find(([ve,Vt])=>Vt.width===R.width&&Vt.height===R.height);P&&D(t,P[0])}}async function O(){if(!U(h))return;D(A,""),D(E,!0);let R,P;if(U(M)==="preset"){const ee=F[U(t)];R=ee.width,P=ee.height}else U(M)==="manual"?(R=U(e),P=U(n)):U(M)==="width-only"?(R=U(o),P=void 0):U(M)==="height-only"&&(R=void 0,P=U(l));const ve={video:{codec:U(I),width:R,height:P,bitrate:U(_)*1e3,framerate:U(c),framerateMode:U(u),rotation:U(S),flipHorizontal:U(w),flipVertical:U(C)},audio:{codec:U(g),sampleRate:44100,numberOfChannels:2,bitrate:U(x)*1e3}},Vt=performance.now();await Nl(U(h),ve,(ee,Ne)=>{ee!==void 0&&D(v,ee),Ne&&(D(s,Ne.fps),D(m,Ne.elapsedMs),D(y,Ne.etaMs??0))});const ge=performance.now(),Oe={process_time_ms:Math.round(ge-Vt),source_size_byte:U(h).size,avg_fps:U(s)};D(A,` (: ${Oe.process_time_ms}ms, FPS: ${Oe.avg_fps.toFixed(1)})`),D(E,!1)}No(()=>{D(f,Hl())}),Oo();var et=nh(),at=z(k(et),2),ft=k(at),ct=z(at,2);{var kt=R=>{var P=Vl(),ve=k(P),Vt=k(ve);dt(ge=>qe(Vt,`: ${U(h).name??""} (${ge??""} MB)`),[()=>(U(h).size/1024/1024).toFixed(2)]),Q(R,P)};St(ct,R=>{U(h)&&R(kt)})}var Re=z(ct,2);{var ei=R=>{var P=eh(),ve=Ye(P),Vt=k(ve),ge=z(k(Vt),2);dt(()=>{U(p),jt(()=>{})});var Oe=k(ge);Oe.value=Oe.__value=!0;var ee=z(Oe);ee.value=ee.__value=!1;var Ne=z(Vt,2);{var Js=it=>{var At=ql(),Tt=z(k(At),2);dt(()=>{U(d),jt(()=>{U(f)})}),Po(Tt,5,()=>U(f),zo,(Dt,ye,me)=>{var It=Yl(),Ge=k(It);It.value=It.__value=me,dt(()=>qe(Ge,U(ye).name)),Q(Dt,It)}),Wt(Tt,()=>U(d),Dt=>D(d,Dt)),si("change",Tt,K),Q(it,At)};St(Ne,it=>{U(p)&&it(Js)})}var sr=z(ve,2);{var Qs=it=>{var At=$l(),Tt=Ye(At),Dt=z(k(Tt),2),ye=z(k(Dt),2);dt(()=>{U(T),jt(()=>{})});var me=k(ye);me.value=me.__value="mp4";var It=z(me);It.value=It.__value="mov";var Ge=z(It);Ge.value=Ge.__value="webm";var Pi=z(Dt,2),ki=z(k(Pi),2);dt(()=>{U(I),jt(()=>{})});var ie=k(ki),ne=k(ie);ne.value=ne.__value="avc1.640028";var xe=z(ne,2);xe.value=xe.__value="avc1.4d001f";var ii=z(xe,2);ii.value=ii.__value="avc1.42001f";var hr=z(ii,2);hr.value=hr.__value="avc1.42001e";var fr=z(ie),tn=k(fr);tn.value=tn.__value="hev1.1.6.L93.B0";var dr=z(tn,2);dr.value=dr.__value="hvc1.1.6.L93.B0";var ur=z(fr),en=k(ur);en.value=en.__value="vp09.00.31.08";var pr=z(en,2);pr.value=pr.__value="vp09.00.41.08";var na=z(ur),nn=k(na);nn.value=nn.__value="av01.0.05M.08";var cr=z(nn,2);cr.value=cr.__value="av01.0.04M.08";var _r=z(Pi,2),vr=z(k(_r),2);dt(()=>{U(g),jt(()=>{})});var gr=k(vr),rn=k(gr);rn.value=rn.__value="mp4a.40.2";var yr=z(rn,2);yr.value=yr.__value="mp4a.40.5";var ra=z(gr),mr=k(ra);mr.value=mr.__value="opus";var xr=z(_r,2),br=z(k(xr),2);dt(()=>{U(M),jt(()=>{})});var sn=k(br);sn.value=sn.__value="preset";var an=z(sn);an.value=an.__value="manual";var on=z(an);on.value=on.__value="width-only";var Sr=z(on);Sr.value=Sr.__value="height-only";var wr=z(xr,2);{var sa=Y=>{var re=jl(),He=z(k(re),2);dt(()=>{U(t),jt(()=>{})});var be=k(He);be.value=be.__value="2160p";var ni=z(be);ni.value=ni.__value="1440p";var Mt=z(ni);Mt.value=Mt.__value="1080p";var Yt=z(Mt);Yt.value=Yt.__value="720p";var se=z(Yt);se.value=se.__value="480p";var Ve=z(se);Ve.value=Ve.__value="360p",Wt(He,()=>U(t),ri=>D(t,ri)),Q(Y,re)},aa=Y=>{var re=_n(),He=Ye(re);{var be=Mt=>{var Yt=Wl(),se=Ye(Yt),Ve=z(k(se),2),ri=z(se,2),ae=z(k(ri),2);Se(Ve,()=>U(e),qt=>D(e,qt)),Se(ae,()=>U(n),qt=>D(n,qt)),Q(Mt,Yt)},ni=Mt=>{var Yt=_n(),se=Ye(Yt);{var Ve=ae=>{var qt=Kl(),un=z(k(qt),2);Se(un,()=>U(o),pn=>D(o,pn)),Q(ae,qt)},ri=ae=>{var qt=_n(),un=Ye(qt);{var pn=cn=>{var Pr=Xl(),ga=z(k(Pr),2);Se(ga,()=>U(l),ya=>D(l,ya)),Q(cn,Pr)};St(un,cn=>{U(M)==="height-only"&&cn(pn)},!0)}Q(ae,qt)};St(se,ae=>{U(M)==="width-only"?ae(Ve):ae(ri,!1)},!0)}Q(Mt,Yt)};St(He,Mt=>{U(M)==="manual"?Mt(be):Mt(ni,!1)},!0)}Q(Y,re)};St(wr,Y=>{U(M)==="preset"?Y(sa):Y(aa,!1)})}var Ur=z(wr,2),Er=z(k(Ur),2);dt(()=>{U(u),jt(()=>{})});var ln=k(Er);ln.value=ln.__value="original";var Br=z(ln);Br.value=Br.__value="manual";var Cr=z(Ur,2);{var oa=Y=>{var re=Zl(),He=z(k(re),2);Se(He,()=>U(c),be=>D(c,be)),Q(Y,re)};St(Cr,Y=>{U(u)==="manual"&&Y(oa)})}var Ar=z(Cr,2),la=z(k(Ar),2),ha=z(Ar,2),fa=z(k(ha),2),da=z(Tt,2),Tr=z(k(da),4),Ir=z(k(Tr),2);dt(()=>{U(S),jt(()=>{})});var hn=k(Ir);hn.value=hn.__value=0;var fn=z(hn);fn.value=fn.__value=90;var dn=z(fn);dn.value=dn.__value=180;var zr=z(dn);zr.value=zr.__value=270;var ua=z(Tr,2),pa=z(k(ua),2),Fr=k(pa),ca=k(Fr),_a=z(Fr,2),va=k(_a);Wt(ye,()=>U(T),Y=>D(T,Y)),Wt(ki,()=>U(I),Y=>D(I,Y)),Wt(vr,()=>U(g),Y=>D(g,Y)),Wt(br,()=>U(M),Y=>D(M,Y)),Wt(Er,()=>U(u),Y=>D(u,Y)),Se(la,()=>U(_),Y=>D(_,Y)),Se(fa,()=>U(x),Y=>D(x,Y)),Wt(Ir,()=>U(S),Y=>D(S,Y)),qr(ca,()=>U(w),Y=>D(w,Y)),qr(va,()=>U(C),Y=>D(C,Y)),Q(it,At)};St(sr,it=>{U(p)||it(Qs)})}var ar=z(sr,2),or=k(ar),lr=z(ar,2);{var ta=it=>{var At=Ql(),Tt=k(At),Dt=k(Tt),ye=z(Tt,2),me=k(ye),It=z(ye,2),Ge=k(It),Pi=z(It,2);{var ki=ie=>{var ne=Jl(),xe=k(ne);dt(ii=>qe(xe,`: ${ii??""}s`),[()=>(U(y)/1e3).toFixed(1)]),Q(ie,ne)};St(Pi,ie=>{U(y)>0&&U(v)<100&&ie(ki)})}dt((ie,ne,xe)=>{Mo(Dt,`width:${U(v)??""}%`),qe(me,`: ${ie??""}%`),qe(Ge,`FPS: ${ne??""} | : ${xe??""}s`)},[()=>Math.round(U(v)),()=>U(s)>0?U(s).toFixed(1):"-",()=>(U(m)/1e3).toFixed(1)]),Q(it,At)};St(lr,it=>{U(E)&&it(ta)})}var ea=z(lr,2);{var ia=it=>{var At=th(),Tt=k(At),Dt=k(Tt);dt(()=>qe(Dt,U(A))),Q(it,At)};St(ea,it=>{U(A)&&it(ia)})}dt(()=>or.disabled=!U(h)||U(E)),Wt(ge,()=>U(p),it=>D(p,it)),si("change",ge,()=>U(p)&&K()),si("click",or,O),Q(R,P)},Lt=R=>{var P=ih();Q(R,P)};St(Re,R=>{U(f).length>0?R(ei):R(Lt,!1)})}si("change",ft,B),si("click",at,()=>document.getElementById("fileInput")?.click()),Q(r,et),rs()}Co(rh,{target:document.getElementById("app")});
